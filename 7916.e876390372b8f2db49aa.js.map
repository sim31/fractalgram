{"version":3,"file":"7916.e876390372b8f2db49aa.js","mappings":"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,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,EAAG,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,IAAK,GAE5qCC,EAAY,CAAC,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,G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","sources":["webpack://telegram-t/./src/components/common/AnimatedIconFromSticker.tsx","webpack://telegram-t/./src/components/common/AnimatedIconWithPreview.module.scss?eca8","webpack://telegram-t/./src/components/common/AnimatedIconWithPreview.tsx","webpack://telegram-t/./src/components/common/helpers/waveform.ts","webpack://telegram-t/./src/util/waveform.ts","webpack://telegram-t/./src/components/common/Audio.tsx","webpack://telegram-t/./src/components/common/ChatExtra.tsx","webpack://telegram-t/./src/components/common/DeleteChatModal.tsx","webpack://telegram-t/./src/components/common/Document.tsx","webpack://telegram-t/./src/components/common/DotAnimation.tsx","webpack://telegram-t/./src/components/common/FakeIcon.tsx","webpack://telegram-t/./src/components/common/File.tsx","webpack://telegram-t/./src/components/common/GroupChatInfo.tsx","webpack://telegram-t/./src/components/common/LastMessageMeta.tsx","webpack://telegram-t/./src/components/common/Media.tsx","webpack://telegram-t/./src/components/common/MessageOutgoingStatus.tsx","webpack://telegram-t/./src/components/common/NothingFound.tsx","webpack://telegram-t/./src/components/common/PasswordForm.tsx","webpack://telegram-t/./src/components/common/Picker.tsx","webpack://telegram-t/./src/components/common/PickerSelectedItem.tsx","webpack://telegram-t/./src/components/common/PremiumIcon.tsx","webpack://telegram-t/./src/components/common/PrivateChatInfo.tsx","webpack://telegram-t/./src/components/common/ProfilePhoto.tsx","webpack://telegram-t/./src/components/common/ProfileInfo.tsx","webpack://telegram-t/./src/components/common/hooks/usePhotosPreload.ts","webpack://telegram-t/./src/components/common/ReactionStaticEmoji.tsx","webpack://telegram-t/./src/components/common/ReportModal.tsx","webpack://telegram-t/./src/components/common/StickerButton.tsx","webpack://telegram-t/./src/components/common/StickerSetModal.async.tsx","webpack://telegram-t/./src/components/common/TypingStatus.tsx","webpack://telegram-t/./src/components/common/VerifiedIcon.tsx","webpack://telegram-t/./src/components/common/WebLink.tsx","webpack://telegram-t/./src/components/common/helpers/mediaDimensions.ts","webpack://telegram-t/./src/components/left/ChatFolderModal.async.tsx","webpack://telegram-t/./src/components/left/main/hooks/useChatAnimationType.ts","webpack://telegram-t/./src/components/left/main/Badge.tsx","webpack://telegram-t/./src/components/left/main/ChatCallStatus.tsx","webpack://telegram-t/./src/components/left/main/Chat.tsx","webpack://telegram-t/./src/components/left/main/EmptyFolder.tsx","webpack://telegram-t/./src/components/left/main/ChatList.tsx","webpack://telegram-t/./src/components/left/search/helpers/getSenderName.ts","webpack://telegram-t/./src/components/middle/composer/CustomSendMenu.async.tsx","webpack://telegram-t/./src/components/middle/composer/DropTarget.tsx","webpack://telegram-t/./src/components/middle/composer/DropArea.tsx","webpack://telegram-t/./src/components/middle/composer/EmojiTooltip.async.tsx","webpack://telegram-t/./src/components/middle/composer/MessageInput.tsx","webpack://telegram-t/./src/components/middle/composer/TextFormatter.tsx","webpack://telegram-t/./src/util/getKeyFromEvent.ts","webpack://telegram-t/./src/components/middle/composer/helpers/getFilesFromDataTransferItems.ts","webpack://telegram-t/./src/components/middle/composer/helpers/prepareForRegExp.ts","webpack://telegram-t/./src/components/middle/composer/helpers/selection.ts","webpack://telegram-t/./src/util/memoized.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useEmojiTooltip.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useMentionTooltip.ts","webpack://telegram-t/./src/components/right/hooks/useAsyncRendering.ts","webpack://telegram-t/./src/components/ui/CheckboxGroup.tsx","webpack://telegram-t/./src/components/ui/ConfirmDialog.tsx","webpack://telegram-t/./src/components/ui/FloatingActionButton.tsx","webpack://telegram-t/./src/components/ui/ListItem.tsx","webpack://telegram-t/./src/components/ui/Notification.tsx","webpack://telegram-t/./src/components/ui/ProgressSpinner.tsx","webpack://telegram-t/./src/components/ui/Radio.tsx","webpack://telegram-t/./src/components/ui/RadioGroup.tsx","webpack://telegram-t/./src/components/ui/RangeSlider.tsx","webpack://telegram-t/./src/components/ui/SearchInput.tsx","webpack://telegram-t/./src/components/ui/ShowTransition.tsx","webpack://telegram-t/./src/components/ui/Skeleton.tsx","webpack://telegram-t/./src/components/ui/Switcher.tsx","webpack://telegram-t/./src/components/ui/Tab.tsx","webpack://telegram-t/./src/components/ui/TabList.tsx","webpack://telegram-t/./src/hooks/reducers/useFoldersReducer.ts","webpack://telegram-t/./src/hooks/useAudioPlayer.ts","webpack://telegram-t/./src/hooks/useBuffering.ts","webpack://telegram-t/./src/hooks/useCanvasBlur.ts","webpack://telegram-t/./src/hooks/useChatContextActions.ts","webpack://telegram-t/./src/hooks/useContextMenuHandlers.ts","webpack://telegram-t/./src/hooks/useContextMenuPosition.ts","webpack://telegram-t/./src/hooks/useEnsureMessage.ts","webpack://telegram-t/./src/hooks/useFolderManager.ts","webpack://telegram-t/./src/hooks/useHorizontalScroll.ts","webpack://telegram-t/./src/hooks/useHotkeys.ts","webpack://telegram-t/./src/util/parseHotkey.ts","webpack://telegram-t/./src/hooks/useInputFocusOnOpen.ts","webpack://telegram-t/./src/hooks/useLayoutEffectWithPrevDeps.ts","webpack://telegram-t/./src/hooks/useUniqueId.ts","webpack://telegram-t/./src/hooks/useMediaWithLoadProgress.ts","webpack://telegram-t/./src/hooks/useMouseInside.ts","webpack://telegram-t/./src/hooks/usePrevDuringAnimation.ts","webpack://telegram-t/./src/hooks/useReducer.ts","webpack://telegram-t/./src/hooks/useRunDebounced.ts","webpack://telegram-t/./src/components/common/CalendarModal.async.tsx","webpack://telegram-t/./src/hooks/useSchedule.tsx","webpack://telegram-t/./src/hooks/useSendMessageAction.ts","webpack://telegram-t/./src/hooks/useStateRef.ts","webpack://telegram-t/./src/hooks/useTimeout.ts","webpack://telegram-t/./src/hooks/useVideoCleanup.ts","webpack://telegram-t/./src/lib/fastBlur.js","webpack://telegram-t/./src/util/audioPlayer.ts","webpack://telegram-t/./src/util/captureEvents.ts","webpack://telegram-t/./src/util/lethargy.ts","webpack://telegram-t/./src/util/colors.ts","webpack://telegram-t/./src/util/cycleRestrict.ts","webpack://telegram-t/./src/util/fastSmoothScroll.ts","webpack://telegram-t/./src/util/fastSmoothScrollHorizontal.ts","webpack://telegram-t/./src/util/focusEditableElement.ts","webpack://telegram-t/./src/util/getMessageIdsForSelectedText.ts","webpack://telegram-t/./src/util/isElementInViewport.ts","webpack://telegram-t/./src/util/mediaSession.ts","webpack://telegram-t/./src/util/parseMessageInput.ts","webpack://telegram-t/./src/util/patchSafariProgressiveAudio.ts","webpack://telegram-t/./src/util/stopEvent.ts","webpack://telegram-t/./src/util/systemFilesDialog.ts","webpack://telegram-t/./src/util/themeStyle.ts"],"sourcesContent":["import React, { memo } from '../../lib/teact/teact';\n\nimport type { OwnProps as AnimatedIconProps } from './AnimatedIcon';\nimport type { ApiSticker } from '../../api/types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport useMedia from '../../hooks/useMedia';\n\nimport AnimatedIconWithPreview from './AnimatedIconWithPreview';\n\ntype OwnProps =\n  Partial<AnimatedIconProps>\n  & { sticker?: ApiSticker; noLoad?: boolean; forcePreview?: boolean; lastSyncTime?: number };\n\nfunction AnimatedIconFromSticker(props: OwnProps) {\n  const {\n    sticker, noLoad, forcePreview, lastSyncTime, ...otherProps\n  } = props;\n\n  const thumbDataUri = sticker?.thumbnail?.dataUri;\n  const localMediaHash = `sticker${sticker?.id}`;\n  const previewBlobUrl = useMedia(\n    sticker ? `${localMediaHash}?size=m` : undefined,\n    noLoad && !forcePreview,\n    ApiMediaFormat.BlobUrl,\n    lastSyncTime,\n  );\n  const tgsUrl = useMedia(localMediaHash, noLoad, undefined, lastSyncTime);\n\n  return (\n    <AnimatedIconWithPreview\n      tgsUrl={tgsUrl}\n      previewUrl={previewBlobUrl}\n      thumbDataUri={thumbDataUri}\n      // eslint-disable-next-line react/jsx-props-no-spreading\n      {...otherProps}\n    />\n  );\n}\n\nexport default memo(AnimatedIconFromSticker);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"src-components-common-AnimatedIconWithPreview-module__root\",\"preview\":\"src-components-common-AnimatedIconWithPreview-module__preview\"};","import React, { memo } from '../../lib/teact/teact';\n\nimport type { OwnProps as AnimatedIconProps } from './AnimatedIcon';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useMediaTransition from '../../hooks/useMediaTransition';\nimport AnimatedIcon from './AnimatedIcon';\nimport styles from './AnimatedIconWithPreview.module.scss';\nimport useFlag from '../../hooks/useFlag';\nimport buildStyle from '../../util/buildStyle';\n\ntype OwnProps =\n  Partial<AnimatedIconProps>\n  & { previewUrl?: string; thumbDataUri?: string };\n\nfunction AnimatedIconWithPreview(props: OwnProps) {\n  const {\n    previewUrl, thumbDataUri, className, ...otherProps\n  } = props;\n\n  const transitionClassNames = useMediaTransition(previewUrl);\n  const [isAnimationReady, markAnimationReady] = useFlag(false);\n  const { size } = props;\n\n  return (\n    <div\n      className={buildClassName(className, styles.root)}\n      style={buildStyle(size !== undefined && `width: ${size}px; height: ${size}px;`)}\n    >\n      {!isAnimationReady && thumbDataUri && (\n        // eslint-disable-next-line jsx-a11y/alt-text\n        <img src={thumbDataUri} className={buildClassName(styles.preview)} />\n      )}\n      {!isAnimationReady && (\n        // eslint-disable-next-line jsx-a11y/alt-text\n        <img src={previewUrl} className={buildClassName(styles.preview, transitionClassNames)} />\n      )}\n      {/* eslint-disable-next-line react/jsx-props-no-spreading */}\n      <AnimatedIcon {...otherProps} onLoad={markAnimationReady} noTransition />\n    </div>\n  );\n}\n\nexport default memo(AnimatedIconWithPreview);\n","type IWaveformProps = {\n  peak: number;\n  fillStyle: string;\n  progressFillStyle: string;\n};\n\nexport const MAX_EMPTY_WAVEFORM_POINTS = 30;\nconst SPIKE_WIDTH = 2;\nconst SPIKE_STEP = 4;\nconst SPIKE_RADIUS = 1;\nconst HEIGHT = 23;\n\nexport function renderWaveform(\n  canvas: HTMLCanvasElement,\n  spikes: number[],\n  progress: number,\n  {\n    peak, fillStyle, progressFillStyle,\n  }: IWaveformProps,\n) {\n  const width = spikes.length * SPIKE_STEP;\n  const height = HEIGHT;\n\n  canvas.width = width * 2;\n  canvas.height = height * 2;\n  canvas.style.width = `${width}px`;\n  canvas.style.height = `${height}px`;\n\n  const ctx = canvas.getContext('2d')!;\n  ctx.scale(2, 2);\n\n  spikes.forEach((item, i) => {\n    ctx.globalAlpha = (i / spikes.length >= progress) ? 0.5 : 1;\n    ctx.fillStyle = progress > i / spikes.length ? progressFillStyle : fillStyle;\n    const spikeHeight = Math.max(2, HEIGHT * (item / Math.max(1, peak)));\n    roundedRectangle(ctx, i * SPIKE_STEP, (height + spikeHeight) / 2, SPIKE_WIDTH, spikeHeight, SPIKE_RADIUS);\n    ctx.fill();\n  });\n}\n\nfunction roundedRectangle(\n  ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number,\n) {\n  if (width < 2 * radius) {\n    radius = width / 2;\n  }\n  if (height < 2 * radius) {\n    radius = height / 2;\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + radius, y);\n  ctx.arcTo(x + width, y, x + width, y - height, radius);\n  ctx.arcTo(x + width, y - height, x, y - height, radius);\n  ctx.arcTo(x, y - height, x, y, radius);\n  ctx.arcTo(x, y, x + width, y, radius);\n  ctx.closePath();\n}\n","/* eslint-disable no-bitwise */\n\n// eslint-disable-next-line max-len\n// Ref: https://github.com/telegramdesktop/tdesktop/blob/0743e71ab6b928d2ee5bae1aed991849b1e2b291/Telegram/SourceFiles/data/data_document.cpp#L1018\nexport function decodeWaveform(encoded5bit: Uint8Array) {\n  const bitsCount = encoded5bit.length * 8;\n  const valuesCount = Math.floor(bitsCount / 5);\n  if (!valuesCount) {\n    return [];\n  }\n\n  // Read each 5 bit of encoded5bit as 0-31 unsigned char.\n  // We count the index of the byte in which the desired 5-bit sequence starts.\n  // And then we read a uint16 starting from that byte to guarantee to get all of those 5 bits.\n  //\n  // BUT! if it is the last byte we have, we're not allowed to read a uint16 starting with it.\n  // Because it will be an overflow (we'll access one byte after the available memory).\n  // We see, that only the last 5 bits could start in the last available byte and be problematic.\n  // So we read in a general way all the entries in a general way except the last one.\n  const result = Array(valuesCount);\n  const bitsData = encoded5bit;\n  for (let i = 0, l = valuesCount - 1; i !== l; ++i) {\n    const byteIndex = Math.floor((i * 5) / 8);\n    const bitShift = Math.floor((i * 5) % 8);\n    const value = bitsData[byteIndex] + (bitsData[byteIndex + 1] << 8);\n    result[i] = ((value >> bitShift) & 0x1F);\n  }\n  const lastByteIndex = Math.floor(((valuesCount - 1) * 5) / 8);\n  const lastBitShift = Math.floor(((valuesCount - 1) * 5) % 8);\n  const lastValue = bitsData[lastByteIndex] + (bitsData[lastByteIndex + 1] << 8);\n  result[valuesCount - 1] = (lastValue >> lastBitShift) & 0x1F;\n\n  return result;\n}\n\nexport function interpolateArray(data: number[], fitCount: number) {\n  let peak = 0;\n  const newData = new Array(fitCount);\n  const springFactor = data.length / fitCount;\n  const leftFiller = data[0];\n  const rightFiller = data[data.length - 1];\n  for (let i = 0; i < fitCount; i++) {\n    const idx = Math.floor(i * springFactor);\n    const val = ((data[idx - 1] ?? leftFiller) + (data[idx] ?? leftFiller) + (data[idx + 1] ?? rightFiller)) / 3;\n    newData[i] = val;\n    if (peak < val) {\n      peak = val;\n    }\n  }\n  return { data: newData, peak };\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiAudio, ApiMessage, ApiVoice } from '../../api/types';\nimport { ApiMediaFormat } from '../../api/types';\nimport type { ISettings } from '../../types';\nimport { AudioOrigin } from '../../types';\n\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../util/environment';\nimport { formatMediaDateTime, formatMediaDuration, formatPastTimeShort } from '../../util/dateFormat';\nimport {\n  getMediaDuration,\n  getMediaTransferState,\n  getMessageMediaFormat,\n  getMessageMediaHash,\n  isMessageLocal,\n  isOwnMessage,\n} from '../../global/helpers';\nimport { MAX_EMPTY_WAVEFORM_POINTS, renderWaveform } from './helpers/waveform';\nimport buildClassName from '../../util/buildClassName';\nimport renderText from './helpers/renderText';\nimport { getFileSizeString } from './helpers/documentInfo';\nimport { decodeWaveform, interpolateArray } from '../../util/waveform';\nimport useMediaWithLoadProgress from '../../hooks/useMediaWithLoadProgress';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport type { BufferedRange } from '../../hooks/useBuffering';\nimport useBuffering from '../../hooks/useBuffering';\nimport useAudioPlayer from '../../hooks/useAudioPlayer';\nimport type { LangFn } from '../../hooks/useLang';\nimport useLang from '../../hooks/useLang';\nimport { captureEvents } from '../../util/captureEvents';\nimport useMedia from '../../hooks/useMedia';\nimport { makeTrackId } from '../../util/audioPlayer';\nimport { getTranslation } from '../../util/langProvider';\n\nimport Button from '../ui/Button';\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport Link from '../ui/Link';\n\nimport './Audio.scss';\n\ntype OwnProps = {\n  theme: ISettings['theme'];\n  message: ApiMessage;\n  senderTitle?: string;\n  uploadProgress?: number;\n  origin: AudioOrigin;\n  date?: number;\n  lastSyncTime?: number;\n  noAvatars?: boolean;\n  className?: string;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  isDownloading: boolean;\n  isTranscribing?: boolean;\n  isTranscribed?: boolean;\n  canDownload?: boolean;\n  canTranscribe?: boolean;\n  isTranscriptionHidden?: boolean;\n  isTranscriptionError?: boolean;\n  onHideTranscription?: (isHidden: boolean) => void;\n  onPlay: (messageId: number, chatId: string) => void;\n  onReadMedia?: () => void;\n  onCancelUpload?: () => void;\n  onDateClick?: (messageId: number, chatId: string) => void;\n};\n\nexport const TINY_SCREEN_WIDTH_MQL = window.matchMedia('(max-width: 375px)');\nexport const WITH_AVATAR_TINY_SCREEN_WIDTH_MQL = window.matchMedia('(max-width: 410px)');\nconst AVG_VOICE_DURATION = 10;\n// This is needed for browsers requiring user interaction before playing.\nconst PRELOAD = true;\n// eslint-disable-next-line max-len\nconst TRANSCRIBE_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 24\" class=\"loading-svg\"><rect class=\"loading-rect\" fill=\"transparent\" width=\"32\" height=\"24\" stroke-width=\"3\" stroke-linejoin=\"round\" rx=\"6\" ry=\"6\" stroke=\"var(--accent-color)\" stroke-dashoffset=\"1\" stroke-dasharray=\"32,68\"></rect></svg>';\n\nconst Audio: FC<OwnProps> = ({\n  theme,\n  message,\n  senderTitle,\n  uploadProgress,\n  origin,\n  date,\n  lastSyncTime,\n  noAvatars,\n  className,\n  isSelectable,\n  isSelected,\n  isDownloading,\n  isTranscribing,\n  isTranscriptionHidden,\n  isTranscribed,\n  isTranscriptionError,\n  canDownload,\n  canTranscribe,\n  onHideTranscription,\n  onPlay,\n  onReadMedia,\n  onCancelUpload,\n  onDateClick,\n}) => {\n  const { cancelMessageMediaDownload, downloadMessageMedia, transcribeAudio } = getActions();\n\n  const { content: { audio, voice, video }, isMediaUnread } = message;\n  const isVoice = Boolean(voice || video);\n  const isSeeking = useRef<boolean>(false);\n  // eslint-disable-next-line no-null/no-null\n  const seekerRef = useRef<HTMLDivElement>(null);\n  const lang = useLang();\n  const { isRtl } = lang;\n\n  const [isActivated, setIsActivated] = useState(false);\n  const shouldLoad = (isActivated || PRELOAD) && lastSyncTime;\n  const coverHash = getMessageMediaHash(message, 'pictogram');\n  const coverBlobUrl = useMedia(coverHash, false, ApiMediaFormat.BlobUrl);\n\n  const mediaData = useMedia(\n    getMessageMediaHash(message, 'inline'),\n    !shouldLoad,\n    getMessageMediaFormat(message, 'inline'),\n  );\n\n  const { loadProgress: downloadProgress } = useMediaWithLoadProgress(\n    getMessageMediaHash(message, 'download'),\n    !isDownloading,\n  );\n\n  const handleForcePlay = useCallback(() => {\n    setIsActivated(true);\n    onPlay(message.id, message.chatId);\n  }, [message, onPlay]);\n\n  const handleTrackChange = useCallback(() => {\n    setIsActivated(false);\n  }, []);\n\n  const {\n    isBuffered, bufferedRanges, bufferingHandlers, checkBuffering,\n  } = useBuffering();\n\n  const {\n    isPlaying, playProgress, playPause, setCurrentTime, duration,\n  } = useAudioPlayer(\n    makeTrackId(message),\n    getMediaDuration(message)!,\n    isVoice ? 'voice' : 'audio',\n    mediaData,\n    bufferingHandlers,\n    undefined,\n    checkBuffering,\n    isActivated,\n    handleForcePlay,\n    handleTrackChange,\n    isMessageLocal(message),\n  );\n\n  const isOwn = isOwnMessage(message);\n  const waveformCanvasRef = useWaveformCanvas(\n    theme, voice, (isMediaUnread && !isOwn) ? 1 : playProgress, isOwn, !noAvatars,\n  );\n\n  const withSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n\n  useEffect(() => {\n    setIsActivated(isPlaying);\n  }, [isPlaying]);\n\n  const isLoadingForPlaying = isActivated && !isBuffered;\n\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(\n    message,\n    uploadProgress || downloadProgress,\n    isLoadingForPlaying || isDownloading,\n  );\n\n  const {\n    shouldRender: shouldRenderSpinner,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransition(isTransferring);\n\n  const shouldRenderCross = shouldRenderSpinner && (isLoadingForPlaying || isUploading);\n\n  const handleButtonClick = useCallback(() => {\n    if (isUploading) {\n      onCancelUpload?.();\n      return;\n    }\n\n    if (!isPlaying) {\n      onPlay(message.id, message.chatId);\n    }\n\n    getActions().setAudioPlayerOrigin({ origin });\n    setIsActivated(!isActivated);\n    playPause();\n  }, [isUploading, isPlaying, isActivated, playPause, onCancelUpload, onPlay, message.id, message.chatId, origin]);\n\n  useEffect(() => {\n    if (onReadMedia && isMediaUnread && (isPlaying || isDownloading)) {\n      onReadMedia();\n    }\n  }, [isPlaying, isMediaUnread, onReadMedia, isDownloading]);\n\n  const handleDownloadClick = useCallback(() => {\n    if (isDownloading) {\n      cancelMessageMediaDownload({ message });\n    } else {\n      downloadMessageMedia({ message });\n    }\n  }, [cancelMessageMediaDownload, downloadMessageMedia, isDownloading, message]);\n\n  const handleSeek = useCallback((e: MouseEvent | TouchEvent) => {\n    if (isSeeking.current && seekerRef.current) {\n      const { width, left } = seekerRef.current.getBoundingClientRect();\n      const clientX = e instanceof MouseEvent ? e.clientX : e.targetTouches[0].clientX;\n      e.stopPropagation(); // Prevent Slide-to-Reply activation\n      // Prevent track skipping while seeking near end\n      setCurrentTime(Math.max(Math.min(duration * ((clientX - left) / width), duration - 0.1), 0.001));\n    }\n  }, [duration, setCurrentTime]);\n\n  const handleStartSeek = useCallback((e: MouseEvent | TouchEvent) => {\n    if (e instanceof MouseEvent && e.button === 2) return;\n    isSeeking.current = true;\n    handleSeek(e);\n  }, [handleSeek]);\n\n  const handleStopSeek = useCallback(() => {\n    isSeeking.current = false;\n  }, []);\n\n  const handleDateClick = useCallback(() => {\n    onDateClick!(message.id, message.chatId);\n  }, [onDateClick, message.id, message.chatId]);\n\n  const handleTranscribe = useCallback(() => {\n    transcribeAudio({ chatId: message.chatId, messageId: message.id });\n  }, [message.chatId, message.id, transcribeAudio]);\n\n  useEffect(() => {\n    if (!seekerRef.current || !withSeekline) return undefined;\n    return captureEvents(seekerRef.current, {\n      onCapture: handleStartSeek,\n      onRelease: handleStopSeek,\n      onClick: handleStopSeek,\n      onDrag: handleSeek,\n    });\n  }, [withSeekline, handleStartSeek, handleSeek, handleStopSeek]);\n\n  const transcribeSvgMemo = useMemo(() => (\n    <div dangerouslySetInnerHTML={{ __html: TRANSCRIBE_SVG }} />\n  ), []);\n\n  function renderFirstLine() {\n    if (isVoice) {\n      return senderTitle || 'Voice';\n    }\n\n    const { title, fileName } = audio!;\n\n    return title || fileName;\n  }\n\n  function renderSecondLine() {\n    if (isVoice) {\n      return (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          {formatMediaDuration((voice || video)!.duration)}\n        </div>\n      );\n    }\n\n    const { performer } = audio!;\n\n    return (\n      <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n        {formatMediaDuration(duration)}\n        <span className=\"bullet\">&bull;</span>\n        {performer && <span className=\"performer\" title={performer}>{renderText(performer)}</span>}\n        {performer && senderTitle && <span className=\"bullet\">&bull;</span>}\n        {senderTitle && <span title={senderTitle}>{renderText(senderTitle)}</span>}\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'Audio',\n    className,\n    isOwn && origin === AudioOrigin.Inline && 'own',\n    (origin === AudioOrigin.Search || origin === AudioOrigin.SharedMedia) && 'bigger',\n    isSelected && 'audio-is-selected',\n  );\n\n  const buttonClassNames = ['toggle-play'];\n  if (shouldRenderCross) {\n    buttonClassNames.push('loading');\n  } else {\n    buttonClassNames.push(isPlaying ? 'pause' : 'play');\n  }\n\n  const contentClassName = buildClassName('content', withSeekline && 'with-seekline');\n\n  function renderWithTitle() {\n    return (\n      <div className={contentClassName}>\n        <div className=\"content-row\">\n          <p className=\"title\" dir=\"auto\" title={renderFirstLine()}>{renderText(renderFirstLine())}</p>\n\n          <div className=\"message-date\">\n            {date && (\n              <Link\n                className=\"date\"\n                onClick={handleDateClick}\n              >\n                {formatPastTimeShort(lang, date * 1000)}\n              </Link>\n            )}\n          </div>\n        </div>\n\n        {withSeekline && (\n          <div className=\"meta search-result\" dir={isRtl ? 'rtl' : undefined}>\n            <span className=\"duration with-seekline\" dir=\"auto\">\n              {playProgress < 1 && `${formatMediaDuration(duration * playProgress, duration)}`}\n            </span>\n            {renderSeekline(playProgress, bufferedRanges, seekerRef)}\n          </div>\n        )}\n        {!withSeekline && renderSecondLine()}\n      </div>\n    );\n  }\n\n  return (\n    <div className={fullClassName} dir={lang.isRtl ? 'rtl' : 'ltr'}>\n      {isSelectable && (\n        <div className=\"message-select-control\">\n          {isSelected && <i className=\"icon-select\" />}\n        </div>\n      )}\n      <Button\n        round\n        ripple={!IS_SINGLE_COLUMN_LAYOUT}\n        size=\"smaller\"\n        color={coverBlobUrl ? 'translucent-white' : 'primary'}\n        className={buttonClassNames.join(' ')}\n        ariaLabel={isPlaying ? 'Pause audio' : 'Play audio'}\n        onClick={handleButtonClick}\n        isRtl={lang.isRtl}\n        backgroundImage={coverBlobUrl}\n      >\n        <i className=\"icon-play\" />\n        <i className=\"icon-pause\" />\n      </Button>\n      {shouldRenderSpinner && (\n        <div className={buildClassName('media-loading', spinnerClassNames, shouldRenderCross && 'interactive')}>\n          <ProgressSpinner\n            progress={transferProgress}\n            transparent\n            size=\"m\"\n            onClick={shouldRenderCross ? handleButtonClick : undefined}\n            noCross={!shouldRenderCross}\n          />\n        </div>\n      )}\n      {audio && canDownload && !isUploading && (\n        <Button\n          round\n          size=\"tiny\"\n          className=\"download-button\"\n          ariaLabel={isDownloading ? 'Cancel download' : 'Download'}\n          onClick={handleDownloadClick}\n        >\n          <i className={isDownloading ? 'icon-close' : 'icon-arrow-down'} />\n        </Button>\n      )}\n      {origin === AudioOrigin.Search && renderWithTitle()}\n      {origin !== AudioOrigin.Search && audio && renderAudio(\n        lang,\n        audio,\n        duration,\n        isPlaying,\n        playProgress,\n        bufferedRanges,\n        seekerRef,\n        (isDownloading || isUploading),\n        date,\n        transferProgress,\n        onDateClick ? handleDateClick : undefined,\n      )}\n      {origin === AudioOrigin.SharedMedia && (voice || video) && renderWithTitle()}\n      {origin === AudioOrigin.Inline && voice && (\n        renderVoice(\n          voice,\n          seekerRef,\n          waveformCanvasRef,\n          playProgress,\n          isMediaUnread,\n          isTranscribing,\n          isTranscriptionHidden,\n          isTranscribed,\n          isTranscriptionError,\n          transcribeSvgMemo,\n          canTranscribe ? handleTranscribe : undefined,\n          onHideTranscription,\n        )\n      )}\n    </div>\n  );\n};\n\nfunction getSeeklineSpikeAmounts(withAvatar?: boolean) {\n  return {\n    MIN_SPIKES: IS_SINGLE_COLUMN_LAYOUT ? (TINY_SCREEN_WIDTH_MQL.matches ? 16 : 20) : 25,\n    MAX_SPIKES: IS_SINGLE_COLUMN_LAYOUT\n      ? (TINY_SCREEN_WIDTH_MQL.matches\n        ? 35\n        : (withAvatar && WITH_AVATAR_TINY_SCREEN_WIDTH_MQL.matches ? 40 : 45))\n      : 75,\n  };\n}\n\nfunction renderAudio(\n  lang: LangFn,\n  audio: ApiAudio,\n  duration: number,\n  isPlaying: boolean,\n  playProgress: number,\n  bufferedRanges: BufferedRange[],\n  seekerRef: React.Ref<HTMLElement>,\n  showProgress?: boolean,\n  date?: number,\n  progress?: number,\n  handleDateClick?: NoneToVoidFunction,\n) {\n  const {\n    title, performer, fileName,\n  } = audio;\n  const showSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n  const { isRtl } = getTranslation;\n\n  return (\n    <div className=\"content\">\n      <p className=\"title\" dir=\"auto\" title={title}>{renderText(title || fileName)}</p>\n      {showSeekline && (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          <span className=\"duration with-seekline\" dir=\"auto\">\n            {formatMediaDuration(duration * playProgress, duration)}\n          </span>\n          {renderSeekline(playProgress, bufferedRanges, seekerRef)}\n        </div>\n      )}\n      {!showSeekline && showProgress && (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          {progress ? `${getFileSizeString(audio!.size * progress)} / ` : undefined}{getFileSizeString(audio!.size)}\n        </div>\n      )}\n      {!showSeekline && !showProgress && (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          <span className=\"duration\" dir=\"auto\">{formatMediaDuration(duration)}</span>\n          {performer && (\n            <>\n              <span className=\"bullet\">&bull;</span>\n              <span className=\"performer\" dir=\"auto\" title={performer}>{renderText(performer)}</span>\n            </>\n          )}\n          {date && (\n            <>\n              <span className=\"bullet\">&bull;</span>\n              <Link className=\"date\" onClick={handleDateClick}>\n                {formatMediaDateTime(lang, date * 1000, true)}\n              </Link>\n            </>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction renderVoice(\n  voice: ApiVoice,\n  seekerRef: React.Ref<HTMLDivElement>,\n  waveformCanvasRef: React.Ref<HTMLCanvasElement>,\n  playProgress: number,\n  isMediaUnread?: boolean,\n  isTranscribing?: boolean,\n  isTranscriptionHidden?: boolean,\n  isTranscribed?: boolean,\n  isTranscriptionError?: boolean,\n  svgMemo?: React.ReactNode,\n  onClickTranscribe?: VoidFunction,\n  onHideTranscription?: (isHidden: boolean) => void,\n) {\n  return (\n    <div className=\"content\">\n      <div className=\"waveform-wrapper\">\n        <div\n          className=\"waveform\"\n          draggable={false}\n          ref={seekerRef}\n        >\n          <canvas ref={waveformCanvasRef} />\n        </div>\n        {onClickTranscribe && (\n          // eslint-disable-next-line react/jsx-no-bind\n          <Button onClick={() => {\n            if ((isTranscribed || isTranscriptionError) && onHideTranscription) {\n              onHideTranscription(!isTranscriptionHidden);\n            } else if (!isTranscribing) {\n              onClickTranscribe();\n            }\n          }}\n          >\n            <i className={buildClassName(\n              'transcribe-icon',\n              (isTranscribed || isTranscriptionError) ? 'icon-down' : 'icon-transcribe',\n              (isTranscribed || isTranscriptionError) && !isTranscriptionHidden && 'transcribe-shown',\n            )}\n            />\n            {isTranscribing && svgMemo}\n          </Button>\n        )}\n      </div>\n      <p className={buildClassName('voice-duration', isMediaUnread && 'unread')} dir=\"auto\">\n        {playProgress === 0 ? formatMediaDuration(voice.duration) : formatMediaDuration(voice.duration * playProgress)}\n      </p>\n    </div>\n  );\n}\n\nfunction useWaveformCanvas(\n  theme: ISettings['theme'],\n  voice?: ApiVoice,\n  playProgress = 0,\n  isOwn = false,\n  withAvatar = false,\n) {\n  // eslint-disable-next-line no-null/no-null\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  const { data: spikes, peak } = useMemo(() => {\n    if (!voice) {\n      return undefined;\n    }\n\n    const { waveform, duration } = voice;\n    if (!waveform) {\n      return {\n        data: new Array(Math.min(duration, MAX_EMPTY_WAVEFORM_POINTS)).fill(0),\n        peak: 0,\n      };\n    }\n\n    const { MIN_SPIKES, MAX_SPIKES } = getSeeklineSpikeAmounts(withAvatar);\n    const durationFactor = Math.min(duration / AVG_VOICE_DURATION, 1);\n    const spikesCount = Math.round(MIN_SPIKES + (MAX_SPIKES - MIN_SPIKES) * durationFactor);\n    const decodedWaveform = decodeWaveform(new Uint8Array(waveform));\n\n    return interpolateArray(decodedWaveform, spikesCount);\n  }, [voice, withAvatar]) || {};\n\n  useLayoutEffect(() => {\n    const canvas = canvasRef.current;\n\n    if (!canvas || !spikes || peak === undefined) {\n      return;\n    }\n\n    const fillColor = theme === 'dark' ? '#494A78' : '#ADD3F7';\n    const fillOwnColor = theme === 'dark' ? '#B7ABED' : '#AEDFA4';\n    const progressFillColor = theme === 'dark' ? '#8774E1' : '#3390EC';\n    const progressFillOwnColor = theme === 'dark' ? '#FFFFFF' : '#4FAE4E';\n\n    renderWaveform(canvas, spikes, playProgress, {\n      peak,\n      fillStyle: isOwn ? fillOwnColor : fillColor,\n      progressFillStyle: isOwn ? progressFillOwnColor : progressFillColor,\n    });\n  }, [isOwn, peak, playProgress, spikes, theme]);\n\n  return canvasRef;\n}\n\nfunction renderSeekline(\n  playProgress: number,\n  bufferedRanges: BufferedRange[],\n  seekerRef: React.Ref<HTMLElement>,\n) {\n  return (\n    <div\n      className=\"seekline no-selection\"\n      ref={seekerRef as React.Ref<HTMLDivElement>}\n    >\n      {bufferedRanges.map(({ start, end }) => (\n        <div\n          className=\"seekline-buffered-progress\"\n          style={`left: ${start * 100}%; right: ${100 - end * 100}%`}\n        />\n      ))}\n      <span className=\"seekline-play-progress\">\n        <i\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n      <span className=\"seekline-thumb\">\n        <i\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n    </div>\n  );\n}\n\nexport default memo(Audio);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useCallback, useEffect } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\nimport type { ApiChat, ApiCountryCode, ApiUser } from '../../api/types';\n\nimport {\n  selectChat, selectNotifyExceptions, selectNotifySettings, selectUser,\n} from '../../global/selectors';\nimport {\n  getChatDescription, getChatLink, getHasAdminRight, isChatChannel, isUserId, isUserRightBanned, selectIsChatMuted,\n} from '../../global/helpers';\nimport renderText from './helpers/renderText';\nimport { copyTextToClipboard } from '../../util/clipboard';\nimport { formatPhoneNumberWithCode } from '../../util/phoneNumber';\nimport useLang from '../../hooks/useLang';\n\nimport ListItem from '../ui/ListItem';\nimport Switcher from '../ui/Switcher';\n\ntype OwnProps = {\n  chatOrUserId: string;\n  forceShowSelf?: boolean;\n};\n\ntype StateProps =\n  {\n    user?: ApiUser;\n    chat?: ApiChat;\n    canInviteUsers?: boolean;\n    isMuted?: boolean;\n    phoneCodeList: ApiCountryCode[];\n  }\n  & Pick<GlobalState, 'lastSyncTime'>;\n\nconst ChatExtra: FC<OwnProps & StateProps> = ({\n  lastSyncTime,\n  user,\n  chat,\n  forceShowSelf,\n  canInviteUsers,\n  isMuted,\n  phoneCodeList,\n}) => {\n  const {\n    loadFullUser,\n    showNotification,\n    updateChatMutedState,\n  } = getActions();\n\n  const {\n    id: userId,\n    fullInfo,\n    username,\n    phoneNumber,\n    isSelf,\n  } = user || {};\n  const { id: chatId } = chat || {};\n  const lang = useLang();\n\n  useEffect(() => {\n    if (lastSyncTime && userId) {\n      loadFullUser({ userId });\n    }\n  }, [loadFullUser, userId, lastSyncTime]);\n\n  const handleNotificationChange = useCallback(() => {\n    updateChatMutedState({ chatId, isMuted: !isMuted });\n  }, [chatId, isMuted, updateChatMutedState]);\n\n  if (!chat || chat.isRestricted || (isSelf && !forceShowSelf)) {\n    return undefined;\n  }\n\n  function copy(text: string, entity: string) {\n    copyTextToClipboard(text);\n    showNotification({ message: `${entity} was copied` });\n  }\n\n  const formattedNumber = phoneNumber && formatPhoneNumberWithCode(phoneCodeList, phoneNumber);\n  const link = getChatLink(chat);\n  const description = (fullInfo?.bio) || getChatDescription(chat);\n\n  return (\n    <div className=\"ChatExtra\">\n      {formattedNumber && Boolean(formattedNumber.length) && (\n        // eslint-disable-next-line react/jsx-no-bind\n        <ListItem icon=\"phone\" multiline narrow ripple onClick={() => copy(formattedNumber, lang('Phone'))}>\n          <span className=\"title\" dir=\"auto\">{formattedNumber}</span>\n          <span className=\"subtitle\">{lang('Phone')}</span>\n        </ListItem>\n      )}\n      {username && (\n        <ListItem\n          icon=\"mention\"\n          multiline\n          narrow\n          ripple\n          // eslint-disable-next-line react/jsx-no-bind\n          onClick={() => copy(`@${username}`, lang('Username'))}\n        >\n          <span className=\"title\" dir=\"auto\">{renderText(username)}</span>\n          <span className=\"subtitle\">{lang('Username')}</span>\n        </ListItem>\n      )}\n      {description && Boolean(description.length) && (\n        <ListItem\n          icon=\"info\"\n          multiline\n          narrow\n          isStatic\n        >\n          <span className=\"title word-break\" dir=\"auto\">\n            {renderText(description, ['br', 'links', 'emoji'])}\n          </span>\n          <span className=\"subtitle\">{lang(userId ? 'UserBio' : 'Info')}</span>\n        </ListItem>\n      )}\n      {(canInviteUsers || !username) && link && (\n        <ListItem\n          icon={chat.username ? 'mention' : 'link'}\n          multiline\n          narrow\n          ripple\n          // eslint-disable-next-line react/jsx-no-bind\n          onClick={() => copy(link, lang('SetUrlPlaceholder'))}\n        >\n          <div className=\"title\">{link}</div>\n          <span className=\"subtitle\">{lang('SetUrlPlaceholder')}</span>\n        </ListItem>\n      )}\n      {!forceShowSelf && (\n        <ListItem icon=\"unmute\" ripple onClick={handleNotificationChange}>\n          <span>{lang('Notifications')}</span>\n          <Switcher\n            id=\"group-notifications\"\n            label={userId ? 'Toggle User Notifications' : 'Toggle Chat Notifications'}\n            checked={!isMuted}\n            inactive\n          />\n        </ListItem>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatOrUserId }): StateProps => {\n    const { lastSyncTime, countryList: { phoneCodes: phoneCodeList } } = global;\n\n    const chat = chatOrUserId ? selectChat(global, chatOrUserId) : undefined;\n    const user = isUserId(chatOrUserId) ? selectUser(global, chatOrUserId) : undefined;\n    const isMuted = chat && selectIsChatMuted(chat, selectNotifySettings(global), selectNotifyExceptions(global));\n\n    const canInviteUsers = chat && !user && (\n      (!isChatChannel(chat) && !isUserRightBanned(chat, 'inviteUsers'))\n      || getHasAdminRight(chat, 'inviteUsers')\n    );\n\n    return {\n      lastSyncTime, phoneCodeList, chat, user, canInviteUsers, isMuted,\n    };\n  },\n)(ChatExtra));\n","import type { FC } from '../../lib/teact/teact';\nimport React, { useCallback, memo } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiChat } from '../../api/types';\n\nimport { selectIsChatWithSelf, selectUser } from '../../global/selectors';\nimport {\n  isUserId,\n  isUserBot,\n  getUserFirstOrLastName,\n  getPrivateChatUserId,\n  isChatBasicGroup,\n  isChatSuperGroup,\n  isChatChannel,\n  getChatTitle,\n} from '../../global/helpers';\nimport useLang from '../../hooks/useLang';\nimport renderText from './helpers/renderText';\n\nimport Avatar from './Avatar';\nimport Modal from '../ui/Modal';\nimport Button from '../ui/Button';\n\nimport './DeleteChatModal.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  chat: ApiChat;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n};\n\ntype StateProps = {\n  isChannel: boolean;\n  isChatWithSelf?: boolean;\n  isBot?: boolean;\n  isPrivateChat: boolean;\n  isBasicGroup: boolean;\n  isSuperGroup: boolean;\n  currentUserId: string | undefined;\n  canDeleteForAll?: boolean;\n  contactName?: string;\n};\n\nconst DeleteChatModal: FC<OwnProps & StateProps> = ({\n  isOpen,\n  chat,\n  isChannel,\n  isPrivateChat,\n  isChatWithSelf,\n  isBot,\n  isBasicGroup,\n  isSuperGroup,\n  currentUserId,\n  canDeleteForAll,\n  contactName,\n  onClose,\n  onCloseAnimationEnd,\n}) => {\n  const {\n    leaveChannel,\n    deleteHistory,\n    deleteChannel,\n    deleteChatUser,\n    blockContact,\n  } = getActions();\n\n  const lang = useLang();\n  const chatTitle = getChatTitle(lang, chat);\n\n  const handleDeleteMessageForAll = useCallback(() => {\n    deleteHistory({ chatId: chat.id, shouldDeleteForAll: true });\n\n    onClose();\n  }, [deleteHistory, chat.id, onClose]);\n\n  const handleDeleteAndStop = useCallback(() => {\n    deleteHistory({ chatId: chat.id, shouldDeleteForAll: true });\n    blockContact({ contactId: chat.id, accessHash: chat.accessHash });\n\n    onClose();\n  }, [deleteHistory, chat.id, chat.accessHash, blockContact, onClose]);\n\n  const handleDeleteChat = useCallback(() => {\n    if (isPrivateChat) {\n      deleteHistory({ chatId: chat.id, shouldDeleteForAll: false });\n    } else if (isBasicGroup) {\n      deleteChatUser({ chatId: chat.id, userId: currentUserId });\n      deleteHistory({ chatId: chat.id, shouldDeleteForAll: false });\n    } else if ((isChannel || isSuperGroup) && !chat.isCreator) {\n      leaveChannel({ chatId: chat.id });\n    } else if ((isChannel || isSuperGroup) && chat.isCreator) {\n      deleteChannel({ chatId: chat.id });\n    }\n    onClose();\n  }, [\n    isPrivateChat,\n    isBasicGroup,\n    isChannel,\n    isSuperGroup,\n    currentUserId,\n    chat.isCreator,\n    chat.id,\n    onClose,\n    deleteHistory,\n    deleteChatUser,\n    leaveChannel,\n    deleteChannel,\n  ]);\n\n  const handleLeaveChat = useCallback(() => {\n    if (isChannel || isSuperGroup) {\n      leaveChannel({ chatId: chat.id });\n      onClose();\n    } else {\n      handleDeleteChat();\n    }\n  }, [chat.id, handleDeleteChat, isChannel, isSuperGroup, leaveChannel, onClose]);\n\n  function renderHeader() {\n    return (\n      <div className=\"modal-header\" dir={lang.isRtl ? 'rtl' : undefined}>\n        <Avatar\n          size=\"tiny\"\n          chat={chat}\n          isSavedMessages={isChatWithSelf}\n        />\n        <h3 className=\"modal-title\">{lang(renderTitle())}</h3>\n      </div>\n    );\n  }\n\n  function renderTitle() {\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n\n    if (isChannel && chat.isCreator) {\n      return 'ChannelDelete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return 'DeleteChatUser';\n  }\n\n  function renderMessage() {\n    if (isChannel && chat.isCreator) {\n      return <p>{renderText(lang('ChatList.DeleteAndLeaveGroupConfirmation', chatTitle), ['simple_markdown'])}</p>;\n    }\n\n    if ((isChannel && !chat.isCreator) || isBasicGroup || isSuperGroup) {\n      return <p>{renderText(lang('ChannelLeaveAlertWithName', chatTitle), ['simple_markdown'])}</p>;\n    }\n\n    return <p>{renderText(lang('ChatList.DeleteChatConfirmation', contactName), ['simple_markdown'])}</p>;\n  }\n\n  function renderActionText() {\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n    if (isChannel && chat.isCreator) {\n      return 'Chat.Input.Delete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return canDeleteForAll ? 'ChatList.DeleteForCurrentUser' : 'Delete';\n  }\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      className=\"DeleteChatModal\"\n      header={renderHeader()}\n      onClose={onClose}\n      onCloseAnimationEnd={onCloseAnimationEnd}\n    >\n      {renderMessage()}\n      {isBot && (\n        <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteAndStop}>\n          {lang('DeleteAndStop')}\n        </Button>\n      )}\n      {canDeleteForAll && (\n        <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteMessageForAll}>\n          {contactName ? renderText(lang('ChatList.DeleteForEveryone', contactName)) : lang('DeleteForAll')}\n        </Button>\n      )}\n      {!isPrivateChat && chat.isCreator && (\n        <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteChat}>\n          {lang('DeleteForAll')}\n        </Button>\n      )}\n      <Button\n        color=\"danger\"\n        className=\"confirm-dialog-button\"\n        isText\n        onClick={isPrivateChat ? handleDeleteChat : handleLeaveChat}\n      >\n        {lang(renderActionText())}\n      </Button>\n      <Button className=\"confirm-dialog-button\" isText onClick={onClose}>{lang('Cancel')}</Button>\n    </Modal>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chat }): StateProps => {\n    const isPrivateChat = isUserId(chat.id);\n    const isChatWithSelf = selectIsChatWithSelf(global, chat.id);\n    const user = isPrivateChat && selectUser(global, getPrivateChatUserId(chat)!);\n    const isBot = user && isUserBot(user) && !chat.isSupport;\n    const canDeleteForAll = (isPrivateChat && !isChatWithSelf && !isBot);\n    const contactName = isPrivateChat\n      ? getUserFirstOrLastName(selectUser(global, getPrivateChatUserId(chat)!))\n      : undefined;\n\n    return {\n      isPrivateChat,\n      isChatWithSelf,\n      isBot,\n      isChannel: isChatChannel(chat),\n      isBasicGroup: isChatBasicGroup(chat),\n      isSuperGroup: isChatSuperGroup(chat),\n      currentUserId: global.currentUserId,\n      canDeleteForAll,\n      contactName,\n    };\n  },\n)(DeleteChatModal));\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  useCallback, memo, useRef, useEffect, useState,\n} from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiMessage } from '../../api/types';\n\nimport { getDocumentExtension, getDocumentHasPreview } from './helpers/documentInfo';\nimport {\n  getMediaTransferState,\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  isMessageDocumentVideo,\n} from '../../global/helpers';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport { useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMediaWithLoadProgress from '../../hooks/useMediaWithLoadProgress';\nimport useMedia from '../../hooks/useMedia';\nimport useFlag from '../../hooks/useFlag';\n\nimport File from './File';\n\ntype OwnProps = {\n  message: ApiMessage;\n  observeIntersection?: ObserveFn;\n  smaller?: boolean;\n  isSelected?: boolean;\n  isSelectable?: boolean;\n  canAutoLoad?: boolean;\n  uploadProgress?: number;\n  withDate?: boolean;\n  datetime?: number;\n  className?: string;\n  sender?: string;\n  autoLoadFileMaxSizeMb?: number;\n  isDownloading: boolean;\n  onCancelUpload?: () => void;\n  onMediaClick?: () => void;\n  onDateClick?: (messageId: number, chatId: string) => void;\n};\n\nconst BYTES_PER_MB = 1024 * 1024;\n\nconst Document: FC<OwnProps> = ({\n  message,\n  observeIntersection,\n  smaller,\n  canAutoLoad,\n  autoLoadFileMaxSizeMb,\n  uploadProgress,\n  withDate,\n  datetime,\n  className,\n  sender,\n  isSelected,\n  isSelectable,\n  onCancelUpload,\n  onMediaClick,\n  onDateClick,\n  isDownloading,\n}) => {\n  const dispatch = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const document = message.content.document!;\n  const { fileName, size, timestamp } = document;\n  const extension = getDocumentExtension(document) || '';\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n  const [wasIntersected, markIntersected] = useFlag();\n  useEffect(() => {\n    if (isIntersecting) {\n      markIntersected();\n    }\n  }, [isIntersecting, markIntersected]);\n\n  // Auto-loading does not use global download manager because requires additional click to save files locally\n  const [isLoadAllowed, setIsLoadAllowed] = useState(\n    canAutoLoad && (!autoLoadFileMaxSizeMb || size <= autoLoadFileMaxSizeMb * BYTES_PER_MB),\n  );\n\n  const shouldDownload = Boolean(isDownloading || (isLoadAllowed && wasIntersected));\n\n  const documentHash = getMessageMediaHash(message, 'download');\n  const { loadProgress: downloadProgress, mediaData } = useMediaWithLoadProgress(\n    documentHash, !shouldDownload, undefined, undefined, undefined, true,\n  );\n  const isLoaded = Boolean(mediaData);\n\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(message, uploadProgress || downloadProgress, shouldDownload && !isLoaded);\n\n  const hasPreview = getDocumentHasPreview(document);\n  const thumbDataUri = hasPreview ? getMessageMediaThumbDataUri(message) : undefined;\n  const localBlobUrl = hasPreview ? document.previewBlobUrl : undefined;\n  const previewData = useMedia(getMessageMediaHash(message, 'pictogram'), !isIntersecting);\n\n  const withMediaViewer = onMediaClick && Boolean(document.mediaType);\n\n  const handleClick = useCallback(() => {\n    if (isUploading) {\n      if (onCancelUpload) {\n        onCancelUpload();\n      }\n      return;\n    }\n\n    if (isDownloading) {\n      dispatch.cancelMessageMediaDownload({ message });\n      return;\n    }\n\n    if (isTransferring) {\n      setIsLoadAllowed(false);\n      return;\n    }\n\n    if (withMediaViewer) {\n      onMediaClick!();\n    } else {\n      dispatch.downloadMessageMedia({ message });\n    }\n  }, [\n    isUploading, isDownloading, isTransferring, withMediaViewer, onCancelUpload, dispatch, message, onMediaClick,\n  ]);\n\n  const handleDateClick = useCallback(() => {\n    onDateClick!(message.id, message.chatId);\n  }, [onDateClick, message.id, message.chatId]);\n\n  return (\n    <File\n      ref={ref}\n      name={fileName}\n      extension={extension}\n      size={size}\n      timestamp={withDate ? datetime || timestamp : undefined}\n      thumbnailDataUri={thumbDataUri}\n      previewData={localBlobUrl || previewData}\n      smaller={smaller}\n      isTransferring={isTransferring}\n      isUploading={isUploading}\n      transferProgress={transferProgress}\n      className={className}\n      sender={sender}\n      isSelectable={isSelectable}\n      isSelected={isSelected}\n      actionIcon={withMediaViewer ? (isMessageDocumentVideo(message) ? 'icon-play' : 'icon-eye') : 'icon-download'}\n      onClick={handleClick}\n      onDateClick={onDateClick ? handleDateClick : undefined}\n    />\n  );\n};\n\nexport default memo(Document);\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport useLang from '../../hooks/useLang';\nimport buildClassName from '../../util/buildClassName';\n\nimport './DotAnimation.scss';\n\ntype OwnProps = {\n  content: string;\n  className?: string;\n};\n\nconst DotAnimation: FC<OwnProps> = ({ content, className }) => {\n  const lang = useLang();\n  return (\n    <span className={buildClassName('DotAnimation', className)} dir={lang.isRtl ? 'rtl' : 'auto'}>\n      {content}\n      <span className=\"ellipsis\" />\n    </span>\n  );\n};\n\nexport default DotAnimation;\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport type { ApiFakeType } from '../../api/types';\n\nimport useLang from '../../hooks/useLang';\n\nimport './FakeIcon.scss';\n\ntype OwnProps = {\n  fakeType: ApiFakeType;\n};\n\nconst FakeIcon: FC<OwnProps> = ({\n  fakeType,\n}) => {\n  const lang = useLang();\n\n  return <span className=\"FakeIcon\">{lang(fakeType === 'fake' ? 'FakeMessage' : 'ScamMessage')}</span>;\n};\n\nexport default memo(FakeIcon);\n","import type { RefObject } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { memo, useRef } from '../../lib/teact/teact';\n\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useMediaTransition from '../../hooks/useMediaTransition';\nimport buildClassName from '../../util/buildClassName';\nimport { formatMediaDateTime, formatPastTimeShort } from '../../util/dateFormat';\nimport { getColorFromExtension, getFileSizeString } from './helpers/documentInfo';\nimport { getDocumentThumbnailDimensions } from './helpers/mediaDimensions';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport Link from '../ui/Link';\n\nimport './File.scss';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  name: string;\n  extension?: string;\n  size: number;\n  timestamp?: number;\n  sender?: string;\n  thumbnailDataUri?: string;\n  previewData?: string;\n  className?: string;\n  smaller?: boolean;\n  isTransferring?: boolean;\n  isUploading?: boolean;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  transferProgress?: number;\n  actionIcon?: string;\n  onClick?: () => void;\n  onDateClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n};\n\nconst File: FC<OwnProps> = ({\n  ref,\n  name,\n  size,\n  extension = '',\n  timestamp,\n  sender,\n  thumbnailDataUri,\n  previewData,\n  className,\n  smaller,\n  isTransferring,\n  isUploading,\n  isSelectable,\n  isSelected,\n  transferProgress,\n  actionIcon,\n  onClick,\n  onDateClick,\n}) => {\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  let elementRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    elementRef = ref;\n  }\n\n  const transitionClassNames = useMediaTransition(previewData);\n  const {\n    shouldRender: shouldSpinnerRender,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransition(isTransferring, undefined, true);\n\n  const color = getColorFromExtension(extension);\n  const sizeString = getFileSizeString(size);\n\n  const { width, height } = getDocumentThumbnailDimensions(smaller);\n\n  const fullClassName = buildClassName(\n    'File',\n    className,\n    smaller && 'smaller',\n    onClick && !isUploading && 'interactive',\n    isSelected && 'file-is-selected',\n  );\n\n  return (\n    <div ref={elementRef} className={fullClassName} dir={lang.isRtl ? 'rtl' : undefined}>\n      {isSelectable && (\n        <div className=\"message-select-control\">\n          {isSelected && <i className=\"icon-select\" />}\n        </div>\n      )}\n      <div className=\"file-icon-container\" onClick={isUploading ? undefined : onClick}>\n        {thumbnailDataUri || previewData ? (\n          <div className=\"file-preview media-inner\">\n            <img\n              src={thumbnailDataUri}\n              width={width}\n              height={height}\n              className=\"thumbnail\"\n              alt=\"\"\n            />\n            <img\n              src={previewData}\n              className={buildClassName('full-media', transitionClassNames)}\n              width={width}\n              height={height}\n              alt=\"\"\n            />\n          </div>\n        ) : (\n          <div className={`file-icon ${color}`}>\n            {extension.length <= 4 && (\n              <span className=\"file-ext\" dir=\"auto\">{extension}</span>\n            )}\n          </div>\n        )}\n        {shouldSpinnerRender && (\n          <div className={buildClassName('file-progress', color, spinnerClassNames)}>\n            <ProgressSpinner\n              progress={transferProgress}\n              size={smaller ? 's' : 'm'}\n              onClick={isUploading ? onClick : undefined}\n            />\n          </div>\n        )}\n        {onClick && (\n          <i\n            className={buildClassName(\n              'action-icon',\n              actionIcon || 'icon-download',\n              shouldSpinnerRender && 'hidden',\n            )}\n          />\n        )}\n      </div>\n      <div className=\"file-info\">\n        <div className=\"file-title\" dir=\"auto\">{renderText(name)}</div>\n        <div className=\"file-subtitle\" dir=\"auto\">\n          <span>\n            {isTransferring && transferProgress ? `${Math.round(transferProgress * 100)}%` : sizeString}\n          </span>\n          {sender && <span className=\"file-sender\">{renderText(sender)}</span>}\n          {!sender && timestamp && (\n            <>\n              <span className=\"bullet\" />\n              <Link onClick={onDateClick}>{formatMediaDateTime(lang, timestamp * 1000, true)}</Link>\n            </>\n          )}\n        </div>\n      </div>\n      {sender && timestamp && (\n        <Link onClick={onDateClick}>{formatPastTimeShort(lang, timestamp * 1000)}</Link>\n      )}\n    </div>\n  );\n};\n\nexport default memo(File);\n","import type { MouseEvent as ReactMouseEvent } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { useEffect, useCallback, memo } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiChat, ApiTypingStatus } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport {\n  getChatTypeString,\n  getChatTitle,\n  isChatSuperGroup,\n} from '../../global/helpers';\nimport { selectChat, selectChatMessages, selectChatOnlineCount } from '../../global/selectors';\nimport renderText from './helpers/renderText';\nimport type { LangFn } from '../../hooks/useLang';\nimport useLang from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\nimport VerifiedIcon from './VerifiedIcon';\nimport TypingStatus from './TypingStatus';\nimport DotAnimation from './DotAnimation';\nimport FakeIcon from './FakeIcon';\n\ntype OwnProps = {\n  chatId: string;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'small' | 'medium' | 'large' | 'jumbo';\n  status?: string;\n  withDots?: boolean;\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  withChatType?: boolean;\n  withVideoAvatar?: boolean;\n  noRtl?: boolean;\n};\n\ntype StateProps =\n  {\n    chat?: ApiChat;\n    onlineCount?: number;\n    areMessagesLoaded: boolean;\n  }\n  & Pick<GlobalState, 'lastSyncTime'>;\n\nconst GroupChatInfo: FC<OwnProps & StateProps> = ({\n  typingStatus,\n  avatarSize = 'medium',\n  status,\n  withDots,\n  withMediaViewer,\n  withUsername,\n  withFullInfo,\n  withUpdatingStatus,\n  withChatType,\n  withVideoAvatar,\n  noRtl,\n  chat,\n  onlineCount,\n  areMessagesLoaded,\n  lastSyncTime,\n}) => {\n  const {\n    loadFullChat,\n    openMediaViewer,\n  } = getActions();\n\n  const isSuperGroup = chat && isChatSuperGroup(chat);\n  const { id: chatId, isMin, isRestricted } = chat || {};\n\n  useEffect(() => {\n    if (chatId && !isMin && withFullInfo && lastSyncTime) {\n      loadFullChat({ chatId });\n    }\n  }, [chatId, isMin, lastSyncTime, withFullInfo, loadFullChat, isSuperGroup]);\n\n  const handleAvatarViewerOpen = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasMedia: boolean) => {\n    if (chat && hasMedia) {\n      e.stopPropagation();\n      openMediaViewer({\n        avatarOwnerId: chat.id,\n        origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n      });\n    }\n  }, [chat, avatarSize, openMediaViewer]);\n\n  const lang = useLang();\n\n  if (!chat) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (status) {\n      return withDots ? (\n        <DotAnimation className=\"status\" content={status} />\n      ) : (\n        <span className=\"status\" dir=\"auto\">{status}</span>\n      );\n    }\n\n    if (withUpdatingStatus && !areMessagesLoaded && !isRestricted) {\n      return (\n        <DotAnimation className=\"status\" content={lang('Updating')} />\n      );\n    }\n\n    if (!chat) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (withChatType) {\n      return (\n        <span className=\"status\" dir=\"auto\">{lang(getChatTypeString(chat))}</span>\n      );\n    }\n\n    const handle = withUsername ? chat.username : undefined;\n    const groupStatus = getGroupStatus(lang, chat);\n    const onlineStatus = onlineCount ? `, ${lang('OnlineCount', onlineCount, 'i')}` : undefined;\n\n    return (\n      <span className=\"status\">\n        {handle && <span className=\"handle\">{handle}</span>}\n        <span className=\"group-status\">{groupStatus}</span>\n        {onlineStatus && <span className=\"online-status\">{onlineStatus}</span>}\n      </span>\n    );\n  }\n\n  return (\n    <div className=\"ChatInfo\" dir={!noRtl && lang.isRtl ? 'rtl' : undefined}>\n      <Avatar\n        key={chat.id}\n        size={avatarSize}\n        chat={chat}\n        onClick={withMediaViewer ? handleAvatarViewerOpen : undefined}\n        noVideo={!withVideoAvatar}\n      />\n      <div className=\"info\">\n        <div className=\"title\">\n          <h3 dir=\"auto\">{renderText(getChatTitle(lang, chat))}</h3>\n          {chat.isVerified && <VerifiedIcon />}\n          {chat.fakeType && <FakeIcon fakeType={chat.fakeType} />}\n        </div>\n        {renderStatusOrTyping()}\n      </div>\n    </div>\n  );\n};\n\nfunction getGroupStatus(lang: LangFn, chat: ApiChat) {\n  const chatTypeString = lang(getChatTypeString(chat));\n  const { membersCount } = chat;\n\n  if (chat.isRestricted) {\n    return chatTypeString === 'Channel' ? 'channel is inaccessible' : 'group is inaccessible';\n  }\n\n  if (!membersCount) {\n    return chatTypeString;\n  }\n\n  return chatTypeString === 'Channel'\n    ? lang('Subscribers', membersCount, 'i')\n    : lang('Members', membersCount, 'i');\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId }): StateProps => {\n    const { lastSyncTime } = global;\n    const chat = selectChat(global, chatId);\n    const onlineCount = chat ? selectChatOnlineCount(global, chat) : undefined;\n    const areMessagesLoaded = Boolean(selectChatMessages(global, chatId));\n\n    return {\n      lastSyncTime, chat, onlineCount, areMessagesLoaded,\n    };\n  },\n)(GroupChatInfo));\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport type { ApiMessage, ApiMessageOutgoingStatus } from '../../api/types';\n\nimport { formatPastTimeShort } from '../../util/dateFormat';\nimport useLang from '../../hooks/useLang';\n\nimport MessageOutgoingStatus from './MessageOutgoingStatus';\n\nimport './LastMessageMeta.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  outgoingStatus?: ApiMessageOutgoingStatus;\n};\n\nconst LastMessageMeta: FC<OwnProps> = ({ message, outgoingStatus }) => {\n  const lang = useLang();\n  return (\n    <div className=\"LastMessageMeta\">\n      {outgoingStatus && (\n        <MessageOutgoingStatus status={outgoingStatus} />\n      )}\n      <span className=\"time\">{formatPastTimeShort(lang, message.date * 1000)}</span>\n    </div>\n  );\n};\n\nexport default memo(LastMessageMeta);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useCallback, useRef } from '../../lib/teact/teact';\n\nimport type { ApiMessage } from '../../api/types';\n\nimport { formatMediaDuration } from '../../util/dateFormat';\nimport stopEvent from '../../util/stopEvent';\nimport {\n  getMessageHtmlId,\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  getMessageVideo,\n} from '../../global/helpers';\nimport buildClassName from '../../util/buildClassName';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaTransition from '../../hooks/useMediaTransition';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport { useIsIntersecting } from '../../hooks/useIntersectionObserver';\n\nimport './Media.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  idPrefix?: string;\n  isProtected?: boolean;\n  observeIntersection?: ObserveFn;\n  onClick?: (messageId: number, chatId: string) => void;\n};\n\nconst Media: FC<OwnProps> = ({\n  message,\n  idPrefix = 'shared-media',\n  isProtected,\n  observeIntersection,\n  onClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n  const thumbDataUri = getMessageMediaThumbDataUri(message);\n  const mediaBlobUrl = useMedia(getMessageMediaHash(message, 'pictogram'), !isIntersecting);\n  const transitionClassNames = useMediaTransition(mediaBlobUrl);\n\n  const video = getMessageVideo(message);\n\n  const handleClick = useCallback(() => {\n    onClick!(message.id, message.chatId);\n  }, [message.id, message.chatId, onClick]);\n\n  return (\n    <div\n      ref={ref}\n      id={`${idPrefix}${getMessageHtmlId(message.id)}`}\n      className=\"Media scroll-item\"\n      onClick={onClick ? handleClick : undefined}\n    >\n      <img\n        src={thumbDataUri}\n        alt=\"\"\n        draggable={!isProtected}\n        decoding=\"async\"\n        onContextMenu={isProtected ? stopEvent : undefined}\n      />\n      <img\n        src={mediaBlobUrl}\n        className={buildClassName('full-media', transitionClassNames)}\n        alt=\"\"\n        draggable={!isProtected}\n        decoding=\"async\"\n        onContextMenu={isProtected ? stopEvent : undefined}\n      />\n      {video && <span className=\"video-duration\">{video.isGif ? 'GIF' : formatMediaDuration(video.duration)}</span>}\n      {isProtected && <span className=\"protector\" />}\n    </div>\n  );\n};\n\nexport default memo(Media);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport type { ApiMessageOutgoingStatus } from '../../api/types';\n\nimport Transition from '../ui/Transition';\n\nimport './MessageOutgoingStatus.scss';\n\ntype OwnProps = {\n  status: ApiMessageOutgoingStatus;\n};\n\nenum Keys {\n  failed, pending, succeeded, read,\n}\n\nconst MessageOutgoingStatus: FC<OwnProps> = ({ status }) => {\n  return (\n    <div className=\"MessageOutgoingStatus\">\n      <Transition name=\"reveal\" activeKey={Keys[status]}>\n        <i className={`icon-message-${status}`} />\n      </Transition>\n    </div>\n  );\n};\n\nexport default memo(MessageOutgoingStatus);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport './NothingFound.scss';\n\ninterface OwnProps {\n  text?: string;\n  description?: string;\n}\n\nconst DEFAULT_TEXT = 'Nothing found.';\n\nconst NothingFound: FC<OwnProps> = ({ text = DEFAULT_TEXT, description }) => {\n  const lang = useLang();\n  const { transitionClassNames } = useShowTransition(true);\n\n  return (\n    <div className={buildClassName('NothingFound', transitionClassNames, description && 'with-description')}>\n      {text}\n      {description && <p className=\"description\">{renderText(lang(description), ['br'])}</p>}\n    </div>\n  );\n};\n\nexport default memo(NothingFound);\n","import type { ChangeEvent } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useEffect, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport { MIN_PASSWORD_LENGTH } from '../../config';\nimport { IS_TOUCH_ENV, IS_SINGLE_COLUMN_LAYOUT } from '../../util/environment';\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\nimport useTimeout from '../../hooks/useTimeout';\n\nimport Button from '../ui/Button';\n\ntype OwnProps = {\n  submitLabel?: string;\n  error?: string;\n  hint?: string;\n  placeholder?: string;\n  isLoading?: boolean;\n  shouldDisablePasswordManager?: boolean;\n  shouldShowSubmit?: boolean;\n  shouldResetValue?: boolean;\n  isPasswordVisible?: boolean;\n  clearError: NoneToVoidFunction;\n  noRipple?: boolean;\n  onChangePasswordVisibility: (state: boolean) => void;\n  onInputChange?: (password: string) => void;\n  onSubmit: (password: string) => void;\n};\n\nconst FOCUS_DELAY_TIMEOUT_MS = IS_SINGLE_COLUMN_LAYOUT ? 550 : 400;\n\nconst PasswordForm: FC<OwnProps> = ({\n  isLoading = false,\n  isPasswordVisible,\n  error,\n  hint,\n  placeholder = 'Password',\n  submitLabel = 'Next',\n  shouldShowSubmit,\n  shouldResetValue,\n  shouldDisablePasswordManager = false,\n  noRipple = false,\n  clearError,\n  onChangePasswordVisibility,\n  onInputChange,\n  onSubmit,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLInputElement>(null);\n  const lang = useLang();\n\n  const [password, setPassword] = useState('');\n  const [canSubmit, setCanSubmit] = useState(false);\n\n  useEffect(() => {\n    if (shouldResetValue) {\n      setPassword('');\n    }\n  }, [shouldResetValue]);\n\n  useTimeout(() => {\n    if (!IS_TOUCH_ENV) {\n      inputRef.current!.focus();\n    }\n  }, FOCUS_DELAY_TIMEOUT_MS);\n\n  useEffect(() => {\n    if (error) {\n      requestAnimationFrame(() => {\n        inputRef.current!.focus();\n        inputRef.current!.select();\n      });\n    }\n  }, [error]);\n\n  function onPasswordChange(e: ChangeEvent<HTMLInputElement>) {\n    if (error) {\n      clearError();\n    }\n\n    const { target } = e;\n    setPassword(target.value);\n    setCanSubmit(target.value.length >= MIN_PASSWORD_LENGTH);\n    if (onInputChange) {\n      onInputChange(target.value);\n    }\n  }\n\n  function togglePasswordVisibility() {\n    onChangePasswordVisibility(!isPasswordVisible);\n  }\n\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n\n    if (isLoading) {\n      return;\n    }\n\n    if (canSubmit) {\n      onSubmit(password);\n    }\n  }\n\n  function renderFakeInput() {\n    return (\n      <input\n        type=\"password\"\n        id=\"prevent_autofill\"\n        autoComplete=\"off\"\n        className=\"visually-hidden\"\n        tabIndex={-2}\n      />\n    );\n  }\n\n  return (\n    <form action=\"\" onSubmit={handleSubmit} autoComplete=\"off\">\n      <div\n        className={buildClassName('input-group password-input', password && 'touched', error && 'error')}\n        dir={lang.isRtl ? 'rtl' : undefined}\n      >\n        {shouldDisablePasswordManager && renderFakeInput()}\n        <input\n          ref={inputRef}\n          className=\"form-control\"\n          type={isPasswordVisible ? 'text' : 'password'}\n          id=\"sign-in-password\"\n          value={password || ''}\n          autoComplete={shouldDisablePasswordManager ? 'one-time-code' : 'current-password'}\n          onChange={onPasswordChange}\n          maxLength={256}\n          dir=\"auto\"\n        />\n        <label>{error || hint || placeholder}</label>\n        <div\n          className=\"toggle-password\"\n          onClick={togglePasswordVisibility}\n          role=\"button\"\n          tabIndex={0}\n          title=\"Toggle password visibility\"\n        >\n          <i className={isPasswordVisible ? 'icon-eye' : 'icon-eye-closed'} />\n        </div>\n      </div>\n      {(canSubmit || shouldShowSubmit) && (\n        <Button type=\"submit\" ripple={!noRipple} isLoading={isLoading} disabled={!canSubmit}>\n          {submitLabel}\n        </Button>\n      )}\n    </form>\n  );\n};\n\nexport default memo(PasswordForm);\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  useCallback, useRef, useEffect, memo,\n} from '../../lib/teact/teact';\n\nimport { isUserId } from '../../global/helpers';\n\nimport InfiniteScroll from '../ui/InfiniteScroll';\nimport Checkbox from '../ui/Checkbox';\nimport InputText from '../ui/InputText';\nimport ListItem from '../ui/ListItem';\nimport PrivateChatInfo from './PrivateChatInfo';\nimport GroupChatInfo from './GroupChatInfo';\nimport PickerSelectedItem from './PickerSelectedItem';\nimport useInfiniteScroll from '../../hooks/useInfiniteScroll';\nimport useLang from '../../hooks/useLang';\n\nimport Loading from '../ui/Loading';\n\nimport './Picker.scss';\n\ntype OwnProps = {\n  itemIds: string[];\n  selectedIds: string[];\n  filterValue?: string;\n  filterPlaceholder?: string;\n  notFoundText?: string;\n  searchInputId?: string;\n  isLoading?: boolean;\n  noScrollRestore?: boolean;\n  onSelectedIdsChange: (ids: string[]) => void;\n  onFilterChange: (value: string) => void;\n  onLoadMore?: () => void;\n};\n\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 500;\n\nconst MAX_FULL_ITEMS = 10;\nconst ALWAYS_FULL_ITEMS_COUNT = 5;\n\nconst Picker: FC<OwnProps> = ({\n  itemIds,\n  selectedIds,\n  filterValue,\n  filterPlaceholder,\n  notFoundText,\n  searchInputId,\n  isLoading,\n  noScrollRestore,\n  onSelectedIdsChange,\n  onFilterChange,\n  onLoadMore,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLInputElement>(null);\n  const shouldMinimize = selectedIds.length > MAX_FULL_ITEMS;\n\n  useEffect(() => {\n    setTimeout(() => {\n      requestAnimationFrame(() => {\n        inputRef.current!.focus();\n      });\n    }, FOCUS_DELAY_MS);\n  }, []);\n\n  const handleItemClick = useCallback((id: string) => {\n    const newSelectedIds = [...selectedIds];\n    if (newSelectedIds.includes(id)) {\n      newSelectedIds.splice(newSelectedIds.indexOf(id), 1);\n    } else {\n      newSelectedIds.push(id);\n    }\n    onSelectedIdsChange(newSelectedIds);\n    onFilterChange('');\n  }, [selectedIds, onSelectedIdsChange, onFilterChange]);\n\n  const handleFilterChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const { value } = e.currentTarget;\n    onFilterChange(value);\n  }, [onFilterChange]);\n\n  const [viewportIds, getMore] = useInfiniteScroll(onLoadMore, itemIds, Boolean(filterValue));\n\n  const lang = useLang();\n\n  return (\n    <div className=\"Picker\">\n      <div className=\"picker-header custom-scroll\" dir={lang.isRtl ? 'rtl' : undefined}>\n        {selectedIds.map((id, i) => (\n          <PickerSelectedItem\n            chatOrUserId={id}\n            isMinimized={shouldMinimize && i < selectedIds.length - ALWAYS_FULL_ITEMS_COUNT}\n            canClose\n            onClick={handleItemClick}\n            clickArg={id}\n          />\n        ))}\n        <InputText\n          id={searchInputId}\n          ref={inputRef}\n          value={filterValue}\n          onChange={handleFilterChange}\n          placeholder={filterPlaceholder || lang('SelectChat')}\n        />\n      </div>\n\n      {viewportIds?.length ? (\n        <InfiniteScroll\n          className=\"picker-list custom-scroll\"\n          items={viewportIds}\n          onLoadMore={getMore}\n          noScrollRestore={noScrollRestore}\n        >\n          {viewportIds.map((id) => (\n            <ListItem\n              key={id}\n              className=\"chat-item-clickable picker-list-item\"\n              // eslint-disable-next-line react/jsx-no-bind\n              onClick={() => handleItemClick(id)}\n              ripple\n            >\n              <Checkbox label=\"\" checked={selectedIds.includes(id)} />\n              {isUserId(id) ? (\n                <PrivateChatInfo userId={id} />\n              ) : (\n                <GroupChatInfo chatId={id} />\n              )}\n            </ListItem>\n          ))}\n        </InfiniteScroll>\n      ) : !isLoading && viewportIds && !viewportIds.length ? (\n        <p className=\"no-results\">{notFoundText || 'Sorry, nothing found.'}</p>\n      ) : (\n        <Loading />\n      )}\n    </div>\n  );\n};\n\nexport default memo(Picker);\n","import type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type { ApiChat, ApiUser } from '../../api/types';\n\nimport { selectChat, selectUser } from '../../global/selectors';\nimport { getChatTitle, getUserFirstOrLastName, isUserId } from '../../global/helpers';\nimport renderText from './helpers/renderText';\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\n\nimport './PickerSelectedItem.scss';\n\ntype OwnProps = {\n  chatOrUserId?: string;\n  icon?: string;\n  title?: string;\n  isMinimized?: boolean;\n  canClose?: boolean;\n  onClick: (arg: any) => void;\n  clickArg: any;\n  className?: string;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  user?: ApiUser;\n};\n\nconst PickerSelectedItem: FC<OwnProps & StateProps> = ({\n  icon,\n  title,\n  isMinimized,\n  canClose,\n  onClick,\n  clickArg,\n  chat,\n  user,\n  className,\n}) => {\n  const lang = useLang();\n\n  let iconElement: TeactNode | undefined;\n  let titleText: any;\n\n  if (icon && title) {\n    iconElement = (\n      <div className=\"item-icon\">\n        <i className={`icon-${icon}`} />\n      </div>\n    );\n\n    titleText = title;\n  } else if (chat || user) {\n    iconElement = (\n      <Avatar\n        chat={chat}\n        user={user}\n        size=\"small\"\n        isSavedMessages={user?.isSelf}\n        noVideo\n      />\n    );\n\n    const name = !chat || (user && !user.isSelf)\n      ? getUserFirstOrLastName(user)\n      : getChatTitle(lang, chat, user);\n\n    titleText = name ? renderText(name) : undefined;\n  }\n\n  const fullClassName = buildClassName(\n    'PickerSelectedItem',\n    className,\n    isMinimized && 'minimized',\n    canClose && 'closeable',\n  );\n\n  return (\n    <div\n      className={fullClassName}\n      onClick={() => onClick(clickArg)}\n      title={isMinimized ? titleText : undefined}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {iconElement}\n      {!isMinimized && (\n        <div className=\"item-name\" dir=\"auto\">\n          {titleText}\n        </div>\n      )}\n      {canClose && (\n        <div className=\"item-remove\">\n          <i className=\"icon-close\" />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatOrUserId }): StateProps => {\n    if (!chatOrUserId) {\n      return {};\n    }\n\n    const chat = chatOrUserId ? selectChat(global, chatOrUserId) : undefined;\n    const user = isUserId(chatOrUserId) ? selectUser(global, chatOrUserId) : undefined;\n\n    return {\n      chat,\n      user,\n    };\n  },\n)(PickerSelectedItem));\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useMemo } from '../../lib/teact/teact';\n\nimport generateIdFor from '../../util/generateIdFor';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './PremiumIcon.scss';\n\n// eslint-disable-next-line max-len\nconst PREMIUM_ICON = { __html: '<svg width=\"14\" height=\"15\" viewBox=\"0 0 14 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M6.63869 12.1902L3.50621 14.1092C3.18049 14.3087 2.75468 14.2064 2.55515 13.8807C2.45769 13.7216 2.42864 13.5299 2.47457 13.3491L2.95948 11.4405C3.13452 10.7515 3.60599 10.1756 4.24682 9.86791L7.6642 8.22716C7.82352 8.15067 7.89067 7.95951 7.81418 7.80019C7.75223 7.67116 7.61214 7.59896 7.47111 7.62338L3.66713 8.28194C2.89387 8.41581 2.1009 8.20228 1.49941 7.69823L0.297703 6.69116C0.00493565 6.44581 -0.0335059 6.00958 0.211842 5.71682C0.33117 5.57442 0.502766 5.48602 0.687982 5.47153L4.35956 5.18419C4.61895 5.16389 4.845 4.99974 4.94458 4.75937L6.36101 1.3402C6.5072 0.987302 6.91179 0.819734 7.26469 0.965925C7.43413 1.03612 7.56876 1.17075 7.63896 1.3402L9.05539 4.75937C9.15496 4.99974 9.38101 5.16389 9.6404 5.18419L13.3322 5.47311C13.713 5.50291 13.9975 5.83578 13.9677 6.2166C13.9534 6.39979 13.8667 6.56975 13.7269 6.68896L10.9114 9.08928C10.7131 9.25826 10.6267 9.52425 10.6876 9.77748L11.5532 13.3733C11.6426 13.7447 11.414 14.1182 11.0427 14.2076C10.8642 14.2506 10.676 14.2208 10.5195 14.1249L7.36128 12.1902C7.13956 12.0544 6.8604 12.0544 6.63869 12.1902Z\" fill=\"var(--color-fill)\"/></svg>' };\nconst store: Record<string, boolean> = {};\n\ntype OwnProps = {\n  withGradient?: boolean;\n  big?: boolean;\n  onClick?: VoidFunction;\n};\n\nconst PremiumIcon: FC<OwnProps> = ({\n  withGradient,\n  big,\n  onClick,\n}) => {\n  const html = useMemo(() => {\n    return withGradient ? getPremiumIconGradient() : PREMIUM_ICON;\n  }, [withGradient]);\n\n  return (\n    <i\n      onClick={onClick}\n      className={buildClassName('PremiumIcon', withGradient && 'gradient', onClick && 'clickable', big && 'big')}\n      dangerouslySetInnerHTML={html}\n      title=\"Premium\"\n    />\n  );\n};\n\nfunction getPremiumIconGradient() {\n  const id = generateIdFor(store);\n  return {\n    // eslint-disable-next-line max-len\n    __html: `<svg width=\"14\" height=\"15\" viewBox=\"0 0 14 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><defs><linearGradient id=\"${id}\" x1=\"3\" y1=\"63.5001\" x2=\"84.1475\" y2=\"-1.32262\" gradientUnits=\"userSpaceOnUse\"><stop stop-color=\"#6B93FF\"/><stop offset=\"0.439058\" stop-color=\"#976FFF\"/><stop offset=\"1\" stop-color=\"#E46ACE\"/></linearGradient></defs><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M6.63869 12.1902L3.50621 14.1092C3.18049 14.3087 2.75468 14.2064 2.55515 13.8807C2.45769 13.7216 2.42864 13.5299 2.47457 13.3491L2.95948 11.4405C3.13452 10.7515 3.60599 10.1756 4.24682 9.86791L7.6642 8.22716C7.82352 8.15067 7.89067 7.95951 7.81418 7.80019C7.75223 7.67116 7.61214 7.59896 7.47111 7.62338L3.66713 8.28194C2.89387 8.41581 2.1009 8.20228 1.49941 7.69823L0.297703 6.69116C0.00493565 6.44581 -0.0335059 6.00958 0.211842 5.71682C0.33117 5.57442 0.502766 5.48602 0.687982 5.47153L4.35956 5.18419C4.61895 5.16389 4.845 4.99974 4.94458 4.75937L6.36101 1.3402C6.5072 0.987302 6.91179 0.819734 7.26469 0.965925C7.43413 1.03612 7.56876 1.17075 7.63896 1.3402L9.05539 4.75937C9.15496 4.99974 9.38101 5.16389 9.6404 5.18419L13.3322 5.47311C13.713 5.50291 13.9975 5.83578 13.9677 6.2166C13.9534 6.39979 13.8667 6.56975 13.7269 6.68896L10.9114 9.08928C10.7131 9.25826 10.6267 9.52425 10.6876 9.77748L11.5532 13.3733C11.6426 13.7447 11.414 14.1182 11.0427 14.2076C10.8642 14.2506 10.676 14.2208 10.5195 14.1249L7.36128 12.1902C7.13956 12.0544 6.8604 12.0544 6.63869 12.1902Z\" fill=\"url(#${id})\"/></svg>`,\n  };\n}\n\nexport default memo(PremiumIcon);\n","import type { MouseEvent as ReactMouseEvent } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { useEffect, useCallback, memo } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiUser, ApiTypingStatus, ApiUserStatus } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport { selectChatMessages, selectUser, selectUserStatus } from '../../global/selectors';\nimport { getUserFullName, getUserStatus, isUserOnline } from '../../global/helpers';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\nimport VerifiedIcon from './VerifiedIcon';\nimport TypingStatus from './TypingStatus';\nimport DotAnimation from './DotAnimation';\nimport FakeIcon from './FakeIcon';\nimport PremiumIcon from './PremiumIcon';\n\ntype OwnProps = {\n  userId: string;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'tiny' | 'small' | 'medium' | 'large' | 'jumbo';\n  forceShowSelf?: boolean;\n  status?: string;\n  withDots?: boolean;\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  withVideoAvatar?: boolean;\n  noStatusOrTyping?: boolean;\n  noRtl?: boolean;\n};\n\ntype StateProps =\n  {\n    user?: ApiUser;\n    userStatus?: ApiUserStatus;\n    isSavedMessages?: boolean;\n    areMessagesLoaded: boolean;\n    serverTimeOffset: number;\n  }\n  & Pick<GlobalState, 'lastSyncTime'>;\n\nconst PrivateChatInfo: FC<OwnProps & StateProps> = ({\n  typingStatus,\n  avatarSize = 'medium',\n  status,\n  withDots,\n  withMediaViewer,\n  withUsername,\n  withFullInfo,\n  withUpdatingStatus,\n  withVideoAvatar,\n  noStatusOrTyping,\n  noRtl,\n  user,\n  userStatus,\n  isSavedMessages,\n  areMessagesLoaded,\n  lastSyncTime,\n  serverTimeOffset,\n}) => {\n  const {\n    loadFullUser,\n    openMediaViewer,\n  } = getActions();\n\n  const { id: userId } = user || {};\n  const fullName = getUserFullName(user);\n\n  useEffect(() => {\n    if (withFullInfo && lastSyncTime && userId) {\n      loadFullUser({ userId });\n    }\n  }, [userId, loadFullUser, lastSyncTime, withFullInfo]);\n\n  const handleAvatarViewerOpen = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasMedia: boolean) => {\n    if (user && hasMedia) {\n      e.stopPropagation();\n      openMediaViewer({\n        avatarOwnerId: user.id,\n        origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n      });\n    }\n  }, [user, avatarSize, openMediaViewer]);\n\n  const lang = useLang();\n\n  if (!user) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (status) {\n      return withDots ? (\n        <DotAnimation className=\"status\" content={status} />\n      ) : (\n        <span className=\"status\" dir=\"auto\">{status}</span>\n      );\n    }\n\n    if (withUpdatingStatus && !areMessagesLoaded) {\n      return (\n        <DotAnimation className=\"status\" content={lang('Updating')} />\n      );\n    }\n\n    if (!user) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    return (\n      <span className={`status ${isUserOnline(user, userStatus) ? 'online' : ''}`}>\n        {withUsername && user.username && <span className=\"handle\">{user.username}</span>}\n        <span className=\"user-status\" dir=\"auto\">{getUserStatus(lang, user, userStatus, serverTimeOffset)}</span>\n      </span>\n    );\n  }\n\n  return (\n    <div className=\"ChatInfo\" dir={!noRtl && lang.isRtl ? 'rtl' : undefined}>\n      <Avatar\n        key={user.id}\n        size={avatarSize}\n        user={user}\n        isSavedMessages={isSavedMessages}\n        onClick={withMediaViewer ? handleAvatarViewerOpen : undefined}\n        noVideo={!withVideoAvatar}\n      />\n      <div className=\"info\">\n        {isSavedMessages ? (\n          <div className=\"title\">\n            <h3>{lang('SavedMessages')}</h3>\n          </div>\n        ) : (\n          <div className=\"title\">\n            <h3 dir=\"auto\">{fullName && renderText(fullName)}</h3>\n            {user?.isVerified && <VerifiedIcon />}\n            {user.isPremium && <PremiumIcon />}\n            {user.fakeType && <FakeIcon fakeType={user.fakeType} />}\n          </div>\n        )}\n        {(status || (!isSavedMessages && !noStatusOrTyping)) && renderStatusOrTyping()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { userId, forceShowSelf }): StateProps => {\n    const { lastSyncTime, serverTimeOffset } = global;\n    const user = selectUser(global, userId);\n    const userStatus = selectUserStatus(global, userId);\n    const isSavedMessages = !forceShowSelf && user && user.isSelf;\n    const areMessagesLoaded = Boolean(selectChatMessages(global, userId));\n\n    return {\n      lastSyncTime, user, userStatus, isSavedMessages, areMessagesLoaded, serverTimeOffset,\n    };\n  },\n)(PrivateChatInfo));\n","import React, { memo, useEffect, useRef } from '../../lib/teact/teact';\n\nimport type { FC, TeactNode } from '../../lib/teact/teact';\nimport type { ApiChat, ApiPhoto, ApiUser } from '../../api/types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport {\n  getChatAvatarHash,\n  getChatTitle,\n  getUserColorKey,\n  getUserFullName,\n  isUserId,\n  isChatWithRepliesBot,\n  isDeletedUser, getVideoAvatarMediaHash,\n} from '../../global/helpers';\nimport renderText from './helpers/renderText';\nimport buildClassName from '../../util/buildClassName';\nimport { getFirstLetters } from '../../util/textFormat';\nimport useMedia from '../../hooks/useMedia';\nimport useLang from '../../hooks/useLang';\n\nimport Spinner from '../ui/Spinner';\n\nimport './ProfilePhoto.scss';\n\ntype OwnProps = {\n  chat?: ApiChat;\n  user?: ApiUser;\n  isFirstPhoto?: boolean;\n  isSavedMessages?: boolean;\n  photo?: ApiPhoto;\n  lastSyncTime?: number;\n  notActive?: boolean;\n  onClick: NoneToVoidFunction;\n};\n\nconst ProfilePhoto: FC<OwnProps> = ({\n  chat,\n  user,\n  photo,\n  isFirstPhoto,\n  isSavedMessages,\n  notActive,\n  lastSyncTime,\n  onClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const lang = useLang();\n  const isDeleted = user && isDeletedUser(user);\n  const isRepliesChat = chat && isChatWithRepliesBot(chat.id);\n\n  function getMediaHash(size: 'normal' | 'big', type: 'photo' | 'video' = 'photo') {\n    const userOrChat = user || chat;\n    const profilePhoto = photo || userOrChat?.fullInfo?.profilePhoto;\n    const hasVideo = profilePhoto?.isVideo;\n    const forceAvatar = isFirstPhoto;\n\n    if (type === 'video' && !hasVideo) return undefined;\n\n    if (photo && !forceAvatar) {\n      if (hasVideo && type === 'video') {\n        return getVideoAvatarMediaHash(photo);\n      }\n      if (type === 'photo') {\n        return `photo${photo.id}?size=c`;\n      }\n    }\n\n    if (!isSavedMessages && !isDeleted && !isRepliesChat && userOrChat) {\n      return getChatAvatarHash(userOrChat, size, type);\n    }\n\n    return undefined;\n  }\n\n  useEffect(() => {\n    if (!videoRef.current) return;\n    if (notActive) {\n      videoRef.current.pause();\n      videoRef.current.currentTime = 0;\n    } else {\n      videoRef.current.play();\n    }\n  }, [notActive]);\n\n  const photoHash = getMediaHash('big', 'photo');\n  const photoBlobUrl = useMedia(photoHash, false, ApiMediaFormat.BlobUrl, lastSyncTime);\n  const videoHash = getMediaHash('normal', 'video');\n  const videoBlobUrl = useMedia(videoHash, false, ApiMediaFormat.BlobUrl, lastSyncTime);\n  const imageSrc = videoBlobUrl || photoBlobUrl || photo?.thumbnail?.dataUri;\n\n  let content: TeactNode | undefined;\n\n  if (isSavedMessages) {\n    content = <i className=\"icon-avatar-saved-messages\" />;\n  } else if (isDeleted) {\n    content = <i className=\"icon-avatar-deleted-account\" />;\n  } else if (isRepliesChat) {\n    content = <i className=\"icon-reply-filled\" />;\n  } else if (imageSrc) {\n    if (videoBlobUrl) {\n      content = (\n        <video\n          ref={videoRef}\n          src={imageSrc}\n          className=\"avatar-media\"\n          muted\n          autoPlay={!notActive}\n          loop\n          playsInline\n        />\n      );\n    } else {\n      content = <img src={imageSrc} className=\"avatar-media\" alt=\"\" />;\n    }\n  } else if (user) {\n    const userFullName = getUserFullName(user);\n    content = userFullName ? getFirstLetters(userFullName, 2) : undefined;\n  } else if (chat) {\n    const title = getChatTitle(lang, chat);\n    content = title && getFirstLetters(title, isUserId(chat.id) ? 2 : 1);\n  } else {\n    content = (\n      <div className=\"spinner-wrapper\">\n        <Spinner color=\"white\" />\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'ProfilePhoto',\n    `color-bg-${getUserColorKey(user || chat)}`,\n    isSavedMessages && 'saved-messages',\n    isDeleted && 'deleted-account',\n    isRepliesChat && 'replies-bot-account',\n    (!isSavedMessages && !imageSrc) && 'no-photo',\n  );\n\n  return (\n    <div className={fullClassName} onClick={imageSrc ? onClick : undefined}>\n      {typeof content === 'string' ? renderText(content, ['hq_emoji']) : content}\n    </div>\n  );\n};\n\nexport default memo(ProfilePhoto);\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  useEffect, useCallback, memo, useState,\n} from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiUser, ApiChat, ApiUserStatus } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport { IS_TOUCH_ENV } from '../../util/environment';\nimport { selectChat, selectUser, selectUserStatus } from '../../global/selectors';\nimport {\n  getUserFullName, getUserStatus, isChatChannel, isUserOnline,\n} from '../../global/helpers';\nimport renderText from './helpers/renderText';\nimport { captureEvents, SwipeDirection } from '../../util/captureEvents';\nimport buildClassName from '../../util/buildClassName';\nimport usePhotosPreload from './hooks/usePhotosPreload';\nimport useLang from '../../hooks/useLang';\n\nimport VerifiedIcon from './VerifiedIcon';\nimport ProfilePhoto from './ProfilePhoto';\nimport Transition from '../ui/Transition';\nimport FakeIcon from './FakeIcon';\nimport PremiumIcon from './PremiumIcon';\n\nimport './ProfileInfo.scss';\n\ntype OwnProps = {\n  userId: string;\n  forceShowSelf?: boolean;\n};\n\ntype StateProps =\n  {\n    user?: ApiUser;\n    userStatus?: ApiUserStatus;\n    chat?: ApiChat;\n    isSavedMessages?: boolean;\n    animationLevel: 0 | 1 | 2;\n    serverTimeOffset: number;\n  }\n  & Pick<GlobalState, 'connectionState'>;\n\nconst ProfileInfo: FC<OwnProps & StateProps> = ({\n  forceShowSelf,\n  user,\n  userStatus,\n  chat,\n  isSavedMessages,\n  connectionState,\n  animationLevel,\n  serverTimeOffset,\n}) => {\n  const {\n    loadFullUser,\n    openMediaViewer,\n    openPremiumModal,\n  } = getActions();\n\n  const lang = useLang();\n\n  const { id: userId } = user || {};\n  const { id: chatId } = chat || {};\n  const fullName = user ? getUserFullName(user) : (chat ? chat.title : '');\n  const photos = user?.photos || chat?.photos || [];\n  const slideAnimation = animationLevel >= 1\n    ? (lang.isRtl ? 'slide-optimized-rtl' : 'slide-optimized')\n    : 'none';\n\n  const [currentPhotoIndex, setCurrentPhotoIndex] = useState(0);\n  const isFirst = isSavedMessages || photos.length <= 1 || currentPhotoIndex === 0;\n  const isLast = isSavedMessages || photos.length <= 1 || currentPhotoIndex === photos.length - 1;\n\n  // Deleting the last profile photo may result in an error\n  useEffect(() => {\n    if (currentPhotoIndex > photos.length) {\n      setCurrentPhotoIndex(Math.max(0, photos.length - 1));\n    }\n  }, [currentPhotoIndex, photos.length]);\n\n  useEffect(() => {\n    if (connectionState === 'connectionStateReady' && userId && !forceShowSelf) {\n      loadFullUser({ userId });\n    }\n  }, [userId, loadFullUser, connectionState, forceShowSelf]);\n\n  usePhotosPreload(user || chat, photos, currentPhotoIndex);\n\n  const handleProfilePhotoClick = useCallback(() => {\n    openMediaViewer({\n      avatarOwnerId: userId || chatId,\n      profilePhotoIndex: currentPhotoIndex,\n      origin: forceShowSelf ? MediaViewerOrigin.SettingsAvatar : MediaViewerOrigin.ProfileAvatar,\n    });\n  }, [openMediaViewer, userId, chatId, currentPhotoIndex, forceShowSelf]);\n\n  const handleClickPremium = useCallback(() => {\n    if (!user) return;\n\n    openPremiumModal({ fromUserId: user.id });\n  }, [openPremiumModal, user]);\n\n  const selectPreviousMedia = useCallback(() => {\n    if (isFirst) {\n      return;\n    }\n\n    setCurrentPhotoIndex(currentPhotoIndex - 1);\n  }, [currentPhotoIndex, isFirst]);\n\n  const selectNextMedia = useCallback(() => {\n    if (isLast) {\n      return;\n    }\n\n    setCurrentPhotoIndex(currentPhotoIndex + 1);\n  }, [currentPhotoIndex, isLast]);\n\n  // Swipe gestures\n  useEffect(() => {\n    const element = document.querySelector<HTMLDivElement>('.photo-wrapper');\n    if (!element) {\n      return undefined;\n    }\n\n    return captureEvents(element, {\n      selectorToPreventScroll: '.Profile, .settings-content',\n      onSwipe: IS_TOUCH_ENV ? (e, direction) => {\n        if (direction === SwipeDirection.Right) {\n          selectPreviousMedia();\n          return true;\n        } else if (direction === SwipeDirection.Left) {\n          selectNextMedia();\n          return true;\n        }\n\n        return false;\n      } : undefined,\n    });\n  }, [selectNextMedia, selectPreviousMedia]);\n\n  if (!user && !chat) {\n    return undefined;\n  }\n\n  function renderPhotoTabs() {\n    if (isSavedMessages || !photos || photos.length <= 1) {\n      return undefined;\n    }\n\n    return (\n      <div className=\"photo-dashes\">\n        {photos.map((_, i) => (\n          <span className={`photo-dash ${i === currentPhotoIndex ? 'current' : ''}`} />\n        ))}\n      </div>\n    );\n  }\n\n  function renderPhoto(isActive?: boolean) {\n    const photo = !isSavedMessages && photos.length > 0 ? photos[currentPhotoIndex] : undefined;\n    return (\n      <ProfilePhoto\n        key={currentPhotoIndex}\n        user={user}\n        chat={chat}\n        photo={photo}\n        isSavedMessages={isSavedMessages}\n        isFirstPhoto={isFirst}\n        notActive={!isActive}\n        onClick={handleProfilePhotoClick}\n      />\n    );\n  }\n\n  function renderStatus() {\n    if (user) {\n      return (\n        <div className={`status ${isUserOnline(user, userStatus) ? 'online' : ''}`}>\n          <span className=\"user-status\" dir=\"auto\">{getUserStatus(lang, user, userStatus, serverTimeOffset)}</span>\n        </div>\n      );\n    }\n\n    return (\n      <span className=\"status\" dir=\"auto\">{\n        isChatChannel(chat!)\n          ? lang('Subscribers', chat!.membersCount ?? 0, 'i')\n          : lang('Members', chat!.membersCount ?? 0, 'i')\n      }\n      </span>\n    );\n  }\n\n  const isVerifiedIconShown = (user || chat)?.isVerified;\n  const isPremiumIconShown = user?.isPremium;\n  const fakeType = (user || chat)?.fakeType;\n\n  return (\n    <div className={buildClassName('ProfileInfo', forceShowSelf && 'self')} dir={lang.isRtl ? 'rtl' : undefined}>\n      <div className=\"photo-wrapper\">\n        {renderPhotoTabs()}\n        <Transition activeKey={currentPhotoIndex} name={slideAnimation} className=\"profile-slide-container\">\n          {renderPhoto}\n        </Transition>\n\n        {!isFirst && (\n          <button\n            type=\"button\"\n            className=\"navigation prev\"\n            aria-label={lang('AccDescrPrevious')}\n            onClick={selectPreviousMedia}\n          />\n        )}\n        {!isLast && (\n          <button\n            type=\"button\"\n            className=\"navigation next\"\n            aria-label={lang('Next')}\n            onClick={selectNextMedia}\n          />\n        )}\n      </div>\n\n      <div className=\"info\" dir={lang.isRtl ? 'rtl' : 'auto'}>\n        {isSavedMessages ? (\n          <div className=\"title\">\n            <div className=\"fullName\" dir=\"auto\">{lang('SavedMessages')}</div>\n          </div>\n        ) : (\n          <div className=\"title\">\n            <div className=\"fullName\" dir=\"auto\">{fullName && renderText(fullName)}</div>\n            {isVerifiedIconShown && <VerifiedIcon />}\n            {isPremiumIconShown && <PremiumIcon onClick={handleClickPremium} />}\n            {fakeType && <FakeIcon fakeType={fakeType} />}\n          </div>\n        )}\n        {!isSavedMessages && renderStatus()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { userId, forceShowSelf }): StateProps => {\n    const { connectionState, serverTimeOffset } = global;\n    const user = selectUser(global, userId);\n    const userStatus = selectUserStatus(global, userId);\n    const chat = selectChat(global, userId);\n    const isSavedMessages = !forceShowSelf && user && user.isSelf;\n    const { animationLevel } = global.settings.byKey;\n\n    return {\n      connectionState,\n      user,\n      userStatus,\n      chat,\n      isSavedMessages,\n      animationLevel,\n      serverTimeOffset,\n    };\n  },\n)(ProfileInfo));\n","import type { ApiChat, ApiPhoto, ApiUser } from '../../../api/types';\nimport { ApiMediaFormat } from '../../../api/types';\nimport { useEffect } from '../../../lib/teact/teact';\nimport * as mediaLoader from '../../../util/mediaLoader';\n\nconst PHOTOS_TO_PRELOAD = 4;\n\nexport default function usePhotosPreload(\n  profile: ApiUser | ApiChat | undefined,\n  photos: ApiPhoto[],\n  currentIndex: number,\n) {\n  useEffect(() => {\n    photos.slice(currentIndex, currentIndex + PHOTOS_TO_PRELOAD).forEach((photo) => {\n      const mediaData = mediaLoader.getFromMemory(`photo${photo.id}?size=c`);\n      if (!mediaData) {\n        mediaLoader.fetch(`photo${photo.id}?size=c`, ApiMediaFormat.BlobUrl);\n      }\n    });\n  }, [currentIndex, photos]);\n}\n","import type { RefObject } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\nimport { getGlobal } from '../../global';\n\nimport { ApiMediaFormat } from '../../api/types';\n\nimport useMedia from '../../hooks/useMedia';\nimport buildClassName from '../../util/buildClassName';\n\nimport './ReactionStaticEmoji.scss';\n\ntype OwnProps = {\n  reaction: string;\n  ref?: RefObject<HTMLImageElement>;\n  className?: string;\n};\n\nconst ReactionStaticEmoji: FC<OwnProps> = ({\n  reaction,\n  ref,\n  className,\n}) => {\n  const staticIconId = getGlobal().availableReactions?.find((l) => l.reaction === reaction)?.staticIcon?.id;\n  const mediaData = useMedia(`document${staticIconId}`, !staticIconId, ApiMediaFormat.BlobUrl);\n\n  return (\n    <img\n      className={buildClassName('ReactionStaticEmoji', className)}\n      ref={ref}\n      src={mediaData}\n      alt=\"\"\n    />\n  );\n};\n\nexport default memo(ReactionStaticEmoji);\n","import type { ChangeEvent } from 'react';\n\nimport type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useMemo, useState,\n} from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiPhoto, ApiReportReason } from '../../api/types';\n\nimport useLang from '../../hooks/useLang';\n\nimport Modal from '../ui/Modal';\nimport Button from '../ui/Button';\nimport RadioGroup from '../ui/RadioGroup';\nimport InputText from '../ui/InputText';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  subject?: 'peer' | 'messages' | 'media';\n  chatId?: string;\n  photo?: ApiPhoto;\n  messageIds?: number[];\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n};\n\nconst ReportModal: FC<OwnProps> = ({\n  isOpen,\n  subject = 'messages',\n  chatId,\n  photo,\n  messageIds,\n  onClose,\n  onCloseAnimationEnd,\n}) => {\n  const {\n    reportMessages,\n    reportPeer,\n    reportProfilePhoto,\n    exitMessageSelectMode,\n  } = getActions();\n\n  const [selectedReason, setSelectedReason] = useState<ApiReportReason>('spam');\n  const [description, setDescription] = useState('');\n\n  const handleReport = useCallback(() => {\n    switch (subject) {\n      case 'messages':\n        reportMessages({ messageIds, reason: selectedReason, description });\n        exitMessageSelectMode();\n        break;\n      case 'peer':\n        reportPeer({ chatId, reason: selectedReason, description });\n        break;\n      case 'media':\n        reportProfilePhoto({\n          chatId, photo, reason: selectedReason, description,\n        });\n        break;\n    }\n    onClose();\n  }, [\n    description,\n    exitMessageSelectMode,\n    messageIds,\n    photo,\n    onClose,\n    reportMessages,\n    selectedReason,\n    chatId,\n    reportProfilePhoto,\n    reportPeer,\n    subject,\n  ]);\n\n  const handleSelectReason = useCallback((value: string) => {\n    setSelectedReason(value as ApiReportReason);\n  }, []);\n\n  const handleDescriptionChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    setDescription(e.target.value);\n  }, []);\n\n  const lang = useLang();\n\n  const REPORT_OPTIONS: { value: ApiReportReason; label: string }[] = useMemo(() => [\n    { value: 'spam', label: lang('lng_report_reason_spam') },\n    { value: 'violence', label: lang('lng_report_reason_violence') },\n    { value: 'pornography', label: lang('lng_report_reason_pornography') },\n    { value: 'childAbuse', label: lang('lng_report_reason_child_abuse') },\n    { value: 'copyright', label: lang('ReportPeer.ReasonCopyright') },\n    { value: 'illegalDrugs', label: 'Illegal Drugs' },\n    { value: 'personalDetails', label: 'Personal Details' },\n    { value: 'other', label: lang('lng_report_reason_other') },\n  ], [lang]);\n\n  if (\n    (subject === 'messages' && !messageIds)\n    || (subject === 'peer' && !chatId)\n    || (subject === 'media' && (!chatId || !photo))\n  ) {\n    return undefined;\n  }\n\n  const title = subject === 'messages'\n    ? lang('lng_report_message_title')\n    : lang('ReportPeer.Report');\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={onClose}\n      onEnter={isOpen ? handleReport : undefined}\n      onCloseAnimationEnd={onCloseAnimationEnd}\n      className=\"report\"\n      title={title}\n    >\n      <RadioGroup\n        name=\"report-message\"\n        options={REPORT_OPTIONS}\n        onChange={handleSelectReason}\n        selected={selectedReason}\n      />\n      <InputText\n        label={lang('lng_report_reason_description')}\n        value={description}\n        onChange={handleDescriptionChange}\n      />\n      <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleReport}>\n        {lang('lng_report_button')}\n      </Button>\n      <Button className=\"confirm-dialog-button\" isText onClick={onClose}>{lang('Cancel')}</Button>\n    </Modal>\n  );\n};\n\nexport default memo(ReportModal);\n","import type { MouseEvent as ReactMouseEvent, ReactNode } from 'react';\nimport React, {\n  memo, useCallback, useEffect, useMemo, useRef,\n} from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ApiBotInlineMediaResult, ApiSticker } from '../../api/types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\nimport { preventMessageInputBlurWithBubbling } from '../middle/helpers/preventMessageInputBlur';\nimport safePlay from '../../util/safePlay';\nimport { IS_TOUCH_ENV, IS_WEBM_SUPPORTED } from '../../util/environment';\n\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport { useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMedia from '../../hooks/useMedia';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\nimport useContextMenuHandlers from '../../hooks/useContextMenuHandlers';\nimport useContextMenuPosition from '../../hooks/useContextMenuPosition';\n\nimport AnimatedSticker from './AnimatedSticker';\nimport Button from '../ui/Button';\nimport Menu from '../ui/Menu';\nimport MenuItem from '../ui/MenuItem';\n\nimport './StickerButton.scss';\n\ntype OwnProps<T> = {\n  sticker: ApiSticker;\n  size: number;\n  noAnimate?: boolean;\n  title?: string;\n  className?: string;\n  clickArg: T;\n  noContextMenu?: boolean;\n  isSavedMessages?: boolean;\n  canViewSet?: boolean;\n  isCurrentUserPremium?: boolean;\n  observeIntersection: ObserveFn;\n  onClick?: (arg: OwnProps<T>['clickArg'], isSilent?: boolean, shouldSchedule?: boolean) => void;\n  onFaveClick?: (sticker: ApiSticker) => void;\n  onUnfaveClick?: (sticker: ApiSticker) => void;\n  onRemoveRecentClick?: (sticker: ApiSticker) => void;\n};\n\nconst StickerButton = <T extends number | ApiSticker | ApiBotInlineMediaResult | undefined = undefined>({\n  sticker,\n  size,\n  noAnimate,\n  title,\n  className,\n  clickArg,\n  noContextMenu,\n  isSavedMessages,\n  canViewSet,\n  observeIntersection,\n  onClick,\n  onFaveClick,\n  onUnfaveClick,\n  onRemoveRecentClick,\n  isCurrentUserPremium,\n}: OwnProps<T>) => {\n  const { openStickerSet, openPremiumModal } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const lang = useLang();\n\n  const localMediaHash = `sticker${sticker.id}`;\n  const stickerSelector = `sticker-button-${sticker.id}`;\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const thumbDataUri = sticker.thumbnail ? sticker.thumbnail.dataUri : undefined;\n  const previewBlobUrl = useMedia(`${localMediaHash}?size=m`, !isIntersecting, ApiMediaFormat.BlobUrl);\n\n  const shouldPlay = isIntersecting && !noAnimate;\n  const lottieData = useMedia(sticker.isLottie && localMediaHash, !shouldPlay);\n  const [isLottieLoaded, markLoaded, unmarkLoaded] = useFlag(Boolean(lottieData));\n  const canLottiePlay = isLottieLoaded && shouldPlay;\n  const isVideo = sticker.isVideo && IS_WEBM_SUPPORTED;\n  const videoBlobUrl = useMedia(isVideo && localMediaHash, !shouldPlay, ApiMediaFormat.BlobUrl);\n  const canVideoPlay = Boolean(isVideo && videoBlobUrl && shouldPlay);\n  const isPremiumSticker = sticker.hasEffect;\n  const isLocked = !isCurrentUserPremium && isPremiumSticker;\n\n  const { transitionClassNames: previewTransitionClassNames } = useShowTransition(\n    Boolean(previewBlobUrl || canLottiePlay),\n    undefined,\n    undefined,\n    'slow',\n  );\n\n  const {\n    isContextMenuOpen, contextMenuPosition,\n    handleBeforeContextMenu, handleContextMenu,\n    handleContextMenuClose, handleContextMenuHide,\n  } = useContextMenuHandlers(ref);\n\n  const getTriggerElement = useCallback(() => ref.current, []);\n\n  const getRootElement = useCallback(\n    () => ref.current!.closest('.custom-scroll, .no-scrollbar'),\n    [],\n  );\n\n  const getMenuElement = useCallback(\n    () => ref.current!.querySelector('.sticker-context-menu .bubble'),\n    [],\n  );\n\n  const {\n    positionX, positionY, transformOriginX, transformOriginY, style: menuStyle,\n  } = useContextMenuPosition(\n    contextMenuPosition,\n    getTriggerElement,\n    getRootElement,\n    getMenuElement,\n  );\n\n  // To avoid flickering\n  useEffect(() => {\n    if (!shouldPlay) {\n      unmarkLoaded();\n    }\n  }, [unmarkLoaded, shouldPlay]);\n\n  useEffect(() => {\n    if (!isVideo || !ref.current) return;\n    const video = ref.current.querySelector('video');\n    if (!video) return;\n    if (canVideoPlay) {\n      safePlay(video);\n    } else {\n      video.pause();\n    }\n  }, [isVideo, canVideoPlay]);\n\n  useEffect(() => {\n    if (!isIntersecting) handleContextMenuClose();\n  }, [handleContextMenuClose, isIntersecting]);\n\n  const handleClick = () => {\n    if (isContextMenuOpen) return;\n    if (isLocked) {\n      openPremiumModal({ initialSection: 'stickers' });\n      return;\n    }\n    onClick?.(clickArg);\n  };\n\n  const handleMouseDown = (e: React.MouseEvent<HTMLElement>) => {\n    preventMessageInputBlurWithBubbling(e);\n    handleBeforeContextMenu(e);\n  };\n\n  const handleRemoveClick = useCallback((e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => {\n    e.stopPropagation();\n    e.preventDefault();\n\n    onRemoveRecentClick!(sticker);\n  }, [onRemoveRecentClick, sticker]);\n\n  const handleContextRemoveRecent = useCallback(() => {\n    onRemoveRecentClick!(sticker);\n  }, [onRemoveRecentClick, sticker]);\n\n  const handleContextUnfave = useCallback(() => {\n    onUnfaveClick!(sticker);\n  }, [onUnfaveClick, sticker]);\n\n  const handleContextFave = useCallback(() => {\n    onFaveClick!(sticker);\n  }, [onFaveClick, sticker]);\n\n  const handleSendQuiet = useCallback(() => {\n    onClick?.(clickArg, true);\n  }, [clickArg, onClick]);\n\n  const handleSendScheduled = useCallback(() => {\n    onClick?.(clickArg, undefined, true);\n  }, [clickArg, onClick]);\n\n  const handleOpenSet = useCallback(() => {\n    openStickerSet({ sticker });\n  }, [openStickerSet, sticker]);\n\n  const shouldShowCloseButton = !IS_TOUCH_ENV && onRemoveRecentClick;\n\n  const fullClassName = buildClassName(\n    'StickerButton',\n    onClick && 'interactive',\n    stickerSelector,\n    className,\n  );\n\n  const style = (thumbDataUri && !canLottiePlay && !canVideoPlay) ? `background-image: url('${thumbDataUri}');` : '';\n\n  const contextMenuItems = useMemo(() => {\n    const items: ReactNode[] = [];\n    if (noContextMenu) return items;\n\n    if (onUnfaveClick) {\n      items.push(\n        <MenuItem icon=\"favorite\" onClick={handleContextUnfave}>\n          {lang('Stickers.RemoveFromFavorites')}\n        </MenuItem>,\n      );\n    }\n\n    if (onFaveClick) {\n      items.push(\n        <MenuItem icon=\"favorite\" onClick={handleContextFave}>\n          {lang('Stickers.AddToFavorites')}\n        </MenuItem>,\n      );\n    }\n\n    if (!isLocked && onClick) {\n      if (!isSavedMessages) {\n        items.push(<MenuItem onClick={handleSendQuiet} icon=\"muted\">{lang('SendWithoutSound')}</MenuItem>);\n      }\n      items.push(\n        <MenuItem onClick={handleSendScheduled} icon=\"calendar\">\n          {lang(isSavedMessages ? 'SetReminder' : 'ScheduleMessage')}\n        </MenuItem>,\n      );\n    }\n\n    if (canViewSet) {\n      items.push(\n        <MenuItem onClick={handleOpenSet} icon=\"stickers\">\n          {lang('ViewPackPreview')}\n        </MenuItem>,\n      );\n    }\n    if (onRemoveRecentClick) {\n      items.push(\n        <MenuItem icon=\"delete\" onClick={handleContextRemoveRecent}>\n          {lang('DeleteFromRecent')}\n        </MenuItem>,\n      );\n    }\n    return items;\n  }, [\n    canViewSet, handleContextFave, handleContextRemoveRecent, handleContextUnfave, handleOpenSet, handleSendQuiet,\n    handleSendScheduled, isLocked, isSavedMessages, lang, onFaveClick, onRemoveRecentClick, onUnfaveClick, onClick,\n    noContextMenu,\n  ]);\n\n  return (\n    <div\n      ref={ref}\n      className={fullClassName}\n      title={title || (sticker?.emoji)}\n      style={style}\n      data-sticker-id={sticker.id}\n      onMouseDown={handleMouseDown}\n      onClick={handleClick}\n      onContextMenu={handleContextMenu}\n    >\n      {!canLottiePlay && !canVideoPlay && (\n        // eslint-disable-next-line jsx-a11y/alt-text\n        <img src={previewBlobUrl} className={previewTransitionClassNames} />\n      )}\n      {isVideo && (\n        <video\n          className={previewTransitionClassNames}\n          src={videoBlobUrl}\n          autoPlay={canVideoPlay}\n          loop\n          playsInline\n          muted\n        />\n      )}\n      {shouldPlay && lottieData && (\n        <AnimatedSticker\n          tgsUrl={lottieData}\n          play\n          size={size}\n          isLowPriority\n          onLoad={markLoaded}\n        />\n      )}\n      {isLocked && (\n        <div\n          className=\"sticker-locked\"\n        >\n          <i className=\"icon-lock-badge\" />\n        </div>\n      )}\n      {isPremiumSticker && !isLocked && (\n        <div className=\"sticker-premium\">\n          <i className=\"icon-premium\" />\n        </div>\n      )}\n      {shouldShowCloseButton && (\n        <Button\n          className=\"sticker-remove-button\"\n          color=\"dark\"\n          round\n          onClick={handleRemoveClick}\n        >\n          <i className=\"icon-close\" />\n        </Button>\n      )}\n      {Boolean(contextMenuItems.length) && contextMenuPosition !== undefined && (\n        <Menu\n          isOpen={isContextMenuOpen}\n          transformOriginX={transformOriginX}\n          transformOriginY={transformOriginY}\n          positionX={positionX}\n          positionY={positionY}\n          style={menuStyle}\n          className=\"sticker-context-menu\"\n          autoClose\n          onClose={handleContextMenuClose}\n          onCloseAnimationEnd={handleContextMenuHide}\n        >\n          {contextMenuItems}\n        </Menu>\n      )}\n    </div>\n  );\n};\n\nexport default memo(StickerButton);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\nimport type { OwnProps } from './StickerSetModal';\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst StickerSetModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const StickerSetModal = useModuleLoader(Bundles.Extra, 'StickerSetModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return StickerSetModal ? <StickerSetModal {...props} /> : undefined;\n};\n\nexport default memo(StickerSetModalAsync);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type { ApiUser, ApiTypingStatus } from '../../api/types';\n\nimport { selectUser } from '../../global/selectors';\nimport { getUserFirstOrLastName } from '../../global/helpers';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport DotAnimation from './DotAnimation';\n\nimport './TypingStatus.scss';\n\ntype OwnProps = {\n  typingStatus: ApiTypingStatus;\n};\n\ntype StateProps = {\n  typingUser?: ApiUser;\n};\n\nconst TypingStatus: FC<OwnProps & StateProps> = ({ typingStatus, typingUser }) => {\n  const lang = useLang();\n  const typingUserName = typingUser && !typingUser.isSelf && getUserFirstOrLastName(typingUser);\n  const content = lang(typingStatus.action)\n    // Fix for translation \"{user} is typing\"\n    .replace('{user}', '')\n    .replace('{emoji}', typingStatus.emoji).trim();\n\n  return (\n    <p className=\"typing-status\" dir={lang.isRtl ? 'rtl' : 'auto'}>\n      {typingUserName && (\n        <span className=\"sender-name\" dir=\"auto\">{renderText(typingUserName)}</span>\n      )}\n      <DotAnimation content={content} />\n    </p>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { typingStatus }): StateProps => {\n    if (!typingStatus.userId) {\n      return {};\n    }\n\n    const typingUser = selectUser(global, typingStatus.userId);\n\n    return { typingUser };\n  },\n)(TypingStatus));\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport './VerifiedIcon.scss';\n\n// eslint-disable-next-line max-len\nconst VERIFIED_ICON = { __html: '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M12.3 2.9c.1.1.2.1.3.2.7.6 1.3 1.1 2 1.7.3.2.6.4.9.4.9.1 1.7.2 2.6.2.5 0 .6.1.7.7.1.9.1 1.8.2 2.6 0 .4.2.7.4 1 .6.7 1.1 1.3 1.7 2 .3.4.3.5 0 .8-.5.6-1.1 1.3-1.6 1.9-.3.3-.5.7-.5 1.2-.1.8-.2 1.7-.2 2.5 0 .4-.2.5-.6.6-.8 0-1.6.1-2.5.2-.5 0-1 .2-1.4.5-.6.5-1.3 1.1-1.9 1.6-.3.3-.5.3-.8 0-.7-.6-1.4-1.2-2-1.8-.3-.2-.6-.4-.9-.4-.9-.1-1.8-.2-2.7-.2-.4 0-.5-.2-.6-.5 0-.9-.1-1.7-.2-2.6 0-.4-.2-.8-.4-1.1-.6-.6-1.1-1.3-1.6-2-.4-.4-.3-.5 0-1 .6-.6 1.1-1.3 1.7-1.9.3-.3.4-.6.4-1 0-.8.1-1.6.2-2.5 0-.5.1-.6.6-.6.9-.1 1.7-.1 2.6-.2.4 0 .7-.2 1-.4.7-.6 1.4-1.2 2.1-1.7.1-.2.3-.3.5-.2z\" style=\"fill: var(--color-fill)\"/><path class=\"lol\" d=\"M16.4 10.1l-.2.2-5.4 5.4c-.1.1-.2.2-.4 0l-2.6-2.6c-.2-.2-.1-.3 0-.4.2-.2.5-.6.7-.6.3 0 .5.4.7.6l1.1 1.1c.2.2.3.2.5 0l4.3-4.3c.2-.2.4-.3.6 0 .1.2.3.3.4.5.2 0 .3.1.3.1z\" style=\"fill: var(--color-checkmark)\"/></svg>' };\n\nconst VerifiedIcon: FC = () => {\n  return (\n    // eslint-disable-next-line react/no-danger\n    <span className=\"VerifiedIcon\" dangerouslySetInnerHTML={VERIFIED_ICON} />\n  );\n};\n\nexport default VerifiedIcon;\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useCallback } from '../../lib/teact/teact';\n\nimport type { ApiMessage, ApiWebPage } from '../../api/types';\nimport type { TextPart } from '../../types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport {\n  getFirstLinkInMessage, getMessageText,\n  getMessageWebPage,\n} from '../../global/helpers';\nimport buildClassName from '../../util/buildClassName';\nimport trimText from '../../util/trimText';\nimport renderText from './helpers/renderText';\nimport { formatPastTimeShort } from '../../util/dateFormat';\nimport useLang from '../../hooks/useLang';\nimport { renderMessageSummary } from './helpers/renderMessageText';\n\nimport Media from './Media';\nimport Link from '../ui/Link';\nimport SafeLink from './SafeLink';\n\nimport './WebLink.scss';\n\nconst MAX_TEXT_LENGTH = 170; // symbols\n\ntype OwnProps = {\n  message: ApiMessage;\n  senderTitle?: string;\n  isProtected?: boolean;\n  observeIntersection?: ObserveFn;\n  onMessageClick: (messageId: number, chatId: string) => void;\n};\n\ntype ApiWebPageWithFormatted =\n  ApiWebPage\n  & { formattedDescription?: TextPart[] };\n\nconst WebLink: FC<OwnProps> = ({\n  message, senderTitle, isProtected, observeIntersection, onMessageClick,\n}) => {\n  const lang = useLang();\n\n  let linkData: ApiWebPageWithFormatted | undefined = getMessageWebPage(message);\n\n  if (!linkData) {\n    const link = getFirstLinkInMessage(message);\n    if (link) {\n      const { url, domain } = link;\n\n      linkData = {\n        siteName: domain.replace(/^www./, ''),\n        url: url.includes('://') ? url : url.includes('@') ? `mailto:${url}` : `http://${url}`,\n        formattedDescription: getMessageText(message) !== url\n          ? renderMessageSummary(lang, message, undefined, undefined, MAX_TEXT_LENGTH)\n          : undefined,\n      } as ApiWebPageWithFormatted;\n    }\n  }\n\n  const handleMessageClick = useCallback(() => {\n    onMessageClick(message.id, message.chatId);\n  }, [onMessageClick, message.id, message.chatId]);\n\n  if (!linkData) {\n    return undefined;\n  }\n\n  const {\n    siteName,\n    url,\n    displayUrl,\n    title,\n    description,\n    formattedDescription,\n    photo,\n    video,\n  } = linkData;\n\n  const truncatedDescription = !senderTitle && description && trimText(description, MAX_TEXT_LENGTH);\n\n  const className = buildClassName(\n    'WebLink scroll-item',\n    (!photo && !video) && 'without-media',\n  );\n\n  return (\n    <div\n      className={className}\n      data-initial={(siteName || displayUrl)[0]}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {photo && (\n        <Media message={message} isProtected={isProtected} observeIntersection={observeIntersection} />\n      )}\n      <div className=\"content\">\n        <Link isRtl={lang.isRtl} className=\"site-title\" onClick={handleMessageClick}>\n          {renderText(title || siteName || displayUrl)}\n        </Link>\n        {(truncatedDescription || formattedDescription) && (\n          <Link isRtl={lang.isRtl} className=\"site-description\" onClick={handleMessageClick}>\n            {formattedDescription || (truncatedDescription && renderText(truncatedDescription))}\n          </Link>\n        )}\n        <SafeLink\n          url={url}\n          className=\"site-name\"\n          text=\"\"\n          isRtl={lang.isRtl}\n        >\n          {url.replace('mailto:', '') || displayUrl}\n        </SafeLink>\n        {senderTitle && <div className=\"sender-name\">{renderText(senderTitle)}</div>}\n      </div>\n      {senderTitle && (\n        <div className=\"message-date\">\n          <Link\n            className=\"date\"\n            onClick={handleMessageClick}\n            isRtl={lang.isRtl}\n          >\n            {formatPastTimeShort(lang, message.date * 1000)}\n          </Link>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(WebLink);\n","import type {\n  ApiPhoto, ApiVideo, ApiSticker, ApiDimensions,\n} from '../../../api/types';\n\nimport { STICKER_SIZE_INLINE_DESKTOP_FACTOR, STICKER_SIZE_INLINE_MOBILE_FACTOR } from '../../../config';\nimport { IS_SINGLE_COLUMN_LAYOUT, IS_TOUCH_ENV } from '../../../util/environment';\nimport windowSize from '../../../util/windowSize';\nimport { getPhotoInlineDimensions, getVideoDimensions } from '../../../global/helpers';\n\nexport const MEDIA_VIEWER_MEDIA_QUERY = '(max-height: 640px)';\nexport const REM = parseInt(getComputedStyle(document.documentElement).fontSize, 10);\nexport const ROUND_VIDEO_DIMENSIONS_PX = 240;\nexport const GIF_MIN_WIDTH = 300;\nexport const AVATAR_FULL_DIMENSIONS = { width: 640, height: 640 };\nexport const VIDEO_AVATAR_FULL_DIMENSIONS = { width: 800, height: 800 };\nexport const LIKE_STICKER_ID = '4986041492570112461';\n\nconst DEFAULT_MEDIA_DIMENSIONS: ApiDimensions = { width: 100, height: 100 };\nconst MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM = 4.5;\nconst MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM = 7;\nconst MESSAGE_MAX_WIDTH_REM = 29;\nconst MESSAGE_OWN_MAX_WIDTH_REM = 30;\n\nlet cachedMaxWidthOwn: number | undefined;\nlet cachedMaxWidth: number | undefined;\nlet cachedMaxWidthNoAvatar: number | undefined;\n\nfunction getMaxMessageWidthRem(fromOwnMessage: boolean, noAvatars?: boolean) {\n  const regularMaxWidth = fromOwnMessage ? MESSAGE_OWN_MAX_WIDTH_REM : MESSAGE_MAX_WIDTH_REM;\n  if (!IS_SINGLE_COLUMN_LAYOUT) {\n    return regularMaxWidth;\n  }\n\n  const { width: windowWidth } = windowSize.get();\n\n  // @optimization Limitation: changing device screen width not supported\n  if (!cachedMaxWidthOwn) {\n    cachedMaxWidthOwn = Math.min(\n      MESSAGE_OWN_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidth) {\n    cachedMaxWidth = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidthNoAvatar) {\n    cachedMaxWidthNoAvatar = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n\n  return fromOwnMessage\n    ? cachedMaxWidthOwn\n    : (noAvatars ? cachedMaxWidthNoAvatar : cachedMaxWidth);\n}\n\nexport function getAvailableWidth(\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  isWebPagePhoto?: boolean,\n  noAvatars?: boolean,\n) {\n  const extraPaddingRem = isForwarded || isWebPagePhoto ? 1.625 : 0;\n  const availableWidthRem = getMaxMessageWidthRem(fromOwnMessage, noAvatars) - extraPaddingRem;\n\n  return availableWidthRem * REM;\n}\n\nfunction getAvailableHeight(isGif?: boolean, aspectRatio?: number) {\n  if (\n    isGif && aspectRatio\n    && aspectRatio >= 0.75 && aspectRatio <= 1.25\n  ) {\n    return 20 * REM;\n  }\n\n  return 27 * REM;\n}\n\nfunction calculateDimensionsForMessageMedia({\n  width,\n  height,\n  fromOwnMessage,\n  isForwarded,\n  isWebPagePhoto,\n  isGif,\n  noAvatars,\n}: {\n  width: number;\n  height: number;\n  fromOwnMessage: boolean;\n  isForwarded?: boolean;\n  isWebPagePhoto?: boolean;\n  isGif?: boolean;\n  noAvatars?: boolean;\n}): ApiDimensions {\n  const aspectRatio = height / width;\n  const availableWidth = getAvailableWidth(fromOwnMessage, isForwarded, isWebPagePhoto, noAvatars);\n  const availableHeight = getAvailableHeight(isGif, aspectRatio);\n  const mediaWidth = isGif ? Math.max(GIF_MIN_WIDTH, width) : width;\n  const mediaHeight = isGif ? height * (mediaWidth / width) : height;\n\n  return calculateDimensions(availableWidth, availableHeight, mediaWidth, mediaHeight);\n}\n\nexport function getMediaViewerAvailableDimensions(withFooter: boolean, isVideo: boolean): ApiDimensions {\n  const mql = window.matchMedia(MEDIA_VIEWER_MEDIA_QUERY);\n  const { width: windowWidth, height: windowHeight } = windowSize.get();\n  let occupiedHeightRem = isVideo && mql.matches ? 10 : 8.25;\n  if (withFooter && !IS_TOUCH_ENV) {\n    occupiedHeightRem = mql.matches ? 10 : 12.5;\n  }\n  return {\n    width: windowWidth,\n    height: windowHeight - occupiedHeightRem * REM,\n  };\n}\n\nexport function calculateInlineImageDimensions(\n  photo: ApiPhoto,\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  isWebPagePhoto?: boolean,\n  noAvatars?: boolean,\n) {\n  const { width, height } = getPhotoInlineDimensions(photo) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    isForwarded,\n    isWebPagePhoto,\n    noAvatars,\n  });\n}\n\nexport function calculateVideoDimensions(\n  video: ApiVideo,\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  noAvatars?: boolean,\n) {\n  const { width, height } = getVideoDimensions(video) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    isForwarded,\n    isGif: video.isGif,\n    noAvatars,\n  });\n}\n\nexport function getPictogramDimensions(): ApiDimensions {\n  return {\n    width: 2 * REM,\n    height: 2 * REM,\n  };\n}\n\nexport function getDocumentThumbnailDimensions(smaller?: boolean): ApiDimensions {\n  if (smaller) {\n    return {\n      width: 3 * REM,\n      height: 3 * REM,\n    };\n  }\n\n  return {\n    width: 3.375 * REM,\n    height: 3.375 * REM,\n  };\n}\n\nexport function getStickerDimensions(sticker: ApiSticker): ApiDimensions {\n  const { width } = sticker;\n  let { height } = sticker;\n\n  // For some reason this sticker has some weird `height` value\n  if (sticker.id === LIKE_STICKER_ID) {\n    height = width;\n  }\n\n  const aspectRatio = (height && width) && height / width;\n  const baseWidth = REM * (\n    IS_SINGLE_COLUMN_LAYOUT\n      ? STICKER_SIZE_INLINE_MOBILE_FACTOR\n      : STICKER_SIZE_INLINE_DESKTOP_FACTOR\n  );\n  const calculatedHeight = aspectRatio ? baseWidth * aspectRatio : baseWidth;\n\n  if (aspectRatio && calculatedHeight > baseWidth) {\n    return {\n      width: Math.round(baseWidth / aspectRatio),\n      height: baseWidth,\n    };\n  }\n\n  return {\n    width: baseWidth,\n    height: calculatedHeight,\n  };\n}\n\nexport function calculateMediaViewerDimensions(\n  { width, height }: ApiDimensions, withFooter: boolean, isVideo: boolean = false,\n): ApiDimensions {\n  const { width: availableWidth, height: availableHeight } = getMediaViewerAvailableDimensions(withFooter, isVideo);\n\n  return calculateDimensions(availableWidth, availableHeight, width, height);\n}\n\nexport function calculateDimensions(\n  availableWidth: number,\n  availableHeight: number,\n  mediaWidth: number,\n  mediaHeight: number,\n): ApiDimensions {\n  const aspectRatio = mediaHeight / mediaWidth;\n  const calculatedWidth = Math.min(mediaWidth, availableWidth);\n  const calculatedHeight = Math.round(calculatedWidth * aspectRatio);\n\n  if (calculatedHeight > availableHeight) {\n    return {\n      width: Math.round(availableHeight / aspectRatio),\n      height: availableHeight,\n    };\n  }\n\n  return {\n    width: calculatedWidth,\n    height: Math.round(calculatedWidth * aspectRatio),\n  };\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\nimport { Bundles } from '../../util/moduleLoader';\nimport type { OwnProps } from './ChatFolderModal';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst ChatFolderModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const ChatFolderModal = useModuleLoader(Bundles.Extra, 'ChatFolderModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return ChatFolderModal ? <ChatFolderModal {...props} /> : undefined;\n};\n\nexport default memo(ChatFolderModalAsync);\n","import { useMemo } from '../../../../lib/teact/teact';\n\nexport enum ChatAnimationTypes {\n  Move,\n  Opacity,\n  None,\n}\n\nexport function useChatAnimationType(orderDiffById: Record<string, number>) {\n  return useMemo(() => {\n    const orderDiffs = Object.values(orderDiffById);\n    const numberOfUp = orderDiffs.filter((diff) => diff < 0).length;\n    const numberOfDown = orderDiffs.filter((diff) => diff > 0).length;\n\n    return (chatId: string): ChatAnimationTypes => {\n      const orderDiff = orderDiffById[chatId];\n      if (orderDiff === 0) {\n        return ChatAnimationTypes.None;\n      }\n\n      if (\n        orderDiff === Infinity\n        || orderDiff === -Infinity\n        || (numberOfUp <= numberOfDown && orderDiff < 0)\n        || (numberOfDown < numberOfUp && orderDiff > 0)\n      ) {\n        return ChatAnimationTypes.Opacity;\n      }\n\n      return ChatAnimationTypes.Move;\n    };\n  }, [orderDiffById]);\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\n\nimport type { ApiChat } from '../../../api/types';\n\nimport { formatIntegerCompact } from '../../../util/textFormat';\nimport buildClassName from '../../../util/buildClassName';\n\nimport ShowTransition from '../../ui/ShowTransition';\n\nimport './Badge.scss';\n\ntype OwnProps = {\n  chat: ApiChat;\n  isPinned?: boolean;\n  isMuted?: boolean;\n};\n\nconst Badge: FC<OwnProps> = ({ chat, isPinned, isMuted }) => {\n  const isShown = Boolean(\n    chat.unreadCount || chat.unreadMentionsCount || chat.hasUnreadMark || isPinned || chat.unreadReactionsCount,\n  );\n  const isUnread = Boolean(chat.unreadCount || chat.hasUnreadMark);\n  const className = buildClassName(\n    'Badge',\n    isMuted && 'muted',\n    !isUnread && isPinned && 'pinned',\n    isUnread && 'unread',\n  );\n\n  function renderContent() {\n    const unreadReactionsElement = chat.unreadReactionsCount && (\n      <div className={buildClassName('Badge reaction', isMuted && 'muted')}>\n        <i className=\"icon-heart\" />\n      </div>\n    );\n\n    const unreadMentionsElement = chat.unreadMentionsCount && (\n      <div className=\"Badge mention\">\n        <i className=\"icon-mention\" />\n      </div>\n    );\n\n    const unreadCountElement = (chat.hasUnreadMark || chat.unreadCount) ? (\n      <div className={className}>\n        {!chat.hasUnreadMark && formatIntegerCompact(chat.unreadCount!)}\n      </div>\n    ) : undefined;\n\n    const pinnedElement = isPinned && !unreadCountElement && !unreadMentionsElement && !unreadReactionsElement && (\n      <div className={className}>\n        <i className=\"icon-pinned-chat\" />\n      </div>\n    );\n\n    const elements = [unreadReactionsElement, unreadMentionsElement, unreadCountElement, pinnedElement].filter(Boolean);\n\n    if (elements.length === 0) return undefined;\n\n    if (elements.length === 1) return elements[0];\n\n    return (\n      <div className=\"Badge-wrapper\">\n        {elements}\n      </div>\n    );\n  }\n\n  return (\n    <ShowTransition isCustom className=\"Badge-transition\" isOpen={isShown}>\n      {renderContent()}\n    </ShowTransition>\n  );\n};\n\nexport default memo(Badge);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\nimport buildClassName from '../../../util/buildClassName';\n\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\n\nimport './ChatCallStatus.scss';\n\ntype OwnProps = {\n  isSelected?: boolean;\n  isActive?: boolean;\n};\n\nconst ChatCallStatus: FC<OwnProps> = ({\n  isSelected,\n  isActive,\n}) => {\n  return (\n    <div className={buildClassName(\n      'ChatCallStatus',\n      isActive && 'active',\n      isSelected && !IS_SINGLE_COLUMN_LAYOUT && 'selected',\n    )}\n    >\n      <div className=\"indicator\">\n        <div />\n        <div />\n        <div />\n      </div>\n    </div>\n  );\n};\n\nexport default memo(ChatCallStatus);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useLayoutEffect, useMemo, useRef,\n} from '../../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../../global';\n\nimport type { LangFn } from '../../../hooks/useLang';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type {\n  ApiChat, ApiUser, ApiMessage, ApiMessageOutgoingStatus, ApiFormattedText, ApiUserStatus,\n} from '../../../api/types';\nimport { MAIN_THREAD_ID } from '../../../api/types';\n\nimport { ANIMATION_END_DELAY } from '../../../config';\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\nimport {\n  getChatTitle,\n  isUserId,\n  isActionMessage,\n  getPrivateChatUserId,\n  getMessageAction,\n  getMessageSenderName,\n  isChatChannel,\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  getMessageVideo,\n  getMessageSticker,\n  selectIsChatMuted,\n  getMessageRoundVideo,\n} from '../../../global/helpers';\nimport {\n  selectChat, selectUser, selectChatMessage, selectOutgoingStatus, selectDraft, selectCurrentMessageList,\n  selectNotifySettings, selectNotifyExceptions, selectUserStatus,\n} from '../../../global/selectors';\nimport { renderActionMessageText } from '../../common/helpers/renderActionMessageText';\nimport renderText from '../../common/helpers/renderText';\nimport { fastRaf } from '../../../util/schedulers';\nimport buildClassName from '../../../util/buildClassName';\nimport { renderMessageSummary } from '../../common/helpers/renderMessageText';\n\nimport useEnsureMessage from '../../../hooks/useEnsureMessage';\nimport useChatContextActions from '../../../hooks/useChatContextActions';\nimport useFlag from '../../../hooks/useFlag';\nimport useMedia from '../../../hooks/useMedia';\nimport { ChatAnimationTypes } from './hooks';\nimport useLang from '../../../hooks/useLang';\n\nimport Avatar from '../../common/Avatar';\nimport VerifiedIcon from '../../common/VerifiedIcon';\nimport TypingStatus from '../../common/TypingStatus';\nimport LastMessageMeta from '../../common/LastMessageMeta';\nimport DeleteChatModal from '../../common/DeleteChatModal';\nimport ListItem from '../../ui/ListItem';\nimport Badge from './Badge';\nimport ChatFolderModal from '../ChatFolderModal.async';\nimport ChatCallStatus from './ChatCallStatus';\nimport ReportModal from '../../common/ReportModal';\nimport FakeIcon from '../../common/FakeIcon';\nimport PremiumIcon from '../../common/PremiumIcon';\n\nimport './Chat.scss';\n\ntype OwnProps = {\n  style?: string;\n  chatId: string;\n  folderId?: number;\n  orderDiff: number;\n  animationType: ChatAnimationTypes;\n  isPinned?: boolean;\n  observeIntersection?: ObserveFn;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  isMuted?: boolean;\n  user?: ApiUser;\n  userStatus?: ApiUserStatus;\n  actionTargetUserIds?: string[];\n  actionTargetMessage?: ApiMessage;\n  actionTargetChatId?: string;\n  lastMessageSender?: ApiUser;\n  lastMessageOutgoingStatus?: ApiMessageOutgoingStatus;\n  draft?: ApiFormattedText;\n  animationLevel?: number;\n  isSelected?: boolean;\n  canScrollDown?: boolean;\n  canChangeFolder?: boolean;\n  lastSyncTime?: number;\n};\n\nconst ANIMATION_DURATION = 200;\n\nconst Chat: FC<OwnProps & StateProps> = ({\n  style,\n  chatId,\n  folderId,\n  orderDiff,\n  animationType,\n  isPinned,\n  observeIntersection,\n  chat,\n  isMuted,\n  user,\n  userStatus,\n  actionTargetUserIds,\n  lastMessageSender,\n  lastMessageOutgoingStatus,\n  actionTargetMessage,\n  actionTargetChatId,\n  draft,\n  animationLevel,\n  isSelected,\n  canScrollDown,\n  canChangeFolder,\n  lastSyncTime,\n}) => {\n  const {\n    openChat,\n    focusLastMessage,\n  } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const [isDeleteModalOpen, openDeleteModal, closeDeleteModal] = useFlag();\n  const [isChatFolderModalOpen, openChatFolderModal, closeChatFolderModal] = useFlag();\n  const [isReportModalOpen, openReportModal, closeReportModal] = useFlag();\n  const [shouldRenderDeleteModal, markRenderDeleteModal, unmarkRenderDeleteModal] = useFlag();\n  const [shouldRenderChatFolderModal, markRenderChatFolderModal, unmarkRenderChatFolderModal] = useFlag();\n  const [shouldRenderReportModal, markRenderReportModal, unmarkRenderReportModal] = useFlag();\n\n  const { lastMessage, typingStatus } = chat || {};\n  const isAction = lastMessage && isActionMessage(lastMessage);\n\n  useEnsureMessage(chatId, isAction ? lastMessage!.replyToMessageId : undefined, actionTargetMessage);\n\n  const mediaThumbnail = lastMessage && !getMessageSticker(lastMessage)\n    ? getMessageMediaThumbDataUri(lastMessage)\n    : undefined;\n  const mediaBlobUrl = useMedia(lastMessage ? getMessageMediaHash(lastMessage, 'micro') : undefined);\n  const isRoundVideo = Boolean(lastMessage && getMessageRoundVideo(lastMessage));\n\n  const actionTargetUsers = useMemo(() => {\n    if (!actionTargetUserIds) {\n      return undefined;\n    }\n\n    // No need for expensive global updates on users, so we avoid them\n    const usersById = getGlobal().users.byId;\n    return actionTargetUserIds.map((userId) => usersById[userId]).filter<ApiUser>(Boolean as any);\n  }, [actionTargetUserIds]);\n\n  // Sets animation excess values when `orderDiff` changes and then resets excess values to animate.\n  useLayoutEffect(() => {\n    const element = ref.current;\n\n    if (animationLevel === 0 || !element) {\n      return;\n    }\n\n    // TODO Refactor animation: create `useListAnimation` that owns `orderDiff` and `animationType`\n    if (animationType === ChatAnimationTypes.Opacity) {\n      element.style.opacity = '0';\n\n      fastRaf(() => {\n        element.classList.add('animate-opacity');\n        element.style.opacity = '1';\n      });\n    } else if (animationType === ChatAnimationTypes.Move) {\n      element.style.transform = `translate3d(0, ${-orderDiff * 100}%, 0)`;\n\n      fastRaf(() => {\n        element.classList.add('animate-transform');\n        element.style.transform = '';\n      });\n    } else {\n      return;\n    }\n\n    setTimeout(() => {\n      fastRaf(() => {\n        element.classList.remove('animate-opacity', 'animate-transform');\n        element.style.opacity = '';\n        element.style.transform = '';\n      });\n    }, ANIMATION_DURATION + ANIMATION_END_DELAY);\n  }, [animationLevel, orderDiff, animationType]);\n\n  const handleClick = useCallback(() => {\n    openChat({ id: chatId, shouldReplaceHistory: true });\n\n    if (isSelected && canScrollDown) {\n      focusLastMessage();\n    }\n  }, [\n    isSelected,\n    canScrollDown,\n    openChat,\n    chatId,\n    focusLastMessage,\n  ]);\n\n  const handleDelete = useCallback(() => {\n    markRenderDeleteModal();\n    openDeleteModal();\n  }, [markRenderDeleteModal, openDeleteModal]);\n\n  const handleChatFolderChange = useCallback(() => {\n    markRenderChatFolderModal();\n    openChatFolderModal();\n  }, [markRenderChatFolderModal, openChatFolderModal]);\n\n  const handleReport = useCallback(() => {\n    markRenderReportModal();\n    openReportModal();\n  }, [markRenderReportModal, openReportModal]);\n\n  const contextActions = useChatContextActions({\n    chat,\n    user,\n    handleDelete,\n    handleChatFolderChange,\n    handleReport,\n    folderId,\n    isPinned,\n    isMuted,\n    canChangeFolder,\n  });\n\n  const lang = useLang();\n\n  if (!chat) {\n    return undefined;\n  }\n\n  function renderLastMessageOrTyping() {\n    if (typingStatus && lastMessage && typingStatus.timestamp > lastMessage.date * 1000) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (draft?.text.length) {\n      return (\n        <p className=\"last-message\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n          <span className=\"draft\">{lang('Draft')}</span>\n          {renderText(draft.text)}\n        </p>\n      );\n    }\n\n    if (!lastMessage) {\n      return undefined;\n    }\n\n    if (isAction) {\n      const isChat = chat && (isChatChannel(chat) || lastMessage.senderId === lastMessage.chatId);\n\n      return (\n        <p className=\"last-message\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n          {renderActionMessageText(\n            lang,\n            lastMessage,\n            !isChat ? lastMessageSender : undefined,\n            isChat ? chat : undefined,\n            actionTargetUsers,\n            actionTargetMessage,\n            actionTargetChatId,\n            { asTextWithSpoilers: true },\n          )}\n        </p>\n      );\n    }\n\n    const senderName = getMessageSenderName(lang, chatId, lastMessageSender);\n\n    return (\n      <p className=\"last-message\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n        {senderName && (\n          <>\n            <span className=\"sender-name\">{renderText(senderName)}</span>\n            <span className=\"colon\">:</span>\n          </>\n        )}\n        {renderSummary(lang, lastMessage!, mediaBlobUrl || mediaThumbnail, isRoundVideo)}\n      </p>\n    );\n  }\n\n  const className = buildClassName(\n    'Chat chat-item-clickable',\n    isUserId(chatId) ? 'private' : 'group',\n    isSelected && 'selected',\n  );\n\n  return (\n    <ListItem\n      ref={ref}\n      className={className}\n      style={style}\n      ripple={!IS_SINGLE_COLUMN_LAYOUT}\n      contextActions={contextActions}\n      onClick={handleClick}\n    >\n      <div className=\"status\">\n        <Avatar\n          chat={chat}\n          user={user}\n          userStatus={userStatus}\n          isSavedMessages={user?.isSelf}\n          lastSyncTime={lastSyncTime}\n          observeIntersection={observeIntersection}\n        />\n        {chat.isCallActive && chat.isCallNotEmpty && (\n          <ChatCallStatus isSelected={isSelected} isActive={animationLevel !== 0} />\n        )}\n      </div>\n      <div className=\"info\">\n        <div className=\"title\">\n          <h3>{renderText(getChatTitle(lang, chat, user))}</h3>\n          {chat.isVerified && <VerifiedIcon />}\n          {user?.isPremium && !user.isSelf && <PremiumIcon />}\n          {chat.fakeType && <FakeIcon fakeType={chat.fakeType} />}\n          {isMuted && <i className=\"icon-muted\" />}\n          {chat.lastMessage && (\n            <LastMessageMeta\n              message={chat.lastMessage}\n              outgoingStatus={lastMessageOutgoingStatus}\n            />\n          )}\n        </div>\n        <div className=\"subtitle\">\n          {renderLastMessageOrTyping()}\n          <Badge chat={chat} isPinned={isPinned} isMuted={isMuted} />\n        </div>\n      </div>\n      {shouldRenderDeleteModal && (\n        <DeleteChatModal\n          isOpen={isDeleteModalOpen}\n          onClose={closeDeleteModal}\n          onCloseAnimationEnd={unmarkRenderDeleteModal}\n          chat={chat}\n        />\n      )}\n      {shouldRenderChatFolderModal && (\n        <ChatFolderModal\n          isOpen={isChatFolderModalOpen}\n          onClose={closeChatFolderModal}\n          onCloseAnimationEnd={unmarkRenderChatFolderModal}\n          chatId={chatId}\n        />\n      )}\n      {shouldRenderReportModal && (\n        <ReportModal\n          isOpen={isReportModalOpen}\n          onClose={closeReportModal}\n          onCloseAnimationEnd={unmarkRenderReportModal}\n          chatId={chatId}\n          subject=\"peer\"\n        />\n      )}\n    </ListItem>\n  );\n};\n\nfunction renderSummary(lang: LangFn, message: ApiMessage, blobUrl?: string, isRoundVideo?: boolean) {\n  if (!blobUrl) {\n    return renderMessageSummary(lang, message);\n  }\n\n  return (\n    <span className=\"media-preview\">\n      <img src={blobUrl} alt=\"\" className={buildClassName('media-preview--image', isRoundVideo && 'round')} />\n      {getMessageVideo(message) && <i className=\"icon-play\" />}\n      {renderMessageSummary(lang, message, true)}\n    </span>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId }): StateProps => {\n    const chat = selectChat(global, chatId);\n    if (!chat || !chat.lastMessage) {\n      return {};\n    }\n\n    const { senderId, replyToMessageId, isOutgoing } = chat.lastMessage;\n    const lastMessageSender = senderId ? selectUser(global, senderId) : undefined;\n    const lastMessageAction = getMessageAction(chat.lastMessage);\n    const actionTargetMessage = lastMessageAction && replyToMessageId\n      ? selectChatMessage(global, chat.id, replyToMessageId)\n      : undefined;\n    const { targetUserIds: actionTargetUserIds, targetChatId: actionTargetChatId } = lastMessageAction || {};\n    const privateChatUserId = getPrivateChatUserId(chat);\n    const {\n      chatId: currentChatId,\n      threadId: currentThreadId,\n      type: messageListType,\n    } = selectCurrentMessageList(global) || {};\n    const isSelected = chatId === currentChatId && currentThreadId === MAIN_THREAD_ID;\n\n    return {\n      chat,\n      isMuted: selectIsChatMuted(chat, selectNotifySettings(global), selectNotifyExceptions(global)),\n      lastMessageSender,\n      actionTargetUserIds,\n      actionTargetChatId,\n      actionTargetMessage,\n      draft: selectDraft(global, chatId, MAIN_THREAD_ID),\n      animationLevel: global.settings.byKey.animationLevel,\n      isSelected,\n      canScrollDown: isSelected && messageListType === 'thread',\n      canChangeFolder: (global.chatFolders.orderedIds?.length || 0) > 1,\n      lastSyncTime: global.lastSyncTime,\n      ...(isOutgoing && { lastMessageOutgoingStatus: selectOutgoingStatus(global, chat.lastMessage) }),\n      ...(privateChatUserId && {\n        user: selectUser(global, privateChatUserId),\n        userStatus: selectUserStatus(global, privateChatUserId),\n      }),\n    };\n  },\n)(Chat));\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useCallback } from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../global';\n\nimport type { ApiChatFolder, ApiSticker } from '../../../api/types';\nimport { SettingsScreens } from '../../../types';\nimport type { FolderEditDispatch } from '../../../hooks/reducers/useFoldersReducer';\n\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\nimport { selectAnimatedEmoji, selectChatFolder } from '../../../global/selectors';\nimport useLang from '../../../hooks/useLang';\n\nimport Button from '../../ui/Button';\nimport AnimatedIconFromSticker from '../../common/AnimatedIconFromSticker';\n\nimport './EmptyFolder.scss';\n\ntype OwnProps = {\n  folderId?: number;\n  folderType: 'all' | 'archived' | 'folder';\n  foldersDispatch?: FolderEditDispatch;\n  onScreenSelect?: (screen: SettingsScreens) => void;\n};\n\ntype StateProps = {\n  chatFolder?: ApiChatFolder;\n  animatedEmoji?: ApiSticker;\n};\n\nconst ICON_SIZE = 128;\n\nconst EmptyFolder: FC<OwnProps & StateProps> = ({\n  chatFolder, animatedEmoji, foldersDispatch, onScreenSelect,\n}) => {\n  const lang = useLang();\n\n  const handleEditFolder = useCallback(() => {\n    foldersDispatch!({ type: 'editFolder', payload: chatFolder });\n    onScreenSelect!(SettingsScreens.FoldersEditFolderFromChatList);\n  }, [chatFolder, foldersDispatch, onScreenSelect]);\n\n  return (\n    <div className=\"EmptyFolder\">\n      <div className=\"sticker\">\n        {animatedEmoji && <AnimatedIconFromSticker sticker={animatedEmoji} size={ICON_SIZE} />}\n      </div>\n      <h3 className=\"title\" dir=\"auto\">{lang('FilterNoChatsToDisplay')}</h3>\n      <p className=\"description\" dir=\"auto\">\n        {lang(chatFolder ? 'ChatList.EmptyChatListFilterText' : 'Chat.EmptyChat')}\n      </p>\n      {chatFolder && foldersDispatch && onScreenSelect && (\n        <Button\n          ripple={!IS_SINGLE_COLUMN_LAYOUT}\n          fluid\n          pill\n          onClick={handleEditFolder}\n          size=\"smaller\"\n          isRtl={lang.isRtl}\n        >\n          <i className=\"icon-settings\" />\n          {lang('ChatList.EmptyChatListEditFilter')}\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>((global, { folderId, folderType }): StateProps => {\n  const chatFolder = folderId && folderType === 'folder' ? selectChatFolder(global, folderId) : undefined;\n\n  return {\n    chatFolder,\n    animatedEmoji: selectAnimatedEmoji(global, '📂'),\n  };\n})(EmptyFolder));\n","import React, {\n  memo, useMemo, useEffect, useRef,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { FC } from '../../../lib/teact/teact';\nimport type { SettingsScreens } from '../../../types';\nimport type { FolderEditDispatch } from '../../../hooks/reducers/useFoldersReducer';\n\nimport {\n  ALL_FOLDER_ID,\n  ARCHIVED_FOLDER_ID,\n  CHAT_HEIGHT_PX,\n  CHAT_LIST_SLICE,\n} from '../../../config';\nimport { IS_MAC_OS, IS_PWA } from '../../../util/environment';\nimport { mapValues } from '../../../util/iteratees';\nimport { getPinnedChatsCount, getOrderKey } from '../../../util/folderManager';\n\nimport usePrevious from '../../../hooks/usePrevious';\nimport useInfiniteScroll from '../../../hooks/useInfiniteScroll';\nimport { useFolderManagerForOrderedIds } from '../../../hooks/useFolderManager';\nimport { useChatAnimationType } from './hooks';\nimport { useIntersectionObserver } from '../../../hooks/useIntersectionObserver';\nimport { useHotkeys } from '../../../hooks/useHotkeys';\n\nimport InfiniteScroll from '../../ui/InfiniteScroll';\nimport Loading from '../../ui/Loading';\nimport Chat from './Chat';\nimport EmptyFolder from './EmptyFolder';\n\ntype OwnProps = {\n  folderType: 'all' | 'archived' | 'folder';\n  folderId?: number;\n  isActive: boolean;\n  lastSyncTime?: number;\n  foldersDispatch?: FolderEditDispatch;\n  onScreenSelect?: (screen: SettingsScreens) => void;\n};\n\nconst INTERSECTION_THROTTLE = 200;\n\nconst ChatList: FC<OwnProps> = ({\n  folderType,\n  folderId,\n  isActive,\n  foldersDispatch,\n  onScreenSelect,\n}) => {\n  const { openChat, openNextChat } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const resolvedFolderId = (\n    folderType === 'all' ? ALL_FOLDER_ID : folderType === 'archived' ? ARCHIVED_FOLDER_ID : folderId!\n  );\n\n  const orderedIds = useFolderManagerForOrderedIds(resolvedFolderId);\n\n  const orderById = useMemo(() => {\n    if (!orderedIds) {\n      return undefined;\n    }\n\n    return orderedIds.reduce((acc, id, i) => {\n      acc[id] = i;\n      return acc;\n    }, {} as Record<string, number>);\n  }, [orderedIds]);\n\n  const prevOrderById = usePrevious(orderById);\n\n  const orderDiffById = useMemo(() => {\n    if (!orderById || !prevOrderById) {\n      return {};\n    }\n\n    return mapValues(orderById, (order, id) => {\n      return prevOrderById[id] !== undefined ? order - prevOrderById[id] : -Infinity;\n    });\n  }, [orderById, prevOrderById]);\n\n  const [viewportIds, getMore] = useInfiniteScroll(undefined, orderedIds, undefined, CHAT_LIST_SLICE);\n\n  // Support <Alt>+<Up/Down> to navigate between chats\n  useHotkeys(isActive && orderedIds?.length ? {\n    'Alt+ArrowUp': (e: KeyboardEvent) => {\n      e.preventDefault();\n      openNextChat({ targetIndexDelta: -1, orderedIds });\n    },\n    'Alt+ArrowDown': (e: KeyboardEvent) => {\n      e.preventDefault();\n      openNextChat({ targetIndexDelta: 1, orderedIds });\n    },\n  } : undefined);\n\n  // Support <Cmd>+<Digit> to navigate between chats\n  useEffect(() => {\n    if (!isActive || !orderedIds || !IS_PWA) {\n      return undefined;\n    }\n\n    function handleKeyDown(e: KeyboardEvent) {\n      if (((IS_MAC_OS && e.metaKey) || (!IS_MAC_OS && e.ctrlKey)) && e.code.startsWith('Digit')) {\n        const [, digit] = e.code.match(/Digit(\\d)/) || [];\n        if (!digit) return;\n\n        const position = Number(digit) - 1;\n        if (position > orderedIds!.length - 1 || position < 0) return;\n\n        openChat({ id: orderedIds![position], shouldReplaceHistory: true });\n      }\n    }\n\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [isActive, openChat, openNextChat, orderedIds]);\n\n  const getAnimationType = useChatAnimationType(orderDiffById);\n\n  const { observe } = useIntersectionObserver({\n    rootRef: containerRef,\n    throttleMs: INTERSECTION_THROTTLE,\n  });\n\n  function renderChats() {\n    const viewportOffset = orderedIds!.indexOf(viewportIds![0]);\n    const pinnedCount = getPinnedChatsCount(resolvedFolderId) || 0;\n\n    return viewportIds!.map((id, i) => {\n      const isPinned = viewportOffset + i < pinnedCount;\n\n      return (\n        <Chat\n          key={id}\n          teactOrderKey={isPinned ? i : getOrderKey(id)}\n          chatId={id}\n          isPinned={isPinned}\n          folderId={folderId}\n          animationType={getAnimationType(id)}\n          orderDiff={orderDiffById[id]}\n          style={`top: ${(viewportOffset + i) * CHAT_HEIGHT_PX}px;`}\n          observeIntersection={observe}\n        />\n      );\n    });\n  }\n\n  return (\n    <InfiniteScroll\n      className=\"chat-list custom-scroll\"\n      ref={containerRef}\n      items={viewportIds}\n      preloadBackwards={CHAT_LIST_SLICE}\n      withAbsolutePositioning\n      maxHeight={(orderedIds?.length || 0) * CHAT_HEIGHT_PX}\n      onLoadMore={getMore}\n    >\n      {viewportIds?.length ? (\n        renderChats()\n      ) : viewportIds && !viewportIds.length ? (\n        (\n          <EmptyFolder\n            folderId={folderId}\n            folderType={folderType}\n            foldersDispatch={foldersDispatch}\n            onScreenSelect={onScreenSelect}\n          />\n        )\n      ) : (\n        <Loading key=\"loading\" />\n      )}\n    </InfiniteScroll>\n  );\n};\n\nexport default memo(ChatList);\n","import type { ApiChat, ApiMessage, ApiUser } from '../../../../api/types';\nimport {\n  getChatTitle,\n  getSenderTitle,\n  isUserId,\n  isChatGroup,\n} from '../../../../global/helpers';\nimport type { LangFn } from '../../../../hooks/useLang';\n\nexport function getSenderName(\n  lang: LangFn, message: ApiMessage, chatsById: Record<string, ApiChat>, usersById: Record<string, ApiUser>,\n) {\n  const { senderId } = message;\n  if (!senderId) {\n    return undefined;\n  }\n\n  const sender = isUserId(senderId) ? usersById[senderId] : chatsById[senderId];\n\n  let senderName = getSenderTitle(lang, sender);\n\n  const chat = chatsById[message.chatId];\n  if (chat) {\n    if (isUserId(senderId) && (sender as ApiUser).isSelf) {\n      senderName = `${lang('FromYou')} → ${getChatTitle(lang, chat)}`;\n    } else if (isChatGroup(chat)) {\n      senderName += ` → ${getChatTitle(lang, chat)}`;\n    }\n  }\n\n  return senderName;\n}\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\nimport type { OwnProps } from './CustomSendMenu';\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst CustomSendMenuAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const CustomSend = useModuleLoader(Bundles.Extra, 'CustomSendMenu', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return CustomSend ? <CustomSend {...props} /> : undefined;\n};\n\nexport default memo(CustomSendMenuAsync);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\n\nimport useFlag from '../../../hooks/useFlag';\nimport buildClassName from '../../../util/buildClassName';\n\nimport './DropTarget.scss';\n\nexport type OwnProps = {\n  isQuick?: boolean;\n  onFileSelect: (e: React.DragEvent<HTMLDivElement>) => void;\n};\n\nconst DropTarget: FC<OwnProps> = ({ isQuick, onFileSelect }) => {\n  const [isHovered, markHovered, unmarkHovered] = useFlag();\n\n  const handleDragEnter = () => { markHovered(); };\n  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\n    const { relatedTarget: toTarget } = e;\n\n    if (toTarget) {\n      e.stopPropagation();\n    }\n\n    unmarkHovered();\n  };\n\n  const className = buildClassName(\n    'DropTarget',\n    isHovered && 'hovered',\n  );\n\n  return (\n    <div\n      className={className}\n      onDrop={onFileSelect}\n      onDragEnter={handleDragEnter}\n      onDragLeave={handleDragLeave}\n    >\n      <div className=\"target-content\">\n        <div className={`icon icon-${isQuick ? 'photo' : 'document'}`} />\n        <div className=\"title\">Drop files here to send them</div>\n        <div className=\"description\">{isQuick ? 'in a quick way' : 'without compression'}</div>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(DropTarget);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useRef,\n} from '../../../lib/teact/teact';\n\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport buildClassName from '../../../util/buildClassName';\nimport getFilesFromDataTransferItems from './helpers/getFilesFromDataTransferItems';\n\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport usePrevious from '../../../hooks/usePrevious';\n\nimport Portal from '../../ui/Portal';\nimport DropTarget from './DropTarget';\n\nimport './DropArea.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  withQuick?: boolean;\n  onHide: NoneToVoidFunction;\n  onFileSelect: (files: File[], isQuick: boolean) => void;\n};\n\nexport enum DropAreaState {\n  None = 'none',\n  Document = 'document',\n  QuickFile = 'quick_file',\n}\n\nconst DROP_LEAVE_TIMEOUT_MS = 150;\n\nconst DropArea: FC<OwnProps> = ({\n  isOpen, withQuick, onHide, onFileSelect,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const hideTimeoutRef = useRef<number>(null);\n  const prevWithQuick = usePrevious(withQuick);\n  const { shouldRender, transitionClassNames } = useShowTransition(isOpen);\n\n  useEffect(() => (isOpen ? captureEscKeyListener(onHide) : undefined), [isOpen, onHide]);\n\n  const handleFilesDrop = useCallback(async (e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n    let files: File[] = [];\n\n    if (dt.files && dt.files.length > 0 && (!dt.items || !dt.items.length)) {\n      files = files.concat(Array.from(dt.files));\n    } else if (dt.items && dt.items.length > 0) {\n      const folderFiles = await getFilesFromDataTransferItems(dt.items);\n      if (folderFiles.length) {\n        files = files.concat(folderFiles);\n      }\n    }\n\n    onHide();\n    onFileSelect(files, false);\n  }, [onFileSelect, onHide]);\n\n  const handleQuickFilesDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n\n    if (dt.files && dt.files.length > 0) {\n      onHide();\n      onFileSelect(Array.from(dt.files), true);\n    }\n  }, [onFileSelect, onHide]);\n\n  const handleDragLeave = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n\n    const { target: fromTarget, relatedTarget: toTarget } = e;\n\n    // Esc button pressed during drag event\n    if ((fromTarget as HTMLDivElement).matches('.DropTarget, .DropArea') && !toTarget) {\n      hideTimeoutRef.current = window.setTimeout(() => {\n        onHide();\n      }, DROP_LEAVE_TIMEOUT_MS);\n    }\n  }, [onHide]);\n\n  const handleDragOver = () => {\n    if (hideTimeoutRef.current) {\n      window.clearTimeout(hideTimeoutRef.current);\n    }\n  };\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const className = buildClassName(\n    'DropArea',\n    transitionClassNames,\n  );\n\n  return (\n    <Portal containerId=\"#middle-column-portals\">\n      <div className={className} onDragLeave={handleDragLeave} onDragOver={handleDragOver} onDrop={onHide}>\n        <DropTarget onFileSelect={handleFilesDrop} />\n        {(withQuick || prevWithQuick) && <DropTarget onFileSelect={handleQuickFilesDrop} isQuick />}\n      </div>\n    </Portal>\n  );\n};\n\nexport default memo(DropArea);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\nimport type { OwnProps } from './EmojiTooltip';\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst EmojiTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const EmojiTooltip = useModuleLoader(Bundles.Extra, 'EmojiTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return EmojiTooltip ? <EmojiTooltip {...props} /> : undefined;\n};\n\nexport default memo(EmojiTooltipAsync);\n","import type { ChangeEvent } from 'react';\nimport type { FC } from '../../../lib/teact/teact';\nimport React, {\n  useEffect, useRef, memo, useState, useCallback,\n} from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { IAnchorPosition, ISettings } from '../../../types';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport { selectReplyingToId } from '../../../global/selectors';\nimport { debounce } from '../../../util/schedulers';\nimport focusEditableElement from '../../../util/focusEditableElement';\nimport buildClassName from '../../../util/buildClassName';\nimport {\n  IS_ANDROID, IS_EMOJI_SUPPORTED, IS_IOS, IS_SINGLE_COLUMN_LAYOUT, IS_TOUCH_ENV,\n} from '../../../util/environment';\nimport captureKeyboardListeners from '../../../util/captureKeyboardListeners';\nimport useLayoutEffectWithPrevDeps from '../../../hooks/useLayoutEffectWithPrevDeps';\nimport useFlag from '../../../hooks/useFlag';\nimport { isHeavyAnimating } from '../../../hooks/useHeavyAnimationCheck';\nimport useSendMessageAction from '../../../hooks/useSendMessageAction';\nimport useLang from '../../../hooks/useLang';\nimport parseEmojiOnlyString from '../../common/helpers/parseEmojiOnlyString';\nimport { isSelectionInsideInput } from './helpers/selection';\nimport renderText from '../../common/helpers/renderText';\n\nimport TextFormatter from './TextFormatter';\n\nconst CONTEXT_MENU_CLOSE_DELAY_MS = 100;\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 350;\nconst TRANSITION_DURATION_FACTOR = 50;\n\ntype OwnProps = {\n  id: string;\n  chatId: string;\n  threadId: number;\n  isAttachmentModalInput?: boolean;\n  editableInputId?: string;\n  html: string;\n  placeholder: string;\n  forcedPlaceholder?: string;\n  canAutoFocus: boolean;\n  shouldSuppressFocus?: boolean;\n  shouldSuppressTextFormatter?: boolean;\n  onUpdate: (html: string) => void;\n  onSuppressedFocus?: () => void;\n  onSend: () => void;\n  captionLimit?: number;\n};\n\ntype StateProps = {\n  replyingToId?: number;\n  noTabCapture?: boolean;\n  messageSendKeyCombo?: ISettings['messageSendKeyCombo'];\n};\n\nconst MAX_INPUT_HEIGHT = IS_SINGLE_COLUMN_LAYOUT ? 256 : 416;\nconst TAB_INDEX_PRIORITY_TIMEOUT = 2000;\n// Heuristics allowing the user to make a triple click\nconst SELECTION_RECALCULATE_DELAY_MS = 260;\nconst TEXT_FORMATTER_SAFE_AREA_PX = 90;\n// For some reason Safari inserts `<br>` after user removes text from input\nconst SAFARI_BR = '<br>';\n\nfunction clearSelection() {\n  const selection = window.getSelection();\n  if (!selection) {\n    return;\n  }\n\n  if (selection.removeAllRanges) {\n    selection.removeAllRanges();\n  } else if (selection.empty) {\n    selection.empty();\n  }\n}\n\nconst MessageInput: FC<OwnProps & StateProps> = ({\n  id,\n  chatId,\n  threadId,\n  captionLimit,\n  isAttachmentModalInput,\n  editableInputId,\n  html,\n  placeholder,\n  forcedPlaceholder,\n  canAutoFocus,\n  shouldSuppressFocus,\n  shouldSuppressTextFormatter,\n  replyingToId,\n  noTabCapture,\n  messageSendKeyCombo,\n  onUpdate,\n  onSuppressedFocus,\n  onSend,\n}) => {\n  const {\n    editLastMessage,\n    replyToNextMessage,\n  } = getActions();\n\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const selectionTimeoutRef = useRef<number>(null);\n  // eslint-disable-next-line no-null/no-null\n  const cloneRef = useRef<HTMLDivElement>(null);\n\n  const lang = useLang();\n  const isContextMenuOpenRef = useRef(false);\n  const [isTextFormatterOpen, openTextFormatter, closeTextFormatter] = useFlag();\n  const [textFormatterAnchorPosition, setTextFormatterAnchorPosition] = useState<IAnchorPosition>();\n  const [selectedRange, setSelectedRange] = useState<Range>();\n\n  const sendMessageAction = useSendMessageAction(chatId, threadId);\n\n  useEffect(() => {\n    if (!isAttachmentModalInput) return;\n    updateInputHeight(false);\n  }, [isAttachmentModalInput]);\n\n  useLayoutEffectWithPrevDeps(([prevHtml]) => {\n    if (html !== inputRef.current!.innerHTML) {\n      inputRef.current!.innerHTML = html;\n    }\n\n    if (html !== cloneRef.current!.innerHTML) {\n      cloneRef.current!.innerHTML = html;\n    }\n\n    if (prevHtml !== undefined && prevHtml !== html) {\n      updateInputHeight(!html.length);\n    }\n  }, [html]);\n\n  const chatIdRef = useRef(chatId);\n  chatIdRef.current = chatId;\n  const focusInput = useCallback(() => {\n    if (!inputRef.current) {\n      return;\n    }\n\n    if (isHeavyAnimating()) {\n      setTimeout(focusInput, FOCUS_DELAY_MS);\n      return;\n    }\n\n    focusEditableElement(inputRef.current!);\n  }, []);\n\n  const handleCloseTextFormatter = useCallback(() => {\n    closeTextFormatter();\n    clearSelection();\n  }, [closeTextFormatter]);\n\n  function checkSelection() {\n    // Disable the formatter on iOS devices for now.\n    if (IS_IOS) {\n      return false;\n    }\n\n    const selection = window.getSelection();\n    if (!selection || !selection.rangeCount || isContextMenuOpenRef.current) {\n      closeTextFormatter();\n      return false;\n    }\n\n    const selectionRange = selection.getRangeAt(0);\n    const selectedText = selectionRange.toString().trim();\n    if (\n      shouldSuppressTextFormatter\n      || !isSelectionInsideInput(selectionRange, editableInputId || EDITABLE_INPUT_ID)\n      || !selectedText\n      || parseEmojiOnlyString(selectedText)\n      || !selectionRange.START_TO_END\n    ) {\n      closeTextFormatter();\n      return false;\n    }\n\n    return true;\n  }\n\n  function processSelection() {\n    if (!checkSelection()) {\n      return;\n    }\n\n    const selectionRange = window.getSelection()!.getRangeAt(0);\n    const selectionRect = selectionRange.getBoundingClientRect();\n    const inputRect = inputRef.current!.getBoundingClientRect();\n\n    let x = (selectionRect.left + selectionRect.width / 2) - inputRect.left;\n\n    if (x < TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = TEXT_FORMATTER_SAFE_AREA_PX;\n    } else if (x > inputRect.width - TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = inputRect.width - TEXT_FORMATTER_SAFE_AREA_PX;\n    }\n\n    setTextFormatterAnchorPosition({\n      x,\n      y: selectionRect.top - inputRect.top,\n    });\n\n    setSelectedRange(selectionRange);\n    openTextFormatter();\n  }\n\n  function processSelectionWithTimeout() {\n    if (selectionTimeoutRef.current) {\n      window.clearTimeout(selectionTimeoutRef.current);\n    }\n    // Small delay to allow browser properly recalculate selection\n    selectionTimeoutRef.current = window.setTimeout(processSelection, SELECTION_RECALCULATE_DELAY_MS);\n  }\n\n  function handleMouseDown(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (e.button !== 2) {\n      e.target.addEventListener('mouseup', processSelectionWithTimeout, { once: true });\n      return;\n    }\n\n    if (isContextMenuOpenRef.current) {\n      return;\n    }\n\n    isContextMenuOpenRef.current = true;\n\n    function handleCloseContextMenu(e2: KeyboardEvent | MouseEvent) {\n      if (e2 instanceof KeyboardEvent && e2.key !== 'Esc' && e2.key !== 'Escape') {\n        return;\n      }\n\n      setTimeout(() => {\n        isContextMenuOpenRef.current = false;\n      }, CONTEXT_MENU_CLOSE_DELAY_MS);\n\n      window.removeEventListener('keydown', handleCloseContextMenu);\n      window.removeEventListener('mousedown', handleCloseContextMenu);\n    }\n\n    document.addEventListener('mousedown', handleCloseContextMenu);\n    document.addEventListener('keydown', handleCloseContextMenu);\n  }\n\n  function handleKeyDown(e: React.KeyboardEvent<HTMLDivElement>) {\n    if (!html.length && (e.metaKey || e.ctrlKey)) {\n      const targetIndexDelta = e.key === 'ArrowDown' ? 1 : e.key === 'ArrowUp' ? -1 : undefined;\n      if (targetIndexDelta) {\n        e.preventDefault();\n\n        replyToNextMessage({ targetIndexDelta });\n        return;\n      }\n    }\n\n    if (e.key === 'Enter' && !e.shiftKey) {\n      if (\n        !(IS_IOS || IS_ANDROID)\n        && (\n          (messageSendKeyCombo === 'enter' && !e.shiftKey)\n          || (messageSendKeyCombo === 'ctrl-enter' && (e.ctrlKey || e.metaKey))\n        )\n      ) {\n        e.preventDefault();\n\n        closeTextFormatter();\n        onSend();\n      }\n    } else if (e.key === 'ArrowUp' && !html.length && !e.metaKey && !e.ctrlKey && !e.altKey) {\n      e.preventDefault();\n      editLastMessage();\n    } else {\n      e.target.addEventListener('keyup', processSelectionWithTimeout, { once: true });\n    }\n  }\n\n  function handleChange(e: ChangeEvent<HTMLDivElement>) {\n    const { innerHTML, textContent } = e.currentTarget;\n\n    onUpdate(innerHTML === SAFARI_BR ? '' : innerHTML);\n    sendMessageAction({ type: 'typing' });\n\n    // Reset focus on the input to remove any active styling when input is cleared\n    if (\n      !IS_TOUCH_ENV\n      && (!textContent || !textContent.length)\n      // When emojis are not supported, innerHTML contains an emoji img tag that doesn't exist in the textContext\n      && !(!IS_EMOJI_SUPPORTED && innerHTML.includes('emoji-small'))\n    ) {\n      const selection = window.getSelection()!;\n      if (selection) {\n        inputRef.current!.blur();\n        selection.removeAllRanges();\n        focusEditableElement(inputRef.current!, true);\n      }\n    }\n  }\n\n  function stopEvent(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (!checkSelection()) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function updateInputHeight(willSend = false) {\n    const input = inputRef.current!;\n    const clone = cloneRef.current!;\n    const currentHeight = Number(input.style.height.replace('px', ''));\n    const newHeight = Math.min(clone.scrollHeight, MAX_INPUT_HEIGHT);\n    if (newHeight === currentHeight) {\n      return;\n    }\n\n    const transitionDuration = Math.round(\n      TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight)),\n    );\n\n    const exec = () => {\n      input.style.height = `${newHeight}px`;\n      input.style.transitionDuration = `${transitionDuration}ms`;\n      input.classList.toggle('overflown', clone.scrollHeight > MAX_INPUT_HEIGHT);\n    };\n\n    if (willSend) {\n      // Sync with sending animation\n      requestAnimationFrame(exec);\n    } else {\n      exec();\n    }\n  }\n\n  useEffect(() => {\n    if (IS_TOUCH_ENV) {\n      return;\n    }\n\n    if (canAutoFocus) {\n      focusInput();\n    }\n  }, [chatId, focusInput, replyingToId, canAutoFocus]);\n\n  useEffect(() => {\n    if (noTabCapture) {\n      return undefined;\n    }\n\n    const captureFirstTab = debounce((e: KeyboardEvent) => {\n      if (e.key === 'Tab') {\n        e.preventDefault();\n        requestAnimationFrame(focusInput);\n      }\n    }, TAB_INDEX_PRIORITY_TIMEOUT, true, false);\n\n    return captureKeyboardListeners({ onTab: captureFirstTab });\n  }, [focusInput, noTabCapture]);\n\n  useEffect(() => {\n    const input = inputRef.current!;\n\n    function suppressFocus() {\n      input.blur();\n    }\n\n    if (shouldSuppressFocus) {\n      input.addEventListener('focus', suppressFocus);\n    }\n\n    return () => {\n      input.removeEventListener('focus', suppressFocus);\n    };\n  }, [shouldSuppressFocus]);\n\n  const className = buildClassName(\n    'form-control custom-scroll',\n    html.length > 0 && 'touched',\n    shouldSuppressFocus && 'focus-disabled',\n  );\n\n  return (\n    <div id={id} onClick={shouldSuppressFocus ? onSuppressedFocus : undefined} dir={lang.isRtl ? 'rtl' : undefined}>\n      <div\n        ref={inputRef}\n        id={editableInputId || EDITABLE_INPUT_ID}\n        className={className}\n        contentEditable\n        dir=\"auto\"\n        onClick={focusInput}\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n        onMouseDown={handleMouseDown}\n        onContextMenu={IS_ANDROID ? stopEvent : undefined}\n        onTouchCancel={IS_ANDROID ? processSelectionWithTimeout : undefined}\n        aria-label={placeholder}\n      />\n      {captionLimit && (\n        <div className=\"max-length-indicator\" dir=\"auto\">\n          {captionLimit}\n        </div>\n      )}\n\n      <div ref={cloneRef} className={buildClassName(className, 'clone')} dir=\"auto\" />\n      {!forcedPlaceholder && <span className=\"placeholder-text\" dir=\"auto\">{placeholder}</span>}\n      <TextFormatter\n        isOpen={isTextFormatterOpen}\n        anchorPosition={textFormatterAnchorPosition}\n        selectedRange={selectedRange}\n        setSelectedRange={setSelectedRange}\n        onClose={handleCloseTextFormatter}\n      />\n      {forcedPlaceholder && <span className=\"forced-placeholder\">{renderText(forcedPlaceholder!)}</span>}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId, threadId }: OwnProps): StateProps => {\n    const { messageSendKeyCombo } = global.settings.byKey;\n\n    return {\n      messageSendKeyCombo,\n      replyingToId: chatId && threadId ? selectReplyingToId(global, chatId, threadId) : undefined,\n      noTabCapture: global.pollModal.isOpen || global.payment.isPaymentModalOpen,\n    };\n  },\n)(MessageInput));\n","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\n\nimport type { IAnchorPosition } from '../../../types';\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport buildClassName from '../../../util/buildClassName';\nimport { ensureProtocol } from '../../../util/ensureProtocol';\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport getKeyFromEvent from '../../../util/getKeyFromEvent';\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport useVirtualBackdrop from '../../../hooks/useVirtualBackdrop';\nimport useFlag from '../../../hooks/useFlag';\nimport useLang from '../../../hooks/useLang';\n\nimport Button from '../../ui/Button';\n\nimport './TextFormatter.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  anchorPosition?: IAnchorPosition;\n  selectedRange?: Range;\n  setSelectedRange: (range: Range) => void;\n  onClose: () => void;\n};\n\ninterface ISelectedTextFormats {\n  bold?: boolean;\n  italic?: boolean;\n  underline?: boolean;\n  strikethrough?: boolean;\n  monospace?: boolean;\n  spoiler?: boolean;\n}\n\nconst TEXT_FORMAT_BY_TAG_NAME: Record<string, keyof ISelectedTextFormats> = {\n  B: 'bold',\n  STRONG: 'bold',\n  I: 'italic',\n  EM: 'italic',\n  U: 'underline',\n  DEL: 'strikethrough',\n  CODE: 'monospace',\n  SPAN: 'spoiler',\n};\nconst fragmentEl = document.createElement('div');\n\nconst TextFormatter: FC<OwnProps> = ({\n  isOpen,\n  anchorPosition,\n  selectedRange,\n  setSelectedRange,\n  onClose,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const linkUrlInputRef = useRef<HTMLInputElement>(null);\n  const { shouldRender, transitionClassNames } = useShowTransition(isOpen);\n  const [isLinkControlOpen, openLinkControl, closeLinkControl] = useFlag();\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditingLink, setIsEditingLink] = useState(false);\n  const [inputClassName, setInputClassName] = useState<string | undefined>();\n  const [selectedTextFormats, setSelectedTextFormats] = useState<ISelectedTextFormats>({});\n\n  useEffect(() => (isOpen ? captureEscKeyListener(onClose) : undefined), [isOpen, onClose]);\n  useVirtualBackdrop(\n    isOpen,\n    containerRef,\n    onClose,\n  );\n\n  useEffect(() => {\n    if (isLinkControlOpen) {\n      linkUrlInputRef.current!.focus();\n    } else {\n      setLinkUrl('');\n      setIsEditingLink(false);\n    }\n  }, [isLinkControlOpen]);\n\n  useEffect(() => {\n    if (!shouldRender) {\n      closeLinkControl();\n      setSelectedTextFormats({});\n      setInputClassName(undefined);\n    }\n  }, [closeLinkControl, shouldRender]);\n\n  useEffect(() => {\n    if (!isOpen || !selectedRange) {\n      return;\n    }\n\n    const selectedFormats: ISelectedTextFormats = {};\n    let { parentElement } = selectedRange.commonAncestorContainer;\n    while (parentElement && parentElement.id !== EDITABLE_INPUT_ID) {\n      const textFormat = TEXT_FORMAT_BY_TAG_NAME[parentElement.tagName];\n      if (textFormat) {\n        selectedFormats[textFormat] = true;\n      }\n\n      parentElement = parentElement.parentElement;\n    }\n\n    setSelectedTextFormats(selectedFormats);\n  }, [isOpen, selectedRange, openLinkControl]);\n\n  const restoreSelection = useCallback(() => {\n    if (!selectedRange) {\n      return;\n    }\n\n    const selection = window.getSelection();\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(selectedRange);\n    }\n  }, [selectedRange]);\n\n  const updateSelectedRange = useCallback(() => {\n    const selection = window.getSelection();\n    if (selection) {\n      setSelectedRange(selection.getRangeAt(0));\n    }\n  }, [setSelectedRange]);\n\n  const getSelectedText = useCallback(() => {\n    if (!selectedRange) {\n      return undefined;\n    }\n    fragmentEl.replaceChildren(selectedRange.cloneContents());\n    return fragmentEl.innerHTML;\n  }, [selectedRange]);\n\n  const getSelectedElement = useCallback(() => {\n    if (!selectedRange) {\n      return undefined;\n    }\n\n    return selectedRange.commonAncestorContainer.parentElement;\n  }, [selectedRange]);\n\n  function updateInputStyles() {\n    const input = linkUrlInputRef.current;\n    if (!input) {\n      return;\n    }\n\n    const { offsetWidth, scrollWidth, scrollLeft } = input;\n    if (scrollWidth <= offsetWidth) {\n      setInputClassName(undefined);\n      return;\n    }\n\n    let className = '';\n    if (scrollLeft < scrollWidth - offsetWidth) {\n      className = 'mask-right';\n    }\n    if (scrollLeft > 0) {\n      className += ' mask-left';\n    }\n\n    setInputClassName(className);\n  }\n\n  function handleLinkUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n    setLinkUrl(e.target.value);\n    updateInputStyles();\n  }\n\n  function getFormatButtonClassName(key: keyof ISelectedTextFormats) {\n    if (selectedTextFormats[key]) {\n      return 'active';\n    }\n\n    if (key === 'monospace' || key === 'strikethrough') {\n      if (Object.keys(selectedTextFormats).some(\n        (fKey) => fKey !== key && Boolean(selectedTextFormats[fKey as keyof ISelectedTextFormats]),\n      )) {\n        return 'disabled';\n      }\n    } else if (selectedTextFormats.monospace || selectedTextFormats.strikethrough) {\n      return 'disabled';\n    }\n\n    return undefined;\n  }\n\n  const handleSpoilerText = useCallback(() => {\n    if (selectedTextFormats.spoiler) {\n      const element = getSelectedElement();\n      if (\n        !selectedRange\n        || !element\n        || element.dataset.entityType !== ApiMessageEntityTypes.Spoiler\n        || !element.textContent\n      ) {\n        return;\n      }\n\n      element.replaceWith(element.textContent);\n      setSelectedTextFormats((selectedFormats) => ({\n        ...selectedFormats,\n        spoiler: false,\n      }));\n\n      return;\n    }\n\n    const text = getSelectedText();\n    document.execCommand(\n      'insertHTML', false, `<span class=\"spoiler\" data-entity-type=\"${ApiMessageEntityTypes.Spoiler}\">${text}</span>`,\n    );\n    onClose();\n  }, [getSelectedElement, getSelectedText, onClose, selectedRange, selectedTextFormats.spoiler]);\n\n  const handleBoldText = useCallback(() => {\n    setSelectedTextFormats((selectedFormats) => {\n      // Somehow re-applying 'bold' command to already bold text doesn't work\n      document.execCommand(selectedFormats.bold ? 'removeFormat' : 'bold');\n      Object.keys(selectedFormats).forEach((key) => {\n        if ((key === 'italic' || key === 'underline') && Boolean(selectedFormats[key])) {\n          document.execCommand(key);\n        }\n      });\n\n      updateSelectedRange();\n      return {\n        ...selectedFormats,\n        bold: !selectedFormats.bold,\n      };\n    });\n  }, [updateSelectedRange]);\n\n  const handleItalicText = useCallback(() => {\n    document.execCommand('italic');\n    updateSelectedRange();\n    setSelectedTextFormats((selectedFormats) => ({\n      ...selectedFormats,\n      italic: !selectedFormats.italic,\n    }));\n  }, [updateSelectedRange]);\n\n  const handleUnderlineText = useCallback(() => {\n    document.execCommand('underline');\n    updateSelectedRange();\n    setSelectedTextFormats((selectedFormats) => ({\n      ...selectedFormats,\n      underline: !selectedFormats.underline,\n    }));\n  }, [updateSelectedRange]);\n\n  const handleStrikethroughText = useCallback(() => {\n    if (selectedTextFormats.strikethrough) {\n      const element = getSelectedElement();\n      if (\n        !selectedRange\n        || !element\n        || element.tagName !== 'DEL'\n        || !element.textContent\n      ) {\n        return;\n      }\n\n      element.replaceWith(element.textContent);\n      setSelectedTextFormats((selectedFormats) => ({\n        ...selectedFormats,\n        strikethrough: false,\n      }));\n\n      return;\n    }\n\n    const text = getSelectedText();\n    document.execCommand('insertHTML', false, `<del>${text}</del>`);\n    onClose();\n  }, [\n    getSelectedElement, getSelectedText, onClose, selectedRange, selectedTextFormats.strikethrough,\n  ]);\n\n  const handleMonospaceText = useCallback(() => {\n    if (selectedTextFormats.monospace) {\n      const element = getSelectedElement();\n      if (\n        !selectedRange\n        || !element\n        || element.tagName !== 'CODE'\n        || !element.textContent\n      ) {\n        return;\n      }\n\n      element.replaceWith(element.textContent);\n      setSelectedTextFormats((selectedFormats) => ({\n        ...selectedFormats,\n        monospace: false,\n      }));\n\n      return;\n    }\n\n    const text = getSelectedText();\n    document.execCommand('insertHTML', false, `<code class=\"text-entity-code\" dir=\"auto\">${text}</code>`);\n    onClose();\n  }, [\n    getSelectedElement, getSelectedText, onClose, selectedRange, selectedTextFormats.monospace,\n  ]);\n\n  const handleLinkUrlConfirm = useCallback(() => {\n    const formattedLinkUrl = (ensureProtocol(linkUrl) || '').split('%').map(encodeURI).join('%');\n\n    if (isEditingLink) {\n      const element = getSelectedElement();\n      if (!element || element.tagName !== 'A') {\n        return;\n      }\n\n      (element as HTMLAnchorElement).href = formattedLinkUrl;\n\n      onClose();\n\n      return;\n    }\n\n    const text = getSelectedText();\n    restoreSelection();\n    document.execCommand(\n      'insertHTML',\n      false,\n      `<a href=${formattedLinkUrl} class=\"text-entity-link\" dir=\"auto\">${text}</a>`,\n    );\n    onClose();\n  }, [getSelectedElement, getSelectedText, isEditingLink, linkUrl, onClose, restoreSelection]);\n\n  const handleKeyDown = useCallback((e: KeyboardEvent) => {\n    const HANDLERS_BY_KEY: Record<string, AnyToVoidFunction> = {\n      k: openLinkControl,\n      b: handleBoldText,\n      u: handleUnderlineText,\n      i: handleItalicText,\n      m: handleMonospaceText,\n      s: handleStrikethroughText,\n      p: handleSpoilerText,\n    };\n\n    const handler = HANDLERS_BY_KEY[getKeyFromEvent(e)];\n\n    if (\n      e.altKey\n      || !(e.ctrlKey || e.metaKey)\n      || !handler\n    ) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n    handler();\n  }, [\n    openLinkControl, handleBoldText, handleUnderlineText, handleItalicText, handleMonospaceText,\n    handleStrikethroughText, handleSpoilerText,\n  ]);\n\n  useEffect(() => {\n    if (isOpen) {\n      document.addEventListener('keydown', handleKeyDown);\n    }\n\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, handleKeyDown]);\n\n  const lang = useLang();\n\n  function handleContainerKeyDown(e: React.KeyboardEvent<HTMLDivElement>) {\n    if (e.key === 'Enter' && isLinkControlOpen) {\n      handleLinkUrlConfirm();\n      e.preventDefault();\n    }\n  }\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const className = buildClassName(\n    'TextFormatter',\n    transitionClassNames,\n    isLinkControlOpen && 'link-control-shown',\n  );\n\n  const linkUrlConfirmClassName = buildClassName(\n    'TextFormatter-link-url-confirm',\n    Boolean(linkUrl.length) && 'shown',\n  );\n\n  const style = anchorPosition\n    ? `left: ${anchorPosition.x}px; top: ${anchorPosition.y}px;--text-formatter-left: ${anchorPosition.x}px;`\n    : '';\n\n  return (\n    <div\n      ref={containerRef}\n      className={className}\n      style={style}\n      onKeyDown={handleContainerKeyDown}\n    >\n      <div className=\"TextFormatter-buttons\">\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Spoiler text\"\n          className={getFormatButtonClassName('spoiler')}\n          onClick={handleSpoilerText}\n        >\n          <i className=\"icon-eye-closed\" />\n        </Button>\n        <div className=\"TextFormatter-divider\" />\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Bold text\"\n          className={getFormatButtonClassName('bold')}\n          onClick={handleBoldText}\n        >\n          <i className=\"icon-bold\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Italic text\"\n          className={getFormatButtonClassName('italic')}\n          onClick={handleItalicText}\n        >\n          <i className=\"icon-italic\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Underlined text\"\n          className={getFormatButtonClassName('underline')}\n          onClick={handleUnderlineText}\n        >\n          <i className=\"icon-underlined\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Strikethrough text\"\n          className={getFormatButtonClassName('strikethrough')}\n          onClick={handleStrikethroughText}\n        >\n          <i className=\"icon-strikethrough\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Monospace text\"\n          className={getFormatButtonClassName('monospace')}\n          onClick={handleMonospaceText}\n        >\n          <i className=\"icon-monospace\" />\n        </Button>\n        <div className=\"TextFormatter-divider\" />\n        <Button color=\"translucent\" ariaLabel={lang('TextFormat.AddLinkTitle')} onClick={openLinkControl}>\n          <i className=\"icon-link\" />\n        </Button>\n      </div>\n\n      <div className=\"TextFormatter-link-control\">\n        <div className=\"TextFormatter-buttons\">\n          <Button color=\"translucent\" ariaLabel={lang('Cancel')} onClick={closeLinkControl}>\n            <i className=\"icon-arrow-left\" />\n          </Button>\n          <div className=\"TextFormatter-divider\" />\n\n          <div\n            className={buildClassName('TextFormatter-link-url-input-wrapper', inputClassName)}\n          >\n            <input\n              ref={linkUrlInputRef}\n              className=\"TextFormatter-link-url-input\"\n              type=\"text\"\n              value={linkUrl}\n              placeholder=\"Enter URL...\"\n              autoComplete=\"off\"\n              inputMode=\"url\"\n              dir=\"auto\"\n              onChange={handleLinkUrlChange}\n              onScroll={updateInputStyles}\n            />\n          </div>\n\n          <div className={linkUrlConfirmClassName}>\n            <div className=\"TextFormatter-divider\" />\n            <Button\n              color=\"translucent\"\n              ariaLabel={lang('Save')}\n              className=\"color-primary\"\n              onClick={handleLinkUrlConfirm}\n            >\n              <i className=\"icon-check\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(TextFormatter);\n","export default function getKeyFromEvent(e: KeyboardEvent) {\n  const key = 'key' in e ? e.key : e.code;\n\n  return key.startsWith('Key') ? key.slice(3).toLowerCase() : key;\n}\n","export default async function getFilesFromDataTransferItems(dataTransferItems: DataTransferItemList) {\n  const files: File[] = [];\n\n  function traverseFileTreePromise(entry: FileSystemEntry | File, item: DataTransferItem) {\n    return new Promise((resolve) => {\n      if (entry instanceof File) {\n        files.push(entry);\n        resolve(entry);\n      } else if (entry.isFile) {\n        const itemFile = item.getAsFile();\n        (entry as FileSystemFileEntry).file((file) => {\n          files.push(file);\n          resolve(file);\n        }, () => {\n          // iOS Safari throws an error \"NotFoundError: Path does not exist\" for files from the clipboard\n          // https://stackoverflow.com/a/50059309\n          if (itemFile) {\n            files.push(itemFile);\n          }\n          resolve(itemFile);\n        });\n      } else if (entry.isDirectory) {\n        const dirReader = (entry as FileSystemDirectoryEntry).createReader();\n        dirReader.readEntries((entries) => {\n          const entriesPromises = [];\n          for (let i = 0; i < entries.length; i++) {\n            entriesPromises.push(traverseFileTreePromise(entries[i], item));\n          }\n          resolve(Promise.all(entriesPromises));\n        });\n      }\n    });\n  }\n\n  const entriesPromises = [];\n  for (let i = 0; i < dataTransferItems.length; i++) {\n    const item = dataTransferItems[i];\n    if (item.kind === 'file') {\n      const entry = item.webkitGetAsEntry() || item.getAsFile();\n      if (entry) {\n        entriesPromises.push(traverseFileTreePromise(entry, item));\n      }\n    }\n  }\n\n  await Promise.all(entriesPromises);\n\n  return files.map(fixMovMime);\n}\n\n// .mov MIME type not reported sometimes https://developer.mozilla.org/en-US/docs/Web/API/File/type#sect1\nfunction fixMovMime(file: File) {\n  const ext = file.name.split('.').pop()!;\n  if (!file.type && ext.toLowerCase() === 'mov') {\n    return new File([file], file.name, { type: 'video/quicktime' });\n  }\n  return file;\n}\n","const RE_BR = /(<br>|<br\\s?\\/>)/g;\nconst RE_SPACE = /(&nbsp;|\\u00A0)/g;\nconst RE_CLEAN_HTML = /(<div>|<\\/div>)/gi;\nconst RE_EXTRA_NEW_LINE = /\\n$/i;\n\nexport function prepareForRegExp(html: string) {\n  return html\n    .replace(RE_SPACE, ' ')\n    .replace(RE_BR, '\\n')\n    .replace(RE_CLEAN_HTML, '')\n    .replace(RE_EXTRA_NEW_LINE, '');\n}\n","const MAX_NESTING_PARENTS = 5;\n\nexport function isSelectionInsideInput(selectionRange: Range, inputId: string) {\n  const { commonAncestorContainer } = selectionRange;\n  let parentNode: HTMLElement | null = commonAncestorContainer as HTMLElement;\n  let iterations = 1;\n  while (parentNode && parentNode.id !== inputId && iterations < MAX_NESTING_PARENTS) {\n    parentNode = parentNode.parentElement;\n    iterations++;\n  }\n\n  return Boolean(parentNode && parentNode.id === inputId);\n}\n","import { areSortedArraysEqual } from './iteratees';\n\nconst cache = new WeakMap<AnyFunction, {\n  lastArgs: any[];\n  lastResult: any;\n}>();\n\nexport default function memoized<T extends AnyFunction>(fn: T) {\n  return (...args: Parameters<T>): ReturnType<T> => {\n    const cached = cache.get(fn);\n    if (cached && areSortedArraysEqual(cached.lastArgs, args)) {\n      return cached.lastResult;\n    }\n\n    const result = fn(...args);\n    cache.set(fn, { lastArgs: args, lastResult: result });\n    return result;\n  };\n}\n","import {\n  useCallback, useEffect, useState,\n} from '../../../../lib/teact/teact';\n\nimport { EDITABLE_INPUT_CSS_SELECTOR, EDITABLE_INPUT_ID } from '../../../../config';\nimport { MEMO_EMPTY_ARRAY } from '../../../../util/memo';\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\nimport type { EmojiData, EmojiModule, EmojiRawData } from '../../../../util/emoji';\nimport { uncompressEmoji } from '../../../../util/emoji';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport {\n  buildCollectionByKey, mapValues, pickTruthy, unique,\n} from '../../../../util/iteratees';\nimport memoized from '../../../../util/memoized';\nimport useFlag from '../../../../hooks/useFlag';\nimport renderText from '../../../common/helpers/renderText';\n\ninterface Library {\n  keywords: string[];\n  byKeyword: Record<string, Emoji[]>;\n  names: string[];\n  byName: Record<string, Emoji[]>;\n}\n\nlet emojiDataPromise: Promise<EmojiModule>;\nlet emojiRawData: EmojiRawData;\nlet emojiData: EmojiData;\n\nlet RE_EMOJI_SEARCH: RegExp;\nconst EMOJIS_LIMIT = 36;\nconst FILTER_MIN_LENGTH = 2;\n\nconst prepareRecentEmojisMemo = memoized(prepareRecentEmojis);\nconst prepareLibraryMemo = memoized(prepareLibrary);\nconst searchInLibraryMemo = memoized(searchInLibrary);\n\ntry {\n  RE_EMOJI_SEARCH = /(^|\\s):[-+_:\\p{L}\\p{N}]*$/gui;\n} catch (e) {\n  // Support for older versions of firefox\n  RE_EMOJI_SEARCH = /(^|\\s):[-+_:\\d\\wа-яё]*$/gi;\n}\n\nexport default function useEmojiTooltip(\n  isAllowed: boolean,\n  htmlRef: { current: string },\n  recentEmojiIds: string[],\n  inputId = EDITABLE_INPUT_ID,\n  onUpdateHtml: (html: string) => void,\n  baseEmojiKeywords?: Record<string, string[]>,\n  emojiKeywords?: Record<string, string[]>,\n  isDisabled = false,\n) {\n  const [isOpen, markIsOpen, unmarkIsOpen] = useFlag();\n  const [byId, setById] = useState<Record<string, Emoji> | undefined>();\n  const [shouldForceInsertEmoji, setShouldForceInsertEmoji] = useState(false);\n  const [filteredEmojis, setFilteredEmojis] = useState<Emoji[]>(MEMO_EMPTY_ARRAY);\n\n  // Initialize data on first render.\n  useEffect(() => {\n    if (isDisabled) return;\n    const exec = () => {\n      setById(emojiData.emojis);\n    };\n\n    if (emojiData) {\n      exec();\n    } else {\n      ensureEmojiData()\n        .then(exec);\n    }\n  }, [isDisabled]);\n\n  const html = htmlRef.current;\n  useEffect(() => {\n    if (!isAllowed || !html || !byId || isDisabled) {\n      unmarkIsOpen();\n      return;\n    }\n\n    const code = html.includes(':') && getEmojiCode(html);\n    if (!code) {\n      setFilteredEmojis(MEMO_EMPTY_ARRAY);\n      unmarkIsOpen();\n      return;\n    }\n\n    const forceSend = code.length > 2 && code.endsWith(':');\n    const filter = code.substr(1, forceSend ? code.length - 2 : undefined);\n    let matched: Emoji[] = MEMO_EMPTY_ARRAY;\n\n    setShouldForceInsertEmoji(forceSend);\n\n    if (!filter) {\n      matched = prepareRecentEmojisMemo(byId, recentEmojiIds, EMOJIS_LIMIT);\n    } else if (filter.length >= FILTER_MIN_LENGTH) {\n      const library = prepareLibraryMemo(byId, baseEmojiKeywords, emojiKeywords);\n      matched = searchInLibraryMemo(library, filter, EMOJIS_LIMIT);\n    }\n\n    if (matched.length) {\n      if (!forceSend) {\n        markIsOpen();\n      }\n      setFilteredEmojis(matched);\n    } else {\n      unmarkIsOpen();\n    }\n  }, [\n    byId, html, isAllowed, markIsOpen, recentEmojiIds, unmarkIsOpen, setShouldForceInsertEmoji,\n    isDisabled, baseEmojiKeywords, emojiKeywords,\n  ]);\n\n  const insertEmoji = useCallback((textEmoji: string, isForce?: boolean) => {\n    const currentHtml = htmlRef.current;\n    const atIndex = currentHtml.lastIndexOf(':', isForce ? currentHtml.lastIndexOf(':') - 1 : undefined);\n    if (atIndex !== -1) {\n      onUpdateHtml(`${currentHtml.substr(0, atIndex)}${renderText(textEmoji, ['emoji_html'])}`);\n      let messageInput: HTMLDivElement;\n      if (inputId === EDITABLE_INPUT_ID) {\n        messageInput = document.querySelector<HTMLDivElement>(EDITABLE_INPUT_CSS_SELECTOR)!;\n      } else {\n        messageInput = document.getElementById(inputId) as HTMLDivElement;\n      }\n      requestAnimationFrame(() => {\n        focusEditableElement(messageInput, true, true);\n      });\n    }\n\n    unmarkIsOpen();\n  }, [htmlRef, inputId, onUpdateHtml, unmarkIsOpen]);\n\n  useEffect(() => {\n    if (isOpen && shouldForceInsertEmoji && filteredEmojis.length) {\n      insertEmoji(filteredEmojis[0].native, true);\n    }\n  }, [filteredEmojis, insertEmoji, isOpen, shouldForceInsertEmoji]);\n\n  return {\n    isEmojiTooltipOpen: isOpen,\n    closeEmojiTooltip: unmarkIsOpen,\n    filteredEmojis,\n    insertEmoji,\n  };\n}\n\nfunction getEmojiCode(html: string) {\n  const emojis = prepareForRegExp(html).match(RE_EMOJI_SEARCH);\n\n  return emojis ? emojis[0].trim() : undefined;\n}\n\nasync function ensureEmojiData() {\n  if (!emojiDataPromise) {\n    emojiDataPromise = import('emoji-data-ios/emoji-data.json') as unknown as Promise<EmojiModule>;\n    emojiRawData = (await emojiDataPromise).default;\n\n    emojiData = uncompressEmoji(emojiRawData);\n  }\n\n  return emojiDataPromise;\n}\n\nfunction prepareRecentEmojis(byId: Record<string, Emoji>, recentEmojiIds: string[], limit: number) {\n  if (!byId || !recentEmojiIds.length) {\n    return MEMO_EMPTY_ARRAY;\n  }\n\n  return Object.values(pickTruthy(byId, recentEmojiIds)).slice(0, limit);\n}\n\nfunction prepareLibrary(\n  byId: Record<string, Emoji>,\n  baseEmojiKeywords?: Record<string, string[]>,\n  emojiKeywords?: Record<string, string[]>,\n): Library {\n  const emojis = Object.values(byId);\n\n  const byNative = buildCollectionByKey<Emoji>(emojis, 'native');\n  const baseEmojisByKeyword = baseEmojiKeywords\n    ? mapValues(baseEmojiKeywords, (natives) => {\n      return Object.values(pickTruthy(byNative, natives));\n    })\n    : {};\n  const emojisByKeyword = emojiKeywords\n    ? mapValues(emojiKeywords, (natives) => {\n      return Object.values(pickTruthy(byNative, natives));\n    })\n    : {};\n\n  const byKeyword = { ...baseEmojisByKeyword, ...emojisByKeyword };\n  const keywords = ([] as string[]).concat(Object.keys(baseEmojisByKeyword), Object.keys(emojisByKeyword));\n\n  const byName = emojis.reduce((result, emoji) => {\n    emoji.names.forEach((name) => {\n      if (!result[name]) {\n        result[name] = [];\n      }\n\n      result[name].push(emoji);\n    });\n\n    return result;\n  }, {} as Record<string, Emoji[]>);\n\n  const names = Object.keys(byName);\n\n  return {\n    byKeyword,\n    keywords,\n    byName,\n    names,\n  };\n}\n\nfunction searchInLibrary(library: Library, filter: string, limit: number) {\n  const {\n    byKeyword, keywords, byName, names,\n  } = library;\n\n  let matched: Emoji[] = MEMO_EMPTY_ARRAY;\n\n  const matchedKeywords = keywords.filter((keyword) => keyword.startsWith(filter)).sort();\n  matched = matched.concat(Object.values(pickTruthy(byKeyword!, matchedKeywords)).flat());\n\n  // Also search by names, which is useful for non-English languages\n  const matchedNames = names.filter((name) => name.startsWith(filter));\n  matched = matched.concat(Object.values(pickTruthy(byName, matchedNames)).flat());\n\n  matched = unique(matched);\n\n  return matched.slice(0, limit);\n}\n","import {\n  useCallback, useEffect, useState,\n} from '../../../../lib/teact/teact';\nimport { getGlobal } from '../../../../global';\n\nimport type { ApiChatMember, ApiUser } from '../../../../api/types';\nimport { ApiMessageEntityTypes } from '../../../../api/types';\nimport { EDITABLE_INPUT_ID } from '../../../../config';\nimport { filterUsersByName, getUserFirstOrLastName } from '../../../../global/helpers';\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport useFlag from '../../../../hooks/useFlag';\nimport { pickTruthy, unique } from '../../../../util/iteratees';\nimport { throttle } from '../../../../util/schedulers';\n\nconst runThrottled = throttle((cb) => cb(), 500, true);\nlet RE_USERNAME_SEARCH: RegExp;\n\ntry {\n  RE_USERNAME_SEARCH = /(^|\\s)@[-_\\p{L}\\p{M}\\p{N}]*$/gui;\n} catch (e) {\n  // Support for older versions of firefox\n  RE_USERNAME_SEARCH = /(^|\\s)@[-_\\d\\wа-яё]*$/gi;\n}\n\nexport default function useMentionTooltip(\n  canSuggestMembers: boolean | undefined,\n  htmlRef: { current: string },\n  onUpdateHtml: (html: string) => void,\n  inputId: string = EDITABLE_INPUT_ID,\n  groupChatMembers?: ApiChatMember[],\n  topInlineBotIds?: string[],\n  currentUserId?: string,\n) {\n  const [isOpen, markIsOpen, unmarkIsOpen] = useFlag();\n  const [usersToMention, setUsersToMention] = useState<ApiUser[] | undefined>();\n\n  const updateFilteredUsers = useCallback((filter, withInlineBots: boolean) => {\n    // No need for expensive global updates on users, so we avoid them\n    const usersById = getGlobal().users.byId;\n\n    if (!(groupChatMembers || topInlineBotIds) || !usersById) {\n      setUsersToMention(undefined);\n\n      return;\n    }\n\n    runThrottled(() => {\n      const memberIds = groupChatMembers?.reduce((acc: string[], member) => {\n        if (member.userId !== currentUserId) {\n          acc.push(member.userId);\n        }\n\n        return acc;\n      }, []);\n\n      const filteredIds = filterUsersByName(unique([\n        ...((withInlineBots && topInlineBotIds) || []),\n        ...(memberIds || []),\n      ]), usersById, filter);\n\n      setUsersToMention(Object.values(pickTruthy(usersById, filteredIds)));\n    });\n  }, [currentUserId, groupChatMembers, topInlineBotIds]);\n\n  const html = htmlRef.current;\n  useEffect(() => {\n    if (!canSuggestMembers || !html.length) {\n      unmarkIsOpen();\n      return;\n    }\n\n    const usernameFilter = html.includes('@') && getUsernameFilter(html);\n\n    if (usernameFilter) {\n      const filter = usernameFilter ? usernameFilter.substr(1) : '';\n      updateFilteredUsers(filter, canSuggestInlineBots(html));\n    } else {\n      unmarkIsOpen();\n    }\n  }, [canSuggestMembers, updateFilteredUsers, markIsOpen, unmarkIsOpen, html]);\n\n  useEffect(() => {\n    if (usersToMention?.length) {\n      markIsOpen();\n    } else {\n      unmarkIsOpen();\n    }\n  }, [markIsOpen, unmarkIsOpen, usersToMention]);\n\n  const insertMention = useCallback((user: ApiUser, forceFocus = false) => {\n    if (!user.username && !getUserFirstOrLastName(user)) {\n      return;\n    }\n\n    const insertedHtml = user.username\n      ? `@${user.username}`\n      : `<a\n          class=\"text-entity-link\"\n          data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n          data-user-id=\"${user.id}\"\n          contenteditable=\"false\"\n          dir=\"auto\"\n        >${getUserFirstOrLastName(user)}</a>`;\n\n    const currentHtml = htmlRef.current;\n    const atIndex = currentHtml.lastIndexOf('@');\n    if (atIndex !== -1) {\n      onUpdateHtml(`${currentHtml.substr(0, atIndex)}${insertedHtml}&nbsp;`);\n      const messageInput = document.getElementById(inputId)!;\n      requestAnimationFrame(() => {\n        focusEditableElement(messageInput, forceFocus);\n      });\n    }\n\n    unmarkIsOpen();\n  }, [htmlRef, inputId, onUpdateHtml, unmarkIsOpen]);\n\n  return {\n    isMentionTooltipOpen: isOpen,\n    closeMentionTooltip: unmarkIsOpen,\n    insertMention,\n    mentionFilteredUsers: usersToMention,\n  };\n}\n\nfunction getUsernameFilter(html: string) {\n  const username = prepareForRegExp(html).match(RE_USERNAME_SEARCH);\n\n  return username ? username[0].trim() : undefined;\n}\n\nfunction canSuggestInlineBots(html: string) {\n  return html.startsWith('@');\n}\n","import { useEffect, useRef } from '../../../lib/teact/teact';\n\nimport useOnChange from '../../../hooks/useOnChange';\nimport useForceUpdate from '../../../hooks/useForceUpdate';\n\nexport default function useAsyncRendering<T extends any[]>(dependencies: T, delay?: number) {\n  const isDisabled = delay === undefined;\n  const shouldRenderRef = useRef(isDisabled);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n\n  useOnChange(() => {\n    if (isDisabled) {\n      return;\n    }\n\n    shouldRenderRef.current = false;\n\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = undefined;\n    }\n  }, dependencies);\n\n  useEffect(() => {\n    if (isDisabled || shouldRenderRef.current) {\n      return;\n    }\n\n    const exec = () => {\n      shouldRenderRef.current = true;\n      forceUpdate();\n    };\n\n    if (delay! > 0) {\n      timeoutRef.current = window.setTimeout(exec, delay);\n    } else {\n      exec();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n\n  return shouldRenderRef.current;\n}\n","import type { ChangeEvent } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { useCallback, memo, useState } from '../../lib/teact/teact';\n\nimport Checkbox from './Checkbox';\n\ntype IRadioOption = {\n  label: string;\n  subLabel?: string;\n  value: string;\n};\n\ntype OwnProps = {\n  id?: string;\n  options: IRadioOption[];\n  selected?: string[];\n  disabled?: boolean;\n  round?: boolean;\n  loadingOptions?: string[];\n  onChange: (value: string[]) => void;\n};\n\nconst CheckboxGroup: FC<OwnProps> = ({\n  id,\n  options,\n  selected = [],\n  disabled,\n  round,\n  loadingOptions,\n  onChange,\n}) => {\n  const [values, setValues] = useState<string[]>(selected || []);\n\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    const { value, checked } = event.currentTarget;\n    let newValues: string[];\n    if (checked) {\n      newValues = [...values, value];\n    } else {\n      newValues = values.filter((v) => v !== value);\n    }\n\n    setValues(newValues);\n    onChange(newValues);\n  }, [onChange, values]);\n\n  return (\n    <div id={id} className=\"radio-group\">\n      {options.map((option) => (\n        <Checkbox\n          label={option.label}\n          subLabel={option.subLabel}\n          value={option.value}\n          checked={selected.indexOf(option.value) !== -1}\n          disabled={disabled}\n          round={round}\n          isLoading={loadingOptions ? loadingOptions.indexOf(option.value) !== -1 : undefined}\n          onChange={handleChange}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(CheckboxGroup);\n","import type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, { memo, useCallback, useRef } from '../../lib/teact/teact';\n\nimport type { TextPart } from '../../types';\n\nimport useLang from '../../hooks/useLang';\nimport useKeyboardListNavigation from '../../hooks/useKeyboardListNavigation';\n\nimport Modal from './Modal';\nimport Button from './Button';\n\ntype OwnProps = {\n  isOpen: boolean;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n  title?: string;\n  header?: TeactNode;\n  textParts?: TextPart[];\n  text?: string;\n  confirmLabel?: string;\n  confirmHandler: () => void;\n  confirmIsDestructive?: boolean;\n  isButtonsInOneRow?: boolean;\n  children?: React.ReactNode;\n};\n\nconst ConfirmDialog: FC<OwnProps> = ({\n  isOpen,\n  onClose,\n  onCloseAnimationEnd,\n  title,\n  header,\n  text,\n  textParts,\n  confirmLabel = 'Confirm',\n  confirmHandler,\n  confirmIsDestructive,\n  isButtonsInOneRow,\n  children,\n}) => {\n  const lang = useLang();\n\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const handleSelectWithEnter = useCallback((index: number) => {\n    if (index === -1) confirmHandler();\n  }, [confirmHandler]);\n\n  const handleKeyDown = useKeyboardListNavigation(containerRef, isOpen, handleSelectWithEnter, '.Button');\n\n  return (\n    <Modal\n      className=\"confirm\"\n      title={title || lang('Telegram')}\n      header={header}\n      isOpen={isOpen}\n      onClose={onClose}\n      onCloseAnimationEnd={onCloseAnimationEnd}\n    >\n      {text && text.split('\\\\n').map((textPart) => (\n        <p>{textPart}</p>\n      ))}\n      {textParts || children}\n      <div className={isButtonsInOneRow ? 'dialog-buttons mt-2' : ''} ref={containerRef} onKeyDown={handleKeyDown}>\n        <Button\n          className=\"confirm-dialog-button\"\n          isText\n          onClick={confirmHandler}\n          color={confirmIsDestructive ? 'danger' : 'primary'}\n        >\n          {confirmLabel}\n        </Button>\n        <Button className=\"confirm-dialog-button\" isText onClick={onClose}>{lang('Cancel')}</Button>\n      </div>\n    </Modal>\n  );\n};\n\nexport default memo(ConfirmDialog);\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport type { OwnProps as ButtonProps } from './Button';\nimport Button from './Button';\n\nimport './FloatingActionButton.scss';\n\ntype OwnProps = {\n  isShown: boolean;\n  className?: string;\n  color?: ButtonProps['color'];\n  ariaLabel?: ButtonProps['ariaLabel'];\n  disabled?: boolean;\n  onClick: () => void;\n  children: React.ReactNode;\n};\n\nconst FloatingActionButton: FC<OwnProps> = ({\n  isShown,\n  className,\n  color = 'primary',\n  ariaLabel,\n  disabled,\n  onClick,\n  children,\n}) => {\n  const buttonClassName = buildClassName(\n    'FloatingActionButton',\n    isShown && 'revealed',\n    className,\n  );\n\n  return (\n    <Button\n      className={buttonClassName}\n      color={color}\n      round\n      disabled={disabled}\n      onClick={isShown && !disabled ? onClick : undefined}\n      ariaLabel={ariaLabel}\n      tabIndex={-1}\n    >\n      {children}\n    </Button>\n  );\n};\n\nexport default FloatingActionButton;\n","import type { RefObject } from 'react';\nimport type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, { useRef, useCallback } from '../../lib/teact/teact';\n\nimport { IS_TOUCH_ENV } from '../../util/environment';\nimport { fastRaf } from '../../util/schedulers';\nimport buildClassName from '../../util/buildClassName';\nimport useContextMenuHandlers from '../../hooks/useContextMenuHandlers';\nimport useContextMenuPosition from '../../hooks/useContextMenuPosition';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\n\nimport RippleEffect from './RippleEffect';\nimport Menu from './Menu';\nimport MenuItem from './MenuItem';\nimport Button from './Button';\n\nimport './ListItem.scss';\n\ninterface MenuItemContextAction {\n  title: string;\n  icon: string;\n  destructive?: boolean;\n  handler?: () => void;\n}\n\ninterface OwnProps {\n  ref?: RefObject<HTMLDivElement>;\n  buttonRef?: RefObject<HTMLDivElement>;\n  icon?: string;\n  leftElement?: TeactNode;\n  secondaryIcon?: string;\n  buttonClassName?: string;\n  className?: string;\n  style?: string;\n  children: React.ReactNode;\n  disabled?: boolean;\n  ripple?: boolean;\n  narrow?: boolean;\n  inactive?: boolean;\n  focus?: boolean;\n  destructive?: boolean;\n  multiline?: boolean;\n  isStatic?: boolean;\n  contextActions?: MenuItemContextAction[];\n  onMouseDown?: (e: React.MouseEvent<HTMLDivElement>) => void;\n  onClick?: (e: React.MouseEvent<HTMLDivElement>) => void;\n  onSecondaryIconClick?: (e: React.MouseEvent<HTMLButtonElement>) => void;\n}\n\nconst ListItem: FC<OwnProps> = ({\n  ref,\n  buttonRef,\n  icon,\n  leftElement,\n  buttonClassName,\n  secondaryIcon,\n  className,\n  style,\n  children,\n  disabled,\n  ripple,\n  narrow,\n  inactive,\n  focus,\n  destructive,\n  multiline,\n  isStatic,\n  contextActions,\n  onMouseDown,\n  onClick,\n  onSecondaryIconClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n  const [isTouched, markIsTouched, unmarkIsTouched] = useFlag();\n\n  const {\n    isContextMenuOpen, contextMenuPosition,\n    handleBeforeContextMenu, handleContextMenu,\n    handleContextMenuClose, handleContextMenuHide,\n  } = useContextMenuHandlers(containerRef, !contextActions);\n\n  const getTriggerElement = useCallback(() => containerRef.current, []);\n\n  const getRootElement = useCallback(\n    () => containerRef.current!.closest('.custom-scroll'),\n    [],\n  );\n\n  const getMenuElement = useCallback(\n    () => containerRef.current!.querySelector('.ListItem-context-menu .bubble'),\n    [],\n  );\n\n  const {\n    positionX, positionY, transformOriginX, transformOriginY, style: menuStyle,\n  } = useContextMenuPosition(\n    contextMenuPosition,\n    getTriggerElement,\n    getRootElement,\n    getMenuElement,\n  );\n\n  const handleClick = useCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (disabled || !onClick) {\n      return;\n    }\n    onClick(e);\n\n    if (IS_TOUCH_ENV && !ripple) {\n      markIsTouched();\n      fastRaf(unmarkIsTouched);\n    }\n  }, [disabled, markIsTouched, onClick, ripple, unmarkIsTouched]);\n\n  const handleSecondaryIconClick = (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    if (disabled || e.button !== 0 || (!onSecondaryIconClick && !contextActions)) return;\n    e.stopPropagation();\n    if (onSecondaryIconClick) {\n      onSecondaryIconClick(e);\n    } else {\n      handleContextMenu(e);\n    }\n  };\n\n  const handleMouseDown = useCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (inactive || IS_TOUCH_ENV) {\n      return;\n    }\n    if (contextActions && (e.button === 2 || !onClick)) {\n      handleBeforeContextMenu(e);\n    }\n    if (e.button === 0) {\n      if (!onClick) {\n        handleContextMenu(e);\n      } else {\n        handleClick(e);\n      }\n    }\n  }, [inactive, contextActions, onClick, handleBeforeContextMenu, handleContextMenu, handleClick]);\n\n  const lang = useLang();\n\n  const fullClassName = buildClassName(\n    'ListItem',\n    className,\n    !isStatic && 'no-selection',\n    ripple && 'has-ripple',\n    narrow && 'narrow',\n    disabled && 'disabled',\n    inactive && 'inactive',\n    contextMenuPosition && 'has-menu-open',\n    focus && 'focus',\n    destructive && 'destructive',\n    multiline && 'multiline',\n    isStatic && 'is-static',\n  );\n\n  return (\n    <div\n      ref={containerRef}\n      className={fullClassName}\n      dir={lang.isRtl ? 'rtl' : undefined}\n      style={style}\n      onMouseDown={onMouseDown}\n    >\n      <div\n        className={buildClassName('ListItem-button', isTouched && 'active', buttonClassName)}\n        role={!isStatic ? 'button' : undefined}\n        ref={buttonRef}\n        tabIndex={!isStatic ? 0 : undefined}\n        onClick={(!inactive && IS_TOUCH_ENV) ? handleClick : undefined}\n        onMouseDown={handleMouseDown}\n        onContextMenu={(!inactive && contextActions) ? handleContextMenu : undefined}\n      >\n        {leftElement}\n        {icon && (\n          <i className={`icon-${icon}`} />\n        )}\n        {multiline && (<div className=\"multiline-item\">{children}</div>)}\n        {!multiline && children}\n        {!disabled && !inactive && ripple && (\n          <RippleEffect />\n        )}\n        {secondaryIcon && (\n          <Button\n            className=\"secondary-icon\"\n            round\n            color=\"translucent\"\n            size=\"smaller\"\n            onClick={IS_TOUCH_ENV ? handleSecondaryIconClick : undefined}\n            onMouseDown={!IS_TOUCH_ENV ? handleSecondaryIconClick : undefined}\n          >\n            <i className={`icon-${secondaryIcon}`} />\n          </Button>\n        )}\n      </div>\n      {contextActions && contextMenuPosition !== undefined && (\n        <Menu\n          isOpen={isContextMenuOpen}\n          transformOriginX={transformOriginX}\n          transformOriginY={transformOriginY}\n          positionX={positionX}\n          positionY={positionY}\n          style={menuStyle}\n          className=\"ListItem-context-menu\"\n          autoClose\n          onClose={handleContextMenuClose}\n          onCloseAnimationEnd={handleContextMenuHide}\n        >\n          {contextActions.map((action) => (\n            <MenuItem\n              key={action.title}\n              icon={action.icon}\n              destructive={action.destructive}\n              disabled={!action.handler}\n              onClick={action.handler}\n            >\n              {action.title}\n            </MenuItem>\n          ))}\n        </Menu>\n      )}\n    </div>\n  );\n};\n\nexport default ListItem;\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\n\nimport type { TextPart } from '../../types';\n\nimport { ANIMATION_END_DELAY } from '../../config';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport buildClassName from '../../util/buildClassName';\nimport captureEscKeyListener from '../../util/captureEscKeyListener';\n\nimport Portal from './Portal';\nimport Button from './Button';\n\nimport './Notification.scss';\n\ntype OwnProps = {\n  title?: TextPart[];\n  containerId?: string;\n  message: TextPart[];\n  duration?: number;\n  onDismiss: () => void;\n  action?: VoidFunction;\n  actionText?: string;\n  className?: string;\n};\n\nconst DEFAULT_DURATION = 3000;\nconst ANIMATION_DURATION = 150;\n\nconst Notification: FC<OwnProps> = ({\n  title, className,\n  message, duration = DEFAULT_DURATION, containerId, onDismiss,\n  action, actionText,\n}) => {\n  const [isOpen, setIsOpen] = useState(true);\n  // eslint-disable-next-line no-null/no-null\n  const timerRef = useRef<number | undefined>(null);\n\n  const { transitionClassNames } = useShowTransition(isOpen);\n\n  const closeAndDismiss = useCallback(() => {\n    setIsOpen(false);\n    setTimeout(onDismiss, ANIMATION_DURATION + ANIMATION_END_DELAY);\n  }, [onDismiss]);\n\n  function handleClick() {\n    action?.();\n    closeAndDismiss();\n  }\n\n  useEffect(() => (isOpen ? captureEscKeyListener(closeAndDismiss) : undefined), [isOpen, closeAndDismiss]);\n\n  useEffect(() => {\n    timerRef.current = window.setTimeout(closeAndDismiss, duration);\n\n    return () => {\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n        timerRef.current = undefined;\n      }\n    };\n  }, [duration, closeAndDismiss]);\n\n  const handleMouseEnter = useCallback(() => {\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n      timerRef.current = undefined;\n    }\n  }, []);\n\n  const handleMouseLeave = useCallback(() => {\n    timerRef.current = window.setTimeout(closeAndDismiss, duration);\n  }, [duration, closeAndDismiss]);\n\n  return (\n    <Portal className=\"Notification-container\" containerId={containerId}>\n      <div\n        className={buildClassName('Notification', transitionClassNames, className)}\n        onClick={handleClick}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n      >\n        <div className=\"content\">\n          {title && <div className=\"notification-title\">{title}</div>}\n          {message}\n        </div>\n        {action && actionText && (\n          <Button\n            color=\"translucent-white\"\n            onClick={action}\n            className=\"Notification-button\"\n          >\n            {actionText}\n          </Button>\n        )}\n      </div>\n    </Portal>\n  );\n};\n\nexport default Notification;\n","import type { FC } from '../../lib/teact/teact';\nimport React, { useEffect, useRef, memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './ProgressSpinner.scss';\n\nconst RADIUSES = {\n  s: 22, m: 25, l: 28, xl: 20,\n};\nconst STROKE_WIDTH = 2;\nconst MIN_PROGRESS = 0.05;\nconst MAX_PROGRESS = 1;\n\nconst ProgressSpinner: FC<{\n  progress?: number;\n  size?: 's' | 'm' | 'l' | 'xl';\n  square?: boolean;\n  transparent?: boolean;\n  noCross?: boolean;\n  onClick?: (e: React.MouseEvent<HTMLElement, MouseEvent>) => void;\n}> = ({\n  progress = 0,\n  size = 'l',\n  square,\n  transparent,\n  noCross,\n  onClick,\n}) => {\n  const radius = RADIUSES[size];\n  const circleRadius = radius - STROKE_WIDTH * 2;\n  const borderRadius = radius - 1;\n  const circumference = circleRadius * 2 * Math.PI;\n  // eslint-disable-next-line no-null/no-null\n  const container = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!container.current) {\n      return;\n    }\n\n    const svg = container.current.firstElementChild;\n    const strokeDashOffset = circumference - Math.min(Math.max(MIN_PROGRESS, progress), MAX_PROGRESS) * circumference;\n\n    if (!svg) {\n      container.current.innerHTML = `<svg\n        viewBox=\"0 0 ${borderRadius * 2} ${borderRadius * 2}\"\n        height=\"${borderRadius * 2}\"\n        width=\"${borderRadius * 2}\"\n      >\n        <circle\n          stroke=\"white\"\n          fill=\"transparent\"\n          stroke-width=${STROKE_WIDTH}\n          stroke-dasharray=\"${circumference} ${circumference}\"}\n          stroke-dashoffset=\"${strokeDashOffset}\"\n          stroke-linecap=\"round\"\n          r=${circleRadius}\n          cx=${borderRadius}\n          cy=${borderRadius}\n        />\n      </svg>`;\n    } else {\n      (svg.firstElementChild as SVGElement).setAttribute('stroke-dashoffset', strokeDashOffset.toString());\n    }\n  }, [container, circumference, borderRadius, circleRadius, progress]);\n\n  const className = buildClassName(\n    `ProgressSpinner size-${size}`,\n    transparent && 'transparent',\n    square && 'square',\n    noCross && 'no-cross',\n  );\n\n  return (\n    <div\n      ref={container}\n      className={className}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default memo(ProgressSpinner);\n","import type { ChangeEvent } from 'react';\nimport type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport Spinner from './Spinner';\n\nimport './Radio.scss';\n\ntype OwnProps = {\n  id?: string;\n  name: string;\n  label: TeactNode;\n  subLabel?: string;\n  value: string;\n  checked: boolean;\n  disabled?: boolean;\n  hidden?: boolean;\n  isLoading?: boolean;\n  onChange: (e: ChangeEvent<HTMLInputElement>) => void;\n};\n\nconst Radio: FC<OwnProps> = ({\n  id,\n  label,\n  subLabel,\n  value,\n  name,\n  checked,\n  disabled,\n  hidden,\n  isLoading,\n  onChange,\n}) => {\n  const lang = useLang();\n  const className = buildClassName(\n    'Radio',\n    disabled && 'disabled',\n    hidden && 'hidden-widget',\n    isLoading && 'loading',\n  );\n\n  return (\n    <label className={className} dir={lang.isRtl ? 'rtl' : undefined}>\n      <input\n        type=\"radio\"\n        name={name}\n        value={value}\n        id={id}\n        checked={checked}\n        onChange={onChange}\n        disabled={disabled || hidden}\n      />\n      <div className=\"Radio-main\">\n        <span className=\"label\" dir={lang.isRtl ? 'auto' : undefined}>{label}</span>\n        {subLabel && <span className=\"subLabel\" dir={lang.isRtl ? 'auto' : undefined}>{subLabel}</span>}\n      </div>\n      {isLoading && <Spinner />}\n    </label>\n  );\n};\n\nexport default memo(Radio);\n","import type { ChangeEvent } from 'react';\nimport type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, { useCallback, memo } from '../../lib/teact/teact';\n\nimport Radio from './Radio';\n\nexport type IRadioOption = {\n  label: TeactNode;\n  subLabel?: string;\n  value: string;\n  hidden?: boolean;\n};\n\ntype OwnProps = {\n  id?: string;\n  name: string;\n  options: IRadioOption[];\n  selected?: string;\n  disabled?: boolean;\n  loadingOption?: string;\n  onChange: (value: string, event: ChangeEvent<HTMLInputElement>) => void;\n};\n\nconst RadioGroup: FC<OwnProps> = ({\n  id,\n  name,\n  options,\n  selected,\n  disabled,\n  loadingOption,\n  onChange,\n}) => {\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    const { value } = event.currentTarget;\n    onChange(value, event);\n  }, [onChange]);\n\n  return (\n    <div id={id} className=\"radio-group\">\n      {options.map((option) => (\n        <Radio\n          name={name}\n          label={option.label}\n          subLabel={option.subLabel}\n          value={option.value}\n          checked={option.value === selected}\n          hidden={option.hidden}\n          disabled={disabled}\n          isLoading={loadingOption ? loadingOption === option.value : undefined}\n          onChange={handleChange}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(RadioGroup);\n","import type { ChangeEvent } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { useCallback, useMemo, memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport './RangeSlider.scss';\n\ntype OwnProps = {\n  options?: string[];\n  min?: number;\n  max?: number;\n  step?: number;\n  label?: string;\n  value: number;\n  disabled?: boolean;\n  bold?: boolean;\n  className?: string;\n  renderValue?: (value: number) => string;\n  onChange: (value: number) => void;\n};\n\nconst RangeSlider: FC<OwnProps> = ({\n  options,\n  min = 0,\n  max = options ? options.length - 1 : 100,\n  step = 1,\n  label,\n  value,\n  disabled,\n  bold,\n  className,\n  renderValue,\n  onChange,\n}) => {\n  const lang = useLang();\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    onChange(Number(event.currentTarget.value));\n  }, [onChange]);\n\n  const mainClassName = buildClassName(\n    className,\n    'RangeSlider',\n    disabled && 'disabled',\n    bold && 'bold',\n  );\n\n  const trackWidth = useMemo(() => {\n    if (options) {\n      return (value / (options.length - 1)) * 100;\n    } else {\n      const possibleValuesLength = (max - min) / step;\n      return ((value - min) / possibleValuesLength) * 100;\n    }\n  }, [options, value, max, min, step]);\n\n  return (\n    <div className={mainClassName}>\n      {label && (\n        <div className=\"slider-top-row\" dir={lang.isRtl ? 'rtl' : undefined}>\n          <span className=\"label\" dir=\"auto\">{label}</span>\n          {!options && (\n            <span className=\"value\" dir=\"auto\">{renderValue ? renderValue(value) : value}</span>\n          )}\n        </div>\n      )}\n      <div className=\"slider-main\">\n        <div\n          className=\"slider-fill-track\"\n          style={`width: ${trackWidth}%`}\n        />\n        <input\n          min={min}\n          max={max}\n          value={value}\n          step={step}\n          type=\"range\"\n          className=\"RangeSlider__input\"\n          onChange={handleChange}\n        />\n        {options && (\n          <div className=\"slider-options\">\n            {options.map((option, index) => (\n              <div\n                className={buildClassName('slider-option no-selection', index === value && 'active')}\n                onClick={() => onChange(index)}\n              >\n                {option}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(RangeSlider);\n","import type { RefObject } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, {\n  useRef, useEffect, memo, useCallback,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\nimport useInputFocusOnOpen from '../../hooks/useInputFocusOnOpen';\n\nimport Loading from './Loading';\nimport Button from './Button';\nimport ShowTransition from './ShowTransition';\n\nimport './SearchInput.scss';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLInputElement>;\n  children?: React.ReactNode;\n  parentContainerClassName?: string;\n  className?: string;\n  inputId?: string;\n  value?: string;\n  focused?: boolean;\n  isLoading?: boolean;\n  spinnerColor?: 'yellow';\n  spinnerBackgroundColor?: 'light';\n  placeholder?: string;\n  disabled?: boolean;\n  autoComplete?: string;\n  canClose?: boolean;\n  autoFocusSearch?: boolean;\n  onChange: (value: string) => void;\n  onReset?: NoneToVoidFunction;\n  onFocus?: NoneToVoidFunction;\n  onBlur?: NoneToVoidFunction;\n  onSpinnerClick?: NoneToVoidFunction;\n};\n\nconst SearchInput: FC<OwnProps> = ({\n  ref,\n  children,\n  parentContainerClassName,\n  value,\n  inputId,\n  className,\n  focused,\n  isLoading,\n  spinnerColor,\n  spinnerBackgroundColor,\n  placeholder,\n  disabled,\n  autoComplete,\n  canClose,\n  autoFocusSearch,\n  onChange,\n  onReset,\n  onFocus,\n  onBlur,\n  onSpinnerClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let inputRef = useRef<HTMLInputElement>(null);\n  if (ref) {\n    inputRef = ref;\n  }\n\n  const [isInputFocused, markInputFocused, unmarkInputFocused] = useFlag(focused);\n\n  useInputFocusOnOpen(inputRef, autoFocusSearch, unmarkInputFocused);\n\n  useEffect(() => {\n    if (!inputRef.current) {\n      return;\n    }\n\n    if (focused) {\n      inputRef.current.focus();\n    } else {\n      inputRef.current.blur();\n    }\n  }, [focused, placeholder]); // Trick for setting focus when selecting a contact to search for\n\n  const lang = useLang();\n\n  function handleChange(event: React.ChangeEvent<HTMLInputElement>) {\n    const { currentTarget } = event;\n    onChange(currentTarget.value);\n  }\n\n  function handleFocus() {\n    markInputFocused();\n    if (onFocus) {\n      onFocus();\n    }\n  }\n\n  function handleBlur() {\n    unmarkInputFocused();\n    if (onBlur) {\n      onBlur();\n    }\n  }\n\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'ArrowDown' || e.key === 'Enter') {\n      const element = document.querySelector(`.${parentContainerClassName} .ListItem-button`) as HTMLElement;\n      if (element) {\n        element.focus();\n      }\n    }\n  }, [parentContainerClassName]);\n\n  return (\n    <div\n      className={buildClassName('SearchInput', className, isInputFocused && 'has-focus')}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {children}\n      <input\n        ref={inputRef}\n        id={inputId}\n        type=\"text\"\n        dir=\"auto\"\n        placeholder={placeholder || lang('Search')}\n        className=\"form-control\"\n        value={value}\n        disabled={disabled}\n        autoComplete={autoComplete}\n        onChange={handleChange}\n        onFocus={handleFocus}\n        onBlur={handleBlur}\n        onKeyDown={handleKeyDown}\n      />\n      <i className=\"icon-search\" />\n      <ShowTransition isOpen={Boolean(isLoading)} className=\"slow\">\n        <Loading color={spinnerColor} backgroundColor={spinnerBackgroundColor} onClick={onSpinnerClick} />\n      </ShowTransition>\n      {!isLoading && (value || canClose) && onReset && (\n        <Button\n          round\n          size=\"tiny\"\n          color=\"translucent\"\n          onClick={onReset}\n        >\n          <span className=\"icon-close\" />\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(SearchInput);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { useRef } from '../../lib/teact/teact';\n\nimport useShowTransition from '../../hooks/useShowTransition';\nimport usePrevious from '../../hooks/usePrevious';\nimport buildClassName from '../../util/buildClassName';\n\ntype OwnProps = {\n  isOpen: boolean;\n  isCustom?: boolean;\n  id?: string;\n  className?: string;\n  onClick?: (e: React.MouseEvent<HTMLElement, MouseEvent>) => void;\n  children: React.ReactNode;\n};\n\nconst ShowTransition: FC<OwnProps> = ({\n  isOpen, isCustom, id, className, onClick, children,\n}) => {\n  const { shouldRender, transitionClassNames } = useShowTransition(\n    isOpen, undefined, undefined, isCustom ? false : undefined,\n  );\n  const prevIsOpen = usePrevious(isOpen);\n  const prevChildren = usePrevious(children);\n  const fromChildrenRef = useRef<React.ReactNode>();\n\n  if (prevIsOpen && !isOpen) {\n    fromChildrenRef.current = prevChildren;\n  }\n\n  return (\n    shouldRender && (\n      <div id={id} className={buildClassName(className, transitionClassNames)} onClick={onClick}>\n        {isOpen ? children : fromChildrenRef.current!}\n      </div>\n    )\n  );\n};\n\nexport default ShowTransition;\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\n\nimport './Skeleton.scss';\n\ntype OwnProps = {\n  variant?: 'rectangular' | 'rounded-rect' | 'round';\n  animation?: 'wave' | 'pulse';\n  width?: number;\n  height?: number;\n  forceAspectRatio?: boolean;\n  className?: string;\n};\n\nconst Skeleton: FC<OwnProps> = ({\n  variant = 'rectangular',\n  animation = 'wave',\n  width,\n  height,\n  forceAspectRatio,\n  className,\n}) => {\n  const classNames = buildClassName('Skeleton', variant, animation, className);\n  const aspectRatio = (width && height) ? `aspect-ratio: ${width}/${height}` : undefined;\n  const style = forceAspectRatio ? aspectRatio\n    : buildStyle(Boolean(width) && `width: ${width}px`, Boolean(height) && `height: ${height}px`);\n  return (\n    <div className={classNames} style={style} />\n  );\n};\n\nexport default Skeleton;\n","import type { ChangeEvent } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { memo, useCallback } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './Switcher.scss';\n\ntype OwnProps = {\n  id?: string;\n  name?: string;\n  value?: string;\n  label: string;\n  checked?: boolean;\n  disabled?: boolean;\n  inactive?: boolean;\n  noAnimation?: boolean;\n  onChange?: (e: ChangeEvent<HTMLInputElement>) => void;\n  onCheck?: (isChecked: boolean) => void;\n};\n\nconst Switcher: FC<OwnProps> = ({\n  id,\n  name,\n  value,\n  label,\n  checked = false,\n  disabled,\n  inactive,\n  noAnimation,\n  onChange,\n  onCheck,\n}) => {\n  const handleChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    if (onChange) {\n      onChange(e);\n    }\n\n    if (onCheck) {\n      onCheck(e.currentTarget.checked);\n    }\n  }, [onChange, onCheck]);\n\n  const className = buildClassName(\n    'Switcher',\n    disabled && 'disabled',\n    inactive && 'inactive',\n    noAnimation && 'no-animation',\n  );\n\n  return (\n    <label className={className} title={label}>\n      <input\n        type=\"checkbox\"\n        id={id}\n        name={name}\n        value={value}\n        checked={checked}\n        disabled={disabled}\n        onChange={handleChange}\n      />\n      <span className=\"widget\" />\n    </label>\n  );\n};\n\nexport default memo(Switcher);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { useRef, memo, useEffect } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport forceReflow from '../../util/forceReflow';\nimport renderText from '../common/helpers/renderText';\n\nimport './Tab.scss';\n\ntype OwnProps = {\n  className?: string;\n  title: string;\n  isActive?: boolean;\n  isBlocked?: boolean;\n  badgeCount?: number;\n  isBadgeActive?: boolean;\n  previousActiveTab?: number;\n  onClick: (arg: number) => void;\n  clickArg: number;\n};\n\nconst classNames = {\n  active: 'Tab--active',\n  badgeActive: 'Tab__badge--active',\n};\n\nconst Tab: FC<OwnProps> = ({\n  className,\n  title,\n  isActive,\n  isBlocked,\n  badgeCount,\n  isBadgeActive,\n  previousActiveTab,\n  onClick,\n  clickArg,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const tabRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    // Set initial active state\n    if (isActive && previousActiveTab === undefined && tabRef.current) {\n      tabRef.current.classList.add(classNames.active);\n    }\n\n    if (!isActive || previousActiveTab === undefined) {\n      return;\n    }\n\n    const tabEl = tabRef.current!;\n    const prevTabEl = tabEl.parentElement!.children[previousActiveTab];\n    if (!prevTabEl) {\n      return;\n    }\n\n    const platformEl = tabEl.querySelector<HTMLElement>('.platform')!;\n    const prevPlatformEl = prevTabEl.querySelector<HTMLElement>('.platform')!;\n\n    // We move and resize the platform, so it repeats the position and size of the previous one\n    const shiftLeft = prevPlatformEl.parentElement!.offsetLeft - platformEl.parentElement!.offsetLeft;\n    const scaleFactor = prevPlatformEl.clientWidth / platformEl.clientWidth;\n\n    prevPlatformEl.classList.remove('animate');\n    platformEl.classList.remove('animate');\n    platformEl.style.transform = `translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`;\n    forceReflow(platformEl);\n    platformEl.classList.add('animate');\n    platformEl.style.transform = 'none';\n\n    prevTabEl.classList.remove(classNames.active);\n    tabEl.classList.add(classNames.active);\n  }, [isActive, previousActiveTab]);\n\n  return (\n    <div\n      className={buildClassName('Tab', className)}\n      onClick={() => onClick(clickArg)}\n      ref={tabRef}\n    >\n      <span>\n        {renderText(title)}\n        {Boolean(badgeCount) && (\n          <span className={buildClassName('badge', isBadgeActive && classNames.badgeActive)}>{badgeCount}</span>\n        )}\n        {isBlocked && <i className=\"icon-lock-badge blocked\" />}\n        <i className=\"platform\" />\n      </span>\n    </div>\n  );\n};\n\nexport default memo(Tab);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useRef, useEffect } from '../../lib/teact/teact';\n\nimport { IS_ANDROID, IS_IOS } from '../../util/environment';\nimport fastSmoothScrollHorizontal from '../../util/fastSmoothScrollHorizontal';\nimport usePrevious from '../../hooks/usePrevious';\nimport useHorizontalScroll from '../../hooks/useHorizontalScroll';\nimport useLang from '../../hooks/useLang';\n\nimport Tab from './Tab';\n\nimport './TabList.scss';\n\nexport type TabWithProperties = {\n  id?: number;\n  title: string;\n  badgeCount?: number;\n  isBlocked?: boolean;\n  isBadgeActive?: boolean;\n};\n\ntype OwnProps = {\n  tabs: readonly TabWithProperties[];\n  activeTab: number;\n  big?: boolean;\n  onSwitchTab: (index: number) => void;\n};\n\nconst TAB_SCROLL_THRESHOLD_PX = 16;\n// Should match duration from `--slide-transition` CSS variable\nconst SCROLL_DURATION = IS_IOS ? 450 : IS_ANDROID ? 400 : 300;\n\nconst TabList: FC<OwnProps> = ({\n  tabs, activeTab, big, onSwitchTab,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  const previousActiveTab = usePrevious(activeTab);\n\n  useHorizontalScroll(containerRef.current);\n\n  // Scroll container to place active tab in the center\n  useEffect(() => {\n    const container = containerRef.current!;\n    const { scrollWidth, offsetWidth, scrollLeft } = container;\n    if (scrollWidth <= offsetWidth) {\n      return;\n    }\n\n    const activeTabElement = container.childNodes[activeTab] as HTMLElement | null;\n    if (!activeTabElement) {\n      return;\n    }\n\n    const { offsetLeft: activeTabOffsetLeft, offsetWidth: activeTabOffsetWidth } = activeTabElement;\n    const newLeft = activeTabOffsetLeft - (offsetWidth / 2) + (activeTabOffsetWidth / 2);\n\n    // Prevent scrolling by only a couple of pixels, which doesn't look smooth\n    if (Math.abs(newLeft - scrollLeft) < TAB_SCROLL_THRESHOLD_PX) {\n      return;\n    }\n\n    fastSmoothScrollHorizontal(container, newLeft, SCROLL_DURATION);\n  }, [activeTab]);\n\n  const lang = useLang();\n\n  return (\n    <div\n      className={`TabList no-selection no-scrollbar ${big ? 'big' : ''}`}\n      ref={containerRef}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {tabs.map((tab, i) => (\n        <Tab\n          key={tab.id ?? tab.title}\n          title={lang(tab.title)}\n          isActive={i === activeTab}\n          isBlocked={tab.isBlocked}\n          badgeCount={tab.badgeCount}\n          isBadgeActive={tab.isBadgeActive}\n          previousActiveTab={previousActiveTab}\n          onClick={onSwitchTab}\n          clickArg={i}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(TabList);\n","import type { StateReducer, Dispatch } from '../useReducer';\nimport useReducer from '../useReducer';\nimport type { ApiChatFolder } from '../../api/types';\nimport { pick, omit } from '../../util/iteratees';\n\nexport type FolderChatType = {\n  icon: string;\n  title: string;\n  key: keyof Pick<ApiChatFolder, (\n    'contacts' | 'nonContacts' | 'groups' | 'channels' | 'bots' |\n    'excludeMuted' | 'excludeArchived' | 'excludeRead'\n  )>;\n};\n\nexport const INCLUDED_CHAT_TYPES: FolderChatType[] = [\n  { icon: 'user', title: 'FilterContacts', key: 'contacts' },\n  { icon: 'non-contacts', title: 'FilterNonContacts', key: 'nonContacts' },\n  { icon: 'group', title: 'FilterGroups', key: 'groups' },\n  { icon: 'channel', title: 'FilterChannels', key: 'channels' },\n  { icon: 'bots', title: 'FilterBots', key: 'bots' },\n];\n\nexport const EXCLUDED_CHAT_TYPES: FolderChatType[] = [\n  { icon: 'mute', title: 'FilterMuted', key: 'excludeMuted' },\n  { icon: 'archive', title: 'FilterArchived', key: 'excludeArchived' },\n  { icon: 'readchats', title: 'FilterRead', key: 'excludeRead' },\n];\n\nconst INCLUDE_FILTER_FIELDS: Array<keyof FolderIncludeFilters> = [\n  'includedChatIds', 'bots', 'channels', 'groups', 'contacts', 'nonContacts',\n];\nconst EXCLUDE_FILTER_FIELDS: Array<keyof FolderExcludeFilters> = [\n  'excludedChatIds', 'excludeArchived', 'excludeMuted', 'excludeRead',\n];\n\nexport function selectChatFilters(state: FoldersState, mode: 'included' | 'excluded', selectTemp?: boolean) {\n  let selectedChatIds: string[] = [];\n  let selectedChatTypes: FolderChatType['key'][] = [];\n\n  if (mode === 'included') {\n    const {\n      includedChatIds,\n      ...includeFilters\n    } = selectTemp\n      ? state.includeFilters || {}\n      : pick(\n        state.folder,\n        INCLUDE_FILTER_FIELDS,\n      );\n\n    selectedChatIds = includedChatIds || [];\n    selectedChatTypes = (Object.keys(includeFilters) as Array<keyof typeof includeFilters>)\n      .filter((key) => Boolean(includeFilters[key]));\n  } else {\n    const {\n      excludedChatIds,\n      ...excludeFilters\n    } = selectTemp\n      ? state.excludeFilters || {}\n      : pick(\n        state.folder,\n        EXCLUDE_FILTER_FIELDS,\n      );\n\n    selectedChatIds = excludedChatIds || [];\n    selectedChatTypes = (Object.keys(excludeFilters) as Array<keyof typeof excludeFilters>)\n      .filter((key) => Boolean(excludeFilters[key]));\n  }\n\n  return {\n    selectedChatIds,\n    selectedChatTypes,\n  };\n}\n\nfunction getSuggestedFolderName(includeFilters?: FolderIncludeFilters) {\n  if (includeFilters) {\n    const {\n      includedChatIds,\n      ...filters\n    } = includeFilters;\n\n    if (\n      Object.values(filters).filter(Boolean).length > 1\n      || (includedChatIds?.length)\n    ) {\n      return '';\n    }\n\n    if (filters.bots) {\n      return 'Bots';\n    } else if (filters.groups) {\n      return 'Groups';\n    } else if (filters.channels) {\n      return 'Channels';\n    } else if (filters.contacts) {\n      return 'Contacts';\n    } else if (filters.nonContacts) {\n      return 'Non-Contacts';\n    }\n  }\n\n  return '';\n}\n\ntype FolderIncludeFilters = Pick<ApiChatFolder, (\n  'includedChatIds' | 'bots' | 'channels' | 'groups' | 'contacts' | 'nonContacts'\n)>;\ntype FolderExcludeFilters = Pick<ApiChatFolder, 'excludedChatIds' | 'excludeArchived' | 'excludeMuted' | 'excludeRead'>;\n\nexport type FoldersState = {\n  mode: 'create' | 'edit';\n  isLoading?: boolean;\n  isTouched?: boolean;\n  error?: string;\n  folderId?: number;\n  chatFilter: string;\n  folder: Omit<ApiChatFolder, 'id' | 'description' | 'emoticon'>;\n  includeFilters?: FolderIncludeFilters;\n  excludeFilters?: FolderExcludeFilters;\n};\nexport type FoldersActions = (\n  'setTitle' | 'saveFilters' | 'editFolder' | 'reset' | 'setChatFilter' | 'setIsLoading' | 'setError' |\n  'editIncludeFilters' | 'editExcludeFilters' | 'setIncludeFilters' | 'setExcludeFilters'\n);\nexport type FolderEditDispatch = Dispatch<FoldersActions>;\n\nconst INITIAL_STATE: FoldersState = {\n  mode: 'create',\n  chatFilter: '',\n  folder: {\n    title: '',\n    includedChatIds: [],\n    excludedChatIds: [],\n  },\n};\n\nconst foldersReducer: StateReducer<FoldersState, FoldersActions> = (\n  state,\n  action,\n) => {\n  switch (action.type) {\n    case 'setTitle':\n      return {\n        ...state,\n        folder: {\n          ...state.folder,\n          title: action.payload,\n        },\n        isTouched: true,\n      };\n    case 'editIncludeFilters':\n      return {\n        ...state,\n        includeFilters: pick(\n          state.folder,\n          INCLUDE_FILTER_FIELDS,\n        ),\n      };\n    case 'editExcludeFilters':\n      return {\n        ...state,\n        excludeFilters: pick(\n          state.folder,\n          EXCLUDE_FILTER_FIELDS,\n        ),\n      };\n    case 'setIncludeFilters':\n      return {\n        ...state,\n        includeFilters: action.payload,\n        chatFilter: '',\n      };\n    case 'setExcludeFilters':\n      return {\n        ...state,\n        excludeFilters: action.payload,\n        chatFilter: '',\n      };\n    case 'saveFilters':\n      if (state.includeFilters) {\n        return {\n          ...state,\n          folder: {\n            ...omit(state.folder, INCLUDE_FILTER_FIELDS),\n            title: state.folder.title ? state.folder.title : getSuggestedFolderName(state.includeFilters),\n            ...state.includeFilters,\n          },\n          includeFilters: undefined,\n          chatFilter: '',\n          isTouched: true,\n        };\n      } else if (state.excludeFilters) {\n        return {\n          ...state,\n          folder: {\n            ...omit(state.folder, EXCLUDE_FILTER_FIELDS),\n            ...state.excludeFilters,\n          },\n          excludeFilters: undefined,\n          chatFilter: '',\n          isTouched: true,\n        };\n      } else {\n        return state;\n      }\n    case 'editFolder': {\n      const { id: folderId, description, ...folder } = action.payload;\n\n      return {\n        mode: 'edit',\n        folderId,\n        folder,\n        chatFilter: '',\n      };\n    }\n    case 'setChatFilter': {\n      return {\n        ...state,\n        chatFilter: action.payload,\n      };\n    }\n    case 'setIsLoading': {\n      return {\n        ...state,\n        isLoading: action.payload,\n      };\n    }\n    case 'setError': {\n      return {\n        ...state,\n        error: action.payload,\n      };\n    }\n    case 'reset':\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n\nconst useFoldersReducer = () => {\n  return useReducer(foldersReducer, INITIAL_STATE);\n};\n\nexport default useFoldersReducer;\n","import {\n  useCallback, useEffect, useRef, useState,\n} from '../lib/teact/teact';\nimport { getActions, getGlobal } from '../global';\n\nimport { PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION } from '../config';\nimport type { Track, TrackId } from '../util/audioPlayer';\nimport { register } from '../util/audioPlayer';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\nimport type { MediaSessionHandlers } from '../util/mediaSession';\nimport {\n  registerMediaSession, setPlaybackState, setPositionState, updateMetadata,\n} from '../util/mediaSession';\n\nimport useEffectWithPrevDeps from './useEffectWithPrevDeps';\nimport useOnChange from './useOnChange';\n\ntype Handler = (e: Event) => void;\n\nconst DEFAULT_SKIP_TIME = 10;\n\nconst useAudioPlayer = (\n  trackId: TrackId,\n  originalDuration: number, // Sometimes incorrect for voice messages\n  trackType: Track['type'],\n  src?: string,\n  handlers?: Record<string, Handler>,\n  metadata?: MediaMetadata,\n  onInit?: (element: HTMLAudioElement) => void,\n  shouldPlay = false,\n  onForcePlay?: NoneToVoidFunction,\n  onTrackChange?: NoneToVoidFunction,\n  noPlaylist = false,\n  noProgressUpdates = false,\n) => {\n  // eslint-disable-next-line no-null/no-null\n  const controllerRef = useRef<ReturnType<typeof register>>(null);\n\n  const [isPlaying, setIsPlaying] = useState(false);\n  let isPlayingSync = isPlaying;\n\n  const [playProgress, setPlayProgress] = useState<number>(0);\n\n  const handleTrackChange = useCallback(() => {\n    setIsPlaying(false);\n    if (onTrackChange) onTrackChange();\n  }, [onTrackChange]);\n\n  useOnChange(() => {\n    controllerRef.current = register(trackId, trackType, (eventName, e) => {\n      switch (eventName) {\n        case 'onPlay': {\n          const {\n            setVolume, setPlaybackRate, toggleMuted, proxy,\n          } = controllerRef.current!;\n          setIsPlaying(true);\n\n          registerMediaSession(metadata, makeMediaHandlers(controllerRef));\n          setPlaybackState('playing');\n          setVolume(getGlobal().audioPlayer.volume);\n          toggleMuted(Boolean(getGlobal().audioPlayer.isMuted));\n          const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n          if (trackType === 'voice' || duration > PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION) {\n            setPlaybackRate(getGlobal().audioPlayer.playbackRate);\n          }\n\n          setPositionState({\n            duration: proxy.duration || 0,\n            playbackRate: proxy.playbackRate,\n            position: proxy.currentTime,\n          });\n          break;\n        }\n        case 'onRateChange': {\n          const { proxy } = controllerRef.current!;\n          setPositionState({\n            duration: proxy.duration || 0,\n            playbackRate: proxy.playbackRate,\n            position: proxy.currentTime,\n          });\n          break;\n        }\n        case 'onPause':\n          setIsPlaying(false);\n          setPlaybackState('paused');\n          break;\n        case 'onTimeUpdate': {\n          const { proxy } = controllerRef.current!;\n          const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n          if (!noProgressUpdates) setPlayProgress(proxy.currentTime / duration);\n          break;\n        }\n        case 'onEnded': {\n          setPlaybackState('paused');\n          break;\n        }\n      }\n\n      handlers?.[eventName]?.(e);\n    }, onForcePlay, handleTrackChange);\n\n    const { proxy } = controllerRef.current!;\n\n    if (!isPlaying && !proxy.paused) {\n      setIsPlaying(true);\n      isPlayingSync = true;\n    }\n\n    if (onInit) {\n      onInit(proxy);\n    }\n  }, [trackId]);\n\n  useEffect(() => {\n    if (isPlaying && metadata) updateMetadata(metadata);\n  }, [metadata, isPlaying]);\n\n  const {\n    play,\n    pause,\n    setCurrentTime,\n    proxy,\n    destroy,\n    setVolume,\n    stop,\n    isFirst,\n    isLast,\n    requestNextTrack,\n    requestPreviousTrack,\n    setPlaybackRate,\n    toggleMuted,\n  } = controllerRef.current!;\n  const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n\n  // RAF progress\n  useEffect(() => {\n    if (duration && !isSafariPatchInProgress(proxy) && !noProgressUpdates) {\n      setPlayProgress(proxy.currentTime / duration);\n    }\n  }, [duration, playProgress, proxy, noProgressUpdates]);\n\n  // Cleanup\n  useEffect(() => () => {\n    destroy(noPlaylist);\n  }, [destroy, noPlaylist]);\n\n  // Autoplay once `src` is present\n  useEffectWithPrevDeps(([prevShouldPlay, prevSrc]) => {\n    if (prevShouldPlay === shouldPlay && src === prevSrc) {\n      return;\n    }\n\n    // When paused by another player\n    if (proxy.src && proxy.paused) {\n      return;\n    }\n\n    if (shouldPlay && src && !isPlaying) {\n      play(src);\n    }\n  }, [shouldPlay, src, isPlaying, play, proxy.src, proxy.paused]);\n\n  const playIfPresent = useCallback(() => {\n    if (src) {\n      play(src);\n    }\n  }, [src, play]);\n\n  const playPause = useCallback(() => {\n    if (isPlaying) {\n      pause();\n    } else {\n      playIfPresent();\n    }\n  }, [pause, playIfPresent, isPlaying]);\n\n  const setTime = useCallback((time: number) => {\n    setCurrentTime(time);\n    if (duration) {\n      setPlayProgress(proxy.currentTime / duration);\n    }\n  }, [duration, proxy, setCurrentTime]);\n\n  return {\n    isPlaying: isPlayingSync,\n    playProgress,\n    playPause,\n    pause,\n    play: playIfPresent,\n    stop,\n    setCurrentTime: setTime,\n    setVolume,\n    audioProxy: proxy,\n    duration,\n    requestNextTrack,\n    requestPreviousTrack,\n    isFirst,\n    isLast,\n    setPlaybackRate,\n    toggleMuted,\n  };\n};\n\nfunction makeMediaHandlers(controllerRef: React.RefObject<ReturnType<typeof register>>) {\n  let mediaHandlers: MediaSessionHandlers = {};\n  if (controllerRef && controllerRef.current) {\n    const {\n      play, pause, setCurrentTime, proxy, requestNextTrack, requestPreviousTrack, isFirst, isLast,\n    } = controllerRef.current;\n    mediaHandlers = {\n      play: () => {\n        play(proxy.src);\n      },\n      pause: () => {\n        pause();\n      },\n      stop: () => {\n        pause();\n        setCurrentTime(0);\n        getActions().closeAudioPlayer();\n      },\n      seekbackward: (event) => {\n        const skipTime = event.seekOffset || DEFAULT_SKIP_TIME;\n        setCurrentTime(Math.max(proxy.currentTime - skipTime, 0));\n      },\n      seekforward: (event) => {\n        const skipTime = event.seekOffset || DEFAULT_SKIP_TIME;\n        setCurrentTime(Math.min(proxy.currentTime + skipTime, proxy.duration));\n      },\n      seekTo: (event) => {\n        if (event.seekTime) {\n          setCurrentTime(event.seekTime);\n        }\n      },\n    };\n\n    if (!isLast()) {\n      mediaHandlers.nexttrack = () => {\n        requestNextTrack();\n      };\n    }\n    if (!isFirst()) {\n      mediaHandlers.previoustrack = () => {\n        requestPreviousTrack();\n      };\n    }\n  }\n  return mediaHandlers;\n}\n\nexport default useAudioPlayer;\n","import type React from '../lib/teact/teact';\nimport { useCallback, useMemo, useState } from '../lib/teact/teact';\nimport { debounce } from '../util/schedulers';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\n\ntype BufferingEvent = (e: Event | React.SyntheticEvent<HTMLMediaElement>) => void;\n\nconst MIN_READY_STATE = 3;\n// Avoid flickering when re-mounting previously buffered video\nconst DEBOUNCE = 200;\n\n/**\n * Time range relative to the duration [0, 1]\n */\nexport type BufferedRange = { start: number; end: number };\n\nconst useBuffering = (noInitiallyBuffered = false) => {\n  const [isBuffered, setIsBuffered] = useState(!noInitiallyBuffered);\n  const [bufferedProgress, setBufferedProgress] = useState(0);\n  const [bufferedRanges, setBufferedRanges] = useState<BufferedRange[]>([]);\n\n  const setIsBufferedDebounced = useMemo(() => {\n    return debounce(setIsBuffered, DEBOUNCE, false, true);\n  }, []);\n\n  const handleBuffering = useCallback<BufferingEvent>((e) => {\n    const media = e.currentTarget as HTMLMediaElement;\n\n    if (!isSafariPatchInProgress(media)) {\n      if (media.buffered.length) {\n        const ranges = getTimeRanges(media.buffered, media.duration);\n        setBufferedRanges(ranges);\n        const bufferedLength = ranges.reduce((acc, { start, end }) => acc + end - start, 0);\n        setBufferedProgress(bufferedLength / media.duration);\n      }\n\n      setIsBufferedDebounced(media.readyState >= MIN_READY_STATE || media.currentTime > 0);\n    }\n  }, [setIsBufferedDebounced]);\n\n  const bufferingHandlers = {\n    onLoadedData: handleBuffering,\n    onPlaying: handleBuffering,\n    onLoadStart: handleBuffering, // Needed for Safari to start\n    onPause: handleBuffering, // Needed for Chrome when seeking\n    onTimeUpdate: handleBuffering, // Needed for audio buffering progress\n    onProgress: handleBuffering, // Needed for video buffering progress\n  };\n\n  return {\n    isBuffered,\n    bufferedProgress,\n    bufferedRanges,\n    bufferingHandlers,\n    checkBuffering(element: HTMLMediaElement) {\n      setIsBufferedDebounced(element.readyState >= MIN_READY_STATE);\n    },\n  };\n};\n\nfunction getTimeRanges(ranges: TimeRanges, duration: number) {\n  const result: BufferedRange[] = [];\n  for (let i = 0; i < ranges.length; i++) {\n    result.push({\n      start: ranges.start(i) / duration,\n      end: ranges.end(i) / duration,\n    });\n  }\n  return result;\n}\n\nexport default useBuffering;\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nimport fastBlur from '../lib/fastBlur';\nimport useForceUpdate from './useForceUpdate';\nimport { IS_CANVAS_FILTER_SUPPORTED } from '../util/environment';\n\nconst RADIUS = 2;\nconst ITERATIONS = 2;\n\nexport default function useCanvasBlur(dataUri?: string, isDisabled = false, withRaf?: boolean) {\n  // eslint-disable-next-line no-null/no-null\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n\n    if (!dataUri || !canvas || isDisabled) {\n      return;\n    }\n\n    const img = new Image();\n\n    const processBlur = () => {\n      canvas.width = img.width;\n      canvas.height = img.height;\n\n      const ctx = canvas.getContext('2d', { alpha: false })!;\n\n      if (IS_CANVAS_FILTER_SUPPORTED) {\n        ctx.filter = `blur(${RADIUS}px)`;\n      }\n\n      ctx.drawImage(img, -RADIUS * 2, -RADIUS * 2, canvas.width + RADIUS * 4, canvas.height + RADIUS * 4);\n\n      if (!IS_CANVAS_FILTER_SUPPORTED) {\n        fastBlur(ctx, 0, 0, canvas.width, canvas.height, RADIUS, ITERATIONS);\n      }\n    };\n\n    img.onload = () => {\n      if (withRaf) {\n        requestAnimationFrame(processBlur);\n      } else {\n        processBlur();\n      }\n    };\n\n    img.src = dataUri;\n  }, [canvasRef, dataUri, forceUpdate, isDisabled, withRaf]);\n\n  return canvasRef;\n}\n","import { useMemo } from '../lib/teact/teact';\nimport { getActions } from '../global';\n\nimport type { ApiChat, ApiUser } from '../api/types';\n\nimport { SERVICE_NOTIFICATIONS_USER_ID } from '../config';\nimport {\n  isChatArchived, getCanDeleteChat, isUserId, isChatChannel, isChatGroup,\n} from '../global/helpers';\nimport { compact } from '../util/iteratees';\nimport useLang from './useLang';\n\nconst useChatContextActions = ({\n  chat,\n  user,\n  folderId,\n  isPinned,\n  isMuted,\n  canChangeFolder,\n  handleDelete,\n  handleChatFolderChange,\n  handleReport,\n}: {\n  chat: ApiChat | undefined;\n  user: ApiUser | undefined;\n  folderId?: number;\n  isPinned?: boolean;\n  isMuted?: boolean;\n  canChangeFolder?: boolean;\n  handleDelete: () => void;\n  handleChatFolderChange: () => void;\n  handleReport?: () => void;\n}, isInSearch = false) => {\n  const lang = useLang();\n\n  const { isSelf } = user || {};\n  const isServiceNotifications = user?.id === SERVICE_NOTIFICATIONS_USER_ID;\n\n  return useMemo(() => {\n    if (!chat) {\n      return undefined;\n    }\n\n    const {\n      toggleChatPinned,\n      updateChatMutedState,\n      toggleChatArchived,\n      toggleChatUnread,\n    } = getActions();\n\n    const actionAddToFolder = canChangeFolder ? {\n      title: lang('ChatList.Filter.AddToFolder'),\n      icon: 'folder',\n      handler: handleChatFolderChange,\n    } : undefined;\n\n    const actionPin = isPinned\n      ? {\n        title: lang('UnpinFromTop'),\n        icon: 'unpin',\n        handler: () => toggleChatPinned({ id: chat.id, folderId }),\n      }\n      : { title: lang('PinToTop'), icon: 'pin', handler: () => toggleChatPinned({ id: chat.id, folderId }) };\n\n    if (isInSearch) {\n      return compact([actionPin, actionAddToFolder]);\n    }\n\n    const actionUnreadMark = chat.unreadCount || chat.hasUnreadMark\n      ? { title: lang('MarkAsRead'), icon: 'readchats', handler: () => toggleChatUnread({ id: chat.id }) }\n      : { title: lang('MarkAsUnread'), icon: 'unread', handler: () => toggleChatUnread({ id: chat.id }) };\n\n    const actionMute = isMuted\n      ? {\n        title: lang('ChatList.Unmute'),\n        icon: 'unmute',\n        handler: () => updateChatMutedState({ chatId: chat.id, isMuted: false }),\n      }\n      : {\n        title: lang('ChatList.Mute'),\n        icon: 'mute',\n        handler: () => updateChatMutedState({ chatId: chat.id, isMuted: true }),\n      };\n\n    const actionArchive = isChatArchived(chat)\n      ? { title: lang('Unarchive'), icon: 'unarchive', handler: () => toggleChatArchived({ id: chat.id }) }\n      : { title: lang('Archive'), icon: 'archive', handler: () => toggleChatArchived({ id: chat.id }) };\n\n    const canReport = handleReport && (isChatChannel(chat) || isChatGroup(chat) || (user && !user.isSelf));\n    const actionReport = canReport\n      ? { title: lang('ReportPeer.Report'), icon: 'flag', handler: handleReport }\n      : undefined;\n\n    const actionDelete = {\n      title: isUserId(chat.id)\n        ? lang('Delete')\n        : lang(getCanDeleteChat(chat)\n          ? 'DeleteChat'\n          : (isChatChannel(chat) ? 'LeaveChannel' : 'Group.LeaveGroup')),\n      icon: 'delete',\n      destructive: true,\n      handler: handleDelete,\n    };\n\n    const isInFolder = folderId !== undefined;\n\n    return compact([\n      actionAddToFolder,\n      actionUnreadMark,\n      actionPin,\n      !isSelf && actionMute,\n      !isSelf && !isServiceNotifications && !isInFolder && actionArchive,\n      actionReport,\n      actionDelete,\n    ]);\n  }, [\n    chat, user, canChangeFolder, lang, handleChatFolderChange, isPinned, isInSearch, isMuted,\n    handleDelete, handleReport, folderId, isSelf, isServiceNotifications,\n  ]);\n};\n\nexport default useChatContextActions;\n","import type { RefObject } from 'react';\nimport { useState, useEffect, useCallback } from '../lib/teact/teact';\n\nimport type { IAnchorPosition } from '../types';\nimport {\n  IS_TOUCH_ENV, IS_PWA, IS_IOS,\n} from '../util/environment';\n\nconst LONG_TAP_DURATION_MS = 200;\n\nfunction stopEvent(e: Event) {\n  e.stopImmediatePropagation();\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nconst useContextMenuHandlers = (\n  elementRef: RefObject<HTMLElement>,\n  isMenuDisabled?: boolean,\n  shouldDisableOnLink?: boolean,\n  shouldDisableOnLongTap?: boolean,\n) => {\n  const [isContextMenuOpen, setIsContextMenuOpen] = useState(false);\n  const [contextMenuPosition, setContextMenuPosition] = useState<IAnchorPosition | undefined>(undefined);\n\n  const handleBeforeContextMenu = useCallback((e: React.MouseEvent) => {\n    if (!isMenuDisabled && e.button === 2) {\n      (e.target as HTMLElement).classList.add('no-selection');\n    }\n  }, [isMenuDisabled]);\n\n  const handleContextMenu = useCallback((e: React.MouseEvent) => {\n    (e.target as HTMLElement).classList.remove('no-selection');\n\n    if (isMenuDisabled || (shouldDisableOnLink && (e.target as HTMLElement).matches('a[href]'))) {\n      return;\n    }\n    e.preventDefault();\n\n    if (contextMenuPosition) {\n      return;\n    }\n\n    setIsContextMenuOpen(true);\n    setContextMenuPosition({ x: e.clientX, y: e.clientY });\n  }, [isMenuDisabled, shouldDisableOnLink, contextMenuPosition]);\n\n  const handleContextMenuClose = useCallback(() => {\n    setIsContextMenuOpen(false);\n  }, []);\n\n  const handleContextMenuHide = useCallback(() => {\n    setContextMenuPosition(undefined);\n  }, []);\n\n  // Support context menu on touch devices\n  useEffect(() => {\n    if (isMenuDisabled || !IS_TOUCH_ENV || shouldDisableOnLongTap) {\n      return undefined;\n    }\n\n    const element = elementRef.current;\n    if (!element) {\n      return undefined;\n    }\n\n    let timer: number | undefined;\n\n    const clearLongPressTimer = () => {\n      if (timer) {\n        clearTimeout(timer);\n        timer = undefined;\n      }\n    };\n\n    const emulateContextMenuEvent = (originalEvent: TouchEvent) => {\n      clearLongPressTimer();\n\n      const { clientX, clientY, target } = originalEvent.touches[0];\n\n      if (contextMenuPosition || (shouldDisableOnLink && (target as HTMLElement).matches('a[href]'))) {\n        return;\n      }\n\n      // Temporarily intercept and clear the next click\n      element.addEventListener('touchend', function cancelClickOnce(e) {\n        element.removeEventListener('touchend', cancelClickOnce, true);\n        stopEvent(e);\n      }, true);\n\n      // On iOS15, in PWA mode, the context menu immediately closes after opening\n      if (IS_PWA && IS_IOS) {\n        element.addEventListener('mousedown', function cancelClickOnce(e) {\n          element.removeEventListener('mousedown', cancelClickOnce, true);\n          stopEvent(e);\n        }, true);\n      }\n\n      setIsContextMenuOpen(true);\n      setContextMenuPosition({ x: clientX, y: clientY });\n    };\n\n    const startLongPressTimer = (e: TouchEvent) => {\n      if (isMenuDisabled) {\n        return;\n      }\n      clearLongPressTimer();\n\n      timer = window.setTimeout(() => emulateContextMenuEvent(e), LONG_TAP_DURATION_MS);\n    };\n\n    // @perf Consider event delegation\n    element.addEventListener('touchstart', startLongPressTimer, { passive: true });\n    element.addEventListener('touchcancel', clearLongPressTimer, true);\n    element.addEventListener('touchend', clearLongPressTimer, true);\n    element.addEventListener('touchmove', clearLongPressTimer, { passive: true });\n\n    return () => {\n      clearLongPressTimer();\n      element.removeEventListener('touchstart', startLongPressTimer);\n      element.removeEventListener('touchcancel', clearLongPressTimer, true);\n      element.removeEventListener('touchend', clearLongPressTimer, true);\n      element.removeEventListener('touchmove', clearLongPressTimer);\n    };\n  }, [contextMenuPosition, isMenuDisabled, shouldDisableOnLongTap, elementRef, shouldDisableOnLink]);\n\n  return {\n    isContextMenuOpen,\n    contextMenuPosition,\n    handleBeforeContextMenu,\n    handleContextMenu,\n    handleContextMenuClose,\n    handleContextMenuHide,\n  };\n};\n\nexport default useContextMenuHandlers;\n","import { useState, useEffect } from '../lib/teact/teact';\nimport type { IAnchorPosition } from '../types';\n\ninterface Layout {\n  extraPaddingX?: number;\n  extraTopPadding?: number;\n  marginSides?: number;\n  extraMarginTop?: number;\n}\n\nconst MENU_POSITION_VISUAL_COMFORT_SPACE_PX = 16;\nconst MENU_POSITION_BOTTOM_MARGIN = 12;\nconst EMPTY_RECT = {\n  width: 0, left: 0, height: 0, top: 0,\n};\n\nexport default function useContextMenuPosition(\n  anchor: IAnchorPosition | undefined,\n  getTriggerElement: () => HTMLElement | null,\n  getRootElement: () => HTMLElement | null,\n  getMenuElement: () => HTMLElement | null,\n  getLayout?: () => Layout,\n) {\n  const [positionX, setPositionX] = useState<'right' | 'left'>('right');\n  const [positionY, setPositionY] = useState<'top' | 'bottom'>('bottom');\n  const [transformOriginX, setTransformOriginX] = useState<number>();\n  const [transformOriginY, setTransformOriginY] = useState<number>();\n  const [withScroll, setWithScroll] = useState(false);\n  const [style, setStyle] = useState('');\n  const [menuStyle, setMenuStyle] = useState('opacity: 0;');\n\n  useEffect(() => {\n    const triggerEl = getTriggerElement();\n    if (!anchor || !triggerEl) {\n      return;\n    }\n\n    let { x, y } = anchor;\n    const anchorX = x;\n    const anchorY = y;\n\n    const menuEl = getMenuElement();\n    const rootEl = getRootElement();\n\n    const {\n      extraPaddingX = 0,\n      extraTopPadding = 0,\n      marginSides = 0,\n      extraMarginTop = 0,\n    } = getLayout?.() || {};\n\n    const marginTop = menuEl ? parseInt(getComputedStyle(menuEl).marginTop, 10) + extraMarginTop : undefined;\n\n    const menuRect = menuEl ? {\n      width: menuEl.offsetWidth,\n      height: menuEl.offsetHeight + marginTop!,\n    } : EMPTY_RECT;\n\n    const rootRect = rootEl ? rootEl.getBoundingClientRect() : EMPTY_RECT;\n\n    let horizontalPosition: 'left' | 'right';\n    let verticalPosition: 'top' | 'bottom';\n    if (x + menuRect.width + extraPaddingX < rootRect.width + rootRect.left) {\n      x += 3;\n      horizontalPosition = 'left';\n    } else if (x - menuRect.width > 0) {\n      horizontalPosition = 'right';\n      x -= 3;\n    } else {\n      horizontalPosition = 'left';\n      x = 16;\n    }\n    setPositionX(horizontalPosition);\n\n    if (marginSides\n      && horizontalPosition === 'right' && (x + extraPaddingX + marginSides >= rootRect.width + rootRect.left)) {\n      x -= marginSides;\n    }\n\n    if (marginSides && horizontalPosition === 'left') {\n      if (x + extraPaddingX + marginSides + menuRect.width >= rootRect.width + rootRect.left) {\n        x -= marginSides;\n      } else if (x - marginSides <= 0) {\n        x += marginSides;\n      }\n    }\n\n    if (y + menuRect.height < rootRect.height + rootRect.top) {\n      verticalPosition = 'top';\n    } else {\n      verticalPosition = 'bottom';\n\n      if (y - menuRect.height < rootRect.top + extraTopPadding) {\n        y = rootRect.top + rootRect.height;\n      }\n    }\n    setPositionY(verticalPosition);\n\n    const triggerRect = triggerEl.getBoundingClientRect();\n    const left = horizontalPosition === 'left'\n      ? Math.min(x - triggerRect.left, rootRect.width - menuRect.width - MENU_POSITION_VISUAL_COMFORT_SPACE_PX)\n      : (x - triggerRect.left);\n    const top = y - triggerRect.top;\n\n    const menuMaxHeight = rootRect.height - MENU_POSITION_BOTTOM_MARGIN - (marginTop || 0);\n\n    setWithScroll(menuMaxHeight < menuRect.height);\n    setMenuStyle(`max-height: ${menuMaxHeight}px;`);\n    setStyle(`left: ${left}px; top: ${top}px`);\n    const offsetX = (anchorX - triggerRect.left) - left;\n    const offsetY = (anchorY - triggerRect.top) - top - (marginTop || 0);\n    setTransformOriginX(horizontalPosition === 'left' ? offsetX : menuRect.width + offsetX);\n    setTransformOriginY(verticalPosition === 'bottom' ? menuRect.height + offsetY : offsetY);\n  }, [\n    anchor, getMenuElement, getRootElement, getTriggerElement, getLayout,\n  ]);\n\n  return {\n    positionX,\n    positionY,\n    transformOriginX,\n    transformOriginY,\n    style,\n    menuStyle,\n    withScroll,\n  };\n}\n","import { useEffect, useMemo } from '../lib/teact/teact';\nimport { getActions } from '../global';\n\nimport type { ApiMessage } from '../api/types';\n\nimport { throttle } from '../util/schedulers';\n\nconst useEnsureMessage = (\n  chatId: string,\n  messageId?: number,\n  message?: ApiMessage,\n  replyOriginForId?: number,\n) => {\n  const { loadMessage } = getActions();\n  const loadMessageThrottled = useMemo(() => {\n    const throttled = throttle(loadMessage, 500, true);\n    return () => {\n      throttled({ chatId, messageId, replyOriginForId });\n    };\n  }, [loadMessage, chatId, messageId, replyOriginForId]);\n\n  useEffect(() => {\n    if (messageId && !message) {\n      loadMessageThrottled();\n    }\n  });\n};\n\nexport default useEnsureMessage;\n","import { useEffect } from '../lib/teact/teact';\n\nimport {\n  getOrderedIds,\n  getUnreadCounters,\n  getChatsCount,\n  addOrderedIdsCallback,\n  addUnreadCountersCallback,\n  addChatsCountCallback,\n} from '../util/folderManager';\nimport useForceUpdate from './useForceUpdate';\n\nexport function useFolderManagerForOrderedIds(folderId: number) {\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => addOrderedIdsCallback(folderId, forceUpdate), [folderId, forceUpdate]);\n\n  return getOrderedIds(folderId);\n}\n\nexport function useFolderManagerForUnreadCounters() {\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => addUnreadCountersCallback(forceUpdate), [forceUpdate]);\n\n  return getUnreadCounters();\n}\n\nexport function useFolderManagerForChatsCount() {\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => addChatsCountCallback(forceUpdate), [forceUpdate]);\n\n  return getChatsCount();\n}\n","import { useEffect } from '../lib/teact/teact';\n\nconst useHorizontalScroll = (container: HTMLElement | null, isDisabled?: boolean) => {\n  useEffect(() => {\n    if (!container || isDisabled) {\n      return undefined;\n    }\n\n    function handleScroll(e: WheelEvent) {\n      // Ignore horizontal scroll and let it work natively (e.g. on touchpad)\n      if (!e.deltaX) {\n        container!.scrollLeft += e.deltaY / 4;\n      }\n    }\n\n    container.addEventListener('wheel', handleScroll, { passive: true });\n\n    return () => {\n      container.removeEventListener('wheel', handleScroll);\n    };\n  }, [container, isDisabled]);\n};\n\nexport default useHorizontalScroll;\n","import { useEffect } from '../lib/teact/teact';\nimport { getHotkeyMatcher } from '../util/parseHotkey';\nimport { createCallbackManager } from '../util/callbacks';\n\nconst IGNORE_TAGS = new Set(['INPUT', 'TEXTAREA', 'SELECT']);\n\nconst handlers = createCallbackManager();\ndocument.documentElement.addEventListener('keydown', handlers.runCallbacks);\n\nexport function useHotkeys(hotkeys?: Record<string, (e: KeyboardEvent) => void>) {\n  useEffect(() => {\n    if (!hotkeys) {\n      return undefined;\n    }\n\n    const entries = Object.entries(hotkeys);\n\n    function handleKeyDown(e: KeyboardEvent) {\n      if (!shouldFireEvent(e)) {\n        return;\n      }\n\n      entries.forEach(([hotkey, handler]) => {\n        if (getHotkeyMatcher(hotkey)(e)) {\n          handler(e);\n        }\n      });\n    }\n\n    return handlers.addCallback(handleKeyDown);\n  }, [hotkeys]);\n}\n\nfunction shouldFireEvent(e: KeyboardEvent) {\n  if (e.target instanceof HTMLElement) {\n    return !IGNORE_TAGS.has(e.target.tagName);\n  }\n\n  return true;\n}\n","// Original source from Mantine\n// https://github.com/mantinedev/mantine/blob/master/src/mantine-hooks/src/use-hotkeys/parse-hotkey.ts\n\nexport type KeyboardModifiers = {\n  alt: boolean;\n  ctrl: boolean;\n  meta: boolean;\n  mod: boolean;\n  shift: boolean;\n};\n\nexport type Hotkey = KeyboardModifiers & {\n  key?: string;\n};\n\ntype CheckHotkeyMatch = (event: KeyboardEvent) => boolean;\n\nexport function parseHotkey(hotkey: string): Hotkey {\n  const keys = hotkey\n    .toLowerCase()\n    .split('+')\n    .map((part) => part.trim());\n\n  const modifiers: KeyboardModifiers = {\n    alt: keys.includes('alt'),\n    ctrl: keys.includes('ctrl'),\n    meta: keys.includes('meta'),\n    mod: keys.includes('mod'),\n    shift: keys.includes('shift'),\n  };\n\n  const reservedKeys = ['alt', 'ctrl', 'meta', 'shift', 'mod'];\n\n  const freeKey = keys.find((key) => !reservedKeys.includes(key));\n\n  return {\n    ...modifiers,\n    key: freeKey,\n  };\n}\n\nfunction isExactHotkey(hotkey: Hotkey, event: KeyboardEvent): boolean {\n  const {\n    alt, ctrl, meta, mod, shift, key,\n  } = hotkey;\n  const {\n    altKey, ctrlKey, metaKey, shiftKey, key: pressedKey,\n  } = event;\n\n  if (alt !== altKey) {\n    return false;\n  }\n\n  if (mod) {\n    if (!ctrlKey && !metaKey) {\n      return false;\n    }\n  } else {\n    if (ctrl !== ctrlKey) {\n      return false;\n    }\n    if (meta !== metaKey) {\n      return false;\n    }\n  }\n  if (shift !== shiftKey) {\n    return false;\n  }\n\n  return Boolean(key\n    && (pressedKey.toLowerCase() === key.toLowerCase()\n      || event.code.replace('Key', '').toLowerCase() === key.toLowerCase()));\n}\n\nexport function getHotkeyMatcher(hotkey: string): CheckHotkeyMatch {\n  return (event) => isExactHotkey(parseHotkey(hotkey), event);\n}\n","import type { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../util/environment';\n\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 500;\nconst MODAL_HIDE_DELAY_MS = 300;\n\nexport default function useInputFocusOnOpen(\n  inputRef: RefObject<HTMLInputElement | HTMLTextAreaElement>,\n  isOpen?: boolean,\n  onClose?: NoneToVoidFunction,\n) {\n  useEffect(() => {\n    if (isOpen) {\n      if (!IS_SINGLE_COLUMN_LAYOUT) {\n        setTimeout(() => {\n          requestAnimationFrame(() => {\n            if (inputRef.current) {\n              inputRef.current.focus();\n            }\n          });\n        }, FOCUS_DELAY_MS);\n      }\n    } else {\n      if (inputRef.current) {\n        inputRef.current.blur();\n      }\n\n      if (onClose) {\n        setTimeout(onClose, MODAL_HIDE_DELAY_MS);\n      }\n    }\n  }, [inputRef, isOpen, onClose]);\n}\n","import { useLayoutEffect } from '../lib/teact/teact';\nimport usePrevious from './usePrevious';\n\nconst useLayoutEffectWithPrevDeps = <T extends readonly any[]>(\n  cb: (args: T | readonly []) => void, dependencies: T, debugKey?: string,\n) => {\n  const prevDeps = usePrevious<T>(dependencies);\n  return useLayoutEffect(() => {\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies, debugKey);\n};\n\nexport default useLayoutEffectWithPrevDeps;\n","import { useRef } from '../lib/teact/teact';\nimport generateIdFor from '../util/generateIdFor';\n\nconst store: Record<string, boolean> = {};\n\nconst useUniqueId = () => {\n  const idRef = useRef<string>();\n\n  if (!idRef.current) {\n    idRef.current = generateIdFor(store);\n    store[idRef.current] = true;\n  }\n\n  return idRef.current;\n};\n\nexport default useUniqueId;\n","import {\n  useEffect, useMemo, useRef, useState,\n} from '../lib/teact/teact';\n\nimport { IS_PROGRESSIVE_SUPPORTED } from '../util/environment';\nimport { ApiMediaFormat } from '../api/types';\nimport { throttle } from '../util/schedulers';\nimport * as mediaLoader from '../util/mediaLoader';\nimport useForceUpdate from './useForceUpdate';\nimport useUniqueId from './useUniqueId';\n\nconst STREAMING_PROGRESS = 0.75;\nconst STREAMING_TIMEOUT = 1500;\nconst PROGRESS_THROTTLE = 500;\n\nexport default function useMediaWithLoadProgress(\n  mediaHash: string | undefined,\n  noLoad = false,\n  mediaFormat = ApiMediaFormat.BlobUrl,\n  cacheBuster?: number,\n  delay?: number | false,\n  isHtmlAllowed = false,\n) {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory(mediaHash) : undefined;\n  const isStreaming = mediaFormat === ApiMediaFormat.Stream || (\n    IS_PROGRESSIVE_SUPPORTED && mediaFormat === ApiMediaFormat.Progressive\n  );\n  const forceUpdate = useForceUpdate();\n  const id = useUniqueId();\n  const [loadProgress, setLoadProgress] = useState(mediaData && !isStreaming ? 1 : 0);\n  const startedAtRef = useRef<number>();\n\n  const handleProgress = useMemo(() => {\n    return throttle((progress: number) => {\n      if (startedAtRef.current && (!delay || (Date.now() - startedAtRef.current > delay))) {\n        setLoadProgress(progress);\n      }\n    }, PROGRESS_THROTTLE, true);\n  }, [delay]);\n\n  useEffect(() => {\n    if (!noLoad && mediaHash) {\n      if (!mediaData) {\n        setLoadProgress(0);\n\n        if (startedAtRef.current) {\n          mediaLoader.cancelProgress(handleProgress);\n        }\n\n        startedAtRef.current = Date.now();\n\n        mediaLoader.fetch(mediaHash, mediaFormat, isHtmlAllowed, handleProgress, id).then(() => {\n          const spentTime = Date.now() - startedAtRef.current!;\n          startedAtRef.current = undefined;\n\n          if (!delay || spentTime >= delay) {\n            forceUpdate();\n          } else {\n            setTimeout(forceUpdate, delay - spentTime);\n          }\n        });\n      } else if (isStreaming) {\n        setTimeout(() => {\n          setLoadProgress(STREAMING_PROGRESS);\n        }, STREAMING_TIMEOUT);\n      }\n    }\n  }, [\n    noLoad, mediaHash, mediaData, mediaFormat, cacheBuster, forceUpdate, isStreaming, delay, handleProgress,\n    isHtmlAllowed, id,\n  ]);\n\n  useEffect(() => {\n    if (noLoad && startedAtRef.current) {\n      mediaLoader.cancelProgress(handleProgress);\n      setLoadProgress(0);\n      startedAtRef.current = undefined;\n    }\n  }, [handleProgress, noLoad]);\n\n  useEffect(() => {\n    return () => {\n      if (mediaHash) {\n        mediaLoader.removeCallback(mediaHash, id);\n      }\n    };\n  }, [id, mediaHash]);\n\n  return { mediaData, loadProgress };\n}\n","import { useCallback, useEffect, useRef } from '../lib/teact/teact';\n\nimport { IS_TOUCH_ENV } from '../util/environment';\n\nconst MENU_CLOSE_TIMEOUT = 250;\nlet closeTimeout: number | undefined;\n\nexport default function useMouseInside(\n  isOpen: boolean, onClose: NoneToVoidFunction, menuCloseTimeout = MENU_CLOSE_TIMEOUT, isDisabled = false,\n) {\n  const isMouseInside = useRef(false);\n\n  const markMouseInside = useCallback(() => {\n    isMouseInside.current = true;\n  }, []);\n\n  useEffect(() => {\n    if (closeTimeout) {\n      clearTimeout(closeTimeout);\n      closeTimeout = undefined;\n    }\n\n    if (isOpen && !IS_TOUCH_ENV && !isDisabled) {\n      closeTimeout = window.setTimeout(() => {\n        if (!isMouseInside.current) {\n          onClose();\n        }\n      }, menuCloseTimeout * 2);\n    }\n  }, [isDisabled, isOpen, menuCloseTimeout, onClose]);\n\n  const handleMouseEnter = useCallback(() => {\n    isMouseInside.current = true;\n  }, []);\n\n  const handleMouseLeave = useCallback(() => {\n    isMouseInside.current = false;\n\n    if (closeTimeout) {\n      clearTimeout(closeTimeout);\n      closeTimeout = undefined;\n    }\n\n    closeTimeout = window.setTimeout(() => {\n      if (!isMouseInside.current) {\n        onClose();\n      }\n    }, menuCloseTimeout);\n  }, [menuCloseTimeout, onClose]);\n\n  return [handleMouseEnter, handleMouseLeave, markMouseInside];\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport usePrevious from './usePrevious';\nimport useForceUpdate from './useForceUpdate';\nimport useOnChange from './useOnChange';\n\nexport default function usePrevDuringAnimation(current: any, duration?: number) {\n  const prev = usePrevious(current, true);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n  // eslint-disable-next-line no-null/no-null\n  const isCurrentPresent = current !== undefined && current !== null;\n  // eslint-disable-next-line no-null/no-null\n  const isPrevPresent = prev !== undefined && prev !== null;\n\n  if (isCurrentPresent && timeoutRef.current) {\n    clearTimeout(timeoutRef.current);\n    timeoutRef.current = undefined;\n  }\n\n  useOnChange(() => {\n    // When `current` becomes empty\n    if (duration && !isCurrentPresent && isPrevPresent && !timeoutRef.current) {\n      timeoutRef.current = window.setTimeout(() => {\n        timeoutRef.current = undefined;\n        forceUpdate();\n      }, duration);\n    }\n  }, [current]);\n\n  return !timeoutRef.current || !duration || isCurrentPresent ? current : prev;\n}\n","import { useCallback, useRef } from '../lib/teact/teact';\n\nimport useForceUpdate from './useForceUpdate';\n\nexport type ReducerAction<Actions> = { type: Actions; payload?: any };\nexport type StateReducer<State, Actions> = (state: State, action: ReducerAction<Actions>) => State;\nexport type Dispatch<Actions> = (action: ReducerAction<Actions>) => void;\n\nexport default function useReducer<State, Actions>(\n  reducer: StateReducer<State, Actions>,\n  initialState: State,\n) {\n  const forceUpdate = useForceUpdate();\n  const reducerRef = useRef(reducer);\n  const state = useRef(initialState);\n\n  const dispatch = useCallback((action: ReducerAction<Actions>) => {\n    state.current = reducerRef.current(state.current, action);\n    forceUpdate();\n  }, [forceUpdate]);\n\n  return [\n    state.current,\n    dispatch,\n  ] as [State, Dispatch<Actions>];\n}\n","import useDebouncedCallback from './useDebouncedCallback';\n\nexport default function useRunDebounced(ms: number, noFirst?: boolean, noLast?: boolean) {\n  return useDebouncedCallback((cb: NoneToVoidFunction) => {\n    cb();\n  }, [], ms, noFirst, noLast);\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\nimport type { OwnProps } from './CalendarModal';\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst CalendarModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const CalendarModal = useModuleLoader(Bundles.Extra, 'CalendarModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return CalendarModal ? <CalendarModal {...props} /> : undefined;\n};\n\nexport default memo(CalendarModalAsync);\n","import React, { useCallback, useState } from '../lib/teact/teact';\nimport { getGlobal } from '../lib/teact/teactn';\n\nimport { SCHEDULED_WHEN_ONLINE } from '../config';\nimport { getDayStartAt } from '../util/dateFormat';\nimport useLang from './useLang';\n\nimport CalendarModal from '../components/common/CalendarModal.async';\n\ntype OnScheduledCallback = (scheduledAt: number) => void;\n\nconst useSchedule = (\n  canScheduleUntilOnline?: boolean,\n  onCancel?: () => void,\n) => {\n  const lang = useLang();\n  const [onScheduled, setOnScheduled] = useState<OnScheduledCallback | undefined>();\n\n  const handleMessageSchedule = useCallback((date: Date, isWhenOnline = false) => {\n    const { serverTimeOffset } = getGlobal();\n    // Scheduled time can not be less than 10 seconds in future\n    const scheduledAt = Math.round(Math.max(date.getTime(), Date.now() + 60 * 1000) / 1000)\n      + (isWhenOnline ? 0 : serverTimeOffset);\n    onScheduled?.(scheduledAt);\n    setOnScheduled(undefined);\n  }, [onScheduled]);\n\n  const handleMessageScheduleUntilOnline = useCallback(() => {\n    handleMessageSchedule(new Date(SCHEDULED_WHEN_ONLINE * 1000), true);\n  }, [handleMessageSchedule]);\n\n  const handleCloseCalendar = useCallback(() => {\n    setOnScheduled(undefined);\n    onCancel?.();\n  }, [onCancel]);\n\n  const requestCalendar = useCallback((whenScheduled: OnScheduledCallback) => {\n    setOnScheduled(() => whenScheduled);\n  }, []);\n\n  const scheduledDefaultDate = new Date();\n  scheduledDefaultDate.setSeconds(0);\n  scheduledDefaultDate.setMilliseconds(0);\n\n  const scheduledMaxDate = new Date();\n  scheduledMaxDate.setFullYear(scheduledMaxDate.getFullYear() + 1);\n\n  const calendar = (\n    <CalendarModal\n      isOpen={Boolean(onScheduled)}\n      withTimePicker\n      selectedAt={scheduledDefaultDate.getTime()}\n      maxAt={getDayStartAt(scheduledMaxDate)}\n      isFutureMode\n      secondButtonLabel={canScheduleUntilOnline ? lang('Schedule.SendWhenOnline') : undefined}\n      onClose={handleCloseCalendar}\n      onSubmit={handleMessageSchedule}\n      onSecondButtonClick={canScheduleUntilOnline ? handleMessageScheduleUntilOnline : undefined}\n    />\n  );\n\n  return [requestCalendar, calendar] as const;\n};\n\nexport default useSchedule;\n","import { useMemo } from '../lib/teact/teact';\nimport { getActions } from '../global';\n\nimport type { ApiSendMessageAction } from '../api/types';\n\nimport { SEND_MESSAGE_ACTION_INTERVAL } from '../config';\nimport { throttle } from '../util/schedulers';\n\nconst useSendMessageAction = (chatId?: string, threadId?: number) => {\n  return useMemo(() => {\n    return throttle((action: ApiSendMessageAction) => {\n      getActions().sendMessageAction({ chatId, threadId, action });\n    }, SEND_MESSAGE_ACTION_INTERVAL);\n  }, [chatId, threadId]);\n};\n\nexport default useSendMessageAction;\n","import { useRef } from '../lib/teact/teact';\n\nimport useOnChange from './useOnChange';\n\n// Allows to use state value as \"silent\" dependency in hooks (not causing updates).\n// Useful for state values that update frequently (such as controlled input value).\nexport function useStateRef<T>(value: T) {\n  const ref = useRef<T>(value);\n\n  useOnChange(() => {\n    ref.current = value;\n  }, [value]);\n\n  return ref;\n}\n","import { useEffect, useLayoutEffect, useRef } from '../lib/teact/teact';\n\nfunction useTimeout(callback: () => void, delay?: number) {\n  const savedCallback = useRef(callback);\n\n  useLayoutEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  useEffect(() => {\n    if (typeof delay !== 'number') {\n      return undefined;\n    }\n    const id = setTimeout(() => savedCallback.current(), delay);\n    return () => clearTimeout(id);\n  }, [delay]);\n}\n\nexport default useTimeout;\n","import type { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\nimport { fastRaf } from '../util/schedulers';\n\n// Fix for memory leak when unmounting video element\nexport default function useVideoCleanup(videoRef: RefObject<HTMLVideoElement>, dependencies: any[]) {\n  useEffect(() => {\n    const videoEl = videoRef.current;\n\n    return () => {\n      if (videoEl) {\n        fastRaf(() => {\n          videoEl.pause();\n          videoEl.src = '';\n          videoEl.load();\n        });\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n}\n","/* eslint-disable no-nested-ternary */\n/* eslint-disable no-bitwise */\n/* eslint-disable no-multi-assign */\n/* eslint-disable no-cond-assign */\n/* eslint-disable no-param-reassign */\n/* eslint-disable prefer-const */\n/* eslint-disable eqeqeq */\n/* eslint-disable @typescript-eslint/naming-convention */\n\n/*\nSuperfast Blur - a fast Box Blur For Canvas\n\nVersion:     0.5\nAuthor:        Mario Klingemann\nContact:     mario@quasimondo.com\nWebsite:    http://www.quasimondo.com/BoxBlurForCanvas\nTwitter:    @quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr:\nhttps://flattr.com/thing/140066/Superfast-Blur-a-pretty-fast-Box-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2011 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\n// eslint-disable-next-line max-len\nconst mul_table = [1, 57, 41, 21, 203, 34, 97, 73, 227, 91, 149, 62, 105, 45, 39, 137, 241, 107, 3, 173, 39, 71, 65, 238, 219, 101, 187, 87, 81, 151, 141, 133, 249, 117, 221, 209, 197, 187, 177, 169, 5, 153, 73, 139, 133, 127, 243, 233, 223, 107, 103, 99, 191, 23, 177, 171, 165, 159, 77, 149, 9, 139, 135, 131, 253, 245, 119, 231, 224, 109, 211, 103, 25, 195, 189, 23, 45, 175, 171, 83, 81, 79, 155, 151, 147, 9, 141, 137, 67, 131, 129, 251, 123, 30, 235, 115, 113, 221, 217, 53, 13, 51, 50, 49, 193, 189, 185, 91, 179, 175, 43, 169, 83, 163, 5, 79, 155, 19, 75, 147, 145, 143, 35, 69, 17, 67, 33, 65, 255, 251, 247, 243, 239, 59, 29, 229, 113, 111, 219, 27, 213, 105, 207, 51, 201, 199, 49, 193, 191, 47, 93, 183, 181, 179, 11, 87, 43, 85, 167, 165, 163, 161, 159, 157, 155, 77, 19, 75, 37, 73, 145, 143, 141, 35, 138, 137, 135, 67, 33, 131, 129, 255, 63, 250, 247, 61, 121, 239, 237, 117, 29, 229, 227, 225, 111, 55, 109, 216, 213, 211, 209, 207, 205, 203, 201, 199, 197, 195, 193, 48, 190, 47, 93, 185, 183, 181, 179, 178, 176, 175, 173, 171, 85, 21, 167, 165, 41, 163, 161, 5, 79, 157, 78, 154, 153, 19, 75, 149, 74, 147, 73, 144, 143, 71, 141, 140, 139, 137, 17, 135, 134, 133, 66, 131, 65, 129, 1];\n// eslint-disable-next-line max-len\nconst shg_table = [0, 9, 10, 10, 14, 12, 14, 14, 16, 15, 16, 15, 16, 15, 15, 17, 18, 17, 12, 18, 16, 17, 17, 19, 19, 18, 19, 18, 18, 19, 19, 19, 20, 19, 20, 20, 20, 20, 20, 20, 15, 20, 19, 20, 20, 20, 21, 21, 21, 20, 20, 20, 21, 18, 21, 21, 21, 21, 20, 21, 17, 21, 21, 21, 22, 22, 21, 22, 22, 21, 22, 21, 19, 22, 22, 19, 20, 22, 22, 21, 21, 21, 22, 22, 22, 18, 22, 22, 21, 22, 22, 23, 22, 20, 23, 22, 22, 23, 23, 21, 19, 21, 21, 21, 23, 23, 23, 22, 23, 23, 21, 23, 22, 23, 18, 22, 23, 20, 22, 23, 23, 23, 21, 22, 20, 22, 21, 22, 24, 24, 24, 24, 24, 22, 21, 24, 23, 23, 24, 21, 24, 23, 24, 22, 24, 24, 22, 24, 24, 22, 23, 24, 24, 24, 20, 23, 22, 23, 24, 24, 24, 24, 24, 24, 24, 23, 21, 23, 22, 23, 24, 24, 24, 22, 24, 24, 24, 23, 22, 24, 24, 25, 23, 25, 25, 23, 24, 25, 25, 24, 22, 25, 25, 25, 24, 23, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 23, 25, 23, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 24, 22, 25, 25, 23, 25, 25, 20, 24, 25, 24, 25, 25, 22, 24, 25, 24, 25, 24, 25, 25, 24, 25, 25, 25, 25, 22, 25, 25, 25, 24, 25, 24, 25, 18];\n\nexport default function boxBlurCanvasRGB(context, top_x, top_y, width, height, radius, iterations) {\n  if (Number.isNaN(radius) || radius < 1) return;\n\n  radius |= 0;\n\n  if (Number.isNaN(iterations)) iterations = 1;\n  iterations |= 0;\n  if (iterations > 3) iterations = 3;\n  if (iterations < 1) iterations = 1;\n\n  const imageData = context.getImageData(top_x, top_y, width, height);\n\n  const pixels = imageData.data;\n\n  let rsum;\n  let gsum;\n  let bsum;\n  let x;\n  let y;\n  let i;\n  let p;\n  let p1;\n  let p2;\n  let yp;\n  let yi;\n  let yw;\n  let wm = width - 1;\n  let hm = height - 1;\n  let rad1 = radius + 1;\n\n  let r = [];\n  let g = [];\n  let b = [];\n\n  let mul_sum = mul_table[radius];\n  let shg_sum = shg_table[radius];\n\n  let vmin = [];\n  let vmax = [];\n\n  while (iterations-- > 0) {\n    yw = yi = 0;\n\n    for (y = 0; y < height; y++) {\n      rsum = pixels[yw] * rad1;\n      gsum = pixels[yw + 1] * rad1;\n      bsum = pixels[yw + 2] * rad1;\n\n      for (i = 1; i <= radius; i++) {\n        p = yw + (((i > wm ? wm : i)) << 2);\n        rsum += pixels[p++];\n        gsum += pixels[p++];\n        bsum += pixels[p++];\n      }\n\n      for (x = 0; x < width; x++) {\n        r[yi] = rsum;\n        g[yi] = gsum;\n        b[yi] = bsum;\n\n        if (y == 0) {\n          vmin[x] = ((p = x + rad1) < wm ? p : wm) << 2;\n          vmax[x] = ((p = x - radius) > 0 ? p << 2 : 0);\n        }\n\n        p1 = yw + vmin[x];\n        p2 = yw + vmax[x];\n\n        rsum += pixels[p1++] - pixels[p2++];\n        gsum += pixels[p1++] - pixels[p2++];\n        bsum += pixels[p1++] - pixels[p2++];\n\n        yi++;\n      }\n      yw += (width << 2);\n    }\n\n    for (x = 0; x < width; x++) {\n      yp = x;\n      rsum = r[yp] * rad1;\n      gsum = g[yp] * rad1;\n      bsum = b[yp] * rad1;\n\n      for (i = 1; i <= radius; i++) {\n        yp += (i > hm ? 0 : width);\n        rsum += r[yp];\n        gsum += g[yp];\n        bsum += b[yp];\n      }\n\n      yi = x << 2;\n      for (y = 0; y < height; y++) {\n        pixels[yi] = (rsum * mul_sum) >>> shg_sum;\n        pixels[yi + 1] = (gsum * mul_sum) >>> shg_sum;\n        pixels[yi + 2] = (bsum * mul_sum) >>> shg_sum;\n\n        if (x == 0) {\n          vmin[y] = ((p = y + rad1) < hm ? p : hm) * width;\n          vmax[y] = ((p = y - radius) > 0 ? p * width : 0);\n        }\n\n        p1 = x + vmin[y];\n        p2 = x + vmax[y];\n\n        rsum += r[p1] - r[p2];\n        gsum += g[p1] - g[p2];\n        bsum += b[p1] - b[p2];\n\n        yi += width << 2;\n      }\n    }\n  }\n\n  context.putImageData(imageData, top_x, top_y);\n}\n","import { getActions, getGlobal } from '../global';\n\nimport { AudioOrigin, GlobalSearchContent } from '../types';\nimport type { ApiMessage } from '../api/types';\n\nimport { IS_SAFARI } from './environment';\nimport safePlay from './safePlay';\nimport { patchSafariProgressiveAudio, isSafariPatchInProgress } from './patchSafariProgressiveAudio';\nimport type { MessageKey } from '../global/helpers';\nimport { getMessageKey, parseMessageKey } from '../global/helpers';\nimport { fastRaf } from './schedulers';\nimport { selectCurrentMessageList } from '../global/selectors';\n\ntype Handler = (eventName: string, e: Event) => void;\nexport type TrackId = `${MessageKey}-${number}`;\n\nexport interface Track {\n  audio: HTMLAudioElement;\n  proxy: HTMLAudioElement;\n  type: 'voice' | 'audio';\n  handlers: Handler[];\n  onForcePlay?: NoneToVoidFunction;\n  onTrackChange?: NoneToVoidFunction;\n}\n\nconst tracks = new Map<TrackId, Track>();\nlet voiceQueue: TrackId[] = [];\nlet musicQueue: TrackId[] = [];\n\nlet currentTrackId: TrackId | undefined;\n\nfunction createAudio(\n  trackId: TrackId,\n  type: Track['type'],\n  onForcePlay?: NoneToVoidFunction,\n  onTrackChange?: NoneToVoidFunction,\n): Track {\n  const audio = new Audio();\n\n  function handleEvent(eventName: string) {\n    return (e: Event) => {\n      if (!tracks.has(trackId)) {\n        return;\n      }\n\n      if (isSafariPatchInProgress(audio)) {\n        return;\n      }\n\n      tracks.get(trackId)!.handlers.forEach((handler) => {\n        handler(eventName, e);\n      });\n    };\n  }\n\n  audio.addEventListener('timeupdate', handleEvent('onTimeUpdate'));\n  audio.addEventListener('play', handleEvent('onPlay'));\n  audio.addEventListener('pause', handleEvent('onPause'));\n  audio.addEventListener('loadstart', handleEvent('onLoadStart'));\n  audio.addEventListener('loadeddata', handleEvent('onLoadedData'));\n  audio.addEventListener('playing', handleEvent('onPlaying'));\n  audio.addEventListener('ended', () => {\n    if (!tracks.has(trackId)) {\n      return;\n    }\n\n    if (isSafariPatchInProgress(audio)) {\n      return;\n    }\n\n    playNext(trackId);\n  });\n\n  return {\n    audio,\n    type,\n    proxy: new Proxy(audio, {\n      get: (target, key: keyof HTMLAudioElement) => target[key],\n    }),\n    handlers: [],\n    onForcePlay,\n    onTrackChange,\n  };\n}\n\nfunction playNext(trackId: TrackId, isReverseOrder?: boolean) {\n  const currentTrack = currentTrackId && tracks.get(currentTrackId);\n  if (currentTrack) {\n    currentTrack.audio.pause();\n    currentTrack.audio.currentTime = 0;\n    if (currentTrack.onTrackChange) currentTrack.onTrackChange();\n  }\n\n  const origin = getGlobal().audioPlayer.origin || AudioOrigin.Inline;\n\n  const nextTrackId = findNextInQueue(trackId, origin, isReverseOrder);\n  if (!nextTrackId) {\n    return;\n  }\n\n  if (!tracks.has(nextTrackId)) {\n    // A bit hacky way to continue playlist when switching chat\n    getActions().openAudioPlayer(parseMessageKey(splitTrackId(nextTrackId).messageKey));\n\n    return;\n  }\n\n  const nextTrack = tracks.get(nextTrackId)!;\n\n  if (nextTrack.onForcePlay) {\n    nextTrack.onForcePlay();\n  }\n\n  currentTrackId = nextTrackId;\n\n  if (nextTrack.audio.src) {\n    safePlay(nextTrack.audio);\n  }\n}\n\nexport function stopCurrentAudio() {\n  const currentTrack = currentTrackId && tracks.get(currentTrackId);\n  if (currentTrack) {\n    currentTrack.audio.pause();\n  }\n}\n\nexport function register(\n  trackId: TrackId,\n  trackType: Track['type'],\n  handler: Handler,\n  onForcePlay?: NoneToVoidFunction,\n  onTrackChange?: NoneToVoidFunction,\n) {\n  if (!tracks.has(trackId)) {\n    const track = createAudio(trackId, trackType, onForcePlay, onTrackChange);\n    tracks.set(trackId, track);\n    addTrackToQueue(track, trackId);\n  }\n  const { audio, proxy, handlers } = tracks.get(trackId)!;\n\n  handlers.push(handler);\n\n  return {\n    play(src: string) {\n      if (!audio.paused) return;\n      const currentTrack = currentTrackId && tracks.get(currentTrackId);\n      if (currentTrack && currentTrackId !== trackId) {\n        currentTrack.audio.pause();\n        currentTrack.audio.currentTime = 0;\n        if (isSafariPatchInProgress(currentTrack.audio)) {\n          currentTrack.audio.dataset.preventPlayAfterPatch = 'true';\n        }\n        if (currentTrack.onTrackChange) currentTrack.onTrackChange();\n      }\n\n      currentTrackId = trackId;\n\n      if (!audio.src) {\n        audio.src = src;\n        audio.preload = 'auto';\n\n        if (src.includes('/progressive/') && IS_SAFARI) {\n          delete audio.dataset.preventPlayAfterPatch;\n          patchSafariProgressiveAudio(audio);\n        }\n      }\n\n      safePlay(audio);\n      cleanUpQueue(trackType, trackId);\n    },\n\n    pause() {\n      if (currentTrackId === trackId) {\n        audio.pause();\n      }\n    },\n\n    stop() {\n      if (currentTrackId === trackId) {\n        // Hack, reset src to remove default media session notification\n        const prevSrc = audio.src;\n        audio.pause();\n        // onPause not called otherwise, but required to sync UI\n        fastRaf(() => {\n          audio.src = '';\n          audio.src = prevSrc;\n        });\n      }\n    },\n\n    setCurrentTime(time: number) {\n      if (currentTrackId === trackId) {\n        if (audio.fastSeek) {\n          audio.fastSeek(time);\n        } else {\n          audio.currentTime = time;\n        }\n      }\n    },\n\n    setVolume(volume: number) {\n      if (currentTrackId === trackId) {\n        audio.volume = volume;\n        audio.muted = false;\n      }\n    },\n\n    setPlaybackRate(rate: number) {\n      if (currentTrackId === trackId) {\n        audio.playbackRate = rate;\n      }\n    },\n\n    toggleMuted(muted?: boolean) {\n      if (muted === undefined) {\n        audio.muted = !audio.muted;\n      } else {\n        audio.muted = muted;\n      }\n    },\n\n    proxy,\n\n    requestNextTrack() {\n      playNext(trackId);\n    },\n\n    isLast() {\n      return !findNextInQueue(trackId, getGlobal().audioPlayer.origin);\n    },\n\n    isFirst() {\n      return !findNextInQueue(trackId, getGlobal().audioPlayer.origin, true);\n    },\n\n    requestPreviousTrack() {\n      playNext(trackId, true);\n    },\n\n    destroy(shouldRemoveFromQueue = false) {\n      const track = tracks.get(trackId);\n      if (!track) {\n        return;\n      }\n\n      track.handlers = track.handlers.filter((h) => h !== handler);\n\n      if (!track.handlers.length) {\n        track.audio.pause();\n        tracks.delete(trackId);\n\n        if (shouldRemoveFromQueue) {\n          removeFromQueue(track, trackId);\n        }\n\n        if (trackId === currentTrackId) {\n          currentTrackId = undefined;\n        }\n      }\n    },\n  };\n}\n\nfunction getTrackQueue(track: Track) {\n  switch (track.type) {\n    case 'audio': return musicQueue;\n    case 'voice': return voiceQueue;\n    default: return undefined;\n  }\n}\n\nfunction addTrackToQueue(track: Track, trackId: TrackId) {\n  if (track.type === 'audio' && !musicQueue.includes(trackId)) {\n    musicQueue.push(trackId);\n    musicQueue.sort(trackIdComparator);\n  }\n\n  if (track.type === 'voice' && !voiceQueue.includes(trackId)) {\n    voiceQueue.push(trackId);\n    voiceQueue.sort(trackIdComparator);\n  }\n}\n\nfunction removeFromQueue(track: Track, trackId: TrackId) {\n  const trackIdFilter = (el: TrackId) => el !== trackId;\n  if (track.type === 'audio') {\n    musicQueue = musicQueue.filter(trackIdFilter);\n  }\n\n  if (track.type === 'voice') {\n    voiceQueue = voiceQueue.filter(trackIdFilter);\n  }\n}\n\nfunction cleanUpQueue(type: Track['type'], trackId: TrackId) {\n  if (getGlobal().globalSearch.currentContent === GlobalSearchContent.Music) return;\n  const { chatId } = parseMessageKey(splitTrackId(trackId).messageKey);\n  const openedChatId = selectCurrentMessageList(getGlobal())?.chatId;\n  const queueFilter = (id: string) => (\n    id.startsWith(`msg${chatId}`) || (openedChatId && id.startsWith(`msg${openedChatId}`))\n  );\n\n  if (type === 'audio') {\n    musicQueue = musicQueue.filter(queueFilter);\n  }\n\n  if (type === 'voice') {\n    voiceQueue = voiceQueue.filter(queueFilter);\n  }\n}\n\nfunction findNextInQueue(currentId: TrackId, origin = AudioOrigin.Inline, isReverseOrder?: boolean) {\n  const track = tracks.get(currentId)!;\n  const queue = getTrackQueue(track);\n  if (!queue) return undefined;\n\n  if (origin === AudioOrigin.Search) {\n    const index = queue.indexOf(currentId);\n    if (index < 0) return undefined;\n    const direction = isReverseOrder ? -1 : 1;\n    return queue[index + direction];\n  }\n\n  const { chatId } = parseMessageKey(splitTrackId(currentId).messageKey);\n  const chatAudio = queue.filter((id) => id.startsWith(`msg${chatId}`));\n  const index = chatAudio.indexOf(currentId);\n  if (index < 0) return undefined;\n  let direction = origin === AudioOrigin.Inline ? -1 : 1;\n  if (isReverseOrder) direction *= -1;\n  return chatAudio[index + direction];\n}\n\nexport function makeTrackId(message: ApiMessage): TrackId {\n  return `${getMessageKey(message)}-${message.date}`;\n}\n\nfunction splitTrackId(trackId: TrackId) {\n  const messageKey = trackId.match(/^msg(-?\\d+)-(\\d+)/)![0] as MessageKey;\n  const date = Number(trackId.split('-').pop());\n  return {\n    messageKey,\n    date,\n  };\n}\n\n// Descending order by date\nfunction trackIdComparator(one?: TrackId, two?: TrackId) {\n  if (!one || !two) return 0;\n  const { date: dateOne, messageKey: keyOne } = splitTrackId(one);\n  const { date: dateTwo, messageKey: keyTwo } = splitTrackId(two);\n  const diff = dateTwo - dateOne;\n  return diff === 0 ? keyTwo.localeCompare(keyOne) : diff;\n}\n","import { IS_IOS } from './environment';\nimport { Lethargy } from './lethargy';\nimport { clamp, round } from './math';\nimport { debounce } from './schedulers';\n\nexport enum SwipeDirection {\n  Up,\n  Down,\n  Left,\n  Right,\n}\n\ninterface CaptureOptions {\n  onCapture?: (e: MouseEvent | TouchEvent | WheelEvent) => void;\n  onRelease?: (e: MouseEvent | TouchEvent | WheelEvent) => void;\n  onDrag?: (\n    e: MouseEvent | TouchEvent | WheelEvent,\n    captureEvent: MouseEvent | TouchEvent | WheelEvent,\n    params: {\n      dragOffsetX: number;\n      dragOffsetY: number;\n    },\n    cancelDrag?: (x: boolean, y: boolean) => void,\n  ) => void;\n  onSwipe?: (e: Event, direction: SwipeDirection) => boolean;\n  onZoom?: (e: TouchEvent | WheelEvent, params: {\n    // Absolute zoom level\n    zoom?: number;\n    // Relative zoom factor\n    zoomFactor?: number;\n\n    // center coordinate of the initial pinch\n    initialCenterX: number;\n    initialCenterY: number;\n\n    // offset of the pinch center (current from initial)\n    dragOffsetX: number;\n    dragOffsetY: number;\n\n    // center coordinate of the current pinch\n    currentCenterX: number;\n    currentCenterY: number;\n  }) => void;\n  onClick?: (e: MouseEvent | TouchEvent) => void;\n  onDoubleClick?: (e: MouseEvent | RealTouchEvent | WheelEvent, params: { centerX: number; centerY: number }) => void;\n  excludedClosestSelector?: string;\n  selectorToPreventScroll?: string;\n  withNativeDrag?: boolean;\n  maxZoom?: number;\n  minZoom?: number;\n  doubleTapZoom?: number;\n  initialZoom?: number;\n  isNotPassive?: boolean;\n  withCursor?: boolean;\n}\n\n// https://stackoverflow.com/questions/11287877/how-can-i-get-e-offsetx-on-mobile-ipad\n// Android does not have this value, and iOS has it but as read-only\nexport interface RealTouchEvent extends TouchEvent {\n  pageX?: number;\n  pageY?: number;\n}\n\ntype TSwipeAxis =\n  'x'\n  | 'y'\n  | undefined;\n\nexport const IOS_SCREEN_EDGE_THRESHOLD = 20;\nconst MOVED_THRESHOLD = 15;\nconst SWIPE_THRESHOLD = 50;\nconst RELEASE_WHEEL_ZOOM_DELAY = 150;\nconst RELEASE_WHEEL_DRAG_DELAY = 150;\n\nfunction getDistance(a: Touch, b?: Touch) {\n  if (!b) return 0;\n  return Math.hypot((b.pageX - a.pageX), (b.pageY - a.pageY));\n}\n\nfunction getTouchCenter(a: Touch, b: Touch) {\n  return {\n    x: (a.pageX + b.pageX) / 2,\n    y: (a.pageY + b.pageY) / 2,\n  };\n}\n\nlet lastClickTime = 0;\nconst lethargy = new Lethargy({\n  stability: 5,\n  sensitivity: 25,\n  tolerance: 0.6,\n  delay: 150,\n});\n\nexport function captureEvents(element: HTMLElement, options: CaptureOptions) {\n  let captureEvent: MouseEvent | RealTouchEvent | WheelEvent | undefined;\n  let hasMoved = false;\n  let hasSwiped = false;\n  let isZooming = false;\n  let initialDistance = 0;\n  let wheelZoom = options.initialZoom ?? 1;\n  let initialDragOffset = {\n    x: 0,\n    y: 0,\n  };\n  let isDragCanceled = {\n    x: false,\n    y: false,\n  };\n  let initialTouchCenter = {\n    x: window.innerWidth / 2,\n    y: window.innerHeight / 2,\n  };\n  let initialSwipeAxis: TSwipeAxis | undefined;\n  const minZoom = options.minZoom ?? 1;\n  const maxZoom = options.maxZoom ?? 4;\n\n  function onCapture(e: MouseEvent | RealTouchEvent) {\n    if (options.excludedClosestSelector && (\n      (e.target as HTMLElement).matches(options.excludedClosestSelector)\n      || (e.target as HTMLElement).closest(options.excludedClosestSelector)\n    )) {\n      return;\n    }\n\n    captureEvent = e;\n\n    if (e.type === 'mousedown') {\n      if (!options.withNativeDrag && options.onDrag) {\n        e.preventDefault();\n      }\n\n      document.addEventListener('mousemove', onMove);\n      document.addEventListener('mouseup', onRelease);\n    } else if (e.type === 'touchstart') {\n      // We need to always listen on `touchstart` target:\n      // https://stackoverflow.com/questions/33298828/touch-move-event-dont-fire-after-touch-start-target-is-removed\n      const target = e.target as HTMLElement;\n      target.addEventListener('touchmove', onMove, { passive: true });\n      target.addEventListener('touchend', onRelease);\n      target.addEventListener('touchcancel', onRelease);\n\n      if ('touches' in e) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (e.touches.length === 2) {\n          initialDistance = getDistance(e.touches[0], e.touches[1]);\n          initialTouchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n        }\n      }\n    }\n\n    if (options.withCursor) {\n      document.body.classList.add('cursor-grabbing');\n    }\n\n    if (options.onCapture) {\n      options.onCapture(e);\n    }\n  }\n\n  function onRelease(e?: MouseEvent | TouchEvent) {\n    if (captureEvent) {\n      if (options.withCursor) {\n        document.body.classList.remove('cursor-grabbing');\n      }\n\n      document.removeEventListener('mouseup', onRelease);\n      document.removeEventListener('mousemove', onMove);\n      (captureEvent.target as HTMLElement).removeEventListener('touchcancel', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchend', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchmove', onMove);\n\n      if (IS_IOS && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll))\n          .forEach((scrollable) => {\n            scrollable.style.overflow = '';\n          });\n      }\n\n      if (e) {\n        if (hasMoved) {\n          if (options.onRelease) {\n            options.onRelease(e);\n          }\n        } else if (e.type === 'mouseup') {\n          if (options.onDoubleClick && Date.now() - lastClickTime < 300) {\n            options.onDoubleClick(e, {\n              centerX: captureEvent!.pageX!,\n              centerY: captureEvent!.pageY!,\n            });\n          } else if (options.onClick && (!('button' in e) || e.button === 0)) {\n            options.onClick(e);\n          }\n          lastClickTime = Date.now();\n        }\n      }\n    }\n\n    hasMoved = false;\n    hasSwiped = false;\n    isZooming = false;\n    initialDistance = 0;\n    wheelZoom = clamp(wheelZoom, minZoom, maxZoom);\n    initialSwipeAxis = undefined;\n    initialDragOffset = {\n      x: 0,\n      y: 0,\n    };\n    isDragCanceled = {\n      x: false,\n      y: false,\n    };\n    initialTouchCenter = {\n      x: window.innerWidth / 2,\n      y: window.innerHeight / 2,\n    };\n    captureEvent = undefined;\n  }\n\n  function onMove(e: MouseEvent | RealTouchEvent) {\n    if (captureEvent) {\n      if (e.type === 'touchmove' && ('touches' in e)) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (options.onZoom && initialDistance > 0 && e.touches.length === 2) {\n          const endDistance = getDistance(e.touches[0], e.touches[1]);\n          const touchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n          const dragOffsetX = touchCenter.x - initialTouchCenter.x;\n          const dragOffsetY = touchCenter.y - initialTouchCenter.y;\n          const zoomFactor = endDistance / initialDistance;\n          options.onZoom(e, {\n            zoomFactor,\n            initialCenterX: initialTouchCenter.x,\n            initialCenterY: initialTouchCenter.y,\n            dragOffsetX,\n            dragOffsetY,\n            currentCenterX: touchCenter.x,\n            currentCenterY: touchCenter.y,\n          });\n          if (zoomFactor !== 1) hasMoved = true;\n        }\n      }\n\n      const dragOffsetX = e.pageX! - captureEvent.pageX!;\n      const dragOffsetY = e.pageY! - captureEvent.pageY!;\n\n      if (Math.abs(dragOffsetX) >= MOVED_THRESHOLD || Math.abs(dragOffsetY) >= MOVED_THRESHOLD) {\n        hasMoved = true;\n      }\n\n      let shouldPreventScroll = false;\n\n      if (options.onDrag) {\n        options.onDrag(e, captureEvent, {\n          dragOffsetX,\n          dragOffsetY,\n        });\n        shouldPreventScroll = true;\n      }\n\n      if (options.onSwipe && !hasSwiped) {\n        hasSwiped = onSwipe(e, dragOffsetX, dragOffsetY);\n        shouldPreventScroll = hasSwiped;\n      }\n\n      if (IS_IOS && shouldPreventScroll && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll))\n          .forEach((scrollable) => {\n            scrollable.style.overflow = 'hidden';\n          });\n      }\n    }\n  }\n\n  function onSwipe(e: MouseEvent | RealTouchEvent, dragOffsetX: number, dragOffsetY: number) {\n    // Avoid conflicts with swipe-to-back gestures\n    if (IS_IOS) {\n      const x = (e as RealTouchEvent).touches[0].pageX;\n      if (x <= IOS_SCREEN_EDGE_THRESHOLD || x >= window.innerWidth - IOS_SCREEN_EDGE_THRESHOLD) {\n        return false;\n      }\n    }\n\n    const xAbs = Math.abs(dragOffsetX);\n    const yAbs = Math.abs(dragOffsetY);\n\n    if (dragOffsetX && dragOffsetY) {\n      const ratio = Math.max(xAbs, yAbs) / Math.min(xAbs, yAbs);\n      // Diagonal swipe\n      if (ratio < 2) {\n        return false;\n      }\n    }\n\n    let axis: TSwipeAxis | undefined;\n    if (xAbs >= SWIPE_THRESHOLD) {\n      axis = 'x';\n    } else if (yAbs >= SWIPE_THRESHOLD) {\n      axis = 'y';\n    }\n\n    if (!axis) {\n      return false;\n    }\n\n    if (!initialSwipeAxis) {\n      initialSwipeAxis = axis;\n    } else if (initialSwipeAxis !== axis) {\n      // Prevent horizontal swipe after vertical to prioritize scroll\n      return false;\n    }\n\n    return processSwipe(e, axis, dragOffsetX, dragOffsetY, options.onSwipe!);\n  }\n\n  const releaseWheelDrag = debounce(onRelease, RELEASE_WHEEL_DRAG_DELAY, false);\n  const releaseWheelZoom = debounce(onRelease, RELEASE_WHEEL_ZOOM_DELAY, false);\n\n  function onWheelCapture(e: WheelEvent) {\n    if (hasMoved) return;\n    onCapture(e);\n    hasMoved = true;\n    initialTouchCenter = { x: e.x, y: e.y };\n  }\n\n  function onWheelZoom(e: WheelEvent) {\n    if (!options.onZoom) return;\n    onWheelCapture(e);\n    const dragOffsetX = e.x - initialTouchCenter.x;\n    const dragOffsetY = e.y - initialTouchCenter.y;\n    const delta = clamp(e.deltaY, -25, 25);\n    wheelZoom -= delta * 0.01;\n    wheelZoom = clamp(wheelZoom, minZoom * 0.5, maxZoom * 3);\n    options.onZoom(e, {\n      zoom: round(wheelZoom, 2),\n      initialCenterX: initialTouchCenter.x,\n      initialCenterY: initialTouchCenter.y,\n      dragOffsetX,\n      dragOffsetY,\n      currentCenterX: e.x,\n      currentCenterY: e.y,\n    });\n    releaseWheelZoom(e);\n  }\n\n  function onWheelDrag(e: WheelEvent) {\n    if (!options.onDrag) return;\n    onWheelCapture(e);\n    // Ignore wheel inertia if drag is canceled in this direction\n    if (!isDragCanceled.x || Math.sign(initialDragOffset.x) === Math.sign(e.deltaX)) {\n      initialDragOffset.x -= e.deltaX;\n    }\n    if (!isDragCanceled.y || Math.sign(initialDragOffset.y) === Math.sign(e.deltaY)) {\n      initialDragOffset.y -= e.deltaY;\n    }\n    const { x, y } = initialDragOffset;\n    options.onDrag(e, captureEvent!, {\n      dragOffsetX: x,\n      dragOffsetY: y,\n    }, (dx, dy) => {\n      isDragCanceled = { x: dx, y: dy };\n    });\n    releaseWheelDrag(e);\n  }\n\n  function onWheel(e: WheelEvent) {\n    if (!options.onZoom && !options.onDrag) return;\n    if (options.excludedClosestSelector && (\n      (e.target as HTMLElement).matches(options.excludedClosestSelector)\n      || (e.target as HTMLElement).closest(options.excludedClosestSelector)\n    )) {\n      return;\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    const { doubleTapZoom = 3 } = options;\n    if (options.onDoubleClick && Object.is(e.deltaX, -0) && Object.is(e.deltaY, -0) && e.ctrlKey) {\n      onWheelCapture(e);\n      wheelZoom = wheelZoom > 1 ? 1 : doubleTapZoom;\n      options.onDoubleClick(e, { centerX: e.pageX, centerY: e.pageY });\n      hasMoved = false;\n      return;\n    }\n    const metaKeyPressed = e.metaKey || e.ctrlKey || e.shiftKey;\n    if (metaKeyPressed) {\n      onWheelZoom(e);\n    }\n    if (!metaKeyPressed && !isZooming) {\n      // Check if this event produced by user scroll and not by inertia\n      const isUserEvent = lethargy.check(e);\n      if (wheelZoom !== 1) {\n        onWheelDrag(e);\n      } else if (isUserEvent) {\n        onWheelDrag(e);\n      }\n    }\n  }\n\n  element.addEventListener('wheel', onWheel);\n  element.addEventListener('mousedown', onCapture);\n  element.addEventListener('touchstart', onCapture, { passive: !options.isNotPassive });\n\n  return () => {\n    onRelease();\n    element.removeEventListener('wheel', onWheel);\n    element.removeEventListener('touchstart', onCapture);\n    element.removeEventListener('mousedown', onCapture);\n  };\n}\n\nfunction processSwipe(\n  e: Event,\n  currentSwipeAxis: TSwipeAxis,\n  dragOffsetX: number,\n  dragOffsetY: number,\n  onSwipe: (e: Event, direction: SwipeDirection) => boolean,\n) {\n  if (currentSwipeAxis === 'x') {\n    if (dragOffsetX < 0) {\n      return onSwipe(e, SwipeDirection.Left);\n    } else {\n      return onSwipe(e, SwipeDirection.Right);\n    }\n  } else if (currentSwipeAxis === 'y') {\n    if (dragOffsetY < 0) {\n      return onSwipe(e, SwipeDirection.Up);\n    } else {\n      return onSwipe(e, SwipeDirection.Down);\n    }\n  }\n\n  return false;\n}\n","/**\n * Lethargy help distinguish between scroll events initiated by the user, and those by inertial scrolling.\n * Lethargy does not have external dependencies.\n *\n * @param stability - Specifies the length of the rolling average.\n * In effect, the larger the value, the smoother the curve will be.\n * This attempts to prevent anomalies from firing 'real' events. Valid values are all positive integers,\n * but in most cases, you would need to stay between 5 and around 30.\n *\n * @param sensitivity - Specifies the minimum value for wheelDelta for it to register as a valid scroll event.\n * Because the tail of the curve have low wheelDelta values,\n * this will stop them from registering as valid scroll events.\n * The unofficial standard wheelDelta is 120, so valid values are positive integers below 120.\n *\n * @param tolerance - Prevent small fluctuations from affecting results.\n * Valid values are decimals from 0, but should ideally be between 0.05 and 0.3.\n *\n * Based on https://github.com/d4nyll/lethargy\n */\n\nexport type LethargyConfig = {\n  stability?: number;\n  sensitivity?: number;\n  tolerance?: number;\n  delay?: number;\n};\n\nexport class Lethargy {\n  stability: number;\n\n  sensitivity: number;\n\n  tolerance: number;\n\n  delay: number;\n\n  lastUpDeltas: Array<number>;\n\n  lastDownDeltas: Array<number>;\n\n  deltasTimestamp: Array<number>;\n\n  constructor({\n    stability = 8,\n    sensitivity = 100,\n    tolerance = 1.1,\n    delay = 150,\n  }: LethargyConfig = {}) {\n    this.stability = stability;\n    this.sensitivity = sensitivity;\n    this.tolerance = tolerance;\n    this.delay = delay;\n    this.lastUpDeltas = new Array(this.stability * 2).fill(0);\n    this.lastDownDeltas = new Array(this.stability * 2).fill(0);\n    this.deltasTimestamp = new Array(this.stability * 2).fill(0);\n  }\n\n  check(e: any) {\n    let lastDelta;\n    e = e.originalEvent || e;\n    if (e.wheelDelta !== undefined) {\n      lastDelta = e.wheelDelta;\n    } else if (e.deltaY !== undefined) {\n      lastDelta = e.deltaY * -40;\n    } else if (e.detail !== undefined || e.detail === 0) {\n      lastDelta = e.detail * -40;\n    }\n    this.deltasTimestamp.push(Date.now());\n    this.deltasTimestamp.shift();\n    if (lastDelta > 0) {\n      this.lastUpDeltas.push(lastDelta);\n      this.lastUpDeltas.shift();\n      return this.isInertia(1);\n    } else {\n      this.lastDownDeltas.push(lastDelta);\n      this.lastDownDeltas.shift();\n      return this.isInertia(-1);\n    }\n  }\n\n  isInertia(direction: number) {\n    const lastDeltas = direction === -1 ? this.lastDownDeltas : this.lastUpDeltas;\n    if (lastDeltas[0] === undefined) return direction;\n    if (\n      this.deltasTimestamp[this.stability * 2 - 2] + this.delay > Date.now()\n      && lastDeltas[0] === lastDeltas[this.stability * 2 - 1]\n    ) {\n      return false;\n    }\n    const lastDeltasOld = lastDeltas.slice(0, this.stability);\n    const lastDeltasNew = lastDeltas.slice(this.stability, this.stability * 2);\n    const oldSum = lastDeltasOld.reduce((t, s) => t + s);\n    const newSum = lastDeltasNew.reduce((t, s) => t + s);\n    const oldAverage = oldSum / lastDeltasOld.length;\n    const newAverage = newSum / lastDeltasNew.length;\n    return Math.abs(oldAverage) < Math.abs(newAverage * this.tolerance)\n      && this.sensitivity < Math.abs(newAverage);\n  }\n}\n","/* eslint-disable eqeqeq */\n/* eslint-disable prefer-template */\n/* eslint-disable prefer-const */\n/* eslint-disable prefer-destructuring */\n/* eslint-disable one-var */\n/* eslint-disable one-var-declaration-per-line */\n\nimport { preloadImage } from './files';\n\n/**\n * HEX > RGB\n * input: 'xxxxxx' (ex. 'ed15fa') case-insensitive\n * output: [r, g, b] ([0-255, 0-255, 0-255])\n */\nexport function hex2rgb(param: string): [number, number, number] {\n  return [\n    parseInt(param.substring(0, 2), 16),\n    parseInt(param.substring(2, 4), 16),\n    parseInt(param.substring(4, 6), 16),\n  ];\n}\n\n/**\n * RGB > HEX\n * input: [r, g, b] ([0-255, 0-255, 0-255])\n * output: 'xxxxxx' (ex. 'ff0000')\n */\nexport function rgb2hex(param: [number, number, number]) {\n  const p0 = param[0].toString(16);\n  const p1 = param[1].toString(16);\n  const p2 = param[2].toString(16);\n  return (p0.length == 1 ? '0' + p0 : p0) + (p1.length == 1 ? '0' + p1 : p1) + (p2.length == 1 ? '0' + p2 : p2);\n}\n\n/**\n * Converts an RGB color value to HSV. Conversion formula\n * adapted from http://en.wikipedia.org/wiki/HSV_color_space.\n * Assumes r, g, and b are contained in the set [0, 255] and\n * returns h, s, and v in the set [0, 1].\n *\n * @param   Number  r       The red color value\n * @param   Number  g       The green color value\n * @param   Number  b       The blue color value\n * @return  Array           The HSV representation\n */\nexport function rgb2hsb([r, g, b]: [number, number, number]): [number, number, number] {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  let max = Math.max(r, g, b), min = Math.min(r, g, b);\n  let h!: number, s: number, v: number = max;\n\n  let d = max - min;\n  s = max == 0 ? 0 : d / max;\n\n  if (max == min) {\n    h = 0; // achromatic\n  } else {\n    switch (max) {\n      case r:\n        h = (g - b) / d + (g < b ? 6 : 0);\n        break;\n      case g:\n        h = (b - r) / d + 2;\n        break;\n      case b:\n        h = (r - g) / d + 4;\n        break;\n    }\n\n    h /= 6;\n  }\n\n  return [h, s, v];\n}\n\n/**\n * Converts an HSV color value to RGB. Conversion formula\n * adapted from http://en.wikipedia.org/wiki/HSV_color_space.\n * Assumes h, s, and v are contained in the set [0, 1] and\n * returns r, g, and b in the set [0, 255].\n *\n * @param   Number  h       The hue\n * @param   Number  s       The saturation\n * @param   Number  v       The value\n * @return  Array           The RGB representation\n */\nexport function hsb2rgb([h, s, v]: [number, number, number]): [number, number, number] {\n  let r!: number, g!: number, b!: number;\n\n  let i = Math.floor(h * 6);\n  let f = h * 6 - i;\n  let p = v * (1 - s);\n  let q = v * (1 - f * s);\n  let t = v * (1 - (1 - f) * s);\n\n  switch (i % 6) {\n    case 0:\n      r = v;\n      g = t;\n      b = p;\n      break;\n    case 1:\n      r = q;\n      g = v;\n      b = p;\n      break;\n    case 2:\n      r = p;\n      g = v;\n      b = t;\n      break;\n    case 3:\n      r = p;\n      g = q;\n      b = v;\n      break;\n    case 4:\n      r = t;\n      g = p;\n      b = v;\n      break;\n    case 5:\n      r = v;\n      g = p;\n      b = q;\n      break;\n  }\n\n  return [\n    Math.round(r * 255),\n    Math.round(g * 255),\n    Math.round(b * 255),\n  ];\n}\n\nexport async function getAverageColor(url: string): Promise<[number, number, number]> {\n  // Only visit every 5 pixels\n  const blockSize = 5;\n  const defaultRGB: [number, number, number] = [0, 0, 0];\n  let data;\n  let width;\n  let height;\n  let i = -4;\n  let length;\n  let rgb: [number, number, number] = [0, 0, 0];\n  let count = 0;\n\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext && canvas.getContext('2d');\n  if (!context) {\n    return defaultRGB;\n  }\n\n  const image = await preloadImage(url);\n  height = image.naturalHeight || image.offsetHeight || image.height;\n  width = image.naturalWidth || image.offsetWidth || image.width;\n  canvas.height = height;\n  canvas.width = width;\n\n  context.drawImage(image, 0, 0);\n\n  try {\n    data = context.getImageData(0, 0, width, height);\n  } catch (e) {\n    return defaultRGB;\n  }\n\n  length = data.data.length;\n\n  // eslint-disable-next-line no-cond-assign\n  while ((i += blockSize * 4) < length) {\n    if (data.data[i + 3] === 0) continue; // Ignore fully transparent pixels\n    ++count;\n    rgb[0] += data.data[i];\n    rgb[1] += data.data[i + 1];\n    rgb[2] += data.data[i + 2];\n  }\n\n  rgb[0] = Math.floor(rgb[0] / count);\n  rgb[1] = Math.floor(rgb[1] / count);\n  rgb[2] = Math.floor(rgb[2] / count);\n\n  return rgb;\n}\n\nexport function getColorLuma(rgbColor: [number, number, number]) {\n  const [r, g, b] = rgbColor;\n  const luma = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n  return luma;\n}\n\n// eslint-disable-next-line max-len\n// Function was adapted from https://github.com/telegramdesktop/tdesktop/blob/35ff621b5b52f7e3553fb0f990ea13ade7101b8e/Telegram/SourceFiles/data/data_wall_paper.cpp#L518\nexport function getPatternColor(rgbColor: [number, number, number]) {\n  let [hue, saturation, value] = rgb2hsb(rgbColor);\n\n  saturation = Math.min(1, saturation + 0.05 + 0.1 * (1 - saturation));\n  value = value > 0.5\n    ? Math.max(0, value * 0.65)\n    : Math.max(0, Math.min(1, 1 - value * 0.65));\n\n  return `hsla(${hue * 360}, ${saturation * 100}%, ${value * 100}%, .4)`;\n}\n","export default function cycleRestrict(length: number, index: number) {\n  return index - Math.floor(index / length) * length;\n}\n","import { getGlobal } from '../global';\n\nimport { FocusDirection } from '../types';\n\nimport {\n  ANIMATION_LEVEL_MIN,\n  FAST_SMOOTH_MAX_DISTANCE, FAST_SMOOTH_MAX_DURATION, FAST_SMOOTH_MIN_DURATION,\n  FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE,\n} from '../config';\nimport { IS_ANDROID } from './environment';\nimport { dispatchHeavyAnimationEvent } from '../hooks/useHeavyAnimationCheck';\nimport { animateSingle } from './animation';\nimport { fastRaf } from './schedulers';\n\nlet isAnimating = false;\n\nexport default function fastSmoothScroll(\n  container: HTMLElement,\n  element: HTMLElement,\n  position: ScrollLogicalPosition | 'centerOrTop',\n  margin = 0,\n  maxDistance = FAST_SMOOTH_MAX_DISTANCE,\n  forceDirection?: FocusDirection,\n  forceDuration?: number,\n  forceNormalContainerHeight?: boolean,\n) {\n  const scrollFrom = calculateScrollFrom(container, element, maxDistance, forceDirection);\n\n  if (forceDirection === FocusDirection.Static) {\n    scrollWithJs(container, element, scrollFrom, position, margin, 0);\n    return;\n  }\n\n  if (getGlobal().settings.byKey.animationLevel === ANIMATION_LEVEL_MIN) {\n    forceDuration = 0;\n  }\n\n  scrollWithJs(container, element, scrollFrom, position, margin, forceDuration, forceNormalContainerHeight);\n}\n\nexport function isAnimatingScroll() {\n  return isAnimating;\n}\n\nfunction calculateScrollFrom(\n  container: HTMLElement,\n  element: HTMLElement,\n  maxDistance = FAST_SMOOTH_MAX_DISTANCE,\n  forceDirection?: FocusDirection,\n) {\n  const { offsetTop: elementTop } = element;\n  const { scrollTop } = container;\n\n  if (forceDirection === undefined) {\n    const offset = elementTop - container.scrollTop;\n\n    if (offset < -maxDistance) {\n      return scrollTop + (offset + maxDistance);\n    } else if (offset > maxDistance) {\n      return scrollTop + (offset - maxDistance);\n    }\n  } else if (forceDirection === FocusDirection.Up) {\n    return elementTop + maxDistance;\n  } else if (forceDirection === FocusDirection.Down) {\n    return Math.max(0, elementTop - maxDistance);\n  }\n\n  return scrollTop;\n}\n\nfunction scrollWithJs(\n  container: HTMLElement,\n  element: HTMLElement,\n  scrollFrom: number,\n  position: ScrollLogicalPosition | 'centerOrTop',\n  margin = 0,\n  forceDuration?: number,\n  forceNormalContainerHeight?: boolean,\n) {\n  const { offsetTop: elementTop, offsetHeight: elementHeight } = element;\n  const { scrollTop: currentScrollTop, offsetHeight: containerHeight, scrollHeight } = container;\n  const targetContainerHeight = forceNormalContainerHeight && container.dataset.normalHeight\n    ? Number(container.dataset.normalHeight)\n    : containerHeight;\n\n  if (currentScrollTop !== scrollFrom) {\n    container.scrollTop = scrollFrom;\n  }\n\n  let path!: number;\n\n  switch (position) {\n    case 'start':\n      path = (elementTop - margin) - scrollFrom + (IS_ANDROID ? 1 : 0);\n      break;\n    case 'end':\n      path = (elementTop + elementHeight + margin) - (scrollFrom + targetContainerHeight);\n      break;\n    // 'nearest' is not supported yet\n    case 'nearest':\n    case 'center':\n    case 'centerOrTop':\n      path = elementHeight < targetContainerHeight\n        ? (elementTop + elementHeight / 2) - (scrollFrom + targetContainerHeight / 2)\n        : (elementTop - margin) - scrollFrom;\n      break;\n  }\n\n  if (path < 0) {\n    const remainingPath = -scrollFrom;\n    path = Math.max(path, remainingPath);\n  } else if (path > 0) {\n    const remainingPath = scrollHeight - (scrollFrom + targetContainerHeight);\n    path = Math.min(path, remainingPath);\n  }\n\n  if (path === 0) {\n    return;\n  }\n\n  const target = scrollFrom + path;\n\n  if (forceDuration === 0) {\n    container.scrollTop = target;\n    return;\n  }\n\n  isAnimating = true;\n\n  const absPath = Math.abs(path);\n  const transition = absPath < FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE ? shortTransition : longTransition;\n  const duration = forceDuration || (\n    FAST_SMOOTH_MIN_DURATION\n    + (absPath / FAST_SMOOTH_MAX_DISTANCE) * (FAST_SMOOTH_MAX_DURATION - FAST_SMOOTH_MIN_DURATION)\n  );\n  const startAt = Date.now();\n  const onHeavyAnimationStop = dispatchHeavyAnimationEvent();\n\n  fastRaf(() => {\n    animateSingle(() => {\n      const t = Math.min((Date.now() - startAt) / duration, 1);\n      const currentPath = path * (1 - transition(t));\n\n      container.scrollTop = Math.round(target - currentPath);\n\n      isAnimating = t < 1;\n\n      if (!isAnimating) {\n        onHeavyAnimationStop();\n      }\n\n      return isAnimating;\n    });\n  });\n}\n\nfunction longTransition(t: number) {\n  return 1 - ((1 - t) ** 5);\n}\n\nfunction shortTransition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n","import { getGlobal } from '../global';\n\nimport { ANIMATION_LEVEL_MIN } from '../config';\nimport { animate } from './animation';\nimport { fastRaf } from './schedulers';\n\nconst DEFAULT_DURATION = 300;\n\nconst stopById: Map<string, VoidFunction> = new Map();\n\nexport default function fastSmoothScrollHorizontal(container: HTMLElement, left: number, duration = DEFAULT_DURATION) {\n  if (getGlobal().settings.byKey.animationLevel === ANIMATION_LEVEL_MIN) {\n    duration = 0;\n  }\n\n  return scrollWithJs(container, left, duration);\n}\n\nfunction scrollWithJs(container: HTMLElement, left: number, duration: number) {\n  const isRtl = container.getAttribute('dir') === 'rtl';\n  const {\n    scrollLeft, offsetWidth: containerWidth, scrollWidth, dataset: { scrollId },\n  } = container;\n\n  let path = left - scrollLeft;\n\n  if (path < 0) {\n    const remainingPath = -scrollLeft * (isRtl ? -1 : 1);\n    path = Math.max(path, remainingPath);\n  } else if (path > 0) {\n    const remainingPath = scrollWidth - (scrollLeft + containerWidth);\n    path = Math.min(path, remainingPath);\n  }\n\n  if (path === 0) {\n    return Promise.resolve();\n  }\n\n  if (scrollId && stopById.has(scrollId)) {\n    stopById.get(scrollId)!();\n  }\n\n  const target = scrollLeft + path;\n\n  if (duration === 0) {\n    container.scrollLeft = target;\n    return Promise.resolve();\n  }\n\n  let isStopped = false;\n  const id = Math.random().toString();\n  container.dataset.scrollId = id;\n  stopById.set(id, () => {\n    isStopped = true;\n  });\n\n  container.style.scrollSnapType = 'none';\n\n  let resolve: VoidFunction;\n  const promise = new Promise<void>((r) => {\n    resolve = r;\n  });\n  const startAt = Date.now();\n\n  fastRaf(() => {\n    animate(() => {\n      if (isStopped) return false;\n\n      const t = Math.min((Date.now() - startAt) / duration, 1);\n\n      const currentPath = path * (1 - transition(t));\n      container.scrollLeft = Math.round(target - currentPath);\n\n      if (t >= 1) {\n        container.style.scrollSnapType = '';\n        container.dataset.scrollId = undefined;\n        stopById.delete(id);\n        resolve();\n      }\n      return t < 1;\n    });\n  });\n\n  return promise;\n}\n\nfunction transition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n","import { IS_TOUCH_ENV } from './environment';\n\nexport default function focusEditableElement(element: HTMLElement, force?: boolean, forcePlaceCaretAtEnd?: boolean) {\n  if (!force && element === document.activeElement) {\n    return;\n  }\n\n  const selection = window.getSelection()!;\n  const range = document.createRange();\n  const lastChild = element.lastChild || element;\n\n  if (!IS_TOUCH_ENV && !forcePlaceCaretAtEnd && (!lastChild || !lastChild.nodeValue)) {\n    element.focus();\n    return;\n  }\n\n  range.selectNodeContents(forcePlaceCaretAtEnd ? element : lastChild);\n  // `false` means collapse to the end rather than the start\n  range.collapse(false);\n  selection.removeAllRanges();\n  selection.addRange(range);\n}\n","const ELEMENT_NODE = 1;\n\nexport default function getMessageIdsForSelectedText() {\n  const selection = window.getSelection();\n  let selectedFragments = selection && selection.rangeCount ? selection.getRangeAt(0).cloneContents() : undefined;\n  if (!selectedFragments || selectedFragments.childElementCount === 0) {\n    return undefined;\n  }\n\n  const messageIds = Array.from(selectedFragments.children)\n    .reduce((result, node) => {\n      if (node.nodeType === ELEMENT_NODE && node.classList.contains('message-date-group')) {\n        return Array.from(node.querySelectorAll('.Message'))\n          .reduce((acc, messageEl) => acc.concat(Number((messageEl as HTMLElement).dataset.messageId)), result);\n      } else if (node.nodeType === ELEMENT_NODE && node.classList.contains('Message')) {\n        return result.concat(Number((node as HTMLElement).dataset.messageId));\n      }\n\n      return result;\n    }, [] as number[]);\n\n  // Cleanup a document fragment because it is playing media content in the background\n  while (selectedFragments.firstChild) {\n    selectedFragments.removeChild(selectedFragments.firstChild);\n  }\n  selectedFragments = undefined;\n\n  return messageIds;\n}\n","import windowSize from './windowSize';\n\nexport function isElementInViewport(el: HTMLElement) {\n  if (el.style.display === 'none') {\n    return false;\n  }\n\n  const rect = el.getBoundingClientRect();\n  const { height: windowHeight } = windowSize.get();\n\n  return (rect.top <= windowHeight) && ((rect.top + rect.height) >= 0);\n}\n","export type MediaSessionHandlers = {\n  play?: () => void;\n  pause?: () => void;\n  stop?: () => void;\n\n  previoustrack?: () => void;\n  nexttrack?: () => void;\n\n  togglemicrophone?: () => void;\n  togglecamera?: () => void;\n  hangup?: () => void;\n\n  seekbackward?: (details: MediaSessionActionDetails) => void;\n  seekforward?: (details: MediaSessionActionDetails) => void;\n  seekTo?: ((details: MediaSessionActionDetails) => void);\n};\n\ninterface MediaMetadataParameters {\n  title?: string;\n  artist?: string;\n  album?: string;\n  artwork?: MediaImage[];\n}\n\nconst DEFAULT_HANDLERS = {\n  play: undefined,\n  pause: undefined,\n  seekbackward: undefined,\n  seekforward: undefined,\n  previoustrack: undefined,\n  nexttrack: undefined,\n  stop: undefined,\n  seekTo: undefined,\n};\n\nexport function registerMediaSession(metadata?: MediaMetadata, handlers?: MediaSessionHandlers) {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    if (metadata) updateMetadata(metadata);\n    if (handlers) setMediaSessionHandlers(handlers);\n  } else {\n    // eslint-disable-next-line no-console\n    console.warn('MediaSession API not supported in this browser');\n  }\n}\n\nexport function updateMetadata(metadata?: MediaMetadata) {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    // eslint-disable-next-line no-null/no-null\n    mediaSession.metadata = metadata ?? null;\n  }\n}\n\nexport function setMediaSessionHandlers(handlers: MediaSessionHandlers) {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    Object.entries({ ...DEFAULT_HANDLERS, ...handlers }).forEach(([key, handler]) => {\n      try {\n        // @ts-ignore API not standardized yet\n        mediaSession.setActionHandler(key, handler);\n      } catch (err) {\n        // Handler not supported, ignoring\n      }\n    });\n  }\n}\n\nexport function clearMediaSession() {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    // eslint-disable-next-line no-null/no-null\n    mediaSession.metadata = null;\n    setMediaSessionHandlers(DEFAULT_HANDLERS);\n    if (mediaSession.playbackState) mediaSession.playbackState = 'none';\n    mediaSession.setPositionState?.();\n  }\n}\n\nexport function setPlaybackState(state: 'none' | 'paused' | 'playing' = 'none') {\n  const { mediaSession } = window.navigator;\n  if (mediaSession && mediaSession.playbackState) {\n    mediaSession.playbackState = state;\n  }\n}\n\nexport function setPositionState(state?: MediaPositionState) {\n  if (!state || state.position === undefined || state.duration === undefined) return;\n  state.position = Math.min(state.position, state.duration);\n\n  const { mediaSession } = window.navigator;\n  mediaSession?.setPositionState?.(state);\n}\n\nexport function setMicrophoneActive(active: boolean) {\n  const { mediaSession } = window.navigator;\n  mediaSession?.setMicrophoneActive?.(active);\n}\n\nexport function setCameraActive(active: boolean) {\n  const { mediaSession } = window.navigator;\n  mediaSession?.setCameraActive?.(active);\n}\n\nexport function buildMediaMetadata({\n  title, artist, album, artwork,\n}: MediaMetadataParameters) {\n  if ('MediaMetadata' in window) {\n    return new window.MediaMetadata({\n      title,\n      artist,\n      album,\n      artwork,\n    });\n  }\n  return undefined;\n}\n","import type { ApiMessageEntity, ApiFormattedText } from '../api/types';\nimport { ApiMessageEntityTypes } from '../api/types';\nimport { IS_EMOJI_SUPPORTED } from './environment';\nimport { RE_LINK_TEMPLATE } from '../config';\n\nconst ENTITY_CLASS_BY_NODE_NAME: Record<string, string> = {\n  B: ApiMessageEntityTypes.Bold,\n  STRONG: ApiMessageEntityTypes.Bold,\n  I: ApiMessageEntityTypes.Italic,\n  EM: ApiMessageEntityTypes.Italic,\n  U: ApiMessageEntityTypes.Underline,\n  S: ApiMessageEntityTypes.Strike,\n  STRIKE: ApiMessageEntityTypes.Strike,\n  DEL: ApiMessageEntityTypes.Strike,\n  CODE: ApiMessageEntityTypes.Code,\n  PRE: ApiMessageEntityTypes.Pre,\n  BLOCKQUOTE: ApiMessageEntityTypes.Blockquote,\n};\n\nconst MAX_TAG_DEEPNESS = 3;\n\nexport default function parseMessageInput(html: string, withMarkdownLinks = false): ApiFormattedText {\n  const fragment = document.createElement('div');\n  fragment.innerHTML = withMarkdownLinks ? parseMarkdown(parseMarkdownLinks(html)) : parseMarkdown(html);\n  const text = fragment.innerText.trim().replace(/\\u200b+/g, '');\n  let textIndex = 0;\n  let recursionDeepness = 0;\n  const entities: ApiMessageEntity[] = [];\n\n  function addEntity(node: ChildNode) {\n    const { index, entity } = getEntityDataFromNode(node, text, textIndex);\n\n    if (entity) {\n      textIndex = index;\n      entities.push(entity);\n    } else if (node.textContent) {\n      // Skip newlines on the beginning\n      if (index === 0 && node.textContent.trim() === '') {\n        return;\n      }\n      textIndex += node.textContent.length;\n    }\n\n    if (node.hasChildNodes() && recursionDeepness <= MAX_TAG_DEEPNESS) {\n      recursionDeepness += 1;\n      Array.from(node.childNodes).forEach(addEntity);\n    }\n  }\n\n  Array.from(fragment.childNodes).forEach((node) => {\n    recursionDeepness = 1;\n    addEntity(node);\n  });\n\n  return {\n    text,\n    entities: entities.length ? entities : undefined,\n  };\n}\n\nfunction parseMarkdown(html: string) {\n  let parsedHtml = html.slice(0);\n\n  if (!IS_EMOJI_SUPPORTED) {\n    // Emojis\n    parsedHtml = parsedHtml.replace(/<img[^>]+alt=\"([^\"]+)\"[^>]*>/gm, '$1');\n  }\n\n  // Strip redundant nbsp's\n  parsedHtml = parsedHtml.replace(/&nbsp;/g, ' ');\n\n  // Replace <div><br></div> with newline (new line in Safari)\n  parsedHtml = parsedHtml.replace(/<div><br([^>]*)?><\\/div>/g, '\\n');\n  // Replace <br> with newline\n  parsedHtml = parsedHtml.replace(/<br([^>]*)?>/g, '\\n');\n\n  // Strip redundant <div> tags\n  parsedHtml = parsedHtml.replace(/<\\/div>(\\s*)<div>/g, '\\n');\n  parsedHtml = parsedHtml.replace(/<div>/g, '\\n');\n  parsedHtml = parsedHtml.replace(/<\\/div>/g, '');\n\n  // Pre\n  parsedHtml = parsedHtml.replace(/^`{3}(.*?)[\\n\\r](.*?[\\n\\r]?)`{3}/gms, '<pre data-language=\"$1\">$2</pre>');\n  parsedHtml = parsedHtml.replace(/^`{3}[\\n\\r]?(.*?)[\\n\\r]?`{3}/gms, '<pre>$1</pre>');\n  parsedHtml = parsedHtml.replace(/[`]{3}([^`]+)[`]{3}/g, '<pre>$1</pre>');\n\n  // Code\n  parsedHtml = parsedHtml.replace(/[`]{1}([^`\\n]+)[`]{1}/g, '<code>$1</code>');\n\n  // Other simple markdown\n  parsedHtml = parsedHtml.replace(\n    /(^|\\s)(?!<code[^<]*|<\\/)[*]{2}([^*\\n]+)[*]{2}(?![^<]*<\\/code>)(\\s|$)/g,\n    '$1<b>$2</b>$3',\n  );\n  parsedHtml = parsedHtml.replace(\n    /(^|\\s)(?!<code[^<]*|<\\/)[_]{2}([^_\\n]+)[_]{2}(?![^<]*<\\/code>)(\\s|$)/g,\n    '$1<i>$2</i>$3',\n  );\n  parsedHtml = parsedHtml.replace(\n    /(^|\\s)(?!<code[^<]*|<\\/)[~]{2}([^~\\n]+)[~]{2}(?![^<]*<\\/code>)(\\s|$)/g,\n    '$1<s>$2</s>$3',\n  );\n  parsedHtml = parsedHtml.replace(\n    /(^|\\s)(?!<code[^<]*|<\\/)[|]{2}([^|\\n]+)[|]{2}(?![^<]*<\\/code>)(\\s|$)/g,\n    `$1<span data-entity-type=\"${ApiMessageEntityTypes.Spoiler}\">$2</span>$3`,\n  );\n\n  return parsedHtml;\n}\n\nfunction parseMarkdownLinks(html: string) {\n  return html.replace(new RegExp(`\\\\[([^\\\\]]+?)]\\\\((${RE_LINK_TEMPLATE}+?)\\\\)`, 'g'), (_, text, link) => {\n    const url = link.includes('://') ? link : link.includes('@') ? `mailto:${link}` : `http://${link}`;\n    return `<a href=\"${url}\">${text}</a>`;\n  });\n}\n\nfunction getEntityDataFromNode(\n  node: ChildNode,\n  rawText: string,\n  textIndex: number,\n): { index: number; entity?: ApiMessageEntity } {\n  const type = getEntityTypeFromNode(node);\n  if (!type || !node.textContent) {\n    return {\n      index: textIndex,\n      entity: undefined,\n    };\n  }\n\n  const rawIndex = rawText.indexOf(node.textContent, textIndex);\n  // In some cases, last text entity ends with a newline (which gets trimmed from `rawText`).\n  // In this case, `rawIndex` would return `-1`, so we use `textIndex` instead.\n  const index = rawIndex >= 0 ? rawIndex : textIndex;\n  const offset = rawText.substring(0, index).length;\n  const { length } = rawText.substring(index, index + node.textContent.length);\n\n  let url: string | undefined;\n  let userId: string | undefined;\n  let language: string | undefined;\n  if (type === ApiMessageEntityTypes.TextUrl) {\n    url = (node as HTMLAnchorElement).href;\n  }\n  if (type === ApiMessageEntityTypes.MentionName) {\n    userId = (node as HTMLAnchorElement).dataset.userId;\n  }\n\n  if (type === ApiMessageEntityTypes.Pre) {\n    language = (node as HTMLPreElement).dataset.language;\n  }\n\n  return {\n    index,\n    entity: {\n      type,\n      offset,\n      length,\n      ...(url && { url }),\n      ...(userId && { userId }),\n      ...(language && { language }),\n    },\n  };\n}\n\nfunction getEntityTypeFromNode(node: ChildNode) {\n  if (ENTITY_CLASS_BY_NODE_NAME[node.nodeName]) {\n    return ENTITY_CLASS_BY_NODE_NAME[node.nodeName];\n  }\n\n  if (node.nodeName === 'A') {\n    const anchor = node as HTMLAnchorElement;\n    if (anchor.dataset.entityType === ApiMessageEntityTypes.MentionName) {\n      return ApiMessageEntityTypes.MentionName;\n    }\n    if (anchor.dataset.entityType === ApiMessageEntityTypes.Url) {\n      return ApiMessageEntityTypes.Url;\n    }\n    if (anchor.href.startsWith('mailto:')) {\n      return ApiMessageEntityTypes.Email;\n    }\n    if (anchor.href.startsWith('tel:')) {\n      return ApiMessageEntityTypes.Phone;\n    }\n    if (anchor.href !== anchor.textContent) {\n      return ApiMessageEntityTypes.TextUrl;\n    }\n\n    return ApiMessageEntityTypes.Url;\n  }\n\n  if (node.nodeName === 'SPAN') {\n    return (node as HTMLElement).dataset.entityType;\n  }\n\n  return undefined;\n}\n","/*\n * Thanks to Ace Monkey for this mind-blowing patch.\n */\n\nexport function patchSafariProgressiveAudio(audioEl: HTMLAudioElement) {\n  if (audioEl.dataset.patchedForSafari) {\n    return;\n  }\n\n  audioEl.addEventListener('play', () => {\n    const t = audioEl.currentTime;\n\n    audioEl.dataset.patchForSafariInProgress = 'true';\n    function onProgress() {\n      if (!audioEl.buffered.length) {\n        return;\n      }\n      audioEl.currentTime = audioEl.duration - 1;\n      audioEl.addEventListener('progress', () => {\n        delete audioEl.dataset.patchForSafariInProgress;\n        audioEl.currentTime = t;\n        if (audioEl.paused && !audioEl.dataset.preventPlayAfterPatch) {\n          audioEl.play();\n        }\n      }, { once: true });\n\n      audioEl.removeEventListener('progress', onProgress);\n    }\n\n    audioEl.addEventListener('progress', onProgress);\n  }, { once: true });\n\n  audioEl.dataset.patchedForSafari = 'true';\n}\n\nexport function isSafariPatchInProgress(audioEl: HTMLAudioElement) {\n  return Boolean(audioEl.dataset.patchForSafariInProgress);\n}\n","import type React from '../lib/teact/teact';\n\nconst stopEvent = (e: React.UIEvent | Event) => {\n  e.stopPropagation();\n  e.preventDefault();\n};\n\nexport default stopEvent;\n","let fileSelector: HTMLInputElement;\n\nexport function openSystemFilesDialog(accept = '*', callback: (e: Event) => void, noMultiple = false) {\n  if (!fileSelector) {\n    fileSelector = document.createElement('input');\n    fileSelector.setAttribute('type', 'file');\n  }\n\n  fileSelector.setAttribute('accept', accept);\n\n  if (noMultiple) {\n    fileSelector.removeAttribute('multiple');\n  } else {\n    fileSelector.setAttribute('multiple', 'multiple');\n  }\n\n  // eslint-disable-next-line no-null/no-null\n  fileSelector.onchange = null;\n  fileSelector.value = '';\n  fileSelector.onchange = callback;\n\n  fileSelector.click();\n}\n","import type { ApiThemeParameters } from '../api/types';\n\nexport function extractCurrentThemeParams(): ApiThemeParameters {\n  const style = getComputedStyle(document.documentElement);\n  const backgroundColor = getPropertyWrapped(style, '--color-background');\n  const textColor = getPropertyWrapped(style, '--color-text');\n  const buttonColor = getPropertyWrapped(style, '--color-primary');\n  const buttonTextColor = getPropertyWrapped(style, '--color-white');\n  const linkColor = getPropertyWrapped(style, '--color-links');\n  const hintColor = getPropertyWrapped(style, '--color-text-secondary');\n  const secondaryBgColor = getPropertyWrapped(style, '--color-background-secondary');\n  return {\n    bg_color: backgroundColor,\n    text_color: textColor,\n    hint_color: hintColor,\n    link_color: linkColor,\n    button_color: buttonColor,\n    button_text_color: buttonTextColor,\n    secondary_bg_color: secondaryBgColor,\n  };\n}\n\nexport function validateHexColor(color: string) {\n  return /^#[0-9A-F]{6}$/i.test(color);\n}\n\nfunction getPropertyWrapped(style: CSSStyleDeclaration, property: string) {\n  const value = style.getPropertyValue(property);\n  return wrapColor(value.trim());\n}\n\nfunction wrapColor(color: string) {\n  if (validateHexColor(color)) return color;\n  return `#${color.match(/^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+\\.{0,1}\\d*))?\\)$/)!\n    .slice(1)\n    .map((n: string, i: number) => (i === 3 ? Math.round(parseFloat(n) * 255) : parseFloat(n))\n      .toString(16)\n      .padStart(2, '0')\n      .replace('NaN', ''))\n    .join('')}`;\n}\n"],"names":["memo","props","sticker","noLoad","forcePreview","lastSyncTime","otherProps","thumbDataUri","thumbnail","dataUri","localMediaHash","id","previewBlobUrl","useMedia","undefined","ApiMediaFormat","tgsUrl","previewUrl","className","transitionClassNames","useMediaTransition","isAnimationReady","markAnimationReady","useFlag","size","buildClassName","style","buildStyle","src","styles","AnimatedIcon","onLoad","noTransition","renderWaveform","canvas","spikes","progress","peak","fillStyle","progressFillStyle","width","length","height","ctx","getContext","scale","forEach","item","i","globalAlpha","spikeHeight","Math","max","x","y","radius","beginPath","moveTo","arcTo","closePath","roundedRectangle","fill","decodeWaveform","encoded5bit","bitsCount","valuesCount","floor","result","Array","bitsData","l","byteIndex","bitShift","value","lastByteIndex","lastBitShift","lastValue","interpolateArray","data","fitCount","newData","springFactor","leftFiller","rightFiller","idx","val","TINY_SCREEN_WIDTH_MQL","window","matchMedia","WITH_AVATAR_TINY_SCREEN_WIDTH_MQL","getSeeklineSpikeAmounts","withAvatar","MIN_SPIKES","IS_SINGLE_COLUMN_LAYOUT","matches","MAX_SPIKES","renderSeekline","playProgress","bufferedRanges","seekerRef","ref","map","start","end","theme","message","senderTitle","uploadProgress","origin","date","noAvatars","isSelectable","isSelected","isDownloading","isTranscribing","isTranscriptionHidden","isTranscribed","isTranscriptionError","canDownload","canTranscribe","onHideTranscription","onPlay","onReadMedia","onCancelUpload","onDateClick","cancelMessageMediaDownload","downloadMessageMedia","transcribeAudio","getActions","content","audio","voice","video","isMediaUnread","isVoice","Boolean","isSeeking","useRef","lang","useLang","isRtl","isActivated","setIsActivated","useState","shouldLoad","coverHash","getMessageMediaHash","coverBlobUrl","mediaData","getMessageMediaFormat","loadProgress","downloadProgress","useMediaWithLoadProgress","handleForcePlay","useCallback","chatId","handleTrackChange","isBuffered","bufferingHandlers","checkBuffering","useBuffering","isPlaying","playPause","setCurrentTime","duration","useAudioPlayer","makeTrackId","getMediaDuration","isMessageLocal","isOwn","isOwnMessage","waveformCanvasRef","canvasRef","useMemo","waveform","min","durationFactor","spikesCount","round","Uint8Array","useLayoutEffect","current","useWaveformCanvas","withSeekline","useEffect","isLoadingForPlaying","isUploading","isTransferring","transferProgress","getMediaTransferState","shouldRender","shouldRenderSpinner","spinnerClassNames","useShowTransition","shouldRenderCross","handleButtonClick","setAudioPlayerOrigin","handleDownloadClick","handleSeek","e","left","getBoundingClientRect","clientX","MouseEvent","targetTouches","stopPropagation","handleStartSeek","button","handleStopSeek","handleDateClick","handleTranscribe","messageId","captureEvents","onCapture","onRelease","onClick","onDrag","transcribeSvgMemo","dangerouslySetInnerHTML","__html","renderFirstLine","title","fileName","fullClassName","AudioOrigin","buttonClassNames","push","contentClassName","renderWithTitle","dir","renderText","Link","formatPastTimeShort","formatMediaDuration","performer","renderSecondLine","Button","ripple","color","join","ariaLabel","backgroundImage","ProgressSpinner","transparent","noCross","showProgress","showSeekline","getTranslation","getFileSizeString","formatMediaDateTime","renderAudio","svgMemo","onClickTranscribe","draggable","renderVoice","withGlobal","global","chatOrUserId","countryList","phoneCodes","phoneCodeList","chat","selectChat","user","isUserId","selectUser","isMuted","selectIsChatMuted","selectNotifySettings","selectNotifyExceptions","canInviteUsers","isChatChannel","isUserRightBanned","getHasAdminRight","forceShowSelf","loadFullUser","showNotification","updateChatMutedState","userId","fullInfo","username","phoneNumber","isSelf","handleNotificationChange","isRestricted","copy","text","entity","copyTextToClipboard","formattedNumber","formatPhoneNumberWithCode","link","getChatLink","description","bio","getChatDescription","icon","multiline","narrow","isStatic","label","checked","inactive","isPrivateChat","isChatWithSelf","selectIsChatWithSelf","getPrivateChatUserId","isBot","isUserBot","isSupport","canDeleteForAll","contactName","getUserFirstOrLastName","isChannel","isBasicGroup","isChatBasicGroup","isSuperGroup","isChatSuperGroup","currentUserId","isOpen","onClose","onCloseAnimationEnd","leaveChannel","deleteHistory","deleteChannel","deleteChatUser","blockContact","chatTitle","getChatTitle","handleDeleteMessageForAll","shouldDeleteForAll","handleDeleteAndStop","contactId","accessHash","handleDeleteChat","isCreator","handleLeaveChat","header","isSavedMessages","isText","observeIntersection","smaller","canAutoLoad","autoLoadFileMaxSizeMb","withDate","datetime","sender","onMediaClick","dispatch","document","timestamp","extension","getDocumentExtension","isIntersecting","useIsIntersecting","wasIntersected","markIntersected","isLoadAllowed","setIsLoadAllowed","shouldDownload","documentHash","isLoaded","hasPreview","getDocumentHasPreview","getMessageMediaThumbDataUri","localBlobUrl","previewData","withMediaViewer","mediaType","handleClick","name","thumbnailDataUri","actionIcon","isMessageDocumentVideo","fakeType","elementRef","shouldSpinnerRender","getColorFromExtension","sizeString","getDocumentThumbnailDimensions","alt","onlineCount","selectChatOnlineCount","areMessagesLoaded","selectChatMessages","typingStatus","avatarSize","status","withDots","withUsername","withFullInfo","withUpdatingStatus","withChatType","withVideoAvatar","noRtl","loadFullChat","openMediaViewer","isMin","handleAvatarViewerOpen","hasMedia","avatarOwnerId","MediaViewerOrigin","key","noVideo","isVerified","getChatTypeString","handle","groupStatus","chatTypeString","membersCount","getGroupStatus","onlineStatus","renderStatusOrTyping","outgoingStatus","idPrefix","isProtected","mediaBlobUrl","getMessageVideo","getMessageHtmlId","decoding","onContextMenu","stopEvent","isGif","Keys","activeKey","DEFAULT_TEXT","FOCUS_DELAY_TIMEOUT_MS","isLoading","isPasswordVisible","error","hint","placeholder","submitLabel","shouldShowSubmit","shouldResetValue","shouldDisablePasswordManager","noRipple","clearError","onChangePasswordVisibility","onInputChange","onSubmit","inputRef","password","setPassword","canSubmit","setCanSubmit","useTimeout","IS_TOUCH_ENV","focus","requestAnimationFrame","select","action","event","preventDefault","autoComplete","type","tabIndex","onChange","target","MIN_PASSWORD_LENGTH","maxLength","role","disabled","itemIds","selectedIds","filterValue","filterPlaceholder","notFoundText","searchInputId","noScrollRestore","onSelectedIdsChange","onFilterChange","onLoadMore","shouldMinimize","setTimeout","handleItemClick","newSelectedIds","includes","splice","indexOf","handleFilterChange","currentTarget","viewportIds","getMore","useInfiniteScroll","isMinimized","canClose","clickArg","items","iconElement","titleText","PREMIUM_ICON","store","withGradient","big","html","generateIdFor","getPremiumIconGradient","serverTimeOffset","userStatus","selectUserStatus","noStatusOrTyping","fullName","getUserFullName","isPremium","isUserOnline","getUserStatus","photo","isFirstPhoto","notActive","videoRef","isDeleted","isDeletedUser","isRepliesChat","isChatWithRepliesBot","getMediaHash","userOrChat","profilePhoto","hasVideo","isVideo","forceAvatar","getVideoAvatarMediaHash","getChatAvatarHash","pause","currentTime","play","photoHash","photoBlobUrl","videoHash","videoBlobUrl","imageSrc","muted","autoPlay","loop","playsInline","userFullName","getFirstLetters","Spinner","getUserColorKey","connectionState","animationLevel","settings","byKey","openPremiumModal","photos","slideAnimation","currentPhotoIndex","setCurrentPhotoIndex","isFirst","isLast","profile","currentIndex","slice","mediaLoader","usePhotosPreload","handleProfilePhotoClick","profilePhotoIndex","handleClickPremium","fromUserId","selectPreviousMedia","selectNextMedia","element","querySelector","selectorToPreventScroll","onSwipe","direction","SwipeDirection","renderPhoto","isActive","isVerifiedIconShown","isPremiumIconShown","_","renderPhotoTabs","Transition","VerifiedIcon","PremiumIcon","FakeIcon","reaction","staticIconId","getGlobal","availableReactions","find","staticIcon","subject","messageIds","reportMessages","reportPeer","reportProfilePhoto","exitMessageSelectMode","selectedReason","setSelectedReason","setDescription","handleReport","reason","handleSelectReason","handleDescriptionChange","REPORT_OPTIONS","onEnter","options","selected","noAnimate","noContextMenu","canViewSet","onFaveClick","onUnfaveClick","onRemoveRecentClick","isCurrentUserPremium","openStickerSet","stickerSelector","shouldPlay","lottieData","isLottie","isLottieLoaded","markLoaded","unmarkLoaded","canLottiePlay","IS_WEBM_SUPPORTED","canVideoPlay","isPremiumSticker","hasEffect","isLocked","previewTransitionClassNames","isContextMenuOpen","contextMenuPosition","handleBeforeContextMenu","handleContextMenu","handleContextMenuClose","handleContextMenuHide","useContextMenuHandlers","getTriggerElement","getRootElement","closest","getMenuElement","positionX","positionY","transformOriginX","transformOriginY","menuStyle","useContextMenuPosition","safePlay","handleRemoveClick","handleContextRemoveRecent","handleContextUnfave","handleContextFave","handleSendQuiet","handleSendScheduled","handleOpenSet","shouldShowCloseButton","contextMenuItems","emoji","onMouseDown","preventMessageInputBlurWithBubbling","initialSection","isLowPriority","autoClose","StickerSetModal","useModuleLoader","Bundles","typingUser","typingUserName","replace","trim","VERIFIED_ICON","onMessageClick","linkData","getMessageWebPage","getFirstLinkInMessage","url","domain","siteName","formattedDescription","getMessageText","renderMessageSummary","handleMessageClick","displayUrl","truncatedDescription","trimText","MEDIA_VIEWER_MEDIA_QUERY","REM","parseInt","getComputedStyle","documentElement","fontSize","ROUND_VIDEO_DIMENSIONS_PX","AVATAR_FULL_DIMENSIONS","VIDEO_AVATAR_FULL_DIMENSIONS","LIKE_STICKER_ID","DEFAULT_MEDIA_DIMENSIONS","cachedMaxWidthOwn","cachedMaxWidth","cachedMaxWidthNoAvatar","getAvailableWidth","fromOwnMessage","isForwarded","isWebPagePhoto","extraPaddingRem","availableWidthRem","regularMaxWidth","windowWidth","windowSize","getMaxMessageWidthRem","calculateDimensionsForMessageMedia","aspectRatio","availableWidth","availableHeight","getAvailableHeight","mediaWidth","calculateDimensions","getMediaViewerAvailableDimensions","withFooter","mql","windowHeight","occupiedHeightRem","calculateInlineImageDimensions","getPhotoInlineDimensions","calculateVideoDimensions","getVideoDimensions","getPictogramDimensions","getStickerDimensions","baseWidth","STICKER_SIZE_INLINE_MOBILE_FACTOR","STICKER_SIZE_INLINE_DESKTOP_FACTOR","calculatedHeight","calculateMediaViewerDimensions","mediaHeight","calculatedWidth","ChatFolderModal","ChatAnimationTypes","isPinned","isShown","unreadCount","unreadMentionsCount","hasUnreadMark","unreadReactionsCount","isUnread","ShowTransition","isCustom","unreadReactionsElement","unreadMentionsElement","unreadCountElement","formatIntegerCompact","elements","filter","renderContent","lastMessage","senderId","replyToMessageId","isOutgoing","lastMessageSender","lastMessageAction","getMessageAction","actionTargetMessage","selectChatMessage","targetUserIds","actionTargetUserIds","targetChatId","actionTargetChatId","privateChatUserId","currentChatId","threadId","currentThreadId","messageListType","selectCurrentMessageList","MAIN_THREAD_ID","draft","selectDraft","canScrollDown","canChangeFolder","chatFolders","orderedIds","lastMessageOutgoingStatus","selectOutgoingStatus","folderId","orderDiff","animationType","openChat","focusLastMessage","isDeleteModalOpen","openDeleteModal","closeDeleteModal","isChatFolderModalOpen","openChatFolderModal","closeChatFolderModal","isReportModalOpen","openReportModal","closeReportModal","shouldRenderDeleteModal","markRenderDeleteModal","unmarkRenderDeleteModal","shouldRenderChatFolderModal","markRenderChatFolderModal","unmarkRenderChatFolderModal","shouldRenderReportModal","markRenderReportModal","unmarkRenderReportModal","isAction","isActionMessage","useEnsureMessage","mediaThumbnail","getMessageSticker","isRoundVideo","getMessageRoundVideo","actionTargetUsers","usersById","users","byId","Opacity","opacity","fastRaf","classList","add","Move","transform","remove","ANIMATION_END_DELAY","shouldReplaceHistory","handleDelete","handleChatFolderChange","contextActions","useChatContextActions","ListItem","Avatar","isCallActive","isCallNotEmpty","LastMessageMeta","TypingStatus","isChat","renderActionMessageText","asTextWithSpoilers","senderName","getMessageSenderName","blobUrl","renderSummary","renderLastMessageOrTyping","DeleteChatModal","ReportModal","folderType","chatFolder","selectChatFolder","animatedEmoji","selectAnimatedEmoji","foldersDispatch","onScreenSelect","handleEditFolder","payload","SettingsScreens","AnimatedIconFromSticker","fluid","pill","openNextChat","containerRef","resolvedFolderId","ALL_FOLDER_ID","ARCHIVED_FOLDER_ID","useFolderManagerForOrderedIds","orderById","reduce","acc","prevOrderById","usePrevious","orderDiffById","mapValues","order","CHAT_LIST_SLICE","useHotkeys","targetIndexDelta","IS_PWA","addEventListener","handleKeyDown","removeEventListener","IS_MAC_OS","metaKey","ctrlKey","code","startsWith","digit","match","position","Number","getAnimationType","orderDiffs","Object","values","numberOfUp","diff","numberOfDown","None","Infinity","useChatAnimationType","observe","useIntersectionObserver","rootRef","throttleMs","InfiniteScroll","preloadBackwards","withAbsolutePositioning","maxHeight","CHAT_HEIGHT_PX","viewportOffset","pinnedCount","getPinnedChatsCount","teactOrderKey","getOrderKey","renderChats","Loading","getSenderName","chatsById","getSenderTitle","isChatGroup","CustomSend","isQuick","onFileSelect","isHovered","markHovered","unmarkHovered","onDrop","onDragEnter","onDragLeave","relatedTarget","toTarget","DropAreaState","withQuick","onHide","hideTimeoutRef","prevWithQuick","captureEscKeyListener","handleFilesDrop","async","dataTransfer","dt","files","folderFiles","getFilesFromDataTransferItems","concat","from","handleQuickFilesDrop","handleDragLeave","fromTarget","Portal","containerId","onDragOver","clearTimeout","EmojiTooltip","MAX_INPUT_HEIGHT","messageSendKeyCombo","replyingToId","selectReplyingToId","noTabCapture","pollModal","payment","isPaymentModalOpen","captionLimit","isAttachmentModalInput","editableInputId","forcedPlaceholder","canAutoFocus","shouldSuppressFocus","shouldSuppressTextFormatter","onUpdate","onSuppressedFocus","onSend","editLastMessage","replyToNextMessage","selectionTimeoutRef","cloneRef","isContextMenuOpenRef","isTextFormatterOpen","openTextFormatter","closeTextFormatter","textFormatterAnchorPosition","setTextFormatterAnchorPosition","selectedRange","setSelectedRange","sendMessageAction","useSendMessageAction","updateInputHeight","useLayoutEffectWithPrevDeps","prevHtml","innerHTML","focusInput","isHeavyAnimating","focusEditableElement","handleCloseTextFormatter","selection","getSelection","removeAllRanges","empty","clearSelection","checkSelection","IS_IOS","rangeCount","selectionRange","getRangeAt","selectedText","toString","isSelectionInsideInput","EDITABLE_INPUT_ID","parseEmojiOnlyString","START_TO_END","processSelection","selectionRect","inputRect","top","processSelectionWithTimeout","willSend","input","clone","currentHeight","newHeight","scrollHeight","transitionDuration","log","abs","exec","toggle","captureFirstTab","debounce","captureKeyboardListeners","onTab","suppressFocus","blur","contentEditable","textContent","IS_EMOJI_SUPPORTED","onKeyDown","shiftKey","altKey","once","IS_ANDROID","handleCloseContextMenu","e2","KeyboardEvent","onTouchCancel","anchorPosition","TEXT_FORMAT_BY_TAG_NAME","B","STRONG","I","EM","U","DEL","CODE","SPAN","fragmentEl","createElement","linkUrlInputRef","isLinkControlOpen","openLinkControl","closeLinkControl","linkUrl","setLinkUrl","isEditingLink","setIsEditingLink","inputClassName","setInputClassName","selectedTextFormats","setSelectedTextFormats","useVirtualBackdrop","selectedFormats","parentElement","commonAncestorContainer","textFormat","tagName","restoreSelection","addRange","updateSelectedRange","getSelectedText","replaceChildren","cloneContents","getSelectedElement","updateInputStyles","offsetWidth","scrollWidth","scrollLeft","getFormatButtonClassName","keys","some","fKey","monospace","strikethrough","handleSpoilerText","spoiler","dataset","entityType","ApiMessageEntityTypes","replaceWith","execCommand","handleBoldText","bold","handleItalicText","italic","handleUnderlineText","underline","handleStrikethroughText","handleMonospaceText","handleLinkUrlConfirm","formattedLinkUrl","ensureProtocol","split","encodeURI","href","handler","k","b","u","m","s","p","toLowerCase","getKeyFromEvent","linkUrlConfirmClassName","inputMode","onScroll","dataTransferItems","traverseFileTreePromise","entry","Promise","resolve","File","isFile","itemFile","getAsFile","file","isDirectory","createReader","readEntries","entries","entriesPromises","all","kind","webkitGetAsEntry","fixMovMime","ext","pop","RE_BR","RE_SPACE","RE_CLEAN_HTML","RE_EXTRA_NEW_LINE","prepareForRegExp","inputId","parentNode","iterations","cache","WeakMap","memoized","fn","cached","get","args","areSortedArraysEqual","lastArgs","lastResult","set","emojiDataPromise","emojiRawData","emojiData","RE_EMOJI_SEARCH","prepareRecentEmojisMemo","recentEmojiIds","limit","pickTruthy","MEMO_EMPTY_ARRAY","prepareLibraryMemo","baseEmojiKeywords","emojiKeywords","emojis","byNative","buildCollectionByKey","baseEmojisByKeyword","natives","emojisByKeyword","byKeyword","keywords","byName","names","searchInLibraryMemo","library","matched","matchedKeywords","keyword","sort","flat","matchedNames","unique","useEmojiTooltip","isAllowed","htmlRef","onUpdateHtml","isDisabled","markIsOpen","unmarkIsOpen","setById","shouldForceInsertEmoji","setShouldForceInsertEmoji","filteredEmojis","setFilteredEmojis","ensureEmojiData","then","getEmojiCode","forceSend","endsWith","substr","insertEmoji","textEmoji","isForce","currentHtml","atIndex","lastIndexOf","messageInput","EDITABLE_INPUT_CSS_SELECTOR","getElementById","native","isEmojiTooltipOpen","closeEmojiTooltip","default","uncompressEmoji","runThrottled","throttle","cb","RE_USERNAME_SEARCH","useMentionTooltip","canSuggestMembers","groupChatMembers","topInlineBotIds","usersToMention","setUsersToMention","updateFilteredUsers","withInlineBots","memberIds","member","filteredIds","filterUsersByName","usernameFilter","getUsernameFilter","canSuggestInlineBots","insertMention","forceFocus","insertedHtml","isMentionTooltipOpen","closeMentionTooltip","mentionFilteredUsers","useAsyncRendering","dependencies","delay","shouldRenderRef","timeoutRef","forceUpdate","useForceUpdate","useOnChange","loadingOptions","setValues","handleChange","newValues","v","option","subLabel","textParts","confirmLabel","confirmHandler","confirmIsDestructive","isButtonsInOneRow","children","handleSelectWithEnter","index","useKeyboardListNavigation","textPart","buttonClassName","buttonRef","leftElement","secondaryIcon","destructive","onSecondaryIconClick","isTouched","markIsTouched","unmarkIsTouched","handleSecondaryIconClick","handleMouseDown","DEFAULT_DURATION","onDismiss","actionText","setIsOpen","timerRef","closeAndDismiss","handleMouseEnter","handleMouseLeave","onMouseEnter","onMouseLeave","RADIUSES","xl","square","circleRadius","STROKE_WIDTH","borderRadius","circumference","PI","container","svg","firstElementChild","strokeDashOffset","setAttribute","hidden","loadingOption","step","renderValue","mainClassName","trackWidth","parentContainerClassName","focused","spinnerColor","spinnerBackgroundColor","autoFocusSearch","onReset","onFocus","onBlur","onSpinnerClick","isInputFocused","markInputFocused","unmarkInputFocused","useInputFocusOnOpen","backgroundColor","prevIsOpen","prevChildren","fromChildrenRef","variant","animation","forceAspectRatio","classNames","noAnimation","onCheck","isBlocked","badgeCount","isBadgeActive","previousActiveTab","tabRef","tabEl","prevTabEl","platformEl","prevPlatformEl","shiftLeft","offsetLeft","scaleFactor","clientWidth","forceReflow","SCROLL_DURATION","tabs","activeTab","onSwitchTab","useHorizontalScroll","activeTabElement","childNodes","activeTabOffsetLeft","activeTabOffsetWidth","newLeft","fastSmoothScrollHorizontal","tab","INCLUDED_CHAT_TYPES","EXCLUDED_CHAT_TYPES","INCLUDE_FILTER_FIELDS","EXCLUDE_FILTER_FIELDS","selectChatFilters","state","mode","selectTemp","selectedChatIds","selectedChatTypes","includedChatIds","includeFilters","pick","folder","excludedChatIds","excludeFilters","getSuggestedFolderName","filters","bots","groups","channels","contacts","nonContacts","INITIAL_STATE","chatFilter","foldersReducer","omit","useReducer","makeMediaHandlers","controllerRef","mediaHandlers","proxy","requestNextTrack","requestPreviousTrack","stop","closeAudioPlayer","seekbackward","skipTime","seekOffset","seekforward","seekTo","seekTime","nexttrack","previoustrack","trackId","originalDuration","trackType","handlers","metadata","onInit","onForcePlay","onTrackChange","noPlaylist","noProgressUpdates","setIsPlaying","isPlayingSync","setPlayProgress","register","eventName","setVolume","setPlaybackRate","toggleMuted","registerMediaSession","setPlaybackState","audioPlayer","volume","isFinite","PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION","playbackRate","setPositionState","paused","updateMetadata","destroy","isSafariPatchInProgress","useEffectWithPrevDeps","prevShouldPlay","prevSrc","playIfPresent","setTime","time","audioProxy","getTimeRanges","ranges","noInitiallyBuffered","setIsBuffered","bufferedProgress","setBufferedProgress","setBufferedRanges","setIsBufferedDebounced","handleBuffering","media","buffered","bufferedLength","readyState","onLoadedData","onPlaying","onLoadStart","onPause","onTimeUpdate","onProgress","useCanvasBlur","withRaf","img","Image","processBlur","alpha","IS_CANVAS_FILTER_SUPPORTED","drawImage","RADIUS","fastBlur","onload","isInSearch","isServiceNotifications","SERVICE_NOTIFICATIONS_USER_ID","toggleChatPinned","toggleChatArchived","toggleChatUnread","actionAddToFolder","actionPin","compact","actionUnreadMark","actionMute","actionArchive","isChatArchived","actionReport","actionDelete","getCanDeleteChat","isInFolder","stopImmediatePropagation","isMenuDisabled","shouldDisableOnLink","shouldDisableOnLongTap","setIsContextMenuOpen","setContextMenuPosition","clientY","timer","clearLongPressTimer","startLongPressTimer","originalEvent","touches","cancelClickOnce","emulateContextMenuEvent","passive","EMPTY_RECT","anchor","getLayout","setPositionX","setPositionY","setTransformOriginX","setTransformOriginY","withScroll","setWithScroll","setStyle","setMenuStyle","triggerEl","anchorX","anchorY","menuEl","rootEl","extraPaddingX","extraTopPadding","marginSides","extraMarginTop","marginTop","menuRect","offsetHeight","rootRect","horizontalPosition","verticalPosition","triggerRect","menuMaxHeight","offsetX","offsetY","replyOriginForId","loadMessage","loadMessageThrottled","throttled","addOrderedIdsCallback","getOrderedIds","useFolderManagerForUnreadCounters","addUnreadCountersCallback","getUnreadCounters","useFolderManagerForChatsCount","addChatsCountCallback","getChatsCount","handleScroll","deltaX","deltaY","IGNORE_TAGS","Set","createCallbackManager","hotkeys","addCallback","HTMLElement","has","shouldFireEvent","hotkey","ctrl","meta","mod","shift","pressedKey","isExactHotkey","part","modifiers","reservedKeys","parseHotkey","getHotkeyMatcher","runCallbacks","debugKey","prevDeps","idRef","mediaHash","mediaFormat","cacheBuster","isHtmlAllowed","isStreaming","IS_PROGRESSIVE_SUPPORTED","useUniqueId","setLoadProgress","startedAtRef","handleProgress","Date","now","spentTime","closeTimeout","useMouseInside","menuCloseTimeout","isMouseInside","markMouseInside","usePrevDuringAnimation","prev","isCurrentPresent","isPrevPresent","reducer","initialState","reducerRef","useRunDebounced","ms","noFirst","noLast","useDebouncedCallback","CalendarModal","canScheduleUntilOnline","onCancel","onScheduled","setOnScheduled","handleMessageSchedule","isWhenOnline","scheduledAt","getTime","handleMessageScheduleUntilOnline","SCHEDULED_WHEN_ONLINE","handleCloseCalendar","requestCalendar","whenScheduled","scheduledDefaultDate","setSeconds","setMilliseconds","scheduledMaxDate","setFullYear","getFullYear","withTimePicker","selectedAt","maxAt","getDayStartAt","isFutureMode","secondButtonLabel","onSecondButtonClick","SEND_MESSAGE_ACTION_INTERVAL","useStateRef","callback","savedCallback","useVideoCleanup","videoEl","load","mul_table","shg_table","boxBlurCanvasRGB","context","top_x","top_y","isNaN","imageData","getImageData","pixels","rsum","gsum","bsum","p1","p2","yp","yi","yw","wm","hm","rad1","r","g","mul_sum","shg_sum","vmin","vmax","putImageData","tracks","Map","currentTrackId","voiceQueue","musicQueue","playNext","isReverseOrder","currentTrack","nextTrackId","findNextInQueue","openAudioPlayer","parseMessageKey","splitTrackId","messageKey","nextTrack","stopCurrentAudio","track","Audio","handleEvent","Proxy","createAudio","trackIdComparator","addTrackToQueue","preventPlayAfterPatch","preload","IS_SAFARI","patchSafariProgressiveAudio","globalSearch","currentContent","GlobalSearchContent","openedChatId","queueFilter","cleanUpQueue","fastSeek","rate","shouldRemoveFromQueue","h","delete","trackIdFilter","el","removeFromQueue","getTrackQueue","currentId","queue","chatAudio","getMessageKey","one","two","dateOne","keyOne","dateTwo","keyTwo","localeCompare","IOS_SCREEN_EDGE_THRESHOLD","getDistance","a","hypot","pageX","pageY","getTouchCenter","lastClickTime","lethargy","constructor","stability","sensitivity","tolerance","this","lastUpDeltas","lastDownDeltas","deltasTimestamp","check","lastDelta","wheelDelta","detail","isInertia","lastDeltas","lastDeltasOld","lastDeltasNew","oldSum","t","newSum","oldAverage","newAverage","captureEvent","initialSwipeAxis","hasMoved","hasSwiped","isZooming","initialDistance","wheelZoom","initialZoom","initialDragOffset","isDragCanceled","initialTouchCenter","innerWidth","innerHeight","minZoom","maxZoom","excludedClosestSelector","withNativeDrag","onMove","withCursor","body","querySelectorAll","scrollable","overflow","onDoubleClick","centerX","centerY","clamp","onZoom","endDistance","touchCenter","dragOffsetX","dragOffsetY","zoomFactor","initialCenterX","initialCenterY","currentCenterX","currentCenterY","shouldPreventScroll","xAbs","yAbs","axis","currentSwipeAxis","Left","Right","Up","Down","processSwipe","releaseWheelDrag","releaseWheelZoom","onWheelCapture","onWheel","doubleTapZoom","is","metaKeyPressed","delta","zoom","onWheelZoom","isUserEvent","sign","dx","dy","onWheelDrag","isNotPassive","hex2rgb","param","substring","rgb2hex","p0","rgb2hsb","d","hsb2rgb","f","q","getAverageColor","defaultRGB","rgb","count","image","preloadImage","naturalHeight","naturalWidth","blockSize","getColorLuma","rgbColor","getPatternColor","hue","saturation","cycleRestrict","isAnimating","fastSmoothScroll","margin","maxDistance","FAST_SMOOTH_MAX_DISTANCE","forceDirection","forceDuration","forceNormalContainerHeight","scrollFrom","calculateScrollFrom","FocusDirection","ANIMATION_LEVEL_MIN","scrollWithJs","isAnimatingScroll","offsetTop","elementTop","scrollTop","offset","elementHeight","currentScrollTop","containerHeight","targetContainerHeight","normalHeight","path","remainingPath","absPath","transition","FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE","shortTransition","longTransition","FAST_SMOOTH_MIN_DURATION","FAST_SMOOTH_MAX_DURATION","startAt","onHeavyAnimationStop","dispatchHeavyAnimationEvent","animateSingle","currentPath","stopById","getAttribute","containerWidth","scrollId","isStopped","random","scrollSnapType","promise","animate","force","forcePlaceCaretAtEnd","activeElement","range","createRange","lastChild","nodeValue","selectNodeContents","collapse","getMessageIdsForSelectedText","selectedFragments","childElementCount","node","nodeType","contains","messageEl","firstChild","removeChild","isElementInViewport","display","rect","DEFAULT_HANDLERS","mediaSession","navigator","setMediaSessionHandlers","console","warn","setActionHandler","err","clearMediaSession","playbackState","buildMediaMetadata","artist","album","artwork","MediaMetadata","ENTITY_CLASS_BY_NODE_NAME","S","STRIKE","PRE","BLOCKQUOTE","parseMessageInput","withMarkdownLinks","fragment","parseMarkdown","parseMarkdownLinks","innerText","textIndex","recursionDeepness","entities","addEntity","getEntityDataFromNode","hasChildNodes","parsedHtml","RegExp","RE_LINK_TEMPLATE","rawText","nodeName","getEntityTypeFromNode","rawIndex","language","audioEl","patchedForSafari","patchForSafariInProgress","fileSelector","openSystemFilesDialog","accept","noMultiple","removeAttribute","onchange","click","extractCurrentThemeParams","getPropertyWrapped","textColor","buttonColor","buttonTextColor","linkColor","bg_color","text_color","hint_color","link_color","button_color","button_text_color","secondary_bg_color","validateHexColor","test","property","getPropertyValue","n","parseFloat","padStart"],"sourceRoot":""}