{"version":3,"file":"37.9e975e031ef296075093.js","mappings":"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IAAK,IAAK,IAAK,IAAK,EAAG,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,EAAG,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,EAAG,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,GAAI,IAAK,EAAG,GAAI,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,EAAG,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,IAAK,GAE5qCC,EAAY,CAAC,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IA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","sources":["webpack://telegram-t/./src/components/common/AnimatedEmoji.tsx","webpack://telegram-t/./src/components/common/Audio.tsx","webpack://telegram-t/./src/components/common/helpers/waveform.ts","webpack://telegram-t/./src/util/waveform.ts","webpack://telegram-t/./src/components/common/CalendarModal.async.tsx","webpack://telegram-t/./src/components/common/ChatExtra.tsx","webpack://telegram-t/./src/components/common/DeleteChatModal.tsx","webpack://telegram-t/./src/components/common/Document.tsx","webpack://telegram-t/./src/components/common/File.tsx","webpack://telegram-t/./src/components/common/GroupChatInfo.tsx","webpack://telegram-t/./src/components/common/LastMessageMeta.tsx","webpack://telegram-t/./src/components/common/Media.tsx","webpack://telegram-t/./src/components/common/MessageOutgoingStatus.tsx","webpack://telegram-t/./src/components/common/NothingFound.tsx","webpack://telegram-t/./src/components/common/Picker.tsx","webpack://telegram-t/./src/components/common/PickerSelectedItem.tsx","webpack://telegram-t/./src/components/common/PrivateChatInfo.tsx","webpack://telegram-t/./src/components/common/ProfilePhoto.tsx","webpack://telegram-t/./src/components/common/ProfileInfo.tsx","webpack://telegram-t/./src/components/common/hooks/usePhotosPreload.ts","webpack://telegram-t/./src/components/common/ReactionStaticEmoji.tsx","webpack://telegram-t/./src/components/common/StickerButton.tsx","webpack://telegram-t/./src/components/common/StickerSetModal.async.tsx","webpack://telegram-t/./src/components/common/TypingStatus.tsx","webpack://telegram-t/./src/components/common/VerifiedIcon.tsx","webpack://telegram-t/./src/components/common/WebLink.tsx","webpack://telegram-t/./src/components/common/helpers/mediaDimensions.ts","webpack://telegram-t/./src/components/common/helpers/renderMessageText.tsx","webpack://telegram-t/./src/components/common/hooks/useAnimatedEmoji.ts","webpack://telegram-t/./src/components/left/ChatFolderModal.async.tsx","webpack://telegram-t/./src/components/left/main/hooks/useChatAnimationType.ts","webpack://telegram-t/./src/components/left/main/Badge.tsx","webpack://telegram-t/./src/components/left/main/ChatCallStatus.tsx","webpack://telegram-t/./src/components/left/main/Chat.tsx","webpack://telegram-t/./src/components/left/main/EmptyFolder.tsx","webpack://telegram-t/./src/components/left/main/ChatList.tsx","webpack://telegram-t/./src/components/left/search/helpers/getSenderName.ts","webpack://telegram-t/./src/components/middle/composer/DropTarget.tsx","webpack://telegram-t/./src/components/middle/composer/DropArea.tsx","webpack://telegram-t/./src/components/middle/composer/EmojiTooltip.async.tsx","webpack://telegram-t/./src/components/middle/composer/MessageInput.tsx","webpack://telegram-t/./src/components/middle/composer/TextFormatter.tsx","webpack://telegram-t/./src/components/middle/composer/helpers/prepareForRegExp.ts","webpack://telegram-t/./src/components/middle/composer/helpers/selection.ts","webpack://telegram-t/./src/util/memoized.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useEmojiTooltip.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useMentionTooltip.ts","webpack://telegram-t/./src/components/right/hooks/useAsyncRendering.ts","webpack://telegram-t/./src/components/ui/CheckboxGroup.tsx","webpack://telegram-t/./src/components/ui/FloatingActionButton.tsx","webpack://telegram-t/./src/components/ui/ListItem.tsx","webpack://telegram-t/./src/components/ui/Notification.tsx","webpack://telegram-t/./src/components/ui/ProgressSpinner.tsx","webpack://telegram-t/./src/components/ui/Radio.tsx","webpack://telegram-t/./src/components/ui/RadioGroup.tsx","webpack://telegram-t/./src/components/ui/RangeSlider.tsx","webpack://telegram-t/./src/components/ui/SearchInput.tsx","webpack://telegram-t/./src/components/ui/ShowTransition.tsx","webpack://telegram-t/./src/components/ui/Switcher.tsx","webpack://telegram-t/./src/components/ui/Tab.tsx","webpack://telegram-t/./src/components/ui/TabList.tsx","webpack://telegram-t/./src/components/ui/Transition.tsx","webpack://telegram-t/./src/hooks/reducers/useFoldersReducer.ts","webpack://telegram-t/./src/hooks/useAudioPlayer.ts","webpack://telegram-t/./src/hooks/useBlur.ts","webpack://telegram-t/./src/hooks/useBlurSync.ts","webpack://telegram-t/./src/hooks/useBuffering.ts","webpack://telegram-t/./src/hooks/useCanvasBlur.ts","webpack://telegram-t/./src/hooks/useChatContextActions.ts","webpack://telegram-t/./src/hooks/useContextMenuHandlers.ts","webpack://telegram-t/./src/hooks/useContextMenuPosition.ts","webpack://telegram-t/./src/hooks/useDebounce.ts","webpack://telegram-t/./src/hooks/useEnsureMessage.ts","webpack://telegram-t/./src/hooks/useHorizontalScroll.ts","webpack://telegram-t/./src/hooks/useInputFocusOnOpen.ts","webpack://telegram-t/./src/hooks/useIntersectionObserver.ts","webpack://telegram-t/./src/hooks/useInterval.ts","webpack://telegram-t/./src/hooks/useLayoutEffectWithPrevDeps.ts","webpack://telegram-t/./src/hooks/useMediaTransition.ts","webpack://telegram-t/./src/hooks/useUniqueId.ts","webpack://telegram-t/./src/hooks/useMediaWithLoadProgress.ts","webpack://telegram-t/./src/hooks/useMouseInside.ts","webpack://telegram-t/./src/hooks/usePrevDuringAnimation.ts","webpack://telegram-t/./src/hooks/useReducer.ts","webpack://telegram-t/./src/hooks/useSendMessageAction.ts","webpack://telegram-t/./src/hooks/useStateRef.ts","webpack://telegram-t/./src/hooks/useVideoCleanup.ts","webpack://telegram-t/./src/lib/fastBlur.js","webpack://telegram-t/./src/util/audioPlayer.ts","webpack://telegram-t/./src/util/captureEvents.ts","webpack://telegram-t/./src/util/cssAnimationEndListeners.ts","webpack://telegram-t/./src/util/cycleRestrict.ts","webpack://telegram-t/./src/util/fastSmoothScroll.ts","webpack://telegram-t/./src/util/fastSmoothScrollHorizontal.ts","webpack://telegram-t/./src/util/focusEditableElement.ts","webpack://telegram-t/./src/util/getKeyFromEvent.ts","webpack://telegram-t/./src/util/mediaSession.ts","webpack://telegram-t/./src/util/parseMessageInput.ts","webpack://telegram-t/./src/util/patchSafariProgressiveAudio.ts","webpack://telegram-t/./src/util/stopEvent.ts"],"sourcesContent":["import React, {\n  FC, memo,\n} from '../../lib/teact/teact';\n\nimport { ApiMediaFormat, ApiSticker } from '../../api/types';\nimport { ActiveEmojiInteraction } from '../../global/types';\n\nimport buildClassName from '../../util/buildClassName';\nimport { ObserveFn, useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaTransition from '../../hooks/useMediaTransition';\nimport useAnimatedEmoji from './hooks/useAnimatedEmoji';\nimport { LIKE_STICKER_ID } from './helpers/mediaDimensions';\n\nimport AnimatedSticker from './AnimatedSticker';\n\nimport './AnimatedEmoji.scss';\n\ntype OwnProps = {\n  sticker: ApiSticker;\n  effect?: ApiSticker;\n  isOwn?: boolean;\n  soundId?: string;\n  observeIntersection?: ObserveFn;\n  size?: 'large' | 'medium' | 'small';\n  lastSyncTime?: number;\n  forceLoadPreview?: boolean;\n  messageId?: number;\n  chatId?: string;\n  activeEmojiInteraction?: ActiveEmojiInteraction;\n};\n\nconst QUALITY = 1;\n\nconst AnimatedEmoji: FC<OwnProps> = ({\n  sticker,\n  effect,\n  isOwn,\n  soundId,\n  size = 'medium',\n  observeIntersection,\n  lastSyncTime,\n  forceLoadPreview,\n  messageId,\n  chatId,\n  activeEmojiInteraction,\n}) => {\n  const {\n    markAnimationLoaded,\n    isAnimationLoaded,\n    ref,\n    width,\n    style,\n    handleClick,\n    playKey,\n  } = useAnimatedEmoji(size, chatId, messageId, soundId, activeEmojiInteraction, isOwn, undefined, effect?.emoji);\n\n  const localMediaHash = `sticker${sticker.id}`;\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const thumbDataUri = sticker.thumbnail?.dataUri;\n  const previewBlobUrl = useMedia(\n    `${localMediaHash}?size=m`,\n    !isIntersecting && !forceLoadPreview,\n    ApiMediaFormat.BlobUrl,\n    lastSyncTime,\n  );\n  const transitionClassNames = useMediaTransition(previewBlobUrl);\n\n  const mediaData = useMedia(localMediaHash, !isIntersecting, ApiMediaFormat.Lottie, lastSyncTime);\n  const isMediaLoaded = Boolean(mediaData);\n\n  return (\n    <div\n      ref={ref}\n      className={buildClassName('AnimatedEmoji media-inner', sticker.id === LIKE_STICKER_ID && 'like-sticker-thumb')}\n      // @ts-ignore teact feature\n      style={style}\n      onClick={handleClick}\n    >\n      {!isAnimationLoaded && thumbDataUri && (\n        <img src={thumbDataUri} alt=\"\" />\n      )}\n      {!isAnimationLoaded && previewBlobUrl && (\n        <img src={previewBlobUrl} className={transitionClassNames} alt=\"\" />\n      )}\n      {isMediaLoaded && localMediaHash && (\n        <AnimatedSticker\n          key={localMediaHash}\n          id={localMediaHash}\n          animationData={mediaData!}\n          size={width}\n          quality={QUALITY}\n          play={isIntersecting && playKey}\n          forceOnHeavyAnimation\n          noLoop\n          onLoad={markAnimationLoaded}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default memo(AnimatedEmoji);\n","import React, {\n  FC, memo, useCallback, useEffect, useLayoutEffect, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\nimport { getDispatch } from '../../lib/teact/teactn';\n\nimport {\n  ApiAudio, ApiMediaFormat, ApiMessage, ApiVoice,\n} from '../../api/types';\nimport { AudioOrigin, ISettings } from '../../types';\n\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../util/environment';\nimport { formatMediaDateTime, formatMediaDuration, formatPastTimeShort } from '../../util/dateFormat';\nimport {\n  getMediaDuration,\n  getMediaTransferState,\n  getMessageMediaFormat,\n  getMessageMediaHash,\n  isMessageLocal,\n  isOwnMessage,\n} from '../../modules/helpers';\nimport { MAX_EMPTY_WAVEFORM_POINTS, renderWaveform } from './helpers/waveform';\nimport buildClassName from '../../util/buildClassName';\nimport renderText from './helpers/renderText';\nimport { getFileSizeString } from './helpers/documentInfo';\nimport { decodeWaveform, interpolateArray } from '../../util/waveform';\nimport useMediaWithLoadProgress from '../../hooks/useMediaWithLoadProgress';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useBuffering from '../../hooks/useBuffering';\nimport useAudioPlayer from '../../hooks/useAudioPlayer';\nimport useLang, { LangFn } from '../../hooks/useLang';\nimport { captureEvents } from '../../util/captureEvents';\nimport useMedia from '../../hooks/useMedia';\nimport { makeTrackId } from '../../util/audioPlayer';\nimport { getTranslation } from '../../util/langProvider';\n\nimport Button from '../ui/Button';\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport Link from '../ui/Link';\n\nimport './Audio.scss';\n\ntype OwnProps = {\n  theme: ISettings['theme'];\n  message: ApiMessage;\n  senderTitle?: string;\n  uploadProgress?: number;\n  origin: AudioOrigin;\n  date?: number;\n  lastSyncTime?: number;\n  className?: string;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  isDownloading: boolean;\n  onPlay: (messageId: number, chatId: string) => void;\n  onReadMedia?: () => void;\n  onCancelUpload?: () => void;\n  onDateClick?: (messageId: number, chatId: string) => void;\n};\n\nconst AVG_VOICE_DURATION = 10;\nconst MIN_SPIKES = IS_SINGLE_COLUMN_LAYOUT ? 20 : 25;\nconst MAX_SPIKES = IS_SINGLE_COLUMN_LAYOUT ? 50 : 75;\n// This is needed for browsers requiring user interaction before playing.\nconst PRELOAD = true;\n\nconst Audio: FC<OwnProps> = ({\n  theme,\n  message,\n  senderTitle,\n  uploadProgress,\n  origin,\n  date,\n  lastSyncTime,\n  className,\n  isSelectable,\n  isSelected,\n  isDownloading,\n  onPlay,\n  onReadMedia,\n  onCancelUpload,\n  onDateClick,\n}) => {\n  const { content: { audio, voice, video }, isMediaUnread } = message;\n  const isVoice = Boolean(voice || video);\n  const isSeeking = useRef<boolean>(false);\n  const playStateBeforeSeeking = useRef<boolean>(false);\n  // eslint-disable-next-line no-null/no-null\n  const seekerRef = useRef<HTMLDivElement>(null);\n  const lang = useLang();\n  const { isRtl } = lang;\n  const dispatch = getDispatch();\n\n  const [isActivated, setIsActivated] = useState(false);\n  const shouldLoad = (isActivated || PRELOAD) && lastSyncTime;\n  const coverHash = getMessageMediaHash(message, 'pictogram');\n  const coverBlobUrl = useMedia(coverHash, false, ApiMediaFormat.BlobUrl);\n\n  const mediaData = useMedia(\n    getMessageMediaHash(message, 'inline'),\n    !shouldLoad,\n    getMessageMediaFormat(message, 'inline'),\n  );\n\n  const { loadProgress: downloadProgress } = useMediaWithLoadProgress(\n    getMessageMediaHash(message, 'download'),\n    !isDownloading,\n  );\n\n  const handleForcePlay = useCallback(() => {\n    setIsActivated(true);\n    onPlay(message.id, message.chatId);\n  }, [message, onPlay]);\n\n  const handleTrackChange = useCallback(() => {\n    setIsActivated(false);\n  }, []);\n\n  const {\n    isBuffered, bufferedProgress, bufferingHandlers, checkBuffering,\n  } = useBuffering();\n\n  const {\n    isPlaying, playProgress, playPause, play, pause, setCurrentTime, duration,\n  } = useAudioPlayer(\n    makeTrackId(message),\n    getMediaDuration(message)!,\n    isVoice ? 'voice' : 'audio',\n    mediaData,\n    bufferingHandlers,\n    undefined,\n    checkBuffering,\n    isActivated,\n    handleForcePlay,\n    handleTrackChange,\n    isMessageLocal(message),\n  );\n\n  const isOwn = isOwnMessage(message);\n  const waveformCanvasRef = useWaveformCanvas(theme, voice, (isMediaUnread && !isOwn) ? 1 : playProgress, isOwn);\n\n  const withSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n\n  useEffect(() => {\n    setIsActivated(isPlaying);\n  }, [isPlaying]);\n\n  const isLoadingForPlaying = isActivated && !isBuffered;\n\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(\n    message,\n    uploadProgress || downloadProgress,\n    isLoadingForPlaying || isDownloading,\n  );\n\n  const {\n    shouldRender: shouldRenderSpinner,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransition(isTransferring);\n\n  const shouldRenderCross = shouldRenderSpinner && (isLoadingForPlaying || isUploading);\n\n  const handleButtonClick = useCallback(() => {\n    if (isUploading) {\n      onCancelUpload?.();\n      return;\n    }\n\n    if (!isPlaying) {\n      onPlay(message.id, message.chatId);\n    }\n\n    getDispatch().setAudioPlayerOrigin({ origin });\n    setIsActivated(!isActivated);\n    playPause();\n  }, [isUploading, isPlaying, isActivated, playPause, onCancelUpload, onPlay, message.id, message.chatId, origin]);\n\n  useEffect(() => {\n    if (onReadMedia && isMediaUnread && (isPlaying || isDownloading)) {\n      onReadMedia();\n    }\n  }, [isPlaying, isMediaUnread, onReadMedia, isDownloading]);\n\n  const handleDownloadClick = useCallback(() => {\n    if (isDownloading) {\n      dispatch.cancelMessageMediaDownload({ message });\n    } else {\n      dispatch.downloadMessageMedia({ message });\n    }\n  }, [dispatch, isDownloading, message]);\n\n  const handleSeek = useCallback((e: MouseEvent | TouchEvent) => {\n    if (isSeeking.current && seekerRef.current) {\n      const { width, left } = seekerRef.current.getBoundingClientRect();\n      const clientX = e instanceof MouseEvent ? e.clientX : e.targetTouches[0].clientX;\n      e.stopPropagation(); // Prevent Slide-to-Reply activation\n      // Prevent track skipping while seeking near end\n      setCurrentTime(Math.max(Math.min(duration * ((clientX - left) / width), duration - 0.1), 0.001));\n    }\n  }, [duration, setCurrentTime]);\n\n  const handleStartSeek = useCallback((e: MouseEvent | TouchEvent) => {\n    if (e instanceof MouseEvent && e.button === 2) return;\n    isSeeking.current = true;\n    playStateBeforeSeeking.current = isPlaying;\n    pause();\n    handleSeek(e);\n  }, [handleSeek, pause, isPlaying]);\n\n  const handleStopSeek = useCallback(() => {\n    isSeeking.current = false;\n    if (playStateBeforeSeeking.current) play();\n  }, [play]);\n\n  const handleDateClick = useCallback(() => {\n    onDateClick!(message.id, message.chatId);\n  }, [onDateClick, message.id, message.chatId]);\n\n  useEffect(() => {\n    if (!seekerRef.current || !withSeekline) return undefined;\n    return captureEvents(seekerRef.current, {\n      onCapture: handleStartSeek,\n      onRelease: handleStopSeek,\n      onClick: handleStopSeek,\n      onDrag: handleSeek,\n    });\n  }, [withSeekline, handleStartSeek, handleSeek, handleStopSeek]);\n\n  function renderFirstLine() {\n    if (isVoice) {\n      return senderTitle || 'Voice';\n    }\n\n    const { title, fileName } = audio!;\n\n    return title || fileName;\n  }\n\n  function renderSecondLine() {\n    if (isVoice) {\n      return (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          {formatMediaDuration((voice || video)!.duration)}\n        </div>\n      );\n    }\n\n    const { performer } = audio!;\n\n    return (\n      <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n        {formatMediaDuration(duration)}\n        <span className=\"bullet\">&bull;</span>\n        {performer && <span className=\"performer\" title={performer}>{renderText(performer)}</span>}\n        {performer && senderTitle && <span className=\"bullet\">&bull;</span>}\n        {senderTitle && <span title={senderTitle}>{renderText(senderTitle)}</span>}\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'Audio',\n    className,\n    isOwn && origin === AudioOrigin.Inline && 'own',\n    (origin === AudioOrigin.Search || origin === AudioOrigin.SharedMedia) && 'bigger',\n    isSelected && 'audio-is-selected',\n  );\n\n  const buttonClassNames = ['toggle-play'];\n  if (shouldRenderCross) {\n    buttonClassNames.push('loading');\n  } else if (isPlaying) {\n    buttonClassNames.push('pause');\n  } else if (!isPlaying) {\n    buttonClassNames.push('play');\n  }\n\n  const contentClassName = buildClassName('content', withSeekline && 'with-seekline');\n\n  function renderWithTitle() {\n    return (\n      <>\n        <div className={contentClassName}>\n          <div className=\"content-row\">\n            <p className=\"title\" dir=\"auto\" title={renderFirstLine()}>{renderText(renderFirstLine())}</p>\n\n            <div className=\"message-date\">\n              {date && (\n                <Link\n                  className=\"date\"\n                  onClick={handleDateClick}\n                >\n                  {formatPastTimeShort(lang, date * 1000)}\n                </Link>\n              )}\n            </div>\n          </div>\n\n          {withSeekline && (\n            <div className=\"meta search-result\" dir={isRtl ? 'rtl' : undefined}>\n              <span className=\"duration with-seekline\" dir=\"auto\">\n                {playProgress < 1 && `${formatMediaDuration(duration * playProgress, duration)}`}\n              </span>\n              {renderSeekline(playProgress, bufferedProgress, seekerRef)}\n            </div>\n          )}\n          {!withSeekline && renderSecondLine()}\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <div className={fullClassName} dir={lang.isRtl ? 'rtl' : 'ltr'}>\n      {isSelectable && (\n        <div className=\"message-select-control\">\n          {isSelected && <i className=\"icon-select\" />}\n        </div>\n      )}\n      <Button\n        round\n        ripple={!IS_SINGLE_COLUMN_LAYOUT}\n        size=\"smaller\"\n        color={coverBlobUrl ? 'translucent-white' : 'primary'}\n        className={buttonClassNames.join(' ')}\n        ariaLabel={isPlaying ? 'Pause audio' : 'Play audio'}\n        onClick={handleButtonClick}\n        isRtl={lang.isRtl}\n        backgroundImage={coverBlobUrl}\n      >\n        <i className=\"icon-play\" />\n        <i className=\"icon-pause\" />\n      </Button>\n      {shouldRenderSpinner && (\n        <div className={buildClassName('media-loading', spinnerClassNames, shouldRenderCross && 'interactive')}>\n          <ProgressSpinner\n            progress={transferProgress}\n            transparent\n            size=\"m\"\n            onClick={shouldRenderCross ? handleButtonClick : undefined}\n            noCross={!shouldRenderCross}\n          />\n        </div>\n      )}\n      {audio && !isUploading && (\n        <Button\n          round\n          size=\"tiny\"\n          className=\"download-button\"\n          ariaLabel={isDownloading ? 'Cancel download' : 'Download'}\n          onClick={handleDownloadClick}\n        >\n          <i className={isDownloading ? 'icon-close' : 'icon-arrow-down'} />\n        </Button>\n      )}\n      {origin === AudioOrigin.Search && renderWithTitle()}\n      {origin !== AudioOrigin.Search && audio && renderAudio(\n        lang, audio, duration, isPlaying, playProgress, bufferedProgress, seekerRef,\n        (isDownloading || isUploading), date, transferProgress, onDateClick ? handleDateClick : undefined,\n      )}\n      {origin === AudioOrigin.SharedMedia && (voice || video) && renderWithTitle()}\n      {origin === AudioOrigin.Inline && voice && (\n        renderVoice(voice, seekerRef, waveformCanvasRef, playProgress, isMediaUnread)\n      )}\n    </div>\n  );\n};\n\nfunction renderAudio(\n  lang: LangFn,\n  audio: ApiAudio,\n  duration: number,\n  isPlaying: boolean,\n  playProgress: number,\n  bufferedProgress: number,\n  seekerRef: React.Ref<HTMLElement>,\n  showProgress?: boolean,\n  date?: number,\n  progress?: number,\n  handleDateClick?: NoneToVoidFunction,\n) {\n  const {\n    title, performer, fileName,\n  } = audio;\n  const showSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n  const { isRtl } = getTranslation;\n\n  return (\n    <div className=\"content\">\n      <p className=\"title\" dir=\"auto\" title={title}>{renderText(title || fileName)}</p>\n      {showSeekline && (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          <span className=\"duration with-seekline\" dir=\"auto\">\n            {formatMediaDuration(duration * playProgress, duration)}\n          </span>\n          {renderSeekline(playProgress, bufferedProgress, seekerRef)}\n        </div>\n      )}\n      {!showSeekline && showProgress && (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          {progress ? `${getFileSizeString(audio!.size * progress)} / ` : undefined}{getFileSizeString(audio!.size)}\n        </div>\n      )}\n      {!showSeekline && !showProgress && (\n        <div className=\"meta\" dir={isRtl ? 'rtl' : undefined}>\n          <span className=\"duration\" dir=\"auto\">{formatMediaDuration(duration)}</span>\n          <span className=\"bullet\">&bull;</span>\n          <span className=\"performer\" dir=\"auto\" title={performer}>{renderText(performer || 'Unknown')}</span>\n          {date && (\n            <>\n              <span className=\"bullet\">&bull;</span>\n              <Link className=\"date\" onClick={handleDateClick}>\n                {formatMediaDateTime(lang, date * 1000, true)}\n              </Link>\n            </>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction renderVoice(\n  voice: ApiVoice,\n  seekerRef: React.Ref<HTMLDivElement>,\n  waveformCanvasRef: React.Ref<HTMLCanvasElement>,\n  playProgress: number,\n  isMediaUnread?: boolean,\n) {\n  return (\n    <div className=\"content\">\n      <div\n        className=\"waveform\"\n        draggable={false}\n        ref={seekerRef}\n      >\n        <canvas ref={waveformCanvasRef} />\n      </div>\n      <p className={buildClassName('voice-duration', isMediaUnread && 'unread')} dir=\"auto\">\n        {playProgress === 0 ? formatMediaDuration(voice.duration) : formatMediaDuration(voice.duration * playProgress)}\n      </p>\n    </div>\n  );\n}\n\nfunction useWaveformCanvas(\n  theme: ISettings['theme'],\n  voice?: ApiVoice,\n  playProgress = 0,\n  isOwn = false,\n) {\n  // eslint-disable-next-line no-null/no-null\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  const { data: spikes, peak } = useMemo(() => {\n    if (!voice) {\n      return undefined;\n    }\n\n    const { waveform, duration } = voice;\n    if (!waveform) {\n      return {\n        data: new Array(Math.min(duration, MAX_EMPTY_WAVEFORM_POINTS)).fill(0),\n        peak: 0,\n      };\n    }\n\n    const durationFactor = Math.min(duration / AVG_VOICE_DURATION, 1);\n    const spikesCount = Math.round(MIN_SPIKES + (MAX_SPIKES - MIN_SPIKES) * durationFactor);\n    const decodedWaveform = decodeWaveform(new Uint8Array(waveform));\n\n    return interpolateArray(decodedWaveform, spikesCount);\n  }, [voice]) || {};\n\n  useLayoutEffect(() => {\n    const canvas = canvasRef.current;\n\n    if (!canvas || !spikes || peak === undefined) {\n      return;\n    }\n\n    const fillColor = theme === 'dark' ? '#494A78' : '#ADD3F7';\n    const fillOwnColor = theme === 'dark' ? '#B7ABED' : '#AEDFA4';\n    const progressFillColor = theme === 'dark' ? '#8774E1' : '#3390EC';\n    const progressFillOwnColor = theme === 'dark' ? '#FFFFFF' : '#4FAE4E';\n\n    renderWaveform(canvas, spikes, playProgress, {\n      peak,\n      fillStyle: isOwn ? fillOwnColor : fillColor,\n      progressFillStyle: isOwn ? progressFillOwnColor : progressFillColor,\n    });\n  }, [isOwn, peak, playProgress, spikes, theme]);\n\n  return canvasRef;\n}\n\nfunction renderSeekline(\n  playProgress: number,\n  bufferedProgress: number,\n  seekerRef: React.Ref<HTMLElement>,\n) {\n  return (\n    <div\n      className=\"seekline no-selection\"\n      ref={seekerRef as React.Ref<HTMLDivElement>}\n    >\n      <span className=\"seekline-buffered-progress\">\n        <i\n          // @ts-ignore\n          style={`transform: translateX(${bufferedProgress * 100}%)`}\n        />\n      </span>\n      <span className=\"seekline-play-progress\">\n        <i\n          // @ts-ignore\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n      <span className=\"seekline-thumb\">\n        <i\n          // @ts-ignore\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n    </div>\n  );\n}\n\nexport default memo(Audio);\n","type IWaveformProps = {\n  peak: number;\n  fillStyle: string;\n  progressFillStyle: string;\n};\n\nexport const MAX_EMPTY_WAVEFORM_POINTS = 30;\nconst SPIKE_WIDTH = 2;\nconst SPIKE_STEP = 4;\nconst SPIKE_RADIUS = 1;\nconst HEIGHT = 23;\n\nexport function renderWaveform(\n  canvas: HTMLCanvasElement,\n  spikes: number[],\n  progress: number,\n  {\n    peak, fillStyle, progressFillStyle,\n  }: IWaveformProps,\n) {\n  const width = spikes.length * SPIKE_STEP;\n  const height = HEIGHT;\n\n  canvas.width = width * 2;\n  canvas.height = height * 2;\n  canvas.style.width = `${width}px`;\n  canvas.style.height = `${height}px`;\n\n  const ctx = canvas.getContext('2d')!;\n  ctx.scale(2, 2);\n\n  spikes.forEach((item, i) => {\n    ctx.globalAlpha = (i / spikes.length >= progress) ? 0.5 : 1;\n    ctx.fillStyle = progress > i / spikes.length ? progressFillStyle : fillStyle;\n    const spikeHeight = Math.max(2, HEIGHT * (item / Math.max(1, peak)));\n    roundedRectangle(ctx, i * SPIKE_STEP, height, SPIKE_WIDTH, spikeHeight, SPIKE_RADIUS);\n    ctx.fill();\n  });\n}\n\nfunction roundedRectangle(\n  ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number,\n) {\n  if (width < 2 * radius) {\n    radius = width / 2;\n  }\n  if (height < 2 * radius) {\n    radius = height / 2;\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + radius, y);\n  ctx.arcTo(x + width, y, x + width, y - height, radius);\n  ctx.arcTo(x + width, y - height, x, y - height, radius);\n  ctx.arcTo(x, y - height, x, y, radius);\n  ctx.arcTo(x, y, x + width, y, radius);\n  ctx.closePath();\n}\n","/* eslint-disable no-bitwise */\n\n// eslint-disable-next-line max-len\n// Ref: https://github.com/telegramdesktop/tdesktop/blob/0743e71ab6b928d2ee5bae1aed991849b1e2b291/Telegram/SourceFiles/data/data_document.cpp#L1018\nexport function decodeWaveform(encoded5bit: Uint8Array) {\n  const bitsCount = encoded5bit.length * 8;\n  const valuesCount = Math.floor(bitsCount / 5);\n  if (!valuesCount) {\n    return [];\n  }\n\n  // Read each 5 bit of encoded5bit as 0-31 unsigned char.\n  // We count the index of the byte in which the desired 5-bit sequence starts.\n  // And then we read a uint16 starting from that byte to guarantee to get all of those 5 bits.\n  //\n  // BUT! if it is the last byte we have, we're not allowed to read a uint16 starting with it.\n  // Because it will be an overflow (we'll access one byte after the available memory).\n  // We see, that only the last 5 bits could start in the last available byte and be problematic.\n  // So we read in a general way all the entries in a general way except the last one.\n  const result = Array(valuesCount);\n  const bitsData = encoded5bit;\n  for (let i = 0, l = valuesCount - 1; i !== l; ++i) {\n    const byteIndex = Math.floor((i * 5) / 8);\n    const bitShift = Math.floor((i * 5) % 8);\n    const value = bitsData[byteIndex] + (bitsData[byteIndex + 1] << 8);\n    result[i] = ((value >> bitShift) & 0x1F);\n  }\n  const lastByteIndex = Math.floor(((valuesCount - 1) * 5) / 8);\n  const lastBitShift = Math.floor(((valuesCount - 1) * 5) % 8);\n  const lastValue = bitsData[lastByteIndex] + (bitsData[lastByteIndex + 1] << 8);\n  result[valuesCount - 1] = (lastValue >> lastBitShift) & 0x1F;\n\n  return result;\n}\n\nexport function interpolateArray(data: number[], fitCount: number) {\n  let peak = 0;\n  const newData = new Array(fitCount);\n  const springFactor = data.length / fitCount;\n  const leftFiller = data[0];\n  const rightFiller = data[data.length - 1];\n  for (let i = 0; i < fitCount; i++) {\n    const idx = Math.floor(i * springFactor);\n    const val = ((data[idx - 1] ?? leftFiller) + (data[idx] ?? leftFiller) + (data[idx + 1] ?? rightFiller)) / 3;\n    newData[i] = val;\n    if (peak < val) {\n      peak = val;\n    }\n  }\n  return { data: newData, peak };\n}\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { OwnProps } from './CalendarModal';\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst CalendarModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const CalendarModal = useModuleLoader(Bundles.Extra, 'CalendarModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return CalendarModal ? <CalendarModal {...props} /> : undefined;\n};\n\nexport default memo(CalendarModalAsync);\n","import React, {\n  FC, memo, useCallback, useEffect,\n} from '../../lib/teact/teact';\nimport { getDispatch, withGlobal } from '../../lib/teact/teactn';\n\nimport { GlobalState } from '../../global/types';\nimport { ApiChat, ApiCountryCode, ApiUser } from '../../api/types';\n\nimport {\n  selectChat, selectNotifyExceptions, selectNotifySettings, selectUser,\n} from '../../modules/selectors';\nimport {\n  getChatDescription, getChatLink, getHasAdminRight, isChatChannel, isUserId, isUserRightBanned, selectIsChatMuted,\n} from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport { copyTextToClipboard } from '../../util/clipboard';\nimport { formatPhoneNumberWithCode } from '../../util/phoneNumber';\nimport useLang from '../../hooks/useLang';\n\nimport ListItem from '../ui/ListItem';\nimport Switcher from '../ui/Switcher';\n\ntype OwnProps = {\n  chatOrUserId: string;\n  forceShowSelf?: boolean;\n};\n\ntype StateProps =\n  {\n    user?: ApiUser;\n    chat?: ApiChat;\n    canInviteUsers?: boolean;\n    isMuted?: boolean;\n    phoneCodeList: ApiCountryCode[];\n  }\n  & Pick<GlobalState, 'lastSyncTime'>;\n\nconst ChatExtra: FC<OwnProps & StateProps> = ({\n  lastSyncTime,\n  user,\n  chat,\n  forceShowSelf,\n  canInviteUsers,\n  isMuted,\n  phoneCodeList,\n}) => {\n  const {\n    loadFullUser,\n    showNotification,\n    updateChatMutedState,\n  } = getDispatch();\n\n  const {\n    id: userId,\n    fullInfo,\n    username,\n    phoneNumber,\n    isSelf,\n  } = user || {};\n  const { id: chatId } = chat || {};\n  const lang = useLang();\n\n  useEffect(() => {\n    if (lastSyncTime && userId) {\n      loadFullUser({ userId });\n    }\n  }, [loadFullUser, userId, lastSyncTime]);\n\n  const handleNotificationChange = useCallback(() => {\n    updateChatMutedState({ chatId, isMuted: !isMuted });\n  }, [chatId, isMuted, updateChatMutedState]);\n\n  if (!chat || chat.isRestricted || (isSelf && !forceShowSelf)) {\n    return undefined;\n  }\n\n  function copy(text: string, entity: string) {\n    copyTextToClipboard(text);\n    showNotification({ message: `${entity} was copied` });\n  }\n\n  const formattedNumber = phoneNumber && formatPhoneNumberWithCode(phoneCodeList, phoneNumber);\n  const link = getChatLink(chat);\n  const description = (fullInfo?.bio) || getChatDescription(chat);\n\n  return (\n    <div className=\"ChatExtra\">\n      {formattedNumber && !!formattedNumber.length && (\n        <ListItem icon=\"phone\" multiline narrow ripple onClick={() => copy(formattedNumber, lang('Phone'))}>\n          <span className=\"title\" dir=\"auto\">{formattedNumber}</span>\n          <span className=\"subtitle\">{lang('Phone')}</span>\n        </ListItem>\n      )}\n      {username && (\n        <ListItem\n          icon=\"mention\"\n          multiline\n          narrow\n          ripple\n          onClick={() => copy(`@${username}`, lang('Username'))}\n        >\n          <span className=\"title\" dir=\"auto\">{renderText(username)}</span>\n          <span className=\"subtitle\">{lang('Username')}</span>\n        </ListItem>\n      )}\n      {description && !!description.length && (\n        <ListItem\n          icon=\"info\"\n          multiline\n          narrow\n          isStatic\n        >\n          <span className=\"title\" dir=\"auto\">\n            {renderText(description, ['br', 'links', 'emoji'])}\n          </span>\n          <span className=\"subtitle\">{lang(userId ? 'UserBio' : 'Info')}</span>\n        </ListItem>\n      )}\n      {(canInviteUsers || !username) && link && (\n        <ListItem\n          icon={chat.username ? 'mention' : 'link'}\n          multiline\n          narrow\n          ripple\n          onClick={() => copy(link, lang('SetUrlPlaceholder'))}\n        >\n          <div className=\"title\">{link}</div>\n          <span className=\"subtitle\">{lang('SetUrlPlaceholder')}</span>\n        </ListItem>\n      )}\n      {!forceShowSelf && (\n        <ListItem icon=\"unmute\" ripple onClick={handleNotificationChange}>\n          <span>{lang('Notifications')}</span>\n          <Switcher\n            id=\"group-notifications\"\n            label={userId ? 'Toggle User Notifications' : 'Toggle Chat Notifications'}\n            checked={!isMuted}\n            inactive\n          />\n        </ListItem>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatOrUserId }): StateProps => {\n    const { lastSyncTime, countryList: { phoneCodes: phoneCodeList } } = global;\n\n    const chat = chatOrUserId ? selectChat(global, chatOrUserId) : undefined;\n    const user = isUserId(chatOrUserId) ? selectUser(global, chatOrUserId) : undefined;\n    const isMuted = chat && selectIsChatMuted(chat, selectNotifySettings(global), selectNotifyExceptions(global));\n\n    const canInviteUsers = chat && !user && (\n      (!isChatChannel(chat) && !isUserRightBanned(chat, 'inviteUsers'))\n      || getHasAdminRight(chat, 'inviteUsers')\n    );\n\n    return {\n      lastSyncTime, phoneCodeList, chat, user, canInviteUsers, isMuted,\n    };\n  },\n)(ChatExtra));\n","import React, { FC, useCallback, memo } from '../../lib/teact/teact';\nimport { getDispatch, withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiChat } from '../../api/types';\n\nimport { selectIsChatWithSelf, selectUser } from '../../modules/selectors';\nimport {\n  isUserId,\n  isUserBot,\n  getUserFirstOrLastName,\n  getPrivateChatUserId,\n  isChatBasicGroup,\n  isChatSuperGroup,\n  isChatChannel,\n  getChatTitle,\n} from '../../modules/helpers';\nimport useLang from '../../hooks/useLang';\nimport renderText from './helpers/renderText';\n\nimport Avatar from './Avatar';\nimport Modal from '../ui/Modal';\nimport Button from '../ui/Button';\n\nimport './DeleteChatModal.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  chat: ApiChat;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n};\n\ntype StateProps = {\n  isChannel: boolean;\n  isChatWithSelf?: boolean;\n  isBot?: boolean;\n  isPrivateChat: boolean;\n  isBasicGroup: boolean;\n  isSuperGroup: boolean;\n  currentUserId: string | undefined;\n  canDeleteForAll?: boolean;\n  contactName?: string;\n};\n\nconst DeleteChatModal: FC<OwnProps & StateProps> = ({\n  isOpen,\n  chat,\n  isChannel,\n  isPrivateChat,\n  isChatWithSelf,\n  isBot,\n  isBasicGroup,\n  isSuperGroup,\n  currentUserId,\n  canDeleteForAll,\n  contactName,\n  onClose,\n  onCloseAnimationEnd,\n}) => {\n  const {\n    leaveChannel,\n    deleteHistory,\n    deleteChannel,\n    deleteChatUser,\n    blockContact,\n  } = getDispatch();\n\n  const lang = useLang();\n  const chatTitle = getChatTitle(lang, chat);\n\n  const handleDeleteMessageForAll = useCallback(() => {\n    deleteHistory({ chatId: chat.id, shouldDeleteForAll: true });\n\n    onClose();\n  }, [deleteHistory, chat.id, onClose]);\n\n  const handleDeleteAndStop = useCallback(() => {\n    deleteHistory({ chatId: chat.id, shouldDeleteForAll: true });\n    blockContact({ contactId: chat.id, accessHash: chat.accessHash });\n\n    onClose();\n  }, [deleteHistory, chat.id, chat.accessHash, blockContact, onClose]);\n\n  const handleDeleteChat = useCallback(() => {\n    if (isPrivateChat) {\n      deleteHistory({ chatId: chat.id, shouldDeleteForAll: false });\n    } else if (isBasicGroup) {\n      deleteChatUser({ chatId: chat.id, userId: currentUserId });\n      deleteHistory({ chatId: chat.id, shouldDeleteForAll: false });\n    } else if ((isChannel || isSuperGroup) && !chat.isCreator) {\n      leaveChannel({ chatId: chat.id });\n    } else if ((isChannel || isSuperGroup) && chat.isCreator) {\n      deleteChannel({ chatId: chat.id });\n    }\n    onClose();\n  }, [\n    isPrivateChat,\n    isBasicGroup,\n    isChannel,\n    isSuperGroup,\n    currentUserId,\n    chat.isCreator,\n    chat.id,\n    onClose,\n    deleteHistory,\n    deleteChatUser,\n    leaveChannel,\n    deleteChannel,\n  ]);\n\n  function renderHeader() {\n    return (\n      <div className=\"modal-header\" dir={lang.isRtl ? 'rtl' : undefined}>\n        <Avatar\n          size=\"tiny\"\n          chat={chat}\n          isSavedMessages={isChatWithSelf}\n        />\n        <h3 className=\"modal-title\">{lang(renderTitle())}</h3>\n      </div>\n    );\n  }\n\n  function renderTitle() {\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n\n    if (isChannel && chat.isCreator) {\n      return 'ChannelDelete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return 'DeleteChatUser';\n  }\n\n  function renderMessage() {\n    if (isChannel && chat.isCreator) {\n      return <p>{renderText(lang('ChatList.DeleteAndLeaveGroupConfirmation', chatTitle), ['simple_markdown'])}</p>;\n    }\n\n    if ((isChannel && !chat.isCreator) || isBasicGroup || isSuperGroup) {\n      return <p>{renderText(lang('ChannelLeaveAlertWithName', chatTitle), ['simple_markdown'])}</p>;\n    }\n\n    return <p>{renderText(lang('ChatList.DeleteChatConfirmation', contactName), ['simple_markdown'])}</p>;\n  }\n\n  function renderActionText() {\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n    if (isChannel && chat.isCreator) {\n      return 'Chat.Input.Delete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return canDeleteForAll ? 'ChatList.DeleteForCurrentUser' : 'Delete';\n  }\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      className=\"DeleteChatModal\"\n      header={renderHeader()}\n      onClose={onClose}\n      onCloseAnimationEnd={onCloseAnimationEnd}\n    >\n      {renderMessage()}\n      {isBot && (\n        <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteAndStop}>\n          {lang('DeleteAndStop')}\n        </Button>\n      )}\n      {canDeleteForAll && (\n        <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteMessageForAll}>\n          {contactName ? renderText(lang('ChatList.DeleteForEveryone', contactName)) : lang('DeleteForAll')}\n        </Button>\n      )}\n      <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteChat}>\n        {lang(renderActionText())}\n      </Button>\n      <Button className=\"confirm-dialog-button\" isText onClick={onClose}>{lang('Cancel')}</Button>\n    </Modal>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chat }): StateProps => {\n    const isPrivateChat = isUserId(chat.id);\n    const isChatWithSelf = selectIsChatWithSelf(global, chat.id);\n    const user = isPrivateChat && selectUser(global, getPrivateChatUserId(chat)!);\n    const isBot = user && isUserBot(user) && !chat.isSupport;\n    const canDeleteForAll = (isPrivateChat && !isChatWithSelf && !isBot);\n    const contactName = isPrivateChat\n      ? getUserFirstOrLastName(selectUser(global, getPrivateChatUserId(chat)!))\n      : undefined;\n\n    return {\n      isPrivateChat,\n      isChatWithSelf,\n      isBot,\n      isChannel: isChatChannel(chat),\n      isBasicGroup: isChatBasicGroup(chat),\n      isSuperGroup: isChatSuperGroup(chat),\n      currentUserId: global.currentUserId,\n      canDeleteForAll,\n      contactName,\n    };\n  },\n)(DeleteChatModal));\n","import React, {\n  FC, useCallback, memo, useRef, useEffect, useState,\n} from '../../lib/teact/teact';\nimport { getDispatch } from '../../lib/teact/teactn';\n\nimport { ApiMessage } from '../../api/types';\n\nimport { getDocumentExtension, getDocumentHasPreview } from './helpers/documentInfo';\nimport {\n  getMediaTransferState,\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  isMessageDocumentVideo,\n} from '../../modules/helpers';\nimport { ObserveFn, useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMediaWithLoadProgress from '../../hooks/useMediaWithLoadProgress';\nimport useMedia from '../../hooks/useMedia';\nimport useFlag from '../../hooks/useFlag';\n\nimport File from './File';\n\ntype OwnProps = {\n  message: ApiMessage;\n  observeIntersection?: ObserveFn;\n  smaller?: boolean;\n  isSelected?: boolean;\n  isSelectable?: boolean;\n  canAutoLoad?: boolean;\n  uploadProgress?: number;\n  withDate?: boolean;\n  datetime?: number;\n  className?: string;\n  sender?: string;\n  autoLoadFileMaxSizeMb?: number;\n  isDownloading: boolean;\n  onCancelUpload?: () => void;\n  onMediaClick?: () => void;\n  onDateClick?: (messageId: number, chatId: string) => void;\n};\n\nconst BYTES_PER_MB = 1024 * 1024;\n\nconst Document: FC<OwnProps> = ({\n  message,\n  observeIntersection,\n  smaller,\n  canAutoLoad,\n  autoLoadFileMaxSizeMb,\n  uploadProgress,\n  withDate,\n  datetime,\n  className,\n  sender,\n  isSelected,\n  isSelectable,\n  onCancelUpload,\n  onMediaClick,\n  onDateClick,\n  isDownloading,\n}) => {\n  const dispatch = getDispatch();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const document = message.content.document!;\n  const { fileName, size, timestamp } = document;\n  const extension = getDocumentExtension(document) || '';\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n  const [wasIntersected, markIntersected] = useFlag();\n  useEffect(() => {\n    if (isIntersecting) {\n      markIntersected();\n    }\n  }, [isIntersecting, markIntersected]);\n\n  // Auto-loading does not use global download manager because requires additional click to save files locally\n  const [isLoadAllowed, setIsLoadAllowed] = useState(\n    canAutoLoad && (!autoLoadFileMaxSizeMb || size <= autoLoadFileMaxSizeMb * BYTES_PER_MB),\n  );\n\n  const shouldDownload = Boolean(isDownloading || (isLoadAllowed && wasIntersected));\n\n  const documentHash = getMessageMediaHash(message, 'download');\n  const { loadProgress: downloadProgress, mediaData } = useMediaWithLoadProgress(\n    documentHash, !shouldDownload, undefined, undefined, undefined, true,\n  );\n  const isLoaded = Boolean(mediaData);\n\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(message, uploadProgress || downloadProgress, shouldDownload && !isLoaded);\n\n  const hasPreview = getDocumentHasPreview(document);\n  const thumbDataUri = hasPreview ? getMessageMediaThumbDataUri(message) : undefined;\n  const localBlobUrl = hasPreview ? document.previewBlobUrl : undefined;\n  const previewData = useMedia(getMessageMediaHash(message, 'pictogram'), !isIntersecting);\n\n  const withMediaViewer = onMediaClick && Boolean(document.mediaType);\n\n  const handleClick = useCallback(() => {\n    if (isUploading) {\n      if (onCancelUpload) {\n        onCancelUpload();\n      }\n      return;\n    }\n\n    if (isDownloading) {\n      dispatch.cancelMessageMediaDownload({ message });\n      return;\n    }\n\n    if (isTransferring) {\n      setIsLoadAllowed(false);\n      return;\n    }\n\n    if (withMediaViewer) {\n      onMediaClick!();\n    } else {\n      dispatch.downloadMessageMedia({ message });\n    }\n  }, [\n    isUploading, isDownloading, isTransferring, withMediaViewer, onCancelUpload, dispatch, message, onMediaClick,\n  ]);\n\n  const handleDateClick = useCallback(() => {\n    onDateClick!(message.id, message.chatId);\n  }, [onDateClick, message.id, message.chatId]);\n\n  return (\n    <File\n      ref={ref}\n      name={fileName}\n      extension={extension}\n      size={size}\n      timestamp={withDate ? datetime || timestamp : undefined}\n      thumbnailDataUri={thumbDataUri}\n      previewData={localBlobUrl || previewData}\n      smaller={smaller}\n      isTransferring={isTransferring}\n      isUploading={isUploading}\n      transferProgress={transferProgress}\n      className={className}\n      sender={sender}\n      isSelectable={isSelectable}\n      isSelected={isSelected}\n      actionIcon={withMediaViewer ? (isMessageDocumentVideo(message) ? 'icon-play' : 'icon-eye') : 'icon-download'}\n      onClick={handleClick}\n      onDateClick={onDateClick ? handleDateClick : undefined}\n    />\n  );\n};\n\nexport default memo(Document);\n","import { RefObject } from 'react';\nimport React, { FC, memo, useRef } from '../../lib/teact/teact';\n\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useMediaTransition from '../../hooks/useMediaTransition';\nimport buildClassName from '../../util/buildClassName';\nimport { formatMediaDateTime, formatPastTimeShort } from '../../util/dateFormat';\nimport { getColorFromExtension, getFileSizeString } from './helpers/documentInfo';\nimport { getDocumentThumbnailDimensions } from './helpers/mediaDimensions';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport Link from '../ui/Link';\n\nimport './File.scss';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  name: string;\n  extension?: string;\n  size: number;\n  timestamp?: number;\n  sender?: string;\n  thumbnailDataUri?: string;\n  previewData?: string;\n  className?: string;\n  smaller?: boolean;\n  isTransferring?: boolean;\n  isUploading?: boolean;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  transferProgress?: number;\n  actionIcon?: string;\n  onClick?: () => void;\n  onDateClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n};\n\nconst File: FC<OwnProps> = ({\n  ref,\n  name,\n  size,\n  extension = '',\n  timestamp,\n  sender,\n  thumbnailDataUri,\n  previewData,\n  className,\n  smaller,\n  isTransferring,\n  isUploading,\n  isSelectable,\n  isSelected,\n  transferProgress,\n  actionIcon,\n  onClick,\n  onDateClick,\n}) => {\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  let elementRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    elementRef = ref;\n  }\n\n  const transitionClassNames = useMediaTransition(previewData);\n  const {\n    shouldRender: shouldSpinnerRender,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransition(isTransferring, undefined, true);\n\n  const color = getColorFromExtension(extension);\n  const sizeString = getFileSizeString(size);\n\n  const { width, height } = getDocumentThumbnailDimensions(smaller);\n\n  const fullClassName = buildClassName(\n    'File',\n    className,\n    smaller && 'smaller',\n    onClick && !isUploading && 'interactive',\n    isSelected && 'file-is-selected',\n  );\n\n  return (\n    <div ref={elementRef} className={fullClassName} dir={lang.isRtl ? 'rtl' : undefined}>\n      {isSelectable && (\n        <div className=\"message-select-control\">\n          {isSelected && <i className=\"icon-select\" />}\n        </div>\n      )}\n      <div className=\"file-icon-container\" onClick={isUploading ? undefined : onClick}>\n        {thumbnailDataUri || previewData ? (\n          <div className=\"file-preview media-inner\">\n            <img\n              src={thumbnailDataUri}\n              width={width}\n              height={height}\n              className=\"thumbnail\"\n              alt=\"\"\n            />\n            <img\n              src={previewData}\n              className={buildClassName('full-media', transitionClassNames)}\n              width={width}\n              height={height}\n              alt=\"\"\n            />\n          </div>\n        ) : (\n          <div className={`file-icon ${color}`}>\n            {extension.length <= 4 && (\n              <span className=\"file-ext\" dir=\"auto\">{extension}</span>\n            )}\n          </div>\n        )}\n        {shouldSpinnerRender && (\n          <div className={buildClassName('file-progress', color, spinnerClassNames)}>\n            <ProgressSpinner\n              progress={transferProgress}\n              size={smaller ? 's' : 'm'}\n              onClick={isUploading ? onClick : undefined}\n            />\n          </div>\n        )}\n        {onClick && (\n          <i\n            className={buildClassName(\n              'action-icon',\n              actionIcon || 'icon-download',\n              shouldSpinnerRender && 'hidden',\n            )}\n          />\n        )}\n      </div>\n      <div className=\"file-info\">\n        <div className=\"file-title\" dir=\"auto\">{renderText(name)}</div>\n        <div className=\"file-subtitle\" dir=\"auto\">\n          <span>\n            {isTransferring && transferProgress ? `${Math.round(transferProgress * 100)}%` : sizeString}\n          </span>\n          {sender && <span className=\"file-sender\">{renderText(sender)}</span>}\n          {!sender && timestamp && (\n            <>\n              <span className=\"bullet\" />\n              <Link onClick={onDateClick}>{formatMediaDateTime(lang, timestamp * 1000, true)}</Link>\n            </>\n          )}\n        </div>\n      </div>\n      {sender && timestamp && (\n        <Link onClick={onDateClick}>{formatPastTimeShort(lang, timestamp * 1000)}</Link>\n      )}\n    </div>\n  );\n};\n\nexport default memo(File);\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, {\n  FC, useEffect, useCallback, memo,\n} from '../../lib/teact/teact';\nimport { getDispatch, withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiChat, ApiTypingStatus } from '../../api/types';\nimport { GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport {\n  getChatTypeString,\n  getChatTitle,\n  isChatSuperGroup,\n} from '../../modules/helpers';\nimport { selectChat, selectChatMessages, selectChatOnlineCount } from '../../modules/selectors';\nimport renderText from './helpers/renderText';\nimport useLang, { LangFn } from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\nimport VerifiedIcon from './VerifiedIcon';\nimport TypingStatus from './TypingStatus';\n\ntype OwnProps = {\n  chatId: string;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'small' | 'medium' | 'large' | 'jumbo';\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  withChatType?: boolean;\n  noRtl?: boolean;\n};\n\ntype StateProps =\n  {\n    chat?: ApiChat;\n    onlineCount?: number;\n    areMessagesLoaded: boolean;\n  }\n  & Pick<GlobalState, 'lastSyncTime'>;\n\nconst GroupChatInfo: FC<OwnProps & StateProps> = ({\n  typingStatus,\n  avatarSize = 'medium',\n  withMediaViewer,\n  withUsername,\n  withFullInfo,\n  withUpdatingStatus,\n  withChatType,\n  noRtl,\n  chat,\n  onlineCount,\n  areMessagesLoaded,\n  lastSyncTime,\n}) => {\n  const {\n    loadFullChat,\n    openMediaViewer,\n  } = getDispatch();\n\n  const isSuperGroup = chat && isChatSuperGroup(chat);\n  const { id: chatId, isMin, isRestricted } = chat || {};\n\n  useEffect(() => {\n    if (chatId && !isMin && withFullInfo && lastSyncTime) {\n      loadFullChat({ chatId });\n    }\n  }, [chatId, isMin, lastSyncTime, withFullInfo, loadFullChat, isSuperGroup]);\n\n  const handleAvatarViewerOpen = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasPhoto: boolean) => {\n    if (chat && hasPhoto) {\n      e.stopPropagation();\n      openMediaViewer({\n        avatarOwnerId: chat.id,\n        origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n      });\n    }\n  }, [chat, avatarSize, openMediaViewer]);\n\n  const lang = useLang();\n\n  if (!chat) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (withUpdatingStatus && !areMessagesLoaded && !isRestricted) {\n      return (\n        <span className=\"status\" dir=\"auto\">{lang('Updating')}</span>\n      );\n    }\n\n    if (!chat) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (withChatType) {\n      return (\n        <div className=\"status\" dir=\"auto\">{lang(getChatTypeString(chat))}</div>\n      );\n    }\n\n    const handle = withUsername ? chat.username : undefined;\n    const groupStatus = getGroupStatus(lang, chat);\n    const onlineStatus = onlineCount ? `, ${lang('OnlineCount', onlineCount, 'i')}` : undefined;\n\n    return (\n      <div className=\"status\">\n        {handle && <span className=\"handle\">{handle}</span>}\n        <span className=\"group-status\">{groupStatus}</span>\n        {onlineStatus && <span className=\"online-status\">{onlineStatus}</span>}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"ChatInfo\" dir={!noRtl && lang.isRtl ? 'rtl' : undefined}>\n      <Avatar\n        key={chat.id}\n        size={avatarSize}\n        chat={chat}\n        onClick={withMediaViewer ? handleAvatarViewerOpen : undefined}\n      />\n      <div className=\"info\">\n        <div className=\"title\">\n          <h3 dir=\"auto\">{renderText(getChatTitle(lang, chat))}</h3>\n          {chat.isVerified && <VerifiedIcon />}\n        </div>\n        {renderStatusOrTyping()}\n      </div>\n    </div>\n  );\n};\n\nfunction getGroupStatus(lang: LangFn, chat: ApiChat) {\n  const chatTypeString = lang(getChatTypeString(chat));\n  const { membersCount } = chat;\n\n  if (chat.isRestricted) {\n    return chatTypeString === 'Channel' ? 'channel is inaccessible' : 'group is inaccessible';\n  }\n\n  if (!membersCount) {\n    return chatTypeString;\n  }\n\n  return chatTypeString === 'Channel'\n    ? lang('Subscribers', membersCount, 'i')\n    : lang('Members', membersCount, 'i');\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId }): StateProps => {\n    const { lastSyncTime } = global;\n    const chat = selectChat(global, chatId);\n    const onlineCount = chat ? selectChatOnlineCount(global, chat) : undefined;\n    const areMessagesLoaded = Boolean(selectChatMessages(global, chatId));\n\n    return {\n      lastSyncTime, chat, onlineCount, areMessagesLoaded,\n    };\n  },\n)(GroupChatInfo));\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport { ApiMessage, ApiMessageOutgoingStatus } from '../../api/types';\n\nimport { formatPastTimeShort } from '../../util/dateFormat';\nimport useLang from '../../hooks/useLang';\n\nimport MessageOutgoingStatus from './MessageOutgoingStatus';\n\nimport './LastMessageMeta.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  outgoingStatus?: ApiMessageOutgoingStatus;\n};\n\nconst LastMessageMeta: FC<OwnProps> = ({ message, outgoingStatus }) => {\n  const lang = useLang();\n  return (\n    <div className=\"LastMessageMeta\">\n      {outgoingStatus && (\n        <MessageOutgoingStatus status={outgoingStatus} />\n      )}\n      <span className=\"time\">{formatPastTimeShort(lang, message.date * 1000)}</span>\n    </div>\n  );\n};\n\nexport default memo(LastMessageMeta);\n","import React, { FC, memo, useCallback } from '../../lib/teact/teact';\n\nimport { ApiMessage } from '../../api/types';\n\nimport { formatMediaDuration } from '../../util/dateFormat';\nimport stopEvent from '../../util/stopEvent';\nimport {\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  getMessageVideo,\n} from '../../modules/helpers';\nimport buildClassName from '../../util/buildClassName';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaTransition from '../../hooks/useMediaTransition';\n\nimport './Media.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  idPrefix?: string;\n  isProtected?: boolean;\n  onClick?: (messageId: number, chatId: string) => void;\n};\n\nconst Media: FC<OwnProps> = ({\n  message,\n  idPrefix = 'shared-media',\n  isProtected,\n  onClick,\n}) => {\n  const handleClick = useCallback(() => {\n    onClick!(message.id, message.chatId);\n  }, [message.id, message.chatId, onClick]);\n\n  const thumbDataUri = getMessageMediaThumbDataUri(message);\n  const mediaBlobUrl = useMedia(getMessageMediaHash(message, 'pictogram'));\n  const transitionClassNames = useMediaTransition(mediaBlobUrl);\n\n  const video = getMessageVideo(message);\n\n  return (\n    <div id={`${idPrefix}${message.id}`} className=\"Media scroll-item\" onClick={onClick ? handleClick : undefined}>\n      <img src={thumbDataUri} alt=\"\" draggable={!isProtected} onContextMenu={isProtected ? stopEvent : undefined} />\n      <img\n        src={mediaBlobUrl}\n        className={buildClassName('full-media', transitionClassNames)}\n        alt=\"\"\n        draggable={!isProtected}\n        onContextMenu={isProtected ? stopEvent : undefined}\n      />\n      {video && <span className=\"video-duration\">{video.isGif ? 'GIF' : formatMediaDuration(video.duration)}</span>}\n      {isProtected && <span className=\"protector\" />}\n    </div>\n  );\n};\n\nexport default memo(Media);\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport { ApiMessageOutgoingStatus } from '../../api/types';\n\nimport Transition from '../ui/Transition';\n\nimport './MessageOutgoingStatus.scss';\n\ntype OwnProps = {\n  status: ApiMessageOutgoingStatus;\n};\n\nenum Keys {\n  failed, pending, succeeded, read,\n}\n\nconst MessageOutgoingStatus: FC<OwnProps> = ({ status }) => {\n  return (\n    <div className=\"MessageOutgoingStatus\">\n      <Transition name=\"reveal\" activeKey={Keys[status]}>\n        {() => (\n          <i className={`icon-message-${status}`} />\n        )}\n      </Transition>\n    </div>\n  );\n};\n\nexport default memo(MessageOutgoingStatus);\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport './NothingFound.scss';\n\ninterface OwnProps {\n  text?: string;\n  description?: string;\n}\n\nconst DEFAULT_TEXT = 'Nothing found.';\n\nconst NothingFound: FC<OwnProps> = ({ text = DEFAULT_TEXT, description }) => {\n  const lang = useLang();\n  const { transitionClassNames } = useShowTransition(true);\n\n  return (\n    <div className={buildClassName('NothingFound', transitionClassNames, description && 'with-description')}>\n      {text}\n      {description && <p className=\"description\">{renderText(lang(description), ['br'])}</p>}\n    </div>\n  );\n};\n\nexport default memo(NothingFound);\n","import React, {\n  FC, useCallback, useRef, useEffect, memo,\n} from '../../lib/teact/teact';\n\nimport { isUserId } from '../../modules/helpers';\n\nimport InfiniteScroll from '../ui/InfiniteScroll';\nimport Checkbox from '../ui/Checkbox';\nimport InputText from '../ui/InputText';\nimport ListItem from '../ui/ListItem';\nimport PrivateChatInfo from './PrivateChatInfo';\nimport GroupChatInfo from './GroupChatInfo';\nimport PickerSelectedItem from './PickerSelectedItem';\nimport useInfiniteScroll from '../../hooks/useInfiniteScroll';\nimport useLang from '../../hooks/useLang';\n\nimport Loading from '../ui/Loading';\n\nimport './Picker.scss';\n\ntype OwnProps = {\n  itemIds: string[];\n  selectedIds: string[];\n  filterValue?: string;\n  filterPlaceholder?: string;\n  notFoundText?: string;\n  searchInputId?: string;\n  isLoading?: boolean;\n  noScrollRestore?: boolean;\n  onSelectedIdsChange: (ids: string[]) => void;\n  onFilterChange: (value: string) => void;\n  onLoadMore?: () => void;\n};\n\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 500;\n\nconst MAX_FULL_ITEMS = 10;\nconst ALWAYS_FULL_ITEMS_COUNT = 5;\n\nconst Picker: FC<OwnProps> = ({\n  itemIds,\n  selectedIds,\n  filterValue,\n  filterPlaceholder,\n  notFoundText,\n  searchInputId,\n  isLoading,\n  noScrollRestore,\n  onSelectedIdsChange,\n  onFilterChange,\n  onLoadMore,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLInputElement>(null);\n  const shouldMinimize = selectedIds.length > MAX_FULL_ITEMS;\n\n  useEffect(() => {\n    setTimeout(() => {\n      requestAnimationFrame(() => {\n        inputRef.current!.focus();\n      });\n    }, FOCUS_DELAY_MS);\n  }, []);\n\n  const handleItemClick = useCallback((id: string) => {\n    const newSelectedIds = [...selectedIds];\n    if (newSelectedIds.includes(id)) {\n      newSelectedIds.splice(newSelectedIds.indexOf(id), 1);\n    } else {\n      newSelectedIds.push(id);\n    }\n    onSelectedIdsChange(newSelectedIds);\n    onFilterChange('');\n  }, [selectedIds, onSelectedIdsChange, onFilterChange]);\n\n  const handleFilterChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const { value } = e.currentTarget;\n    onFilterChange(value);\n  }, [onFilterChange]);\n\n  const [viewportIds, getMore] = useInfiniteScroll(onLoadMore, itemIds, Boolean(filterValue));\n\n  const lang = useLang();\n\n  return (\n    <div className=\"Picker\">\n      <div className=\"picker-header custom-scroll\" dir={lang.isRtl ? 'rtl' : undefined}>\n        {selectedIds.map((id, i) => (\n          <PickerSelectedItem\n            chatOrUserId={id}\n            isMinimized={shouldMinimize && i < selectedIds.length - ALWAYS_FULL_ITEMS_COUNT}\n            canClose\n            onClick={handleItemClick}\n            clickArg={id}\n          />\n        ))}\n        <InputText\n          id={searchInputId}\n          ref={inputRef}\n          value={filterValue}\n          onChange={handleFilterChange}\n          placeholder={filterPlaceholder || lang('SelectChat')}\n        />\n      </div>\n\n      {viewportIds?.length ? (\n        <InfiniteScroll\n          className=\"picker-list custom-scroll\"\n          items={viewportIds}\n          onLoadMore={getMore}\n          noScrollRestore={noScrollRestore}\n        >\n          {viewportIds.map((id) => (\n            <ListItem\n              key={id}\n              className=\"chat-item-clickable picker-list-item\"\n              onClick={() => handleItemClick(id)}\n              ripple\n            >\n              <Checkbox label=\"\" checked={selectedIds.includes(id)} />\n              {isUserId(id) ? (\n                <PrivateChatInfo userId={id} />\n              ) : (\n                <GroupChatInfo chatId={id} />\n              )}\n            </ListItem>\n          ))}\n        </InfiniteScroll>\n      ) : !isLoading && viewportIds && !viewportIds.length ? (\n        <p className=\"no-results\">{notFoundText || 'Sorry, nothing found.'}</p>\n      ) : (\n        <Loading />\n      )}\n    </div>\n  );\n};\n\nexport default memo(Picker);\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiChat, ApiUser } from '../../api/types';\n\nimport { selectChat, selectUser } from '../../modules/selectors';\nimport { getChatTitle, getUserFirstOrLastName, isUserId } from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\n\nimport './PickerSelectedItem.scss';\n\ntype OwnProps = {\n  chatOrUserId?: string;\n  icon?: string;\n  title?: string;\n  isMinimized?: boolean;\n  canClose?: boolean;\n  onClick: (arg: any) => void;\n  clickArg: any;\n  className?: string;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  user?: ApiUser;\n};\n\nconst PickerSelectedItem: FC<OwnProps & StateProps> = ({\n  icon,\n  title,\n  isMinimized,\n  canClose,\n  onClick,\n  clickArg,\n  chat,\n  user,\n  className,\n}) => {\n  const lang = useLang();\n\n  let iconElement: any;\n  let titleText: any;\n\n  if (icon && title) {\n    iconElement = (\n      <div className=\"item-icon\">\n        <i className={`icon-${icon}`} />\n      </div>\n    );\n\n    titleText = title;\n  } else if (chat || user) {\n    iconElement = (\n      <Avatar\n        chat={chat}\n        user={user}\n        size=\"small\"\n        isSavedMessages={user?.isSelf}\n      />\n    );\n\n    const name = !chat || (user && !user.isSelf)\n      ? getUserFirstOrLastName(user)\n      : getChatTitle(lang, chat, user);\n\n    titleText = name ? renderText(name) : undefined;\n  }\n\n  const fullClassName = buildClassName(\n    'PickerSelectedItem',\n    className,\n    isMinimized && 'minimized',\n    canClose && 'closeable',\n  );\n\n  return (\n    <div\n      className={fullClassName}\n      onClick={() => onClick(clickArg)}\n      title={isMinimized ? titleText : undefined}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {iconElement}\n      {!isMinimized && (\n        <div className=\"item-name\" dir=\"auto\">\n          {titleText}\n        </div>\n      )}\n      {canClose && (\n        <div className=\"item-remove\">\n          <i className=\"icon-close\" />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatOrUserId }): StateProps => {\n    if (!chatOrUserId) {\n      return {};\n    }\n\n    const chat = chatOrUserId ? selectChat(global, chatOrUserId) : undefined;\n    const user = isUserId(chatOrUserId) ? selectUser(global, chatOrUserId) : undefined;\n\n    return {\n      chat,\n      user,\n    };\n  },\n)(PickerSelectedItem));\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, {\n  FC, useEffect, useCallback, memo,\n} from '../../lib/teact/teact';\nimport { getDispatch, withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiUser, ApiTypingStatus, ApiUserStatus } from '../../api/types';\nimport { GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport { selectChatMessages, selectUser, selectUserStatus } from '../../modules/selectors';\nimport { getUserFullName, getUserStatus, isUserOnline } from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\nimport VerifiedIcon from './VerifiedIcon';\nimport TypingStatus from './TypingStatus';\n\ntype OwnProps = {\n  userId: string;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'tiny' | 'small' | 'medium' | 'large' | 'jumbo';\n  forceShowSelf?: boolean;\n  status?: string;\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  noStatusOrTyping?: boolean;\n  noRtl?: boolean;\n};\n\ntype StateProps =\n  {\n    user?: ApiUser;\n    userStatus?: ApiUserStatus;\n    isSavedMessages?: boolean;\n    areMessagesLoaded: boolean;\n    serverTimeOffset: number;\n  }\n  & Pick<GlobalState, 'lastSyncTime'>;\n\nconst PrivateChatInfo: FC<OwnProps & StateProps> = ({\n  typingStatus,\n  avatarSize = 'medium',\n  status,\n  withMediaViewer,\n  withUsername,\n  withFullInfo,\n  withUpdatingStatus,\n  noStatusOrTyping,\n  noRtl,\n  user,\n  userStatus,\n  isSavedMessages,\n  areMessagesLoaded,\n  lastSyncTime,\n  serverTimeOffset,\n}) => {\n  const {\n    loadFullUser,\n    openMediaViewer,\n  } = getDispatch();\n\n  const { id: userId } = user || {};\n  const fullName = getUserFullName(user);\n\n  useEffect(() => {\n    if (withFullInfo && lastSyncTime && userId) {\n      loadFullUser({ userId });\n    }\n  }, [userId, loadFullUser, lastSyncTime, withFullInfo]);\n\n  const handleAvatarViewerOpen = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasPhoto: boolean) => {\n    if (user && hasPhoto) {\n      e.stopPropagation();\n      openMediaViewer({\n        avatarOwnerId: user.id,\n        origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n      });\n    }\n  }, [user, avatarSize, openMediaViewer]);\n\n  const lang = useLang();\n\n  if (!user) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (status) {\n      return (\n        <span className=\"status\" dir=\"auto\">{status}</span>\n      );\n    }\n\n    if (withUpdatingStatus && !areMessagesLoaded) {\n      return (\n        <span className=\"status\" dir=\"auto\">{lang('Updating')}</span>\n      );\n    }\n\n    if (!user) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    return (\n      <div className={`status ${isUserOnline(user, userStatus) ? 'online' : ''}`}>\n        {withUsername && user.username && <span className=\"handle\">{user.username}</span>}\n        <span className=\"user-status\" dir=\"auto\">{getUserStatus(lang, user, userStatus, serverTimeOffset)}</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"ChatInfo\" dir={!noRtl && lang.isRtl ? 'rtl' : undefined}>\n      <Avatar\n        key={user.id}\n        size={avatarSize}\n        user={user}\n        isSavedMessages={isSavedMessages}\n        onClick={withMediaViewer ? handleAvatarViewerOpen : undefined}\n      />\n      <div className=\"info\">\n        {isSavedMessages ? (\n          <div className=\"title\">\n            <h3>{lang('SavedMessages')}</h3>\n          </div>\n        ) : (\n          <div className=\"title\">\n            <h3 dir=\"auto\">{fullName && renderText(fullName)}</h3>\n            {user?.isVerified && <VerifiedIcon />}\n          </div>\n        )}\n        {(status || (!isSavedMessages && !noStatusOrTyping)) && renderStatusOrTyping()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { userId, forceShowSelf }): StateProps => {\n    const { lastSyncTime, serverTimeOffset } = global;\n    const user = selectUser(global, userId);\n    const userStatus = selectUserStatus(global, userId);\n    const isSavedMessages = !forceShowSelf && user && user.isSelf;\n    const areMessagesLoaded = Boolean(selectChatMessages(global, userId));\n\n    return {\n      lastSyncTime, user, userStatus, isSavedMessages, areMessagesLoaded, serverTimeOffset,\n    };\n  },\n)(PrivateChatInfo));\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport {\n  ApiChat, ApiMediaFormat, ApiPhoto, ApiUser,\n} from '../../api/types';\n\nimport {\n  getChatAvatarHash,\n  getChatTitle,\n  getUserColorKey,\n  getUserFullName,\n  isUserId,\n  isChatWithRepliesBot,\n  isDeletedUser,\n} from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport buildClassName from '../../util/buildClassName';\nimport { getFirstLetters } from '../../util/textFormat';\nimport useMedia from '../../hooks/useMedia';\nimport useBlurSync from '../../hooks/useBlurSync';\nimport usePrevious from '../../hooks/usePrevious';\nimport useLang from '../../hooks/useLang';\n\nimport Spinner from '../ui/Spinner';\n\nimport './ProfilePhoto.scss';\n\ntype OwnProps = {\n  chat?: ApiChat;\n  user?: ApiUser;\n  isFirstPhoto?: boolean;\n  isSavedMessages?: boolean;\n  photo?: ApiPhoto;\n  lastSyncTime?: number;\n  onClick: NoneToVoidFunction;\n};\n\nconst ProfilePhoto: FC<OwnProps> = ({\n  chat,\n  user,\n  photo,\n  isFirstPhoto,\n  isSavedMessages,\n  lastSyncTime,\n  onClick,\n}) => {\n  const lang = useLang();\n  const isDeleted = user && isDeletedUser(user);\n  const isRepliesChat = chat && isChatWithRepliesBot(chat.id);\n\n  function getMediaHash(size: 'normal' | 'big', forceAvatar?: boolean) {\n    if (photo && !forceAvatar) {\n      return `photo${photo.id}?size=c`;\n    }\n\n    let hash: string | undefined;\n    if (!isSavedMessages && !isDeleted && !isRepliesChat) {\n      if (user) {\n        hash = getChatAvatarHash(user, size);\n      } else if (chat) {\n        hash = getChatAvatarHash(chat, size);\n      }\n    }\n\n    return hash;\n  }\n\n  const photoBlobUrl = useMedia(getMediaHash('big'), false, ApiMediaFormat.BlobUrl, lastSyncTime);\n  const avatarMediaHash = isFirstPhoto && !photoBlobUrl ? getMediaHash('normal', true) : undefined;\n  const avatarBlobUrl = useMedia(avatarMediaHash, false, ApiMediaFormat.BlobUrl, lastSyncTime);\n  const thumbDataUri = useBlurSync(!photoBlobUrl && photo && photo.thumbnail && photo.thumbnail.dataUri);\n  const imageSrc = photoBlobUrl || avatarBlobUrl || thumbDataUri;\n  const prevImageSrc = usePrevious(imageSrc);\n\n  let content: string | undefined = '';\n\n  if (isSavedMessages) {\n    content = <i className=\"icon-avatar-saved-messages\" />;\n  } else if (isDeleted) {\n    content = <i className=\"icon-avatar-deleted-account\" />;\n  } else if (isRepliesChat) {\n    content = <i className=\"icon-reply-filled\" />;\n  } else if (imageSrc) {\n    content = <img src={imageSrc} className=\"avatar-media\" alt=\"\" decoding=\"async\" />;\n  } else if (!imageSrc && user) {\n    const userFullName = getUserFullName(user);\n    content = userFullName ? getFirstLetters(userFullName, 2) : undefined;\n  } else if (!imageSrc && chat) {\n    const title = getChatTitle(lang, chat);\n    content = title && getFirstLetters(title, isUserId(chat.id) ? 2 : 1);\n  } else {\n    content = (\n      <div className=\"spinner-wrapper\">\n        <Spinner color=\"white\" />\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'ProfilePhoto',\n    `color-bg-${getUserColorKey(user || chat)}`,\n    isSavedMessages && 'saved-messages',\n    isDeleted && 'deleted-account',\n    isRepliesChat && 'replies-bot-account',\n    (!isSavedMessages && !(imageSrc)) && 'no-photo',\n  );\n\n  return (\n    <div className={fullClassName} onClick={imageSrc ? onClick : undefined}>\n      {prevImageSrc && imageSrc && prevImageSrc !== imageSrc && (\n        <img src={prevImageSrc} className=\"prev-avatar-media\" alt=\"\" decoding=\"async\" />\n      )}\n      {typeof content === 'string' ? renderText(content, ['hq_emoji']) : content}\n    </div>\n  );\n};\n\nexport default memo(ProfilePhoto);\n","import React, {\n  FC, useEffect, useCallback, memo, useState,\n} from '../../lib/teact/teact';\nimport { getDispatch, withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiUser, ApiChat, ApiUserStatus } from '../../api/types';\nimport { GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport { IS_TOUCH_ENV } from '../../util/environment';\nimport { selectChat, selectUser, selectUserStatus } from '../../modules/selectors';\nimport {\n  getUserFullName, getUserStatus, isChatChannel, isUserOnline,\n} from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport { captureEvents, SwipeDirection } from '../../util/captureEvents';\nimport buildClassName from '../../util/buildClassName';\nimport usePhotosPreload from './hooks/usePhotosPreload';\nimport useLang from '../../hooks/useLang';\n\nimport VerifiedIcon from './VerifiedIcon';\nimport ProfilePhoto from './ProfilePhoto';\nimport Transition from '../ui/Transition';\n\nimport './ProfileInfo.scss';\n\ntype OwnProps = {\n  userId: string;\n  forceShowSelf?: boolean;\n};\n\ntype StateProps =\n  {\n    user?: ApiUser;\n    userStatus?: ApiUserStatus;\n    chat?: ApiChat;\n    isSavedMessages?: boolean;\n    animationLevel: 0 | 1 | 2;\n    serverTimeOffset: number;\n  }\n  & Pick<GlobalState, 'connectionState'>;\n\nconst ProfileInfo: FC<OwnProps & StateProps> = ({\n  forceShowSelf,\n  user,\n  userStatus,\n  chat,\n  isSavedMessages,\n  connectionState,\n  animationLevel,\n  serverTimeOffset,\n}) => {\n  const {\n    loadFullUser,\n    openMediaViewer,\n  } = getDispatch();\n\n  const lang = useLang();\n\n  const { id: userId } = user || {};\n  const { id: chatId } = chat || {};\n  const fullName = user ? getUserFullName(user) : (chat ? chat.title : '');\n  const photos = user?.photos || chat?.photos || [];\n  const slideAnimation = animationLevel >= 1\n    ? (lang.isRtl ? 'slide-optimized-rtl' : 'slide-optimized')\n    : 'none';\n\n  const [currentPhotoIndex, setCurrentPhotoIndex] = useState(0);\n  const isFirst = isSavedMessages || photos.length <= 1 || currentPhotoIndex === 0;\n  const isLast = isSavedMessages || photos.length <= 1 || currentPhotoIndex === photos.length - 1;\n\n  // Deleting the last profile photo may result in an error\n  useEffect(() => {\n    if (currentPhotoIndex > photos.length) {\n      setCurrentPhotoIndex(Math.max(0, photos.length - 1));\n    }\n  }, [currentPhotoIndex, photos.length]);\n\n  useEffect(() => {\n    if (connectionState === 'connectionStateReady' && userId && !forceShowSelf) {\n      loadFullUser({ userId });\n    }\n  }, [userId, loadFullUser, connectionState, forceShowSelf]);\n\n  usePhotosPreload(user || chat, photos, currentPhotoIndex);\n\n  const handleProfilePhotoClick = useCallback(() => {\n    openMediaViewer({\n      avatarOwnerId: userId || chatId,\n      profilePhotoIndex: currentPhotoIndex,\n      origin: forceShowSelf ? MediaViewerOrigin.SettingsAvatar : MediaViewerOrigin.ProfileAvatar,\n    });\n  }, [openMediaViewer, userId, chatId, currentPhotoIndex, forceShowSelf]);\n\n  const selectPreviousMedia = useCallback(() => {\n    if (isFirst) {\n      return;\n    }\n\n    setCurrentPhotoIndex(currentPhotoIndex - 1);\n  }, [currentPhotoIndex, isFirst]);\n\n  const selectNextMedia = useCallback(() => {\n    if (isLast) {\n      return;\n    }\n\n    setCurrentPhotoIndex(currentPhotoIndex + 1);\n  }, [currentPhotoIndex, isLast]);\n\n  // Support for swipe gestures and closing on click\n  useEffect(() => {\n    const element = document.querySelector<HTMLDivElement>('.photo-wrapper');\n    if (!element) {\n      return undefined;\n    }\n\n    return captureEvents(element, {\n      selectorToPreventScroll: '.Profile, .settings-content',\n      onSwipe: IS_TOUCH_ENV ? (e, direction) => {\n        if (direction === SwipeDirection.Right) {\n          selectPreviousMedia();\n          return true;\n        } else if (direction === SwipeDirection.Left) {\n          selectNextMedia();\n          return true;\n        }\n\n        return false;\n      } : undefined,\n    });\n  }, [selectNextMedia, selectPreviousMedia]);\n\n  if (!user && !chat) {\n    return undefined;\n  }\n\n  function renderPhotoTabs() {\n    if (isSavedMessages || !photos || photos.length <= 1) {\n      return undefined;\n    }\n\n    return (\n      <div className=\"photo-dashes\">\n        {photos.map((_, i) => (\n          <span className={`photo-dash ${i === currentPhotoIndex ? 'current' : ''}`} />\n        ))}\n      </div>\n    );\n  }\n\n  function renderPhoto() {\n    const photo = !isSavedMessages && photos && photos.length > 0 ? photos[currentPhotoIndex] : undefined;\n\n    return (\n      <ProfilePhoto\n        key={currentPhotoIndex}\n        user={user}\n        chat={chat}\n        photo={photo}\n        isSavedMessages={isSavedMessages}\n        isFirstPhoto={isFirst}\n        onClick={handleProfilePhotoClick}\n      />\n    );\n  }\n\n  function renderStatus() {\n    if (user) {\n      return (\n        <div className={`status ${isUserOnline(user, userStatus) ? 'online' : ''}`}>\n          <span className=\"user-status\" dir=\"auto\">{getUserStatus(lang, user, userStatus, serverTimeOffset)}</span>\n        </div>\n      );\n    }\n\n    return (\n      <span className=\"status\" dir=\"auto\">{\n        isChatChannel(chat!)\n          ? lang('Subscribers', chat!.membersCount ?? 0, 'i')\n          : lang('Members', chat!.membersCount ?? 0, 'i')\n      }\n      </span>\n    );\n  }\n\n  const isVerifiedIconShown = (user || chat)?.isVerified;\n\n  return (\n    <div className={buildClassName('ProfileInfo', forceShowSelf && 'self')} dir={lang.isRtl ? 'rtl' : undefined}>\n      <div className=\"photo-wrapper\">\n        {renderPhotoTabs()}\n        <Transition activeKey={currentPhotoIndex} name={slideAnimation} className=\"profile-slide-container\">\n          {renderPhoto}\n        </Transition>\n\n        {!isFirst && (\n          <button\n            type=\"button\"\n            className=\"navigation prev\"\n            aria-label={lang('AccDescrPrevious')}\n            onClick={selectPreviousMedia}\n          />\n        )}\n        {!isLast && (\n          <button\n            type=\"button\"\n            className=\"navigation next\"\n            aria-label={lang('Next')}\n            onClick={selectNextMedia}\n          />\n        )}\n      </div>\n\n      <div className=\"info\" dir={lang.isRtl ? 'rtl' : 'auto'}>\n        {isSavedMessages ? (\n          <div className=\"title\">\n            <h3 dir=\"auto\">{lang('SavedMessages')}</h3>\n          </div>\n        ) : (\n          <div className=\"title\">\n            <h3 dir=\"auto\">{fullName && renderText(fullName)}</h3>\n            {isVerifiedIconShown && <VerifiedIcon />}\n          </div>\n        )}\n        {!isSavedMessages && renderStatus()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { userId, forceShowSelf }): StateProps => {\n    const { connectionState, serverTimeOffset } = global;\n    const user = selectUser(global, userId);\n    const userStatus = selectUserStatus(global, userId);\n    const chat = selectChat(global, userId);\n    const isSavedMessages = !forceShowSelf && user && user.isSelf;\n    const { animationLevel } = global.settings.byKey;\n\n    return {\n      connectionState,\n      user,\n      userStatus,\n      chat,\n      isSavedMessages,\n      animationLevel,\n      serverTimeOffset,\n    };\n  },\n)(ProfileInfo));\n","import {\n  ApiChat, ApiMediaFormat, ApiPhoto, ApiUser,\n} from '../../../api/types';\nimport { useEffect } from '../../../lib/teact/teact';\nimport * as mediaLoader from '../../../util/mediaLoader';\n\nconst PHOTOS_TO_PRELOAD = 4;\n\nexport default function usePhotosPreload(\n  profile: ApiUser | ApiChat | undefined,\n  photos: ApiPhoto[],\n  currentIndex: number,\n) {\n  useEffect(() => {\n    photos.slice(currentIndex, currentIndex + PHOTOS_TO_PRELOAD).forEach((photo) => {\n      const mediaData = mediaLoader.getFromMemory(`photo${photo.id}?size=c`);\n      if (!mediaData) {\n        mediaLoader.fetch(`photo${photo.id}?size=c`, ApiMediaFormat.BlobUrl);\n      }\n    });\n  }, [currentIndex, photos]);\n}\n","import { RefObject } from 'react';\nimport React, { FC, memo } from '../../lib/teact/teact';\nimport { getGlobal } from '../../lib/teact/teactn';\n\nimport { ApiMediaFormat } from '../../api/types';\n\nimport useMedia from '../../hooks/useMedia';\nimport buildClassName from '../../util/buildClassName';\n\nimport './ReactionStaticEmoji.scss';\n\ntype OwnProps = {\n  reaction: string;\n  ref?: RefObject<HTMLImageElement>;\n  className?: string;\n};\n\nconst ReactionStaticEmoji: FC<OwnProps> = ({\n  reaction,\n  ref,\n  className,\n}) => {\n  const staticIconId = getGlobal().availableReactions?.find((l) => l.reaction === reaction)?.staticIcon?.id;\n  const mediaData = useMedia(`document${staticIconId}`, !staticIconId, ApiMediaFormat.BlobUrl);\n\n  return (\n    <img\n      className={buildClassName('ReactionStaticEmoji', className)}\n      ref={ref}\n      src={mediaData}\n      alt=\"\"\n    />\n  );\n};\n\nexport default memo(ReactionStaticEmoji);\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, {\n  FC, memo, useEffect, useRef,\n} from '../../lib/teact/teact';\n\nimport { ApiMediaFormat, ApiSticker } from '../../api/types';\n\nimport { useIsIntersecting, ObserveFn } from '../../hooks/useIntersectionObserver';\nimport useMedia from '../../hooks/useMedia';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useFlag from '../../hooks/useFlag';\nimport buildClassName from '../../util/buildClassName';\nimport { preventMessageInputBlurWithBubbling } from '../middle/helpers/preventMessageInputBlur';\n\nimport AnimatedSticker from './AnimatedSticker';\nimport Button from '../ui/Button';\n\nimport './StickerButton.scss';\n\ntype OwnProps = {\n  sticker: ApiSticker;\n  size: number;\n  observeIntersection: ObserveFn;\n  noAnimate?: boolean;\n  title?: string;\n  className?: string;\n  onClick?: (arg: any) => void;\n  clickArg?: any;\n  onUnfaveClick?: (sticker: ApiSticker) => void;\n};\n\nconst StickerButton: FC<OwnProps> = ({\n  sticker, size, observeIntersection, noAnimate, title, className, onClick, clickArg, onUnfaveClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const localMediaHash = `sticker${sticker.id}`;\n  const stickerSelector = `sticker-button-${sticker.id}`;\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const thumbDataUri = sticker.thumbnail ? sticker.thumbnail.dataUri : undefined;\n  const previewBlobUrl = useMedia(`${localMediaHash}?size=m`, !isIntersecting, ApiMediaFormat.BlobUrl);\n\n  const shouldPlay = isIntersecting && !noAnimate;\n  const lottieData = useMedia(sticker.isAnimated && localMediaHash, !shouldPlay, ApiMediaFormat.Lottie);\n  const [isAnimationLoaded, markLoaded, unmarkLoaded] = useFlag(Boolean(lottieData));\n  const canAnimatedPlay = isAnimationLoaded && shouldPlay;\n\n  const { transitionClassNames: previewTransitionClassNames } = useShowTransition(\n    Boolean(previewBlobUrl || canAnimatedPlay),\n    undefined,\n    undefined,\n    'slow',\n  );\n\n  // To avoid flickering\n  useEffect(() => {\n    if (!shouldPlay) {\n      unmarkLoaded();\n    }\n  }, [unmarkLoaded, shouldPlay]);\n\n  function handleClick() {\n    if (onClick) {\n      onClick(clickArg);\n    }\n  }\n\n  function handleUnfaveClick(e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    onUnfaveClick!(sticker);\n  }\n\n  const fullClassName = buildClassName(\n    'StickerButton',\n    onClick && 'interactive',\n    sticker.isAnimated && 'animated',\n    stickerSelector,\n    className,\n  );\n\n  const style = thumbDataUri && !canAnimatedPlay ? `background-image: url('${thumbDataUri}');` : '';\n\n  return (\n    <div\n      ref={ref}\n      className={fullClassName}\n      title={title || (sticker?.emoji)}\n      // @ts-ignore\n      style={style}\n      data-sticker-id={sticker.id}\n      onMouseDown={preventMessageInputBlurWithBubbling}\n      onClick={handleClick}\n    >\n      {!canAnimatedPlay && (\n        // eslint-disable-next-line jsx-a11y/alt-text\n        <img src={previewBlobUrl} className={previewTransitionClassNames} />\n      )}\n      {shouldPlay && lottieData && (\n        <AnimatedSticker\n          id={localMediaHash}\n          animationData={lottieData}\n          play\n          size={size}\n          isLowPriority\n          onLoad={markLoaded}\n        />\n      )}\n      {onUnfaveClick && (\n        <Button\n          className=\"sticker-unfave-button\"\n          color=\"dark\"\n          round\n          onClick={handleUnfaveClick}\n        >\n          <i className=\"icon-close\" />\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(StickerButton);\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { OwnProps } from './StickerSetModal';\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst StickerSetModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const StickerSetModal = useModuleLoader(Bundles.Extra, 'StickerSetModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return StickerSetModal ? <StickerSetModal {...props} /> : undefined;\n};\n\nexport default memo(StickerSetModalAsync);\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiUser, ApiTypingStatus } from '../../api/types';\n\nimport { selectUser } from '../../modules/selectors';\nimport { getUserFirstOrLastName } from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport './TypingStatus.scss';\n\ntype OwnProps = {\n  typingStatus: ApiTypingStatus;\n};\n\ntype StateProps = {\n  typingUser?: ApiUser;\n};\n\nconst TypingStatus: FC<OwnProps & StateProps> = ({ typingStatus, typingUser }) => {\n  const lang = useLang();\n  const typingUserName = typingUser && !typingUser.isSelf && getUserFirstOrLastName(typingUser);\n\n  return (\n    <p className=\"typing-status\" dir={lang.isRtl ? 'rtl' : 'auto'}>\n      {typingUserName && (\n        <span className=\"sender-name\" dir=\"auto\">{renderText(typingUserName)}</span>\n      )}\n      {/* fix for translation \"username _is_ typing\" */}\n      {lang(typingStatus.action).replace('{user}', '').replace('{emoji}', typingStatus.emoji).trim()}\n      <span className=\"ellipsis\" />\n    </p>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { typingStatus }): StateProps => {\n    if (!typingStatus.userId) {\n      return {};\n    }\n\n    const typingUser = selectUser(global, typingStatus.userId);\n\n    return { typingUser };\n  },\n)(TypingStatus));\n","import React, { FC } from '../../lib/teact/teact';\n\nimport './VerifiedIcon.scss';\n\nconst VerifiedIcon: FC = () => {\n  return (\n    <span className=\"VerifiedIcon\" />\n  );\n};\n\nexport default VerifiedIcon;\n","import React, { FC, memo, useCallback } from '../../lib/teact/teact';\n\nimport { ApiMessage, ApiWebPage } from '../../api/types';\n\nimport { getFirstLinkInMessage, getMessageSummaryText, getMessageWebPage } from '../../modules/helpers';\nimport buildClassName from '../../util/buildClassName';\nimport trimText from '../../util/trimText';\nimport renderText from './helpers/renderText';\nimport { formatPastTimeShort } from '../../util/dateFormat';\nimport useLang from '../../hooks/useLang';\n\nimport Media from './Media';\nimport Link from '../ui/Link';\nimport SafeLink from './SafeLink';\n\nimport './WebLink.scss';\n\nconst MAX_TEXT_LENGTH = 170; // symbols\n\ntype OwnProps = {\n  message: ApiMessage;\n  senderTitle?: string;\n  isProtected?: boolean;\n  onMessageClick: (messageId: number, chatId: string) => void;\n};\n\nconst WebLink: FC<OwnProps> = ({\n  message, senderTitle, isProtected, onMessageClick,\n}) => {\n  const lang = useLang();\n\n  let linkData: ApiWebPage | undefined = getMessageWebPage(message);\n\n  if (!linkData) {\n    const link = getFirstLinkInMessage(message);\n    if (link) {\n      const { url, domain } = link;\n      const messageText = getMessageSummaryText(lang, message);\n\n      linkData = {\n        siteName: domain.replace(/^www./, ''),\n        url: url.includes('://') ? url : url.includes('@') ? `mailto:${url}` : `http://${url}`,\n        description: messageText !== url ? messageText : undefined,\n      } as ApiWebPage;\n    }\n  }\n\n  const handleMessageClick = useCallback(() => {\n    onMessageClick(message.id, message.chatId);\n  }, [onMessageClick, message.id, message.chatId]);\n\n  if (!linkData) {\n    return undefined;\n  }\n\n  const {\n    siteName,\n    url,\n    displayUrl,\n    title,\n    description,\n    photo,\n    video,\n  } = linkData;\n\n  const truncatedDescription = !senderTitle && trimText(description, MAX_TEXT_LENGTH);\n\n  const className = buildClassName(\n    'WebLink scroll-item',\n    (!photo && !video) && 'without-media',\n  );\n\n  return (\n    <div\n      className={className}\n      data-initial={(siteName || displayUrl)[0]}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {photo && (\n        <Media message={message} isProtected={isProtected} />\n      )}\n      <div className=\"content\">\n        <Link isRtl={lang.isRtl} className=\"site-title\" onClick={handleMessageClick}>\n          {renderText(title || siteName || displayUrl)}\n        </Link>\n        {truncatedDescription && (\n          <Link isRtl={lang.isRtl} className=\"site-description\" onClick={handleMessageClick}>\n            {renderText(truncatedDescription)}\n          </Link>\n        )}\n        <SafeLink\n          url={url}\n          className=\"site-name\"\n          text=\"\"\n          isRtl={lang.isRtl}\n        >\n          {url.replace('mailto:', '') || displayUrl}\n        </SafeLink>\n        {senderTitle && <div className=\"sender-name\">{renderText(senderTitle)}</div>}\n      </div>\n      {senderTitle && (\n        <div className=\"message-date\">\n          <Link\n            className=\"date\"\n            onClick={handleMessageClick}\n            isRtl={lang.isRtl}\n          >\n            {formatPastTimeShort(lang, message.date * 1000)}\n          </Link>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(WebLink);\n","import {\n  ApiPhoto, ApiVideo, ApiSticker, ApiDimensions,\n} from '../../../api/types';\n\nimport { STICKER_SIZE_INLINE_DESKTOP_FACTOR, STICKER_SIZE_INLINE_MOBILE_FACTOR } from '../../../config';\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\nimport windowSize from '../../../util/windowSize';\nimport { getPhotoInlineDimensions, getVideoDimensions } from '../../../modules/helpers';\n\nexport const MEDIA_VIEWER_MEDIA_QUERY = '(max-height: 640px)';\nexport const REM = parseInt(getComputedStyle(document.documentElement).fontSize, 10);\nexport const ROUND_VIDEO_DIMENSIONS_PX = 240;\nexport const GIF_MIN_WIDTH = 300;\nexport const AVATAR_FULL_DIMENSIONS = { width: 640, height: 640 };\nexport const LIKE_STICKER_ID = '4986041492570112461';\n\nconst DEFAULT_MEDIA_DIMENSIONS: ApiDimensions = { width: 100, height: 100 };\nconst MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM = 4.5;\nconst MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM = 7;\nconst MESSAGE_MAX_WIDTH_REM = 29;\nconst MESSAGE_OWN_MAX_WIDTH_REM = 30;\n\nlet cachedMaxWidthOwn: number | undefined;\nlet cachedMaxWidth: number | undefined;\nlet cachedMaxWidthNoAvatar: number | undefined;\n\nfunction getMaxMessageWidthRem(fromOwnMessage: boolean, noAvatars?: boolean) {\n  const regularMaxWidth = fromOwnMessage ? MESSAGE_OWN_MAX_WIDTH_REM : MESSAGE_MAX_WIDTH_REM;\n  if (!IS_SINGLE_COLUMN_LAYOUT) {\n    return regularMaxWidth;\n  }\n\n  const { width: windowWidth } = windowSize.get();\n\n  // @optimization Limitation: changing device screen width not supported\n  if (!cachedMaxWidthOwn) {\n    cachedMaxWidthOwn = Math.min(\n      MESSAGE_OWN_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidth) {\n    cachedMaxWidth = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidthNoAvatar) {\n    cachedMaxWidthNoAvatar = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n\n  return fromOwnMessage\n    ? cachedMaxWidthOwn\n    : (noAvatars ? cachedMaxWidthNoAvatar : cachedMaxWidth);\n}\n\nexport function getAvailableWidth(\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  isWebPagePhoto?: boolean,\n  noAvatars?: boolean,\n) {\n  const extraPaddingRem = isForwarded || isWebPagePhoto ? 1.625 : 0;\n  const availableWidthRem = getMaxMessageWidthRem(fromOwnMessage, noAvatars) - extraPaddingRem;\n\n  return availableWidthRem * REM;\n}\n\nfunction getAvailableHeight(isGif?: boolean, aspectRatio?: number) {\n  if (\n    isGif && aspectRatio\n    && aspectRatio >= 0.75 && aspectRatio <= 1.25\n  ) {\n    return 20 * REM;\n  }\n\n  return 27 * REM;\n}\n\nfunction calculateDimensionsForMessageMedia({\n  width,\n  height,\n  fromOwnMessage,\n  isForwarded,\n  isWebPagePhoto,\n  isGif,\n  noAvatars,\n}: {\n  width: number;\n  height: number;\n  fromOwnMessage: boolean;\n  isForwarded?: boolean;\n  isWebPagePhoto?: boolean;\n  isGif?: boolean;\n  noAvatars?: boolean;\n}): ApiDimensions {\n  const aspectRatio = height / width;\n  const availableWidth = getAvailableWidth(fromOwnMessage, isForwarded, isWebPagePhoto, noAvatars);\n  const availableHeight = getAvailableHeight(isGif, aspectRatio);\n  const mediaWidth = isGif ? Math.max(GIF_MIN_WIDTH, width) : width;\n  const mediaHeight = isGif ? height * (mediaWidth / width) : height;\n\n  return calculateDimensions(availableWidth, availableHeight, mediaWidth, mediaHeight);\n}\n\nexport function getMediaViewerAvailableDimensions(withFooter: boolean, isVideo: boolean): ApiDimensions {\n  const mql = window.matchMedia(MEDIA_VIEWER_MEDIA_QUERY);\n  const { width: windowWidth, height: windowHeight } = windowSize.get();\n  let occupiedHeightRem = isVideo && mql.matches ? 10 : 8.25;\n  if (withFooter) {\n    occupiedHeightRem = mql.matches ? 10 : 15;\n  }\n\n  return {\n    width: windowWidth,\n    height: windowHeight - occupiedHeightRem * REM,\n  };\n}\n\nexport function calculateInlineImageDimensions(\n  photo: ApiPhoto,\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  isWebPagePhoto?: boolean,\n  noAvatars?: boolean,\n) {\n  const { width, height } = getPhotoInlineDimensions(photo) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    isForwarded,\n    isWebPagePhoto,\n    noAvatars,\n  });\n}\n\nexport function calculateVideoDimensions(\n  video: ApiVideo,\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  noAvatars?: boolean,\n) {\n  const { width, height } = getVideoDimensions(video) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    isForwarded,\n    isGif: video.isGif,\n    noAvatars,\n  });\n}\n\nexport function getPictogramDimensions(): ApiDimensions {\n  return {\n    width: 2 * REM,\n    height: 2 * REM,\n  };\n}\n\nexport function getDocumentThumbnailDimensions(smaller?: boolean): ApiDimensions {\n  if (smaller) {\n    return {\n      width: 3 * REM,\n      height: 3 * REM,\n    };\n  }\n\n  return {\n    width: 3.375 * REM,\n    height: 3.375 * REM,\n  };\n}\n\nexport function getStickerDimensions(sticker: ApiSticker): ApiDimensions {\n  const { width } = sticker;\n  let { height } = sticker;\n\n  // For some reason this sticker has some weird `height` value\n  if (sticker.id === LIKE_STICKER_ID) {\n    height = width;\n  }\n\n  const aspectRatio = (height && width) && height / width;\n  const baseWidth = REM * (\n    IS_SINGLE_COLUMN_LAYOUT\n      ? STICKER_SIZE_INLINE_MOBILE_FACTOR\n      : STICKER_SIZE_INLINE_DESKTOP_FACTOR\n  );\n  const calculatedHeight = aspectRatio ? baseWidth * aspectRatio : baseWidth;\n\n  if (aspectRatio && calculatedHeight > baseWidth) {\n    return {\n      width: Math.round(baseWidth / aspectRatio),\n      height: baseWidth,\n    };\n  }\n\n  return {\n    width: baseWidth,\n    height: calculatedHeight,\n  };\n}\n\nexport function calculateMediaViewerDimensions(\n  { width, height }: ApiDimensions, withFooter: boolean, isVideo: boolean = false,\n): ApiDimensions {\n  const { width: availableWidth, height: availableHeight } = getMediaViewerAvailableDimensions(withFooter, isVideo);\n\n  return calculateDimensions(availableWidth, availableHeight, width, height);\n}\n\nexport function calculateDimensions(\n  availableWidth: number,\n  availableHeight: number,\n  mediaWidth: number,\n  mediaHeight: number,\n): ApiDimensions {\n  const aspectRatio = mediaHeight / mediaWidth;\n  const calculatedWidth = Math.min(mediaWidth, availableWidth);\n  const calculatedHeight = Math.round(calculatedWidth * aspectRatio);\n\n  if (calculatedHeight > availableHeight) {\n    return {\n      width: Math.round(availableHeight / aspectRatio),\n      height: availableHeight,\n    };\n  }\n\n  return {\n    width: calculatedWidth,\n    height: Math.round(calculatedWidth * aspectRatio),\n  };\n}\n","import { MouseEvent } from 'react';\nimport React from '../../../lib/teact/teact';\nimport { getDispatch } from '../../../lib/teact/teactn';\n\nimport { ApiMessageEntity, ApiMessageEntityTypes, ApiMessage } from '../../../api/types';\n\nimport { getMessageText } from '../../../modules/helpers';\nimport renderText from './renderText';\n\nimport MentionLink from '../../middle/message/MentionLink';\nimport SafeLink from '../SafeLink';\n\nexport type TextPart = string | Element;\n\nexport function renderMessageText(message: ApiMessage, highlight?: string, shouldRenderHqEmoji?: boolean) {\n  const formattedText = message.content.text;\n\n  if (!formattedText || !formattedText.text) {\n    const rawText = getMessageText(message);\n    return rawText ? [rawText] : undefined;\n  }\n  const { text, entities } = formattedText;\n\n  return renderTextWithEntities(text, entities, highlight, shouldRenderHqEmoji);\n}\n\ninterface IOrganizedEntity {\n  entity: ApiMessageEntity;\n  organizedIndexes: Set<number>;\n  nestedEntities: IOrganizedEntity[];\n}\n\nfunction organizeEntity(\n  entity: ApiMessageEntity,\n  index: number,\n  entities: ApiMessageEntity[],\n  organizedEntityIndexes: Set<number>,\n): IOrganizedEntity | undefined {\n  const { offset, length } = entity;\n  const organizedIndexes = new Set([index]);\n\n  if (organizedEntityIndexes.has(index)) {\n    return undefined;\n  }\n\n  // Determine any nested entities inside current entity\n  const nestedEntities: IOrganizedEntity[] = [];\n  const parsedNestedEntities = entities\n    .filter((e, i) => i > index && e.offset >= offset && e.offset < offset + length)\n    .map((e) => organizeEntity(e, entities.indexOf(e), entities, organizedEntityIndexes))\n    .filter<IOrganizedEntity>(Boolean as any);\n\n  parsedNestedEntities.forEach((parsedEntity) => {\n    let isChanged = false;\n\n    parsedEntity.organizedIndexes.forEach((organizedIndex) => {\n      if (!isChanged && !organizedIndexes.has(organizedIndex)) {\n        isChanged = true;\n      }\n\n      organizedIndexes.add(organizedIndex);\n    });\n\n    if (isChanged) {\n      nestedEntities.push(parsedEntity);\n    }\n  });\n\n  return {\n    entity,\n    organizedIndexes,\n    nestedEntities,\n  };\n}\n\n// Organize entities in a tree-like structure to better represent how the text will be displayed\nfunction organizeEntities(entities: ApiMessageEntity[]) {\n  const organizedEntityIndexes: Set<number> = new Set();\n  const organizedEntities: IOrganizedEntity[] = [];\n\n  entities.forEach((entity, index) => {\n    if (organizedEntityIndexes.has(index)) {\n      return;\n    }\n\n    const organizedEntity = organizeEntity(entity, index, entities, organizedEntityIndexes);\n    if (organizedEntity) {\n      organizedEntity.organizedIndexes.forEach((organizedIndex) => {\n        organizedEntityIndexes.add(organizedIndex);\n      });\n\n      organizedEntities.push(organizedEntity);\n    }\n  });\n\n  return organizedEntities;\n}\n\nexport function renderTextWithEntities(\n  text: string,\n  entities?: ApiMessageEntity[],\n  highlight?: string,\n  shouldRenderHqEmoji?: boolean,\n  shouldRenderAsHtml?: boolean,\n) {\n  if (!entities || !entities.length) {\n    return renderMessagePart(text, highlight, shouldRenderHqEmoji, shouldRenderAsHtml);\n  }\n\n  const result: TextPart[] = [];\n  let deleteLineBreakAfterPre = false;\n\n  const organizedEntities = organizeEntities(entities);\n\n  // Recursive function to render regular and nested entities\n  function renderEntity(\n    textPartStart: number,\n    textPartEnd: number,\n    organizedEntity: IOrganizedEntity,\n    isLastEntity: boolean,\n  ) {\n    const renderResult: TextPart[] = [];\n    const { entity, nestedEntities } = organizedEntity;\n    const { offset, length, type } = entity;\n\n    // Render text before the entity\n    let textBefore = text.substring(textPartStart, offset);\n    const textBeforeLength = textBefore.length;\n    if (textBefore) {\n      if (deleteLineBreakAfterPre && textBefore.length > 0 && textBefore[0] === '\\n') {\n        textBefore = textBefore.substr(1);\n        deleteLineBreakAfterPre = false;\n      }\n      if (textBefore) {\n        renderResult.push(...renderMessagePart(\n          textBefore, highlight, shouldRenderHqEmoji, shouldRenderAsHtml,\n        ) as TextPart[]);\n      }\n    }\n\n    const entityStartIndex = textPartStart + textBeforeLength;\n    const entityEndIndex = entityStartIndex + length;\n\n    let entityContent: TextPart = text.substring(offset, offset + length);\n    const nestedEntityContent: TextPart[] = [];\n\n    if (deleteLineBreakAfterPre && entityContent.length > 0 && entityContent[0] === '\\n') {\n      entityContent = entityContent.substr(1);\n      deleteLineBreakAfterPre = false;\n    }\n\n    if (type === ApiMessageEntityTypes.Pre) {\n      deleteLineBreakAfterPre = true;\n    }\n\n    // Render nested entities, if any\n    if (nestedEntities.length) {\n      let nestedIndex = entityStartIndex;\n\n      nestedEntities.forEach((nestedEntity, nestedEntityIndex) => {\n        const {\n          renderResult: nestedResult,\n          entityEndIndex: nestedEntityEndIndex,\n        } = renderEntity(\n          nestedIndex,\n          entityEndIndex,\n          nestedEntity,\n          nestedEntityIndex === nestedEntities.length - 1,\n        );\n\n        nestedEntityContent.push(...nestedResult);\n        nestedIndex = nestedEntityEndIndex;\n      });\n    }\n\n    // Render the entity itself\n    const newEntity = shouldRenderAsHtml\n      ? processEntityAsHtml(entity, entityContent, nestedEntityContent)\n      : processEntity(entity, entityContent, nestedEntityContent);\n\n    if (Array.isArray(newEntity)) {\n      renderResult.push(...newEntity);\n    } else {\n      renderResult.push(newEntity);\n    }\n\n    // Render text after the entity, if it is the last entity in the text,\n    // or the last nested entity inside of another entity\n    if (isLastEntity && entityEndIndex < textPartEnd) {\n      let textAfter = text.substring(entityEndIndex, textPartEnd);\n      if (deleteLineBreakAfterPre && textAfter.length > 0 && textAfter[0] === '\\n') {\n        textAfter = textAfter.substring(1);\n      }\n      if (textAfter) {\n        renderResult.push(...renderMessagePart(\n          textAfter, highlight, shouldRenderHqEmoji, shouldRenderAsHtml,\n        ) as TextPart[]);\n      }\n    }\n\n    return {\n      renderResult,\n      entityEndIndex,\n    };\n  }\n\n  // Process highest-level entities\n  let index = 0;\n\n  organizedEntities.forEach((entity, arrayIndex) => {\n    const { renderResult, entityEndIndex } = renderEntity(\n      index,\n      text.length,\n      entity,\n      arrayIndex === organizedEntities.length - 1,\n    );\n\n    result.push(...renderResult);\n    index = entityEndIndex;\n  });\n\n  return result;\n}\n\nfunction processEntity(\n  entity: ApiMessageEntity,\n  entityContent: TextPart,\n  nestedEntityContent: TextPart[],\n) {\n  const entityText = typeof entityContent === 'string' && entityContent;\n  const renderedContent = nestedEntityContent.length ? nestedEntityContent : entityContent;\n\n  if (!entityText) {\n    return renderMessagePart(renderedContent);\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return <strong>{renderMessagePart(renderedContent)}</strong>;\n    case ApiMessageEntityTypes.Blockquote:\n      return <blockquote>{renderMessagePart(renderedContent)}</blockquote>;\n    case ApiMessageEntityTypes.BotCommand:\n      return (\n        <a\n          onClick={handleBotCommandClick}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Hashtag:\n      return (\n        <a\n          onClick={handleHashtagClick}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Cashtag:\n      return (\n        <a\n          onClick={handleHashtagClick}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Code:\n      return <code className=\"text-entity-code\">{renderMessagePart(renderedContent)}</code>;\n    case ApiMessageEntityTypes.Email:\n      return (\n        <a\n          href={`mailto:${entityText}`}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Italic:\n      return <em>{renderMessagePart(renderedContent)}</em>;\n    case ApiMessageEntityTypes.MentionName:\n      return (\n        <MentionLink userId={entity.userId}>\n          {renderMessagePart(renderedContent)}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Mention:\n      return (\n        <MentionLink username={entityText}>\n          {renderMessagePart(renderedContent)}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Phone:\n      return (\n        <a\n          href={`tel:${entityText}`}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Pre:\n      return <pre className=\"text-entity-pre\">{renderMessagePart(renderedContent)}</pre>;\n    case ApiMessageEntityTypes.Strike:\n      return <del>{renderMessagePart(renderedContent)}</del>;\n    case ApiMessageEntityTypes.TextUrl:\n    case ApiMessageEntityTypes.Url:\n      return (\n        <SafeLink\n          url={getLinkUrl(entityText, entity)}\n          text={entityText}\n        >\n          {renderMessagePart(renderedContent)}\n        </SafeLink>\n      );\n    case ApiMessageEntityTypes.Underline:\n      return <ins>{renderMessagePart(renderedContent)}</ins>;\n    default:\n      return renderMessagePart(renderedContent);\n  }\n}\n\nfunction renderMessagePart(\n  content: TextPart | TextPart[],\n  highlight?: string,\n  shouldRenderHqEmoji?: boolean,\n  shouldRenderAsHtml?: boolean,\n) {\n  if (Array.isArray(content)) {\n    const result: TextPart[] = [];\n\n    content.forEach((c) => {\n      result.push(...renderMessagePart(c, highlight, shouldRenderHqEmoji, shouldRenderAsHtml));\n    });\n\n    return result;\n  }\n\n  if (shouldRenderAsHtml) {\n    return renderText(content, ['escape_html', 'emoji_html', 'br_html']);\n  }\n\n  const emojiFilter = shouldRenderHqEmoji ? 'hq_emoji' : 'emoji';\n\n  if (highlight) {\n    return renderText(content, [emojiFilter, 'br', 'highlight'], { highlight });\n  } else {\n    return renderText(content, [emojiFilter, 'br']);\n  }\n}\n\nfunction getLinkUrl(entityContent: string, entity: ApiMessageEntity) {\n  const { type, url } = entity;\n  return type === ApiMessageEntityTypes.TextUrl && url ? url : entityContent;\n}\n\nfunction handleBotCommandClick(e: MouseEvent<HTMLAnchorElement>) {\n  getDispatch().sendBotCommand({ command: e.currentTarget.innerText });\n}\n\nfunction handleHashtagClick(e: MouseEvent<HTMLAnchorElement>) {\n  getDispatch().setLocalTextSearchQuery({ query: e.currentTarget.innerText });\n  getDispatch().searchTextMessagesLocal();\n}\n\nfunction processEntityAsHtml(\n  entity: ApiMessageEntity,\n  entityContent: TextPart,\n  nestedEntityContent: TextPart[],\n) {\n  const rawEntityText = typeof entityContent === 'string' && entityContent;\n\n  const renderedContent = nestedEntityContent.length\n    ? nestedEntityContent.join('')\n    : renderText(entityContent, ['escape_html', 'emoji_html', 'br_html']).join('');\n\n  if (!rawEntityText) {\n    return renderedContent;\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return `<b>${renderedContent}</b>`;\n    case ApiMessageEntityTypes.Italic:\n      return `<i>${renderedContent}</i>`;\n    case ApiMessageEntityTypes.Underline:\n      return `<u>${renderedContent}</u>`;\n    case ApiMessageEntityTypes.Code:\n      return `<code class=\"text-entity-code\">${renderedContent}</code>`;\n    case ApiMessageEntityTypes.Pre:\n      return `\\`\\`\\`<br/>${renderedContent}<br/>\\`\\`\\``;\n    case ApiMessageEntityTypes.Strike:\n      return `<del>${renderedContent}</del>`;\n    case ApiMessageEntityTypes.MentionName:\n      return `<a\n        class=\"text-entity-link\"\n        data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n        data-user-id=\"${entity.userId}\"\n        contenteditable=\"false\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    case ApiMessageEntityTypes.Url:\n    case ApiMessageEntityTypes.TextUrl:\n      return `<a\n        class=\"text-entity-link\"\n        href=${getLinkUrl(rawEntityText, entity)}\n        data-entity-type=\"${entity.type}\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    default:\n      return renderedContent;\n  }\n}\n","import {\n  useCallback, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\nimport safePlay from '../../../util/safePlay';\nimport { getDispatch } from '../../../lib/teact/teactn';\nimport useMedia from '../../../hooks/useMedia';\nimport { ActiveEmojiInteraction } from '../../../global/types';\nimport useFlag from '../../../hooks/useFlag';\nimport { selectLocalAnimatedEmojiEffectByName } from '../../../modules/selectors';\n\nconst WIDTH = {\n  large: 160,\n  medium: 128,\n  small: 104,\n};\nconst INTERACTION_BUNCH_TIME = 1000;\nconst MS_DIVIDER = 1000;\nconst TIME_DEFAULT = 0;\n\nexport default function useAnimatedEmoji(\n  size: 'large' | 'medium' | 'small',\n  chatId?: string,\n  messageId?: number,\n  soundId?: string,\n  activeEmojiInteraction?: ActiveEmojiInteraction,\n  isOwn?: boolean,\n  localEffect?: string,\n  emoji?: string,\n) {\n  const {\n    interactWithAnimatedEmoji, sendEmojiInteraction, sendWatchingEmojiInteraction,\n  } = getDispatch();\n\n  const hasEffect = localEffect || emoji;\n  const [isAnimationLoaded, markAnimationLoaded] = useFlag();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  // eslint-disable-next-line no-null/no-null\n  const audioRef = useRef<HTMLAudioElement | undefined>(null);\n\n  const soundMediaData = useMedia(soundId ? `document${soundId}` : undefined, !soundId);\n\n  const width = WIDTH[size];\n  const style = `width: ${width}px; height: ${width}px;`;\n\n  const [playKey, setPlayKey] = useState(String(Math.random()));\n  const interactions = useRef<number[] | undefined>(undefined);\n  const startedInteractions = useRef<number | undefined>(undefined);\n  const sendInteractionBunch = useCallback(() => {\n    const container = ref.current;\n\n    if (!container) return;\n\n    sendEmojiInteraction({\n      chatId,\n      messageId,\n      localEffect,\n      emoji,\n      interactions: interactions.current,\n    });\n    startedInteractions.current = undefined;\n    interactions.current = undefined;\n  }, [sendEmojiInteraction, chatId, messageId, localEffect, emoji]);\n\n  const play = useCallback(() => {\n    setPlayKey(String(Math.random()));\n\n    const audio = audioRef.current;\n    if (soundMediaData) {\n      if (audio) {\n        audio.pause();\n        audio.remove();\n      }\n      audioRef.current = new Audio();\n      audioRef.current.src = soundMediaData;\n      safePlay(audioRef.current);\n      audioRef.current.addEventListener('ended', () => {\n        audioRef.current = undefined;\n      }, { once: true });\n    }\n  }, [soundMediaData]);\n\n  const handleClick = useCallback(() => {\n    play();\n\n    const container = ref.current;\n\n    if (!hasEffect || !container || !messageId || !chatId) {\n      return;\n    }\n\n    const { x, y } = container.getBoundingClientRect();\n\n    interactWithAnimatedEmoji({\n      localEffect,\n      emoji,\n      x,\n      y,\n      startSize: width,\n      isReversed: !isOwn,\n    });\n\n    if (!interactions.current) {\n      interactions.current = [];\n      startedInteractions.current = performance.now();\n      setTimeout(sendInteractionBunch, INTERACTION_BUNCH_TIME);\n    }\n\n    interactions.current.push(startedInteractions.current\n      ? (performance.now() - startedInteractions.current) / MS_DIVIDER\n      : TIME_DEFAULT);\n  }, [\n    chatId, emoji, hasEffect, interactWithAnimatedEmoji, isOwn,\n    localEffect, messageId, play, sendInteractionBunch, width,\n  ]);\n\n  // Set an end anchor for remote activated interaction\n  useEffect(() => {\n    const container = ref.current;\n\n    if (!container || !activeEmojiInteraction) return;\n\n    const {\n      messageId: selectedMessageId, endX, endY,\n    } = activeEmojiInteraction;\n\n    if (!endX && !endY && selectedMessageId === messageId) {\n      const { x, y } = container.getBoundingClientRect();\n\n      sendWatchingEmojiInteraction({\n        chatId,\n        emoticon: localEffect ? selectLocalAnimatedEmojiEffectByName(localEffect) : emoji,\n        startSize: width,\n        x,\n        y,\n        isReversed: !isOwn,\n      });\n      play();\n    }\n  }, [\n    activeEmojiInteraction, chatId, emoji, isOwn, localEffect, messageId, play, sendWatchingEmojiInteraction, width,\n  ]);\n\n  return {\n    playKey,\n    ref,\n    style,\n    width,\n    handleClick,\n    markAnimationLoaded,\n    isAnimationLoaded,\n  };\n}\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { Bundles } from '../../util/moduleLoader';\nimport { OwnProps } from './ChatFolderModal';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst ChatFolderModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const ChatFolderModal = useModuleLoader(Bundles.Extra, 'ChatFolderModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return ChatFolderModal ? <ChatFolderModal {...props} /> : undefined;\n};\n\nexport default memo(ChatFolderModalAsync);\n","import { useMemo } from '../../../../lib/teact/teact';\n\nexport enum ChatAnimationTypes {\n  Move,\n  Opacity,\n  None,\n}\n\nexport function useChatAnimationType(orderDiffById: Record<string, number>) {\n  return useMemo(() => {\n    const orderDiffs = Object.values(orderDiffById);\n    const numberOfUp = orderDiffs.filter((diff) => diff < 0).length;\n    const numberOfDown = orderDiffs.filter((diff) => diff > 0).length;\n\n    return (chatId: string): ChatAnimationTypes => {\n      const orderDiff = orderDiffById[chatId];\n      if (orderDiff === 0) {\n        return ChatAnimationTypes.None;\n      }\n\n      if (\n        orderDiff === Infinity\n        || orderDiff === -Infinity\n        || (numberOfUp <= numberOfDown && orderDiff < 0)\n        || (numberOfDown < numberOfUp && orderDiff > 0)\n      ) {\n        return ChatAnimationTypes.Opacity;\n      }\n\n      return ChatAnimationTypes.Move;\n    };\n  }, [orderDiffById]);\n}\n","import React, { FC, memo } from '../../../lib/teact/teact';\n\nimport { ApiChat } from '../../../api/types';\n\nimport { formatIntegerCompact } from '../../../util/textFormat';\nimport buildClassName from '../../../util/buildClassName';\n\nimport ShowTransition from '../../ui/ShowTransition';\n\nimport './Badge.scss';\n\ntype OwnProps = {\n  chat: ApiChat;\n  isPinned?: boolean;\n  isMuted?: boolean;\n};\n\nconst Badge: FC<OwnProps> = ({ chat, isPinned, isMuted }) => {\n  const isShown = Boolean(chat.unreadCount || chat.hasUnreadMark || isPinned);\n  const className = buildClassName(\n    'Badge',\n    isMuted && 'muted',\n    isPinned && 'pinned',\n    Boolean(chat.unreadCount || chat.hasUnreadMark) && 'unread',\n  );\n\n  function renderContent() {\n    if (chat.unreadCount) {\n      if (chat.unreadMentionsCount) {\n        return (\n          <div className=\"Badge-wrapper\">\n            <div className=\"Badge mention\">\n              <i className=\"icon-mention\" />\n            </div>\n            <div className={className}>\n              {formatIntegerCompact(chat.unreadCount)}\n            </div>\n          </div>\n        );\n      }\n\n      return (\n        <div className={className}>\n          {formatIntegerCompact(chat.unreadCount)}\n        </div>\n      );\n    } else if (chat.hasUnreadMark) {\n      return (\n        <div className={className} />\n      );\n    } else if (isPinned) {\n      return (\n        <div className={className}>\n          <i className=\"icon-pinned-chat\" />\n        </div>\n      );\n    }\n\n    return undefined;\n  }\n\n  return (\n    <ShowTransition isCustom className=\"Badge-transition\" isOpen={isShown}>\n      {renderContent}\n    </ShowTransition>\n  );\n};\n\nexport default memo(Badge);\n","import React, { FC, memo } from '../../../lib/teact/teact';\nimport buildClassName from '../../../util/buildClassName';\n\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\n\nimport './ChatCallStatus.scss';\n\ntype OwnProps = {\n  isSelected?: boolean;\n  isActive?: boolean;\n};\n\nconst ChatCallStatus: FC<OwnProps> = ({\n  isSelected,\n  isActive,\n}) => {\n  return (\n    <div className={buildClassName(\n      'ChatCallStatus',\n      isActive && 'active',\n      isSelected && !IS_SINGLE_COLUMN_LAYOUT && 'selected',\n    )}\n    >\n      <div className=\"indicator\">\n        <div />\n        <div />\n        <div />\n      </div>\n    </div>\n  );\n};\n\nexport default memo(ChatCallStatus);\n","import React, {\n  FC, memo, useCallback, useLayoutEffect, useMemo, useRef,\n} from '../../../lib/teact/teact';\nimport { getDispatch, getGlobal, withGlobal } from '../../../lib/teact/teactn';\n\nimport useLang, { LangFn } from '../../../hooks/useLang';\n\nimport {\n  ApiChat, ApiUser, ApiMessage, ApiMessageOutgoingStatus, ApiFormattedText, MAIN_THREAD_ID, ApiUserStatus,\n} from '../../../api/types';\n\nimport { ANIMATION_END_DELAY } from '../../../config';\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\nimport {\n  getChatTitle,\n  isUserId,\n  isActionMessage,\n  getPrivateChatUserId,\n  getMessageAction,\n  getMessageSenderName,\n  isChatChannel,\n  getMessageMediaHash,\n  getMessageSummaryText,\n  getMessageMediaThumbDataUri,\n  getMessageVideo,\n  getMessageSticker,\n  selectIsChatMuted,\n  getMessageRoundVideo,\n} from '../../../modules/helpers';\nimport {\n  selectChat, selectUser, selectChatMessage, selectOutgoingStatus, selectDraft, selectCurrentMessageList,\n  selectNotifySettings, selectNotifyExceptions, selectUserStatus,\n} from '../../../modules/selectors';\nimport { renderActionMessageText } from '../../common/helpers/renderActionMessageText';\nimport renderText from '../../common/helpers/renderText';\nimport { fastRaf } from '../../../util/schedulers';\nimport buildClassName from '../../../util/buildClassName';\nimport useEnsureMessage from '../../../hooks/useEnsureMessage';\nimport useChatContextActions from '../../../hooks/useChatContextActions';\nimport useFlag from '../../../hooks/useFlag';\nimport useMedia from '../../../hooks/useMedia';\nimport { ChatAnimationTypes } from './hooks';\n\nimport Avatar from '../../common/Avatar';\nimport VerifiedIcon from '../../common/VerifiedIcon';\nimport TypingStatus from '../../common/TypingStatus';\nimport LastMessageMeta from '../../common/LastMessageMeta';\nimport DeleteChatModal from '../../common/DeleteChatModal';\nimport ListItem from '../../ui/ListItem';\nimport Badge from './Badge';\nimport ChatFolderModal from '../ChatFolderModal.async';\nimport ChatCallStatus from './ChatCallStatus';\n\nimport './Chat.scss';\n\ntype OwnProps = {\n  style?: string;\n  chatId: string;\n  folderId?: number;\n  orderDiff: number;\n  animationType: ChatAnimationTypes;\n  isPinned?: boolean;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  isMuted?: boolean;\n  user?: ApiUser;\n  userStatus?: ApiUserStatus;\n  actionTargetUserIds?: string[];\n  actionTargetMessage?: ApiMessage;\n  actionTargetChatId?: string;\n  lastMessageSender?: ApiUser;\n  lastMessageOutgoingStatus?: ApiMessageOutgoingStatus;\n  draft?: ApiFormattedText;\n  animationLevel?: number;\n  isSelected?: boolean;\n  canScrollDown?: boolean;\n  canChangeFolder?: boolean;\n  lastSyncTime?: number;\n};\n\nconst ANIMATION_DURATION = 200;\n\nconst Chat: FC<OwnProps & StateProps> = ({\n  style,\n  chatId,\n  folderId,\n  orderDiff,\n  animationType,\n  isPinned,\n  chat,\n  isMuted,\n  user,\n  userStatus,\n  actionTargetUserIds,\n  lastMessageSender,\n  lastMessageOutgoingStatus,\n  actionTargetMessage,\n  actionTargetChatId,\n  draft,\n  animationLevel,\n  isSelected,\n  canScrollDown,\n  canChangeFolder,\n  lastSyncTime,\n}) => {\n  const {\n    openChat,\n    focusLastMessage,\n  } = getDispatch();\n\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const [isDeleteModalOpen, openDeleteModal, closeDeleteModal] = useFlag();\n  const [isChatFolderModalOpen, openChatFolderModal, closeChatFolderModal] = useFlag();\n  const [shouldRenderDeleteModal, markRenderDeleteModal, unmarkRenderDeleteModal] = useFlag();\n  const [shouldRenderChatFolderModal, markRenderChatFolderModal, unmarkRenderChatFolderModal] = useFlag();\n\n  const { lastMessage, typingStatus } = chat || {};\n  const isAction = lastMessage && isActionMessage(lastMessage);\n\n  useEnsureMessage(chatId, isAction ? lastMessage!.replyToMessageId : undefined, actionTargetMessage);\n\n  const mediaThumbnail = lastMessage && !getMessageSticker(lastMessage)\n    ? getMessageMediaThumbDataUri(lastMessage)\n    : undefined;\n  const mediaBlobUrl = useMedia(lastMessage ? getMessageMediaHash(lastMessage, 'micro') : undefined);\n  const isRoundVideo = Boolean(lastMessage && getMessageRoundVideo(lastMessage));\n\n  const actionTargetUsers = useMemo(() => {\n    if (!actionTargetUserIds) {\n      return undefined;\n    }\n\n    // No need for expensive global updates on users, so we avoid them\n    const usersById = getGlobal().users.byId;\n    return actionTargetUserIds.map((userId) => usersById[userId]).filter<ApiUser>(Boolean as any);\n  }, [actionTargetUserIds]);\n\n  // Sets animation excess values when `orderDiff` changes and then resets excess values to animate.\n  useLayoutEffect(() => {\n    const element = ref.current;\n\n    if (animationLevel === 0 || !element) {\n      return;\n    }\n\n    // TODO Refactor animation: create `useListAnimation` that owns `orderDiff` and `animationType`\n    if (animationType === ChatAnimationTypes.Opacity) {\n      element.style.opacity = '0';\n\n      fastRaf(() => {\n        element.classList.add('animate-opacity');\n        element.style.opacity = '1';\n      });\n    } else if (animationType === ChatAnimationTypes.Move) {\n      element.style.transform = `translate3d(0, ${-orderDiff * 100}%, 0)`;\n\n      fastRaf(() => {\n        element.classList.add('animate-transform');\n        element.style.transform = '';\n      });\n    } else {\n      return;\n    }\n\n    setTimeout(() => {\n      fastRaf(() => {\n        element.classList.remove('animate-opacity', 'animate-transform');\n        element.style.opacity = '';\n        element.style.transform = '';\n      });\n    }, ANIMATION_DURATION + ANIMATION_END_DELAY);\n  }, [animationLevel, orderDiff, animationType]);\n\n  const handleClick = useCallback(() => {\n    openChat({ id: chatId, shouldReplaceHistory: true });\n\n    if (isSelected && canScrollDown) {\n      focusLastMessage();\n    }\n  }, [\n    isSelected,\n    canScrollDown,\n    openChat,\n    chatId,\n    focusLastMessage,\n  ]);\n\n  function handleDelete() {\n    markRenderDeleteModal();\n    openDeleteModal();\n  }\n\n  function handleChatFolderChange() {\n    markRenderChatFolderModal();\n    openChatFolderModal();\n  }\n\n  const contextActions = useChatContextActions({\n    chat,\n    user,\n    handleDelete,\n    handleChatFolderChange,\n    folderId,\n    isPinned,\n    isMuted,\n    canChangeFolder,\n  });\n\n  const lang = useLang();\n\n  if (!chat) {\n    return undefined;\n  }\n\n  function renderLastMessageOrTyping() {\n    if (typingStatus && lastMessage && typingStatus.timestamp > lastMessage.date * 1000) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (draft?.text.length) {\n      return (\n        <p className=\"last-message\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n          <span className=\"draft\">{lang('Draft')}</span>\n          {renderText(draft.text)}\n        </p>\n      );\n    }\n\n    if (!lastMessage) {\n      return undefined;\n    }\n\n    if (isAction) {\n      const actionOrigin = chat && (isChatChannel(chat) || lastMessage.senderId === lastMessage.chatId)\n        ? chat\n        : lastMessageSender;\n\n      return (\n        <p className=\"last-message\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n          {renderText(renderActionMessageText(\n            lang,\n            lastMessage,\n            actionOrigin,\n            actionTargetUsers,\n            actionTargetMessage,\n            actionTargetChatId,\n            { asPlain: true },\n          ) as string)}\n        </p>\n      );\n    }\n\n    const senderName = getMessageSenderName(lang, chatId, lastMessageSender);\n\n    return (\n      <p className=\"last-message\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n        {senderName && (\n          <>\n            <span className=\"sender-name\">{renderText(senderName)}</span>\n            <span className=\"colon\">:</span>\n          </>\n        )}\n        {renderMessageSummary(lang, lastMessage!, mediaBlobUrl || mediaThumbnail, isRoundVideo)}\n      </p>\n    );\n  }\n\n  const className = buildClassName(\n    'Chat chat-item-clickable',\n    isUserId(chatId) ? 'private' : 'group',\n    isSelected && 'selected',\n  );\n\n  return (\n    <ListItem\n      ref={ref}\n      className={className}\n      style={style}\n      ripple={!IS_SINGLE_COLUMN_LAYOUT}\n      contextActions={contextActions}\n      onClick={handleClick}\n    >\n      <div className=\"status\">\n        <Avatar\n          chat={chat}\n          user={user}\n          userStatus={userStatus}\n          isSavedMessages={user?.isSelf}\n          lastSyncTime={lastSyncTime}\n        />\n        {chat.isCallActive && chat.isCallNotEmpty && (\n          <ChatCallStatus isSelected={isSelected} isActive={animationLevel !== 0} />\n        )}\n      </div>\n      <div className=\"info\">\n        <div className=\"title\">\n          <h3>{renderText(getChatTitle(lang, chat, user))}</h3>\n          {chat.isVerified && <VerifiedIcon />}\n          {isMuted && <i className=\"icon-muted\" />}\n          {chat.lastMessage && (\n            <LastMessageMeta\n              message={chat.lastMessage}\n              outgoingStatus={lastMessageOutgoingStatus}\n            />\n          )}\n        </div>\n        <div className=\"subtitle\">\n          {renderLastMessageOrTyping()}\n          <Badge chat={chat} isPinned={isPinned} isMuted={isMuted} />\n        </div>\n      </div>\n      {shouldRenderDeleteModal && (\n        <DeleteChatModal\n          isOpen={isDeleteModalOpen}\n          onClose={closeDeleteModal}\n          onCloseAnimationEnd={unmarkRenderDeleteModal}\n          chat={chat}\n        />\n      )}\n      {shouldRenderChatFolderModal && (\n        <ChatFolderModal\n          isOpen={isChatFolderModalOpen}\n          onClose={closeChatFolderModal}\n          onCloseAnimationEnd={unmarkRenderChatFolderModal}\n          chatId={chatId}\n        />\n      )}\n    </ListItem>\n  );\n};\n\nfunction renderMessageSummary(lang: LangFn, message: ApiMessage, blobUrl?: string, isRoundVideo?: boolean) {\n  if (!blobUrl) {\n    return renderText(getMessageSummaryText(lang, message));\n  }\n\n  return (\n    <span className=\"media-preview\">\n      <img src={blobUrl} alt=\"\" className={isRoundVideo ? 'round' : undefined} />\n      {getMessageVideo(message) && <i className=\"icon-play\" />}\n      {renderText(getMessageSummaryText(lang, message, true))}\n    </span>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId }): StateProps => {\n    const chat = selectChat(global, chatId);\n    if (!chat || !chat.lastMessage) {\n      return {};\n    }\n\n    const { senderId, replyToMessageId, isOutgoing } = chat.lastMessage;\n    const lastMessageSender = senderId ? selectUser(global, senderId) : undefined;\n    const lastMessageAction = getMessageAction(chat.lastMessage);\n    const actionTargetMessage = lastMessageAction && replyToMessageId\n      ? selectChatMessage(global, chat.id, replyToMessageId)\n      : undefined;\n    const { targetUserIds: actionTargetUserIds, targetChatId: actionTargetChatId } = lastMessageAction || {};\n    const privateChatUserId = getPrivateChatUserId(chat);\n    const {\n      chatId: currentChatId,\n      threadId: currentThreadId,\n      type: messageListType,\n    } = selectCurrentMessageList(global) || {};\n    const isSelected = chatId === currentChatId && currentThreadId === MAIN_THREAD_ID;\n\n    return {\n      chat,\n      isMuted: selectIsChatMuted(chat, selectNotifySettings(global), selectNotifyExceptions(global)),\n      lastMessageSender,\n      actionTargetUserIds,\n      actionTargetChatId,\n      actionTargetMessage,\n      draft: selectDraft(global, chatId, MAIN_THREAD_ID),\n      animationLevel: global.settings.byKey.animationLevel,\n      isSelected,\n      canScrollDown: isSelected && messageListType === 'thread',\n      canChangeFolder: Boolean(global.chatFolders.orderedIds?.length),\n      lastSyncTime: global.lastSyncTime,\n      ...(isOutgoing && { lastMessageOutgoingStatus: selectOutgoingStatus(global, chat.lastMessage) }),\n      ...(privateChatUserId && {\n        user: selectUser(global, privateChatUserId),\n        userStatus: selectUserStatus(global, privateChatUserId),\n      }),\n    };\n  },\n)(Chat));\n","import React, { FC, memo, useCallback } from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../lib/teact/teactn';\n\nimport { ApiChatFolder, ApiSticker } from '../../../api/types';\nimport { SettingsScreens } from '../../../types';\nimport { FolderEditDispatch } from '../../../hooks/reducers/useFoldersReducer';\n\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\nimport { selectAnimatedEmoji, selectChatFolder } from '../../../modules/selectors';\nimport useLang from '../../../hooks/useLang';\n\nimport Button from '../../ui/Button';\nimport AnimatedEmoji from '../../common/AnimatedEmoji';\n\nimport './EmptyFolder.scss';\n\ntype OwnProps = {\n  folderId?: number;\n  folderType: 'all' | 'archived' | 'folder';\n  foldersDispatch?: FolderEditDispatch;\n  onScreenSelect?: (screen: SettingsScreens) => void;\n};\n\ntype StateProps = {\n  chatFolder?: ApiChatFolder;\n  animatedEmoji?: ApiSticker;\n};\n\nconst EmptyFolder: FC<OwnProps & StateProps> = ({\n  chatFolder, animatedEmoji, foldersDispatch, onScreenSelect,\n}) => {\n  const lang = useLang();\n\n  const handleEditFolder = useCallback(() => {\n    foldersDispatch!({ type: 'editFolder', payload: chatFolder });\n    onScreenSelect!(SettingsScreens.FoldersEditFolderFromChatList);\n  }, [chatFolder, foldersDispatch, onScreenSelect]);\n\n  return (\n    <div className=\"EmptyFolder\">\n      <div className=\"sticker\">{animatedEmoji && <AnimatedEmoji sticker={animatedEmoji} />}</div>\n      <h3 className=\"title\" dir=\"auto\">{lang('FilterNoChatsToDisplay')}</h3>\n      <p className=\"description\" dir=\"auto\">\n        {lang(chatFolder ? 'ChatList.EmptyChatListFilterText' : 'Chat.EmptyChat')}\n      </p>\n      {chatFolder && foldersDispatch && onScreenSelect && (\n        <Button\n          ripple={!IS_SINGLE_COLUMN_LAYOUT}\n          fluid\n          pill\n          onClick={handleEditFolder}\n          size=\"smaller\"\n          isRtl={lang.isRtl}\n        >\n          <i className=\"icon-settings\" />\n          {lang('ChatList.EmptyChatListEditFilter')}\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>((global, { folderId, folderType }): StateProps => {\n  const chatFolder = folderId && folderType === 'folder' ? selectChatFolder(global, folderId) : undefined;\n\n  return {\n    chatFolder,\n    animatedEmoji: selectAnimatedEmoji(global, '📂'),\n  };\n})(EmptyFolder));\n","import React, {\n  FC, memo, useMemo, useCallback, useEffect,\n} from '../../../lib/teact/teact';\nimport { getDispatch, withGlobal } from '../../../lib/teact/teactn';\n\nimport { GlobalState } from '../../../global/types';\nimport {\n  ApiChat, ApiChatFolder, ApiUser,\n} from '../../../api/types';\nimport { NotifyException, NotifySettings, SettingsScreens } from '../../../types';\nimport { FolderEditDispatch } from '../../../hooks/reducers/useFoldersReducer';\n\nimport { ALL_CHATS_PRELOAD_DISABLED, CHAT_HEIGHT_PX, CHAT_LIST_SLICE } from '../../../config';\nimport { IS_ANDROID, IS_MAC_OS, IS_PWA } from '../../../util/environment';\nimport usePrevious from '../../../hooks/usePrevious';\nimport { mapValues } from '../../../util/iteratees';\nimport {\n  getChatOrder, prepareChatList, prepareFolderListIds, reduceChatList,\n} from '../../../modules/helpers';\nimport {\n  selectChatFolder, selectNotifyExceptions, selectNotifySettings,\n} from '../../../modules/selectors';\nimport useInfiniteScroll from '../../../hooks/useInfiniteScroll';\nimport { useChatAnimationType } from './hooks';\n\nimport InfiniteScroll from '../../ui/InfiniteScroll';\nimport Loading from '../../ui/Loading';\nimport Chat from './Chat';\nimport EmptyFolder from './EmptyFolder';\n\ntype OwnProps = {\n  folderType: 'all' | 'archived' | 'folder';\n  folderId?: number;\n  isActive: boolean;\n  onScreenSelect?: (screen: SettingsScreens) => void;\n  foldersDispatch?: FolderEditDispatch;\n};\n\ntype StateProps = {\n  allListIds: GlobalState['chats']['listIds'];\n  chatsById: Record<string, ApiChat>;\n  usersById: Record<string, ApiUser>;\n  listIds?: string[];\n  orderedPinnedIds?: string[];\n  chatFolder?: ApiChatFolder;\n  lastSyncTime?: number;\n  notifySettings: NotifySettings;\n  notifyExceptions?: Record<number, NotifyException>;\n};\n\nenum FolderTypeToListType {\n  'all' = 'active',\n  'archived' = 'archived',\n}\n\nconst ChatList: FC<OwnProps & StateProps> = ({\n  folderType,\n  folderId,\n  isActive,\n  allListIds,\n  chatsById,\n  usersById,\n  listIds,\n  orderedPinnedIds,\n  chatFolder,\n  lastSyncTime,\n  notifySettings,\n  notifyExceptions,\n  foldersDispatch,\n  onScreenSelect,\n}) => {\n  const {\n    loadMoreChats,\n    preloadTopChatMessages,\n    preloadArchivedChats,\n    openChat,\n    openNextChat,\n  } = getDispatch();\n\n  const [currentListIds, currentPinnedIds] = useMemo(() => {\n    return folderType === 'folder' && chatFolder\n      ? prepareFolderListIds(allListIds, chatsById, usersById, chatFolder, notifySettings, notifyExceptions)\n      : [listIds, orderedPinnedIds];\n  }, [\n    folderType, chatFolder, allListIds, chatsById, usersById,\n    notifySettings, notifyExceptions, listIds, orderedPinnedIds,\n  ]);\n\n  const [orderById, orderedIds, chatArrays] = useMemo(() => {\n    if (!currentListIds || (folderType === 'folder' && !chatFolder)) {\n      return [];\n    }\n\n    const newChatArrays = prepareChatList(chatsById, currentListIds, currentPinnedIds, folderType);\n    const singleList = ([] as ApiChat[]).concat(newChatArrays.pinnedChats, newChatArrays.otherChats);\n    const newOrderedIds = singleList.map(({ id }) => id);\n    const newOrderById = singleList.reduce((acc, chat, i) => {\n      acc[chat.id] = i;\n      return acc;\n    }, {} as Record<string, number>);\n\n    return [newOrderById, newOrderedIds, newChatArrays];\n  }, [currentListIds, currentPinnedIds, folderType, chatFolder, chatsById]);\n\n  const prevOrderById = usePrevious(orderById);\n\n  const orderDiffById = useMemo(() => {\n    if (!orderById || !prevOrderById) {\n      return {};\n    }\n\n    return mapValues(orderById, (order, id) => {\n      return prevOrderById[id] !== undefined ? order - prevOrderById[id] : -Infinity;\n    });\n  }, [orderById, prevOrderById]);\n\n  const loadMoreOfType = useCallback(() => {\n    loadMoreChats({ listType: folderType === 'archived' ? 'archived' : 'active' });\n  }, [loadMoreChats, folderType]);\n\n  const [viewportIds, getMore] = useInfiniteScroll(\n    lastSyncTime ? loadMoreOfType : undefined,\n    orderedIds,\n    undefined,\n    CHAT_LIST_SLICE,\n    folderType === 'all' && !ALL_CHATS_PRELOAD_DISABLED,\n  );\n\n  const viewportChatArrays = useMemo(() => {\n    if (!viewportIds || !chatArrays) {\n      return undefined;\n    }\n\n    return reduceChatList(chatArrays, viewportIds);\n  }, [chatArrays, viewportIds]);\n\n  useEffect(() => {\n    if (lastSyncTime && folderType === 'all') {\n      preloadTopChatMessages();\n      preloadArchivedChats();\n    }\n  }, [lastSyncTime, folderType, preloadTopChatMessages, preloadArchivedChats]);\n\n  // Support <Cmd>+<Digit> and <Alt>+<Up/Down> to navigate between chats\n  useEffect(() => {\n    if (!isActive || !orderedIds) {\n      return undefined;\n    }\n\n    function handleKeyDown(e: KeyboardEvent) {\n      if (IS_PWA && ((IS_MAC_OS && e.metaKey) || (!IS_MAC_OS && e.ctrlKey)) && e.code.startsWith('Digit')) {\n        const [, digit] = e.code.match(/Digit(\\d)/) || [];\n        if (!digit) return;\n\n        const position = Number(digit) - 1;\n        if (position > orderedIds!.length - 1) return;\n\n        openChat({ id: orderedIds![position], shouldReplaceHistory: true });\n      }\n\n      if (e.altKey) {\n        const targetIndexDelta = e.key === 'ArrowDown' ? 1 : e.key === 'ArrowUp' ? -1 : undefined;\n        if (!targetIndexDelta) return;\n\n        e.preventDefault();\n        openNextChat({ targetIndexDelta, orderedIds });\n      }\n    }\n\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [isActive, openChat, openNextChat, orderedIds]);\n\n  const getAnimationType = useChatAnimationType(orderDiffById);\n\n  function renderChats() {\n    const viewportOffset = orderedIds!.indexOf(viewportIds![0]);\n    const pinnedOffset = viewportOffset + viewportChatArrays!.pinnedChats.length;\n\n    return (\n      <div\n        className=\"scroll-container\"\n        // @ts-ignore\n        style={IS_ANDROID ? `height: ${orderedIds!.length * CHAT_HEIGHT_PX}px` : undefined}\n        teactFastList\n      >\n        {viewportChatArrays!.pinnedChats.map(({ id }, i) => (\n          <Chat\n            key={id}\n            teactOrderKey={i}\n            chatId={id}\n            isPinned\n            folderId={folderId}\n            animationType={getAnimationType(id)}\n            orderDiff={orderDiffById[id]}\n            // @ts-ignore\n            style={`top: ${(viewportOffset + i) * CHAT_HEIGHT_PX}px;`}\n          />\n        ))}\n        {viewportChatArrays!.otherChats.map((chat, i) => (\n          <Chat\n            key={chat.id}\n            teactOrderKey={getChatOrder(chat)}\n            chatId={chat.id}\n            folderId={folderId}\n            animationType={getAnimationType(chat.id)}\n            orderDiff={orderDiffById[chat.id]}\n            // @ts-ignore\n            style={`top: ${(pinnedOffset + i) * CHAT_HEIGHT_PX}px;`}\n          />\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <InfiniteScroll\n      className=\"chat-list custom-scroll\"\n      items={viewportIds}\n      onLoadMore={getMore}\n      preloadBackwards={CHAT_LIST_SLICE}\n      noFastList\n      noScrollRestore\n    >\n      {viewportIds?.length && viewportChatArrays ? (\n        renderChats()\n      ) : viewportIds && !viewportIds.length ? (\n        (\n          <EmptyFolder\n            folderId={folderId}\n            folderType={folderType}\n            foldersDispatch={foldersDispatch}\n            onScreenSelect={onScreenSelect}\n          />\n        )\n      ) : (\n        <Loading key=\"loading\" />\n      )}\n    </InfiniteScroll>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { folderType, folderId }): StateProps => {\n    const {\n      chats: {\n        listIds,\n        byId: chatsById,\n        orderedPinnedIds,\n      },\n      users: { byId: usersById },\n      lastSyncTime,\n    } = global;\n    const listType = folderType !== 'folder' ? FolderTypeToListType[folderType] : undefined;\n    const chatFolder = folderId ? selectChatFolder(global, folderId) : undefined;\n\n    return {\n      allListIds: listIds,\n      chatsById,\n      usersById,\n      lastSyncTime,\n      notifySettings: selectNotifySettings(global),\n      notifyExceptions: selectNotifyExceptions(global),\n      ...(listType ? {\n        listIds: listIds[listType],\n        orderedPinnedIds: orderedPinnedIds[listType],\n      } : {\n        chatFolder,\n      }),\n    };\n  },\n)(ChatList));\n","import { ApiChat, ApiMessage, ApiUser } from '../../../../api/types';\nimport {\n  getChatTitle,\n  getSenderTitle,\n  isUserId,\n  isChatGroup,\n} from '../../../../modules/helpers';\nimport { LangFn } from '../../../../hooks/useLang';\n\nexport function getSenderName(\n  lang: LangFn, message: ApiMessage, chatsById: Record<string, ApiChat>, usersById: Record<string, ApiUser>,\n) {\n  const { senderId } = message;\n  if (!senderId) {\n    return undefined;\n  }\n\n  const sender = isUserId(senderId) ? usersById[senderId] : chatsById[senderId];\n\n  let senderName = getSenderTitle(lang, sender);\n\n  const chat = chatsById[message.chatId];\n  if (chat) {\n    if (isUserId(senderId) && (sender as ApiUser).isSelf) {\n      senderName = `${lang('FromYou')} → ${getChatTitle(lang, chat)}`;\n    } else if (isChatGroup(chat)) {\n      senderName += ` → ${getChatTitle(lang, chat)}`;\n    }\n  }\n\n  return senderName;\n}\n","import React, { FC, memo } from '../../../lib/teact/teact';\n\nimport useFlag from '../../../hooks/useFlag';\nimport buildClassName from '../../../util/buildClassName';\n\nimport './DropTarget.scss';\n\nexport type OwnProps = {\n  isQuick?: boolean;\n  onFileSelect: (e: React.DragEvent<HTMLDivElement>) => void;\n};\n\nconst DropTarget: FC<OwnProps> = ({ isQuick, onFileSelect }) => {\n  const [isHovered, markHovered, unmarkHovered] = useFlag();\n\n  const handleDragEnter = () => { markHovered(); };\n  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\n    const { relatedTarget: toTarget } = e;\n\n    if (toTarget) {\n      e.stopPropagation();\n    }\n\n    unmarkHovered();\n  };\n\n  const className = buildClassName(\n    'DropTarget',\n    isHovered && 'hovered',\n  );\n\n  return (\n    <div\n      className={className}\n      onDrop={onFileSelect}\n      onDragEnter={handleDragEnter}\n      onDragLeave={handleDragLeave}\n    >\n      <div className=\"target-content\">\n        <div className={`icon icon-${isQuick ? 'photo' : 'document'}`} />\n        <div className=\"title\">Drop files here to send them</div>\n        <div className=\"description\">{isQuick ? 'in a quick way' : 'without compression'}</div>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(DropTarget);\n","import React, {\n  FC, memo, useCallback, useEffect, useRef,\n} from '../../../lib/teact/teact';\n\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport buildClassName from '../../../util/buildClassName';\n\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport usePrevious from '../../../hooks/usePrevious';\n\nimport Portal from '../../ui/Portal';\nimport DropTarget from './DropTarget';\n\nimport './DropArea.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  withQuick?: boolean;\n  onHide: NoneToVoidFunction;\n  onFileSelect: (files: File[], isQuick: boolean) => void;\n};\n\nexport enum DropAreaState {\n  None = 'none',\n  Document = 'document',\n  QuickFile = 'quick_file',\n}\n\nconst DROP_LEAVE_TIMEOUT_MS = 150;\n\nconst DropArea: FC<OwnProps> = ({\n  isOpen, withQuick, onHide, onFileSelect,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const hideTimeoutRef = useRef<number>(null);\n  const prevWithQuick = usePrevious(withQuick);\n  const { shouldRender, transitionClassNames } = useShowTransition(isOpen);\n\n  useEffect(() => (isOpen ? captureEscKeyListener(onHide) : undefined), [isOpen, onHide]);\n\n  const handleFilesDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n\n    if (dt.files && dt.files.length > 0) {\n      onHide();\n      onFileSelect(Array.from(dt.files), false);\n    }\n  }, [onFileSelect, onHide]);\n\n  const handleQuickFilesDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n\n    if (dt.files && dt.files.length > 0) {\n      onHide();\n      onFileSelect(Array.from(dt.files), true);\n    }\n  }, [onFileSelect, onHide]);\n\n  const handleDragLeave = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n\n    const { target: fromTarget, relatedTarget: toTarget } = e;\n\n    // Esc button pressed during drag event\n    if ((fromTarget as HTMLDivElement).matches('.DropTarget, .DropArea') && !toTarget) {\n      hideTimeoutRef.current = window.setTimeout(() => {\n        onHide();\n      }, DROP_LEAVE_TIMEOUT_MS);\n    }\n  }, [onHide]);\n\n  const handleDragOver = () => {\n    if (hideTimeoutRef.current) {\n      window.clearTimeout(hideTimeoutRef.current);\n    }\n  };\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const className = buildClassName(\n    'DropArea',\n    transitionClassNames,\n  );\n\n  return (\n    <Portal containerId=\"#middle-column-portals\">\n      <div className={className} onDragLeave={handleDragLeave} onDragOver={handleDragOver} onDrop={onHide}>\n        <DropTarget onFileSelect={handleFilesDrop} />\n        {(withQuick || prevWithQuick) && <DropTarget onFileSelect={handleQuickFilesDrop} isQuick />}\n      </div>\n    </Portal>\n  );\n};\n\nexport default memo(DropArea);\n","import React, { FC, memo } from '../../../lib/teact/teact';\nimport { OwnProps } from './EmojiTooltip';\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst EmojiTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const EmojiTooltip = useModuleLoader(Bundles.Extra, 'EmojiTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return EmojiTooltip ? <EmojiTooltip {...props} /> : undefined;\n};\n\nexport default memo(EmojiTooltipAsync);\n","import { ChangeEvent } from 'react';\nimport React, {\n  FC, useEffect, useRef, memo, useState, useCallback,\n} from '../../../lib/teact/teact';\nimport { getDispatch, withGlobal } from '../../../lib/teact/teactn';\n\nimport { IAnchorPosition, ISettings } from '../../../types';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport { selectReplyingToId } from '../../../modules/selectors';\nimport { debounce } from '../../../util/schedulers';\nimport focusEditableElement from '../../../util/focusEditableElement';\nimport buildClassName from '../../../util/buildClassName';\nimport {\n  IS_ANDROID, IS_EMOJI_SUPPORTED, IS_IOS, IS_SINGLE_COLUMN_LAYOUT, IS_TOUCH_ENV,\n} from '../../../util/environment';\nimport captureKeyboardListeners from '../../../util/captureKeyboardListeners';\nimport useLayoutEffectWithPrevDeps from '../../../hooks/useLayoutEffectWithPrevDeps';\nimport useFlag from '../../../hooks/useFlag';\nimport { isHeavyAnimating } from '../../../hooks/useHeavyAnimationCheck';\nimport useSendMessageAction from '../../../hooks/useSendMessageAction';\nimport useLang from '../../../hooks/useLang';\nimport parseEmojiOnlyString from '../../common/helpers/parseEmojiOnlyString';\nimport { isSelectionInsideInput } from './helpers/selection';\nimport renderText from '../../common/helpers/renderText';\n\nimport TextFormatter from './TextFormatter';\n\nconst CONTEXT_MENU_CLOSE_DELAY_MS = 100;\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 350;\nconst TRANSITION_DURATION_FACTOR = 50;\n\ntype OwnProps = {\n  id: string;\n  chatId: string;\n  threadId: number;\n  isAttachmentModalInput?: boolean;\n  editableInputId?: string;\n  html: string;\n  placeholder: string;\n  forcedPlaceholder?: string;\n  canAutoFocus: boolean;\n  shouldSuppressFocus?: boolean;\n  shouldSuppressTextFormatter?: boolean;\n  onUpdate: (html: string) => void;\n  onSuppressedFocus?: () => void;\n  onSend: () => void;\n};\n\ntype StateProps = {\n  replyingToId?: number;\n  noTabCapture?: boolean;\n  messageSendKeyCombo?: ISettings['messageSendKeyCombo'];\n};\n\nconst MAX_INPUT_HEIGHT = IS_SINGLE_COLUMN_LAYOUT ? 256 : 416;\nconst TAB_INDEX_PRIORITY_TIMEOUT = 2000;\nconst TEXT_FORMATTER_SAFE_AREA_PX = 90;\n// For some reason Safari inserts `<br>` after user removes text from input\nconst SAFARI_BR = '<br>';\n\nfunction clearSelection() {\n  const selection = window.getSelection();\n  if (!selection) {\n    return;\n  }\n\n  if (selection.removeAllRanges) {\n    selection.removeAllRanges();\n  } else if (selection.empty) {\n    selection.empty();\n  }\n}\n\nconst MessageInput: FC<OwnProps & StateProps> = ({\n  id,\n  chatId,\n  threadId,\n  isAttachmentModalInput,\n  editableInputId,\n  html,\n  placeholder,\n  forcedPlaceholder,\n  canAutoFocus,\n  shouldSuppressFocus,\n  shouldSuppressTextFormatter,\n  replyingToId,\n  noTabCapture,\n  messageSendKeyCombo,\n  onUpdate,\n  onSuppressedFocus,\n  onSend,\n}) => {\n  const {\n    editLastMessage,\n    replyToNextMessage,\n  } = getDispatch();\n\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const cloneRef = useRef<HTMLDivElement>(null);\n\n  const lang = useLang();\n  const isContextMenuOpenRef = useRef(false);\n  const [isTextFormatterOpen, openTextFormatter, closeTextFormatter] = useFlag();\n  const [textFormatterAnchorPosition, setTextFormatterAnchorPosition] = useState<IAnchorPosition>();\n  const [selectedRange, setSelectedRange] = useState<Range>();\n\n  const sendMessageAction = useSendMessageAction(chatId, threadId);\n\n  useEffect(() => {\n    if (!isAttachmentModalInput) return;\n    updateInputHeight(false);\n  }, [isAttachmentModalInput]);\n\n  useLayoutEffectWithPrevDeps(([prevHtml]) => {\n    if (html !== inputRef.current!.innerHTML) {\n      inputRef.current!.innerHTML = html;\n    }\n\n    if (html !== cloneRef.current!.innerHTML) {\n      cloneRef.current!.innerHTML = html;\n    }\n\n    if (prevHtml !== undefined && prevHtml !== html) {\n      updateInputHeight(!html.length);\n    }\n  }, [html]);\n\n  const chatIdRef = useRef(chatId);\n  chatIdRef.current = chatId;\n  const focusInput = useCallback(() => {\n    if (isHeavyAnimating()) {\n      setTimeout(focusInput, FOCUS_DELAY_MS);\n      return;\n    }\n\n    focusEditableElement(inputRef.current!);\n  }, []);\n\n  const handleCloseTextFormatter = useCallback(() => {\n    closeTextFormatter();\n    clearSelection();\n  }, [closeTextFormatter]);\n\n  function checkSelection() {\n    // Disable the formatter on iOS devices for now.\n    if (IS_IOS) {\n      return false;\n    }\n\n    const selection = window.getSelection();\n    if (!selection || !selection.rangeCount || isContextMenuOpenRef.current) {\n      closeTextFormatter();\n      return false;\n    }\n\n    const selectionRange = selection.getRangeAt(0);\n    const selectedText = selectionRange.toString().trim();\n    if (\n      shouldSuppressTextFormatter\n      || !isSelectionInsideInput(selectionRange, editableInputId || EDITABLE_INPUT_ID)\n      || !selectedText\n      || parseEmojiOnlyString(selectedText)\n      || !selectionRange.START_TO_END\n    ) {\n      closeTextFormatter();\n      return false;\n    }\n\n    return true;\n  }\n\n  function processSelection() {\n    if (!checkSelection()) {\n      return;\n    }\n\n    const selectionRange = window.getSelection()!.getRangeAt(0);\n    const selectionRect = selectionRange.getBoundingClientRect();\n    const inputRect = inputRef.current!.getBoundingClientRect();\n\n    let x = (selectionRect.left + selectionRect.width / 2) - inputRect.left;\n\n    if (x < TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = TEXT_FORMATTER_SAFE_AREA_PX;\n    } else if (x > inputRect.width - TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = inputRect.width - TEXT_FORMATTER_SAFE_AREA_PX;\n    }\n\n    setTextFormatterAnchorPosition({\n      x,\n      y: selectionRect.top - inputRect.top,\n    });\n\n    setSelectedRange(selectionRange);\n    openTextFormatter();\n  }\n\n  function handleMouseDown(event: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    function handleMouseUp() {\n      processSelection();\n\n      event.target.removeEventListener('mouseup', handleMouseUp);\n    }\n\n    if (event.button !== 2) {\n      event.target.addEventListener('mouseup', handleMouseUp);\n      return;\n    }\n\n    if (isContextMenuOpenRef.current === true) {\n      return;\n    }\n\n    isContextMenuOpenRef.current = true;\n\n    function closeContextMenuMouseListener() {\n      setTimeout(() => {\n        isContextMenuOpenRef.current = false;\n      }, CONTEXT_MENU_CLOSE_DELAY_MS);\n\n      window.removeEventListener('mouseup', closeContextMenuMouseListener);\n    }\n\n    function closeContextMenuKeyListener(e: KeyboardEvent) {\n      if (e.key !== 'Esc' && e.key !== 'Escape') {\n        return;\n      }\n\n      setTimeout(() => {\n        isContextMenuOpenRef.current = false;\n      }, CONTEXT_MENU_CLOSE_DELAY_MS);\n\n      window.removeEventListener('keydown', closeContextMenuKeyListener);\n    }\n\n    document.addEventListener('mousedown', closeContextMenuMouseListener);\n    document.addEventListener('keydown', closeContextMenuKeyListener);\n  }\n\n  function handleKeyDown(e: React.KeyboardEvent<HTMLDivElement>) {\n    function handleKeyUp() {\n      processSelection();\n\n      e.target.removeEventListener('keyup', handleKeyUp);\n    }\n\n    if (!html.length && (e.metaKey || e.ctrlKey)) {\n      const targetIndexDelta = e.key === 'ArrowDown' ? 1 : e.key === 'ArrowUp' ? -1 : undefined;\n      if (targetIndexDelta) {\n        e.preventDefault();\n\n        replyToNextMessage({ targetIndexDelta });\n        return;\n      }\n    }\n\n    if (e.key === 'Enter' && !e.shiftKey) {\n      if (\n        !(IS_IOS || IS_ANDROID)\n        && (\n          (messageSendKeyCombo === 'enter' && !e.shiftKey)\n          || (messageSendKeyCombo === 'ctrl-enter' && (e.ctrlKey || e.metaKey))\n        )\n      ) {\n        e.preventDefault();\n\n        closeTextFormatter();\n        onSend();\n      }\n    } else if (e.key === 'ArrowUp' && !html.length && !e.metaKey && !e.ctrlKey && !e.altKey) {\n      e.preventDefault();\n      editLastMessage();\n    } else {\n      e.target.addEventListener('keyup', handleKeyUp);\n    }\n  }\n\n  function handleChange(e: ChangeEvent<HTMLDivElement>) {\n    const { innerHTML, textContent } = e.currentTarget;\n\n    onUpdate(innerHTML === SAFARI_BR ? '' : innerHTML);\n    sendMessageAction({ type: 'typing' });\n\n    // Reset focus on the input to remove any active styling when input is cleared\n    if (\n      !IS_TOUCH_ENV\n      && (!textContent || !textContent.length)\n      // When emojis are not supported, innerHTML contains an emoji img tag that doesn't exist in the textContext\n      && !(!IS_EMOJI_SUPPORTED && innerHTML.includes('emoji-small'))\n    ) {\n      const selection = window.getSelection()!;\n      if (selection) {\n        inputRef.current!.blur();\n        selection.removeAllRanges();\n        focusEditableElement(inputRef.current!, true);\n      }\n    }\n  }\n\n  function stopEvent(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (!checkSelection()) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function updateInputHeight(willSend = false) {\n    const input = inputRef.current!;\n    const clone = cloneRef.current!;\n    const currentHeight = Number(input.style.height.replace('px', ''));\n    const newHeight = Math.min(clone.scrollHeight, MAX_INPUT_HEIGHT);\n    if (newHeight === currentHeight) {\n      return;\n    }\n\n    const transitionDuration = Math.round(\n      TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight)),\n    );\n\n    const exec = () => {\n      input.style.height = `${newHeight}px`;\n      input.style.transitionDuration = `${transitionDuration}ms`;\n      input.classList.toggle('overflown', clone.scrollHeight > MAX_INPUT_HEIGHT);\n    };\n\n    if (willSend) {\n      // Sync with sending animation\n      requestAnimationFrame(exec);\n    } else {\n      exec();\n    }\n  }\n\n  useEffect(() => {\n    if (IS_TOUCH_ENV) {\n      return;\n    }\n\n    if (canAutoFocus) {\n      focusInput();\n    }\n  }, [chatId, focusInput, replyingToId, canAutoFocus]);\n\n  useEffect(() => {\n    if (noTabCapture) {\n      return undefined;\n    }\n\n    const captureFirstTab = debounce((e: KeyboardEvent) => {\n      if (e.key === 'Tab') {\n        e.preventDefault();\n        requestAnimationFrame(focusInput);\n      }\n    }, TAB_INDEX_PRIORITY_TIMEOUT, true, false);\n\n    return captureKeyboardListeners({ onTab: captureFirstTab });\n  }, [focusInput, noTabCapture]);\n\n  useEffect(() => {\n    const input = inputRef.current!;\n\n    function suppressFocus() {\n      input.blur();\n    }\n\n    if (shouldSuppressFocus) {\n      input.addEventListener('focus', suppressFocus);\n    }\n\n    return () => {\n      input.removeEventListener('focus', suppressFocus);\n    };\n  }, [shouldSuppressFocus]);\n\n  const className = buildClassName(\n    'form-control custom-scroll',\n    html.length > 0 && 'touched',\n    shouldSuppressFocus && 'focus-disabled',\n  );\n\n  return (\n    <div id={id} onClick={shouldSuppressFocus ? onSuppressedFocus : undefined} dir={lang.isRtl ? 'rtl' : undefined}>\n      <div\n        ref={inputRef}\n        id={editableInputId || EDITABLE_INPUT_ID}\n        className={className}\n        contentEditable\n        dir=\"auto\"\n        onClick={focusInput}\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n        onMouseDown={handleMouseDown}\n        onContextMenu={IS_ANDROID ? stopEvent : undefined}\n        onTouchCancel={IS_ANDROID ? processSelection : undefined}\n      />\n      <div ref={cloneRef} className={buildClassName(className, 'clone')} dir=\"auto\" />\n      {!forcedPlaceholder && <span className=\"placeholder-text\" dir=\"auto\">{placeholder}</span>}\n      <TextFormatter\n        isOpen={isTextFormatterOpen}\n        anchorPosition={textFormatterAnchorPosition}\n        selectedRange={selectedRange}\n        setSelectedRange={setSelectedRange}\n        onClose={handleCloseTextFormatter}\n      />\n      {forcedPlaceholder && <span className=\"forced-placeholder\">{renderText(forcedPlaceholder!)}</span>}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId, threadId }: OwnProps): StateProps => {\n    const { messageSendKeyCombo } = global.settings.byKey;\n\n    return {\n      messageSendKeyCombo,\n      replyingToId: chatId && threadId ? selectReplyingToId(global, chatId, threadId) : undefined,\n      noTabCapture: global.isPollModalOpen || global.payment.isPaymentModalOpen,\n    };\n  },\n)(MessageInput));\n","import React, {\n  FC, memo, useCallback, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\n\nimport { IAnchorPosition } from '../../../types';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport buildClassName from '../../../util/buildClassName';\nimport { ensureProtocol } from '../../../util/ensureProtocol';\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport getKeyFromEvent from '../../../util/getKeyFromEvent';\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport useVirtualBackdrop from '../../../hooks/useVirtualBackdrop';\nimport useFlag from '../../../hooks/useFlag';\nimport useLang from '../../../hooks/useLang';\n\nimport Button from '../../ui/Button';\n\nimport './TextFormatter.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  anchorPosition?: IAnchorPosition;\n  selectedRange?: Range;\n  setSelectedRange: (range: Range) => void;\n  onClose: () => void;\n};\n\ninterface ISelectedTextFormats {\n  bold?: boolean;\n  italic?: boolean;\n  underline?: boolean;\n  strikethrough?: boolean;\n  monospace?: boolean;\n}\n\nconst TEXT_FORMAT_BY_TAG_NAME: Record<string, keyof ISelectedTextFormats> = {\n  B: 'bold',\n  STRONG: 'bold',\n  I: 'italic',\n  EM: 'italic',\n  U: 'underline',\n  DEL: 'strikethrough',\n  CODE: 'monospace',\n};\nconst fragmentEl = document.createElement('div');\n\nconst TextFormatter: FC<OwnProps> = ({\n  isOpen,\n  anchorPosition,\n  selectedRange,\n  setSelectedRange,\n  onClose,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const linkUrlInputRef = useRef<HTMLInputElement>(null);\n  const { shouldRender, transitionClassNames } = useShowTransition(isOpen);\n  const [isLinkControlOpen, openLinkControl, closeLinkControl] = useFlag();\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditingLink, setIsEditingLink] = useState(false);\n  const [inputClassName, setInputClassName] = useState<string | undefined>();\n  const [selectedTextFormats, setSelectedTextFormats] = useState<ISelectedTextFormats>({});\n\n  useEffect(() => (isOpen ? captureEscKeyListener(onClose) : undefined), [isOpen, onClose]);\n  useVirtualBackdrop(\n    isOpen,\n    containerRef,\n    onClose,\n  );\n\n  useEffect(() => {\n    if (isLinkControlOpen) {\n      linkUrlInputRef.current!.focus();\n    } else {\n      setLinkUrl('');\n      setIsEditingLink(false);\n    }\n  }, [isLinkControlOpen]);\n\n  useEffect(() => {\n    if (!shouldRender) {\n      closeLinkControl();\n      setSelectedTextFormats({});\n      setInputClassName(undefined);\n    }\n  }, [closeLinkControl, shouldRender]);\n\n  useEffect(() => {\n    if (!isOpen || !selectedRange) {\n      return;\n    }\n\n    const selectedFormats: ISelectedTextFormats = {};\n    let { parentElement } = selectedRange.commonAncestorContainer;\n    while (parentElement && parentElement.id !== EDITABLE_INPUT_ID) {\n      const textFormat = TEXT_FORMAT_BY_TAG_NAME[parentElement.tagName];\n      if (textFormat) {\n        selectedFormats[textFormat] = true;\n      }\n\n      parentElement = parentElement.parentElement;\n    }\n\n    setSelectedTextFormats(selectedFormats);\n  }, [isOpen, selectedRange, openLinkControl]);\n\n  function restoreSelection() {\n    if (!selectedRange) {\n      return;\n    }\n\n    const selection = window.getSelection();\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(selectedRange);\n    }\n  }\n\n  const updateSelectedRange = useCallback(() => {\n    const selection = window.getSelection();\n    if (selection) {\n      setSelectedRange(selection.getRangeAt(0));\n    }\n  }, [setSelectedRange]);\n\n  const getSelectedText = useCallback(() => {\n    if (!selectedRange) {\n      return undefined;\n    }\n    fragmentEl.innerText = selectedRange.toString();\n\n    return fragmentEl.innerHTML;\n  }, [selectedRange]);\n\n  const getSelectedElement = useCallback(() => {\n    if (!selectedRange) {\n      return undefined;\n    }\n\n    return selectedRange.commonAncestorContainer.parentElement;\n  }, [selectedRange]);\n\n  function updateInputStyles() {\n    const input = linkUrlInputRef.current;\n    if (!input) {\n      return;\n    }\n\n    const { offsetWidth, scrollWidth, scrollLeft } = input;\n    if (scrollWidth <= offsetWidth) {\n      setInputClassName(undefined);\n      return;\n    }\n\n    let className = '';\n    if (scrollLeft < scrollWidth - offsetWidth) {\n      className = 'mask-right';\n    }\n    if (scrollLeft > 0) {\n      className += ' mask-left';\n    }\n\n    setInputClassName(className);\n  }\n\n  function handleLinkUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n    setLinkUrl(e.target.value);\n    updateInputStyles();\n  }\n\n  function getFormatButtonClassName(key: keyof ISelectedTextFormats) {\n    if (selectedTextFormats[key]) {\n      return 'active';\n    }\n\n    if (key === 'monospace' || key === 'strikethrough') {\n      if (Object.keys(selectedTextFormats).some(\n        (fKey) => fKey !== key && !!selectedTextFormats[fKey as keyof ISelectedTextFormats],\n      )) {\n        return 'disabled';\n      }\n    } else if (selectedTextFormats.monospace || selectedTextFormats.strikethrough) {\n      return 'disabled';\n    }\n\n    return undefined;\n  }\n\n  const handleBoldText = useCallback(() => {\n    setSelectedTextFormats((selectedFormats) => {\n      // Somehow re-applying 'bold' command to already bold text doesn't work\n      document.execCommand(selectedFormats.bold ? 'removeFormat' : 'bold');\n      Object.keys(selectedFormats).forEach((key) => {\n        if ((key === 'italic' || key === 'underline') && !!selectedFormats[key]) {\n          document.execCommand(key);\n        }\n      });\n\n      updateSelectedRange();\n      return {\n        ...selectedFormats,\n        bold: !selectedFormats.bold,\n      };\n    });\n  }, [updateSelectedRange]);\n\n  const handleItalicText = useCallback(() => {\n    document.execCommand('italic');\n    updateSelectedRange();\n    setSelectedTextFormats((selectedFormats) => ({\n      ...selectedFormats,\n      italic: !selectedFormats.italic,\n    }));\n  }, [updateSelectedRange]);\n\n  const handleUnderlineText = useCallback(() => {\n    document.execCommand('underline');\n    updateSelectedRange();\n    setSelectedTextFormats((selectedFormats) => ({\n      ...selectedFormats,\n      underline: !selectedFormats.underline,\n    }));\n  }, [updateSelectedRange]);\n\n  const handleStrikethroughText = useCallback(() => {\n    if (selectedTextFormats.strikethrough) {\n      const element = getSelectedElement();\n      if (\n        !selectedRange\n        || !element\n        || element.tagName !== 'DEL'\n        || !element.textContent\n      ) {\n        return;\n      }\n\n      element.replaceWith(element.textContent);\n      setSelectedTextFormats((selectedFormats) => ({\n        ...selectedFormats,\n        strikethrough: false,\n      }));\n\n      return;\n    }\n\n    const text = getSelectedText();\n    document.execCommand('insertHTML', false, `<del>${text}</del>`);\n    onClose();\n  }, [\n    getSelectedElement, getSelectedText, onClose,\n    selectedRange, selectedTextFormats.strikethrough,\n  ]);\n\n  const handleMonospaceText = useCallback(() => {\n    if (selectedTextFormats.monospace) {\n      const element = getSelectedElement();\n      if (\n        !selectedRange\n        || !element\n        || element.tagName !== 'CODE'\n        || !element.textContent\n      ) {\n        return;\n      }\n\n      element.replaceWith(element.textContent);\n      setSelectedTextFormats((selectedFormats) => ({\n        ...selectedFormats,\n        monospace: false,\n      }));\n      return;\n    }\n\n    const text = getSelectedText();\n    document.execCommand('insertHTML', false, `<code class=\"text-entity-code\" dir=\"auto\">${text}</code>`);\n    onClose();\n  }, [\n    getSelectedElement, getSelectedText, onClose,\n    selectedRange, selectedTextFormats.monospace,\n  ]);\n\n  function handleLinkUrlConfirm() {\n    const formattedLinkUrl = encodeURI(ensureProtocol(linkUrl) || '');\n\n    if (isEditingLink) {\n      const element = getSelectedElement();\n      if (!element || element.tagName !== 'A') {\n        return;\n      }\n\n      (element as HTMLAnchorElement).href = formattedLinkUrl;\n\n      onClose();\n      return;\n    }\n\n    const text = getSelectedText();\n    restoreSelection();\n    document.execCommand(\n      'insertHTML',\n      false,\n      `<a href=${formattedLinkUrl} class=\"text-entity-link\" dir=\"auto\">${text}</a>`,\n    );\n    onClose();\n  }\n\n  const handleKeyDown = useCallback((e: KeyboardEvent) => {\n    const HANDLERS_BY_KEY: Record<string, AnyToVoidFunction> = {\n      k: openLinkControl,\n      b: handleBoldText,\n      u: handleUnderlineText,\n      i: handleItalicText,\n      m: handleMonospaceText,\n      s: handleStrikethroughText,\n    };\n\n    const handler = HANDLERS_BY_KEY[getKeyFromEvent(e)];\n\n    if (\n      e.altKey\n      || !(e.ctrlKey || e.metaKey)\n      || !handler\n    ) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n    handler();\n  }, [\n    handleBoldText, handleItalicText, handleUnderlineText,\n    handleMonospaceText, handleStrikethroughText,\n    openLinkControl,\n  ]);\n\n  useEffect(() => {\n    if (isOpen) {\n      document.addEventListener('keydown', handleKeyDown);\n    }\n\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, handleKeyDown]);\n\n  const lang = useLang();\n\n  function handleContainerKeyDown(e: React.KeyboardEvent<HTMLDivElement>) {\n    if (e.key === 'Enter' && isLinkControlOpen) {\n      handleLinkUrlConfirm();\n      e.preventDefault();\n    }\n  }\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const className = buildClassName(\n    'TextFormatter',\n    transitionClassNames,\n    isLinkControlOpen && 'link-control-shown',\n  );\n\n  const linkUrlConfirmClassName = buildClassName(\n    'TextFormatter-link-url-confirm',\n    !!linkUrl.length && 'shown',\n  );\n\n  const style = anchorPosition\n    ? `left: ${anchorPosition.x}px; top: ${anchorPosition.y}px;--text-formatter-left: ${anchorPosition.x}px;`\n    : '';\n\n  return (\n    <div\n      ref={containerRef}\n      className={className}\n      // @ts-ignore Teact feature\n      style={style}\n      onKeyDown={handleContainerKeyDown}\n    >\n      <div className=\"TextFormatter-buttons\">\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Bold text\"\n          className={getFormatButtonClassName('bold')}\n          onClick={handleBoldText}\n        >\n          <i className=\"icon-bold\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Italic text\"\n          className={getFormatButtonClassName('italic')}\n          onClick={handleItalicText}\n        >\n          <i className=\"icon-italic\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Underlined text\"\n          className={getFormatButtonClassName('underline')}\n          onClick={handleUnderlineText}\n        >\n          <i className=\"icon-underlined\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Strikethrough text\"\n          className={getFormatButtonClassName('strikethrough')}\n          onClick={handleStrikethroughText}\n        >\n          <i className=\"icon-strikethrough\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Monospace text\"\n          className={getFormatButtonClassName('monospace')}\n          onClick={handleMonospaceText}\n        >\n          <i className=\"icon-monospace\" />\n        </Button>\n        <div className=\"TextFormatter-divider\" />\n        <Button color=\"translucent\" ariaLabel={lang('TextFormat.AddLinkTitle')} onClick={openLinkControl}>\n          <i className=\"icon-link\" />\n        </Button>\n      </div>\n\n      <div className=\"TextFormatter-link-control\">\n        <div className=\"TextFormatter-buttons\">\n          <Button color=\"translucent\" ariaLabel={lang('Cancel')} onClick={closeLinkControl}>\n            <i className=\"icon-arrow-left\" />\n          </Button>\n          <div className=\"TextFormatter-divider\" />\n\n          <div\n            className={buildClassName('TextFormatter-link-url-input-wrapper', inputClassName)}\n          >\n            <input\n              ref={linkUrlInputRef}\n              className=\"TextFormatter-link-url-input\"\n              type=\"text\"\n              value={linkUrl}\n              placeholder=\"Enter URL...\"\n              autoComplete=\"off\"\n              inputMode=\"url\"\n              dir=\"auto\"\n              onChange={handleLinkUrlChange}\n              onScroll={updateInputStyles}\n            />\n          </div>\n\n          <div className={linkUrlConfirmClassName}>\n            <div className=\"TextFormatter-divider\" />\n            <Button\n              color=\"translucent\"\n              ariaLabel={lang('Save')}\n              className=\"color-primary\"\n              onClick={handleLinkUrlConfirm}\n            >\n              <i className=\"icon-check\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(TextFormatter);\n","const RE_BR = /(<br>|<br\\s?\\/>)/g;\nconst RE_SPACE = /(&nbsp;|\\u00A0)/g;\nconst RE_CLEAN_HTML = /(<div>|<\\/div>)/gi;\nconst RE_EXTRA_NEW_LINE = /\\n$/i;\n\nexport function prepareForRegExp(html: string) {\n  return html\n    .replace(RE_SPACE, ' ')\n    .replace(RE_BR, '\\n')\n    .replace(RE_CLEAN_HTML, '')\n    .replace(RE_EXTRA_NEW_LINE, '');\n}\n","const MAX_NESTING_PARENTS = 5;\n\nexport function isSelectionInsideInput(selectionRange: Range, inputId: string) {\n  const { commonAncestorContainer } = selectionRange;\n  let parentNode: HTMLElement | null = commonAncestorContainer as HTMLElement;\n  let iterations = 1;\n  while (parentNode && parentNode.id !== inputId && iterations < MAX_NESTING_PARENTS) {\n    parentNode = parentNode.parentElement;\n    iterations++;\n  }\n\n  return Boolean(parentNode && parentNode.id === inputId);\n}\n","import { areSortedArraysEqual } from './iteratees';\n\nconst cache = new WeakMap<AnyFunction, {\n  lastArgs: any[];\n  lastResult: any;\n}>();\n\nexport default function memoized<T extends AnyFunction>(fn: T) {\n  return (...args: Parameters<T>): ReturnType<T> => {\n    const cached = cache.get(fn);\n    if (cached && areSortedArraysEqual(cached.lastArgs, args)) {\n      return cached.lastResult;\n    }\n\n    const result = fn(...args);\n    cache.set(fn, { lastArgs: args, lastResult: result });\n    return result;\n  };\n}\n","import {\n  useCallback, useEffect, useState,\n} from '../../../../lib/teact/teact';\n\nimport { EDITABLE_INPUT_ID } from '../../../../config';\nimport { MEMO_EMPTY_ARRAY } from '../../../../util/memo';\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\nimport {\n  EmojiData, EmojiModule, EmojiRawData, uncompressEmoji,\n} from '../../../../util/emoji';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport {\n  buildCollectionByKey, flatten, mapValues, pickTruthy, unique,\n} from '../../../../util/iteratees';\nimport memoized from '../../../../util/memoized';\nimport useFlag from '../../../../hooks/useFlag';\n\ninterface Library {\n  keywords: string[];\n  byKeyword: Record<string, Emoji[]>;\n  names: string[];\n  byName: Record<string, Emoji[]>;\n}\n\nlet emojiDataPromise: Promise<EmojiModule>;\nlet emojiRawData: EmojiRawData;\nlet emojiData: EmojiData;\n\nlet RE_EMOJI_SEARCH: RegExp;\nconst EMOJIS_LIMIT = 36;\nconst FILTER_MIN_LENGTH = 2;\n\nconst prepareRecentEmojisMemo = memoized(prepareRecentEmojis);\nconst prepareLibraryMemo = memoized(prepareLibrary);\nconst searchInLibraryMemo = memoized(searchInLibrary);\n\ntry {\n  RE_EMOJI_SEARCH = new RegExp('(^|\\\\s):[-+_:\\\\p{L}\\\\p{N}]*$', 'gui');\n} catch (e) {\n  // Support for older versions of firefox\n  RE_EMOJI_SEARCH = new RegExp('(^|\\\\s):[-+_:\\\\d\\\\wа-яё]*$', 'gi');\n}\n\nexport default function useEmojiTooltip(\n  isAllowed: boolean,\n  htmlRef: { current: string },\n  recentEmojiIds: string[],\n  inputId = EDITABLE_INPUT_ID,\n  onUpdateHtml: (html: string) => void,\n  baseEmojiKeywords?: Record<string, string[]>,\n  emojiKeywords?: Record<string, string[]>,\n  isDisabled = false,\n) {\n  const [isOpen, markIsOpen, unmarkIsOpen] = useFlag();\n  const [byId, setById] = useState<Record<string, Emoji> | undefined>();\n  const [shouldForceInsertEmoji, setShouldForceInsertEmoji] = useState(false);\n  const [filteredEmojis, setFilteredEmojis] = useState<Emoji[]>(MEMO_EMPTY_ARRAY);\n\n  // Initialize data on first render.\n  useEffect(() => {\n    if (isDisabled) return;\n    const exec = () => {\n      setById(emojiData.emojis);\n    };\n\n    if (emojiData) {\n      exec();\n    } else {\n      ensureEmojiData()\n        .then(exec);\n    }\n  }, [isDisabled]);\n\n  const html = htmlRef.current;\n  useEffect(() => {\n    if (!isAllowed || !html || !byId || isDisabled) {\n      unmarkIsOpen();\n      return;\n    }\n\n    const code = html.includes(':') && getEmojiCode(html);\n    if (!code) {\n      setFilteredEmojis(MEMO_EMPTY_ARRAY);\n      unmarkIsOpen();\n      return;\n    }\n\n    const forceSend = code.length > 2 && code.endsWith(':');\n    const filter = code.substr(1, forceSend ? code.length - 2 : undefined);\n    let matched: Emoji[] = MEMO_EMPTY_ARRAY;\n\n    setShouldForceInsertEmoji(forceSend);\n\n    if (!filter) {\n      matched = prepareRecentEmojisMemo(byId, recentEmojiIds, EMOJIS_LIMIT);\n    } else if (filter.length >= FILTER_MIN_LENGTH) {\n      const library = prepareLibraryMemo(byId, baseEmojiKeywords, emojiKeywords);\n      matched = searchInLibraryMemo(library, filter, EMOJIS_LIMIT);\n    }\n\n    if (matched.length) {\n      if (!forceSend) {\n        markIsOpen();\n      }\n      setFilteredEmojis(matched);\n    } else {\n      unmarkIsOpen();\n    }\n  }, [\n    byId, html, isAllowed, markIsOpen, recentEmojiIds, unmarkIsOpen, setShouldForceInsertEmoji,\n    isDisabled, baseEmojiKeywords, emojiKeywords,\n  ]);\n\n  const insertEmoji = useCallback((textEmoji: string, isForce?: boolean) => {\n    const currentHtml = htmlRef.current;\n    const atIndex = currentHtml.lastIndexOf(':', isForce ? currentHtml.lastIndexOf(':') - 1 : undefined);\n    if (atIndex !== -1) {\n      onUpdateHtml(`${currentHtml.substr(0, atIndex)}${textEmoji}`);\n      const messageInput = document.getElementById(inputId)!;\n      requestAnimationFrame(() => {\n        focusEditableElement(messageInput, true);\n      });\n    }\n\n    unmarkIsOpen();\n  }, [htmlRef, inputId, onUpdateHtml, unmarkIsOpen]);\n\n  useEffect(() => {\n    if (isOpen && shouldForceInsertEmoji && filteredEmojis.length) {\n      insertEmoji(filteredEmojis[0].native, true);\n    }\n  }, [filteredEmojis, insertEmoji, isOpen, shouldForceInsertEmoji]);\n\n  return {\n    isEmojiTooltipOpen: isOpen,\n    closeEmojiTooltip: unmarkIsOpen,\n    filteredEmojis,\n    insertEmoji,\n  };\n}\n\nfunction getEmojiCode(html: string) {\n  const emojis = prepareForRegExp(html).match(RE_EMOJI_SEARCH);\n\n  return emojis ? emojis[0].trim() : undefined;\n}\n\nasync function ensureEmojiData() {\n  if (!emojiDataPromise) {\n    emojiDataPromise = import('emoji-data-ios/emoji-data.json') as unknown as Promise<EmojiModule>;\n    emojiRawData = (await emojiDataPromise).default;\n\n    emojiData = uncompressEmoji(emojiRawData);\n  }\n\n  return emojiDataPromise;\n}\n\nfunction prepareRecentEmojis(byId: Record<string, Emoji>, recentEmojiIds: string[], limit: number) {\n  if (!byId || !recentEmojiIds.length) {\n    return MEMO_EMPTY_ARRAY;\n  }\n\n  return Object.values(pickTruthy(byId, recentEmojiIds)).slice(0, limit);\n}\n\nfunction prepareLibrary(\n  byId: Record<string, Emoji>,\n  baseEmojiKeywords?: Record<string, string[]>,\n  emojiKeywords?: Record<string, string[]>,\n): Library {\n  const emojis = Object.values(byId);\n\n  const byNative = buildCollectionByKey<Emoji>(emojis, 'native');\n  const baseEmojisByKeyword = baseEmojiKeywords\n    ? mapValues(baseEmojiKeywords, (natives) => {\n      return Object.values(pickTruthy(byNative, natives));\n    })\n    : {};\n  const emojisByKeyword = emojiKeywords\n    ? mapValues(emojiKeywords, (natives) => {\n      return Object.values(pickTruthy(byNative, natives));\n    })\n    : {};\n\n  const byKeyword = { ...baseEmojisByKeyword, ...emojisByKeyword };\n  const keywords = ([] as string[]).concat(Object.keys(baseEmojisByKeyword), Object.keys(emojisByKeyword));\n\n  const byName = emojis.reduce((result, emoji) => {\n    emoji.names.forEach((name) => {\n      if (!result[name]) {\n        result[name] = [];\n      }\n\n      result[name].push(emoji);\n    });\n\n    return result;\n  }, {} as Record<string, Emoji[]>);\n\n  const names = Object.keys(byName);\n\n  return {\n    byKeyword,\n    keywords,\n    byName,\n    names,\n  };\n}\n\nfunction searchInLibrary(library: Library, filter: string, limit: number) {\n  const {\n    byKeyword, keywords, byName, names,\n  } = library;\n\n  let matched: Emoji[] = MEMO_EMPTY_ARRAY;\n\n  const matchedKeywords = keywords.filter((keyword) => keyword.startsWith(filter)).sort();\n  matched = matched.concat(flatten(Object.values(pickTruthy(byKeyword!, matchedKeywords))));\n\n  // Also search by names, which is useful for non-English languages\n  const matchedNames = names.filter((name) => name.startsWith(filter));\n  matched = matched.concat(flatten(Object.values(pickTruthy(byName, matchedNames))));\n\n  matched = unique(matched);\n\n  return matched.slice(0, limit);\n}\n","import {\n  useCallback, useEffect, useState,\n} from '../../../../lib/teact/teact';\nimport { getGlobal } from '../../../../lib/teact/teactn';\n\nimport { ApiMessageEntityTypes, ApiChatMember, ApiUser } from '../../../../api/types';\nimport { EDITABLE_INPUT_ID } from '../../../../config';\nimport { filterUsersByName, getUserFirstOrLastName } from '../../../../modules/helpers';\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport useFlag from '../../../../hooks/useFlag';\nimport { pickTruthy, unique } from '../../../../util/iteratees';\nimport { throttle } from '../../../../util/schedulers';\n\nconst runThrottled = throttle((cb) => cb(), 500, true);\nlet RE_USERNAME_SEARCH: RegExp;\n\ntry {\n  RE_USERNAME_SEARCH = new RegExp('(^|\\\\s)@[-_\\\\p{L}\\\\p{M}\\\\p{N}]*$', 'gui');\n} catch (e) {\n  // Support for older versions of firefox\n  RE_USERNAME_SEARCH = new RegExp('(^|\\\\s)@[-_\\\\d\\\\wа-яё]*$', 'gi');\n}\n\nexport default function useMentionTooltip(\n  canSuggestMembers: boolean | undefined,\n  htmlRef: { current: string },\n  onUpdateHtml: (html: string) => void,\n  inputId: string = EDITABLE_INPUT_ID,\n  groupChatMembers?: ApiChatMember[],\n  topInlineBotIds?: string[],\n  currentUserId?: string,\n) {\n  const [isOpen, markIsOpen, unmarkIsOpen] = useFlag();\n  const [usersToMention, setUsersToMention] = useState<ApiUser[] | undefined>();\n\n  const updateFilteredUsers = useCallback((filter, withInlineBots: boolean) => {\n    // No need for expensive global updates on users, so we avoid them\n    const usersById = getGlobal().users.byId;\n\n    if (!(groupChatMembers || topInlineBotIds) || !usersById) {\n      setUsersToMention(undefined);\n\n      return;\n    }\n\n    runThrottled(() => {\n      const memberIds = groupChatMembers?.reduce((acc: string[], member) => {\n        if (member.userId !== currentUserId) {\n          acc.push(member.userId);\n        }\n\n        return acc;\n      }, []);\n\n      const filteredIds = filterUsersByName(unique([\n        ...((withInlineBots && topInlineBotIds) || []),\n        ...(memberIds || []),\n      ]), usersById, filter);\n\n      setUsersToMention(Object.values(pickTruthy(usersById, filteredIds)));\n    });\n  }, [currentUserId, groupChatMembers, topInlineBotIds]);\n\n  const html = htmlRef.current;\n  useEffect(() => {\n    if (!canSuggestMembers || !html.length) {\n      unmarkIsOpen();\n      return;\n    }\n\n    const usernameFilter = html.includes('@') && getUsernameFilter(html);\n\n    if (usernameFilter) {\n      const filter = usernameFilter ? usernameFilter.substr(1) : '';\n      updateFilteredUsers(filter, canSuggestInlineBots(html));\n    } else {\n      unmarkIsOpen();\n    }\n  }, [canSuggestMembers, updateFilteredUsers, markIsOpen, unmarkIsOpen, html]);\n\n  useEffect(() => {\n    if (usersToMention?.length) {\n      markIsOpen();\n    } else {\n      unmarkIsOpen();\n    }\n  }, [markIsOpen, unmarkIsOpen, usersToMention]);\n\n  const insertMention = useCallback((user: ApiUser, forceFocus = false) => {\n    if (!user.username && !getUserFirstOrLastName(user)) {\n      return;\n    }\n\n    const insertedHtml = user.username\n      ? `@${user.username}`\n      : `<a\n          class=\"text-entity-link\"\n          data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n          data-user-id=\"${user.id}\"\n          contenteditable=\"false\"\n          dir=\"auto\"\n        >${getUserFirstOrLastName(user)}</a>`;\n\n    const currentHtml = htmlRef.current;\n    const atIndex = currentHtml.lastIndexOf('@');\n    if (atIndex !== -1) {\n      onUpdateHtml(`${currentHtml.substr(0, atIndex)}${insertedHtml}&nbsp;`);\n      const messageInput = document.getElementById(inputId)!;\n      requestAnimationFrame(() => {\n        focusEditableElement(messageInput, forceFocus);\n      });\n    }\n\n    unmarkIsOpen();\n  }, [htmlRef, inputId, onUpdateHtml, unmarkIsOpen]);\n\n  return {\n    isMentionTooltipOpen: isOpen,\n    closeMentionTooltip: unmarkIsOpen,\n    insertMention,\n    mentionFilteredUsers: usersToMention,\n  };\n}\n\nfunction getUsernameFilter(html: string) {\n  const username = prepareForRegExp(html).match(RE_USERNAME_SEARCH);\n\n  return username ? username[0].trim() : undefined;\n}\n\nfunction canSuggestInlineBots(html: string) {\n  return html.startsWith('@');\n}\n","import { useEffect, useRef } from '../../../lib/teact/teact';\n\nimport useOnChange from '../../../hooks/useOnChange';\nimport useForceUpdate from '../../../hooks/useForceUpdate';\n\nexport default function useAsyncRendering<T extends any[]>(dependencies: T, delay?: number) {\n  const isDisabled = delay === undefined;\n  const shouldRenderRef = useRef(isDisabled);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n\n  useOnChange(() => {\n    if (isDisabled) {\n      return;\n    }\n\n    shouldRenderRef.current = false;\n\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = undefined;\n    }\n  }, dependencies);\n\n  useEffect(() => {\n    if (isDisabled || shouldRenderRef.current) {\n      return;\n    }\n\n    const exec = () => {\n      shouldRenderRef.current = true;\n      forceUpdate();\n    };\n\n    if (delay! > 0) {\n      timeoutRef.current = window.setTimeout(exec, delay);\n    } else {\n      exec();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n\n  return shouldRenderRef.current;\n}\n","import { ChangeEvent } from 'react';\nimport React, {\n  FC, useCallback, memo, useState,\n} from '../../lib/teact/teact';\n\nimport Checkbox from './Checkbox';\n\ntype IRadioOption = {\n  label: string;\n  subLabel?: string;\n  value: string;\n};\n\ntype OwnProps = {\n  id?: string;\n  options: IRadioOption[];\n  selected?: string[];\n  disabled?: boolean;\n  round?: boolean;\n  loadingOptions?: string[];\n  onChange: (value: string[]) => void;\n};\n\nconst CheckboxGroup: FC<OwnProps> = ({\n  id,\n  options,\n  selected = [],\n  disabled,\n  round,\n  loadingOptions,\n  onChange,\n}) => {\n  const [values, setValues] = useState<string[]>(selected || []);\n\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    const { value, checked } = event.currentTarget;\n    let newValues: string[];\n    if (checked) {\n      newValues = [...values, value];\n    } else {\n      newValues = values.filter((v) => v !== value);\n    }\n\n    setValues(newValues);\n    onChange(newValues);\n  }, [onChange, values]);\n\n  return (\n    <div id={id} className=\"radio-group\">\n      {options.map((option) => (\n        <Checkbox\n          label={option.label}\n          subLabel={option.subLabel}\n          value={option.value}\n          checked={selected.indexOf(option.value) !== -1}\n          disabled={disabled}\n          round={round}\n          isLoading={loadingOptions ? loadingOptions.indexOf(option.value) !== -1 : undefined}\n          onChange={handleChange}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(CheckboxGroup);\n","import React, { FC } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport Button, { OwnProps as ButtonProps } from './Button';\n\nimport './FloatingActionButton.scss';\n\ntype OwnProps = {\n  isShown: boolean;\n  className?: string;\n  color?: ButtonProps['color'];\n  ariaLabel?: ButtonProps['ariaLabel'];\n  disabled?: boolean;\n  onClick: () => void;\n  children: any;\n};\n\nconst FloatingActionButton: FC<OwnProps> = ({\n  isShown,\n  className,\n  color = 'primary',\n  ariaLabel,\n  disabled,\n  onClick,\n  children,\n}) => {\n  const buttonClassName = buildClassName(\n    'FloatingActionButton',\n    isShown && 'revealed',\n    className,\n  );\n\n  return (\n    <Button\n      className={buttonClassName}\n      color={color}\n      round\n      disabled={disabled}\n      onClick={isShown && !disabled ? onClick : undefined}\n      ariaLabel={ariaLabel}\n      tabIndex={-1}\n    >\n      {children}\n    </Button>\n  );\n};\n\nexport default FloatingActionButton;\n","import { RefObject } from 'react';\nimport React, { FC, useRef, useCallback } from '../../lib/teact/teact';\n\nimport { IS_TOUCH_ENV } from '../../util/environment';\nimport { fastRaf } from '../../util/schedulers';\nimport buildClassName from '../../util/buildClassName';\nimport useContextMenuHandlers from '../../hooks/useContextMenuHandlers';\nimport useContextMenuPosition from '../../hooks/useContextMenuPosition';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\n\nimport RippleEffect from './RippleEffect';\nimport Menu from './Menu';\nimport MenuItem from './MenuItem';\nimport Button from './Button';\n\nimport './ListItem.scss';\n\ninterface MenuItemContextAction {\n  title: string;\n  icon: string;\n  destructive?: boolean;\n  handler?: () => void;\n}\n\ninterface OwnProps {\n  ref?: RefObject<HTMLDivElement>;\n  buttonRef?: RefObject<HTMLDivElement>;\n  icon?: string;\n  secondaryIcon?: string;\n  className?: string;\n  style?: string;\n  children: any;\n  disabled?: boolean;\n  ripple?: boolean;\n  narrow?: boolean;\n  inactive?: boolean;\n  focus?: boolean;\n  destructive?: boolean;\n  multiline?: boolean;\n  isStatic?: boolean;\n  contextActions?: MenuItemContextAction[];\n  onMouseDown?: (e: React.MouseEvent<HTMLDivElement>) => void;\n  onClick?: (e: React.MouseEvent<HTMLDivElement>) => void;\n  onSecondaryIconClick?: (e: React.MouseEvent<HTMLButtonElement>) => void;\n}\n\nconst ListItem: FC<OwnProps> = ({\n  ref,\n  buttonRef,\n  icon,\n  secondaryIcon,\n  className,\n  style,\n  children,\n  disabled,\n  ripple,\n  narrow,\n  inactive,\n  focus,\n  destructive,\n  multiline,\n  isStatic,\n  contextActions,\n  onMouseDown,\n  onClick,\n  onSecondaryIconClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n  const [isTouched, markIsTouched, unmarkIsTouched] = useFlag();\n\n  const {\n    isContextMenuOpen, contextMenuPosition,\n    handleBeforeContextMenu, handleContextMenu,\n    handleContextMenuClose, handleContextMenuHide,\n  } = useContextMenuHandlers(containerRef, !contextActions);\n\n  const getTriggerElement = useCallback(() => containerRef.current, []);\n\n  const getRootElement = useCallback(\n    () => containerRef.current!.closest('.custom-scroll'),\n    [],\n  );\n\n  const getMenuElement = useCallback(\n    () => containerRef.current!.querySelector('.ListItem-context-menu .bubble'),\n    [],\n  );\n\n  const { positionX, positionY, style: menuStyle } = useContextMenuPosition(\n    contextMenuPosition,\n    getTriggerElement,\n    getRootElement,\n    getMenuElement,\n  );\n\n  const handleClick = useCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (disabled || !onClick) {\n      return;\n    }\n    onClick(e);\n\n    if (IS_TOUCH_ENV && !ripple) {\n      markIsTouched();\n      fastRaf(unmarkIsTouched);\n    }\n  }, [disabled, markIsTouched, onClick, ripple, unmarkIsTouched]);\n\n  const handleSecondaryIconClick = (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n    if (disabled || e.button !== 0 || (!onSecondaryIconClick && !contextActions)) return;\n\n    e.stopPropagation();\n    if (onSecondaryIconClick) {\n      onSecondaryIconClick(e);\n    } else {\n      handleContextMenu(e);\n    }\n  };\n\n  const handleMouseDown = useCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (inactive || IS_TOUCH_ENV) {\n      return;\n    }\n    if (contextActions && (e.button === 2 || !onClick)) {\n      handleBeforeContextMenu(e);\n    }\n    if (e.button === 0) {\n      if (!onClick) {\n        handleContextMenu(e);\n      } else {\n        handleClick(e);\n      }\n    }\n  }, [inactive, contextActions, onClick, handleBeforeContextMenu, handleContextMenu, handleClick]);\n\n  const lang = useLang();\n\n  const fullClassName = buildClassName(\n    'ListItem',\n    className,\n    !isStatic && 'no-selection',\n    ripple && 'has-ripple',\n    narrow && 'narrow',\n    disabled && 'disabled',\n    inactive && 'inactive',\n    contextMenuPosition && 'has-menu-open',\n    focus && 'focus',\n    destructive && 'destructive',\n    multiline && 'multiline',\n    isStatic && 'is-static',\n  );\n\n  return (\n    <div\n      ref={containerRef}\n      className={fullClassName}\n      dir={lang.isRtl ? 'rtl' : undefined}\n      // @ts-ignore\n      style={style}\n      onMouseDown={onMouseDown}\n    >\n      <div\n        className={buildClassName('ListItem-button', isTouched && 'active')}\n        role=\"button\"\n        ref={buttonRef}\n        tabIndex={0}\n        onClick={(!inactive && IS_TOUCH_ENV) ? handleClick : undefined}\n        onMouseDown={handleMouseDown}\n        onContextMenu={(!inactive && contextActions) ? handleContextMenu : undefined}\n      >\n        {icon && (\n          <i className={`icon-${icon}`} />\n        )}\n        {multiline && (<div className=\"multiline-item\">{children}</div>)}\n        {!multiline && children}\n        {!disabled && !inactive && ripple && (\n          <RippleEffect />\n        )}\n        {secondaryIcon && (\n          <Button\n            className=\"secondary-icon\"\n            round\n            color=\"translucent\"\n            size=\"smaller\"\n            onMouseDown={handleSecondaryIconClick}\n          >\n            <i className={`icon-${secondaryIcon}`} />\n          </Button>\n        )}\n      </div>\n      {contextActions && contextMenuPosition !== undefined && (\n        <Menu\n          isOpen={isContextMenuOpen}\n          positionX={positionX}\n          positionY={positionY}\n          style={menuStyle}\n          className=\"ListItem-context-menu\"\n          autoClose\n          onClose={handleContextMenuClose}\n          onCloseAnimationEnd={handleContextMenuHide}\n        >\n          {contextActions.map((action) => (\n            <MenuItem\n              key={action.title}\n              icon={action.icon}\n              destructive={action.destructive}\n              disabled={!action.handler}\n              onClick={action.handler}\n            >\n              {action.title}\n            </MenuItem>\n          ))}\n        </Menu>\n      )}\n    </div>\n  );\n};\n\nexport default ListItem;\n","import React, {\n  FC,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\n\nimport { ANIMATION_END_DELAY } from '../../config';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport { TextPart } from '../common/helpers/renderMessageText';\nimport buildClassName from '../../util/buildClassName';\nimport captureEscKeyListener from '../../util/captureEscKeyListener';\n\nimport Portal from './Portal';\n\nimport './Notification.scss';\n\ntype OwnProps = {\n  containerId?: string;\n  message: TextPart[];\n  duration?: number;\n  onDismiss: () => void;\n};\n\nconst DEFAULT_DURATION = 3000;\nconst ANIMATION_DURATION = 150;\n\nconst Notification: FC<OwnProps> = ({\n  message, duration = DEFAULT_DURATION, containerId, onDismiss,\n}) => {\n  const [isOpen, setIsOpen] = useState(true);\n  // eslint-disable-next-line no-null/no-null\n  const timerRef = useRef<number | undefined>(null);\n\n  const { transitionClassNames } = useShowTransition(isOpen);\n\n  const closeAndDismiss = useCallback(() => {\n    setIsOpen(false);\n    setTimeout(onDismiss, ANIMATION_DURATION + ANIMATION_END_DELAY);\n  }, [onDismiss]);\n\n  useEffect(() => (isOpen ? captureEscKeyListener(closeAndDismiss) : undefined), [isOpen, closeAndDismiss]);\n\n  useEffect(() => {\n    timerRef.current = window.setTimeout(closeAndDismiss, duration);\n\n    return () => {\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n        timerRef.current = undefined;\n      }\n    };\n  }, [duration, closeAndDismiss]);\n\n  const handleMouseEnter = useCallback(() => {\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n      timerRef.current = undefined;\n    }\n  }, []);\n\n  const handleMouseLeave = useCallback(() => {\n    timerRef.current = window.setTimeout(closeAndDismiss, duration);\n  }, [duration, closeAndDismiss]);\n\n  return (\n    <Portal className=\"Notification-container\" containerId={containerId}>\n      <div\n        className={buildClassName('Notification', transitionClassNames)}\n        onClick={closeAndDismiss}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n      >\n        <div className=\"content\">\n          {message}\n        </div>\n      </div>\n    </Portal>\n  );\n};\n\nexport default Notification;\n","import React, {\n  FC, useEffect, useRef, memo,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './ProgressSpinner.scss';\n\nconst RADIUSES = {\n  s: 22, m: 25, l: 28, xl: 20,\n};\nconst STROKE_WIDTH = 2;\nconst MIN_PROGRESS = 0.05;\nconst MAX_PROGRESS = 1;\n\nconst ProgressSpinner: FC<{\n  progress?: number;\n  size?: 's' | 'm' | 'l' | 'xl';\n  square?: boolean;\n  transparent?: boolean;\n  noCross?: boolean;\n  onClick?: (e: React.MouseEvent<HTMLElement, MouseEvent>) => void;\n}> = ({\n  progress = 0,\n  size = 'l',\n  square,\n  transparent,\n  noCross,\n  onClick,\n}) => {\n  const radius = RADIUSES[size];\n  const circleRadius = radius - STROKE_WIDTH * 2;\n  const borderRadius = radius - 1;\n  const circumference = circleRadius * 2 * Math.PI;\n  // eslint-disable-next-line no-null/no-null\n  const container = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!container.current) {\n      return;\n    }\n\n    const svg = container.current.firstElementChild;\n    const strokeDashOffset = circumference - Math.min(Math.max(MIN_PROGRESS, progress), MAX_PROGRESS) * circumference;\n\n    if (!svg) {\n      container.current.innerHTML = `<svg\n        viewBox=\"0 0 ${borderRadius * 2} ${borderRadius * 2}\"\n        height=\"${borderRadius * 2}\"\n        width=\"${borderRadius * 2}\"\n      >\n        <circle\n          stroke=\"white\"\n          fill=\"transparent\"\n          stroke-width=${STROKE_WIDTH}\n          stroke-dasharray=\"${circumference} ${circumference}\"}\n          stroke-dashoffset=\"${strokeDashOffset}\"\n          stroke-linecap=\"round\"\n          r=${circleRadius}\n          cx=${borderRadius}\n          cy=${borderRadius}\n        />\n      </svg>`;\n    } else {\n      (svg.firstElementChild as SVGElement).setAttribute('stroke-dashoffset', strokeDashOffset.toString());\n    }\n  }, [container, circumference, borderRadius, circleRadius, progress]);\n\n  const className = buildClassName(\n    `ProgressSpinner size-${size}`,\n    transparent && 'transparent',\n    square && 'square',\n    noCross && 'no-cross',\n  );\n\n  return (\n    <div\n      ref={container}\n      className={className}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default memo(ProgressSpinner);\n","import { ChangeEvent } from 'react';\nimport React, { FC, memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport Spinner from './Spinner';\n\nimport './Radio.scss';\n\ntype OwnProps = {\n  id?: string;\n  name: string;\n  label: string;\n  subLabel?: string;\n  value: string;\n  checked: boolean;\n  disabled?: boolean;\n  hidden?: boolean;\n  isLoading?: boolean;\n  onChange: (e: ChangeEvent<HTMLInputElement>) => void;\n};\n\nconst Radio: FC<OwnProps> = ({\n  id,\n  label,\n  subLabel,\n  value,\n  name,\n  checked,\n  disabled,\n  hidden,\n  isLoading,\n  onChange,\n}) => {\n  const lang = useLang();\n  const className = buildClassName(\n    'Radio',\n    disabled && 'disabled',\n    hidden && 'hidden-widget',\n    isLoading && 'loading',\n  );\n\n  return (\n    <label className={className} dir={lang.isRtl ? 'rtl' : undefined}>\n      <input\n        type=\"radio\"\n        name={name}\n        value={value}\n        id={id}\n        checked={checked}\n        onChange={onChange}\n        disabled={disabled || hidden}\n      />\n      <div className=\"Radio-main\">\n        <span className=\"label\" dir={lang.isRtl ? 'auto' : undefined}>{label}</span>\n        {subLabel && <span className=\"subLabel\" dir={lang.isRtl ? 'auto' : undefined}>{subLabel}</span>}\n      </div>\n      {isLoading && <Spinner />}\n    </label>\n  );\n};\n\nexport default memo(Radio);\n","import { ChangeEvent } from 'react';\nimport React, { FC, useCallback, memo } from '../../lib/teact/teact';\n\nimport Radio from './Radio';\n\nexport type IRadioOption = {\n  label: string;\n  subLabel?: string;\n  value: string;\n  hidden?: boolean;\n};\n\ntype OwnProps = {\n  id?: string;\n  name: string;\n  options: IRadioOption[];\n  selected?: string;\n  disabled?: boolean;\n  loadingOption?: string;\n  onChange: (value: string) => void;\n};\n\nconst RadioGroup: FC<OwnProps> = ({\n  id,\n  name,\n  options,\n  selected,\n  disabled,\n  loadingOption,\n  onChange,\n}) => {\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    const { value } = event.currentTarget;\n    onChange(value);\n  }, [onChange]);\n\n  return (\n    <div id={id} className=\"radio-group\">\n      {options.map((option) => (\n        <Radio\n          name={name}\n          label={option.label}\n          subLabel={option.subLabel}\n          value={option.value}\n          checked={option.value === selected}\n          hidden={option.hidden}\n          disabled={disabled}\n          isLoading={loadingOption ? loadingOption === option.value : undefined}\n          onChange={handleChange}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(RadioGroup);\n","import { ChangeEvent } from 'react';\nimport React, {\n  FC, useCallback, useMemo, memo,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport './RangeSlider.scss';\n\ntype OwnProps = {\n  options?: string[];\n  min?: number;\n  max?: number;\n  step?: number;\n  label?: string;\n  value: number;\n  renderValue?: (value: number) => string;\n  disabled?: boolean;\n  onChange: (value: number) => void;\n};\n\nconst RangeSlider: FC<OwnProps> = ({\n  options,\n  min = 0,\n  max = options ? options.length - 1 : 100,\n  step = 1,\n  label,\n  value,\n  renderValue,\n  disabled,\n  onChange,\n}) => {\n  const lang = useLang();\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    onChange(Number(event.currentTarget.value));\n  }, [onChange]);\n\n  const className = buildClassName(\n    'RangeSlider',\n    disabled && 'disabled',\n  );\n\n  const trackWidth = useMemo(() => {\n    if (options) {\n      return (value / (options.length - 1)) * 100;\n    } else {\n      const possibleValuesLength = (max - min) / step;\n      return ((value - min) / possibleValuesLength) * 100;\n    }\n  }, [options, value, max, min, step]);\n\n  return (\n    <div className={className}>\n      {label && (\n        <div className=\"slider-top-row\" dir={lang.isRtl ? 'rtl' : undefined}>\n          <span className=\"label\" dir=\"auto\">{label}</span>\n          {!options && (\n            <span className=\"value\" dir=\"auto\">{renderValue ? renderValue(value) : value}</span>\n          )}\n        </div>\n      )}\n      <div className=\"slider-main\">\n        <div\n          className=\"slider-fill-track\"\n          // @ts-ignore\n          style={`width: ${trackWidth}%`}\n        />\n        <input\n          min={min}\n          max={max}\n          value={value}\n          step={step}\n          type=\"range\"\n          onChange={handleChange}\n        />\n        {options && (\n          <div className=\"slider-options\">\n            {options.map((option, index) => (\n              <div\n                className={buildClassName('slider-option no-selection', index === value && 'active')}\n                onClick={() => onChange(index)}\n              >\n                {option}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(RangeSlider);\n","import { RefObject } from 'react';\nimport React, {\n  FC, useRef, useEffect, memo, useCallback,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\nimport useInputFocusOnOpen from '../../hooks/useInputFocusOnOpen';\n\nimport Loading from './Loading';\nimport Button from './Button';\n\nimport './SearchInput.scss';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLInputElement>;\n  children?: any;\n  parentContainerClassName?: string;\n  className?: string;\n  inputId?: string;\n  value?: string;\n  focused?: boolean;\n  isLoading?: boolean;\n  placeholder?: string;\n  disabled?: boolean;\n  autoComplete?: string;\n  canClose?: boolean;\n  autoFocusSearch?: boolean;\n  onChange: (value: string) => void;\n  onReset?: NoneToVoidFunction;\n  onFocus?: NoneToVoidFunction;\n  onBlur?: NoneToVoidFunction;\n};\n\nconst SearchInput: FC<OwnProps> = ({\n  ref,\n  children,\n  parentContainerClassName,\n  value,\n  inputId,\n  className,\n  focused,\n  isLoading,\n  placeholder,\n  disabled,\n  autoComplete,\n  canClose,\n  autoFocusSearch,\n  onChange,\n  onReset,\n  onFocus,\n  onBlur,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let inputRef = useRef<HTMLInputElement>(null);\n  if (ref) {\n    inputRef = ref;\n  }\n\n  const [isInputFocused, markInputFocused, unmarkInputFocused] = useFlag(focused);\n\n  useInputFocusOnOpen(inputRef, autoFocusSearch, unmarkInputFocused);\n\n  useEffect(() => {\n    if (!inputRef.current) {\n      return;\n    }\n\n    if (focused) {\n      inputRef.current.focus();\n    } else {\n      inputRef.current.blur();\n    }\n  }, [focused, placeholder]); // Trick for setting focus when selecting a contact to search for\n\n  const lang = useLang();\n\n  function handleChange(event: React.ChangeEvent<HTMLInputElement>) {\n    const { currentTarget } = event;\n    onChange(currentTarget.value);\n  }\n\n  function handleFocus() {\n    markInputFocused();\n    if (onFocus) {\n      onFocus();\n    }\n  }\n\n  function handleBlur() {\n    unmarkInputFocused();\n    if (onBlur) {\n      onBlur();\n    }\n  }\n\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'ArrowDown' || e.key === 'Enter') {\n      const element = document.querySelector(`.${parentContainerClassName} .ListItem-button`) as HTMLElement;\n      if (element) {\n        element.focus();\n      }\n    }\n  }, [parentContainerClassName]);\n\n  return (\n    <div\n      className={buildClassName('SearchInput', className, isInputFocused && 'has-focus')}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {children}\n      <input\n        ref={inputRef}\n        id={inputId}\n        type=\"text\"\n        dir=\"auto\"\n        placeholder={placeholder || lang('Search')}\n        className=\"form-control\"\n        value={value}\n        disabled={disabled}\n        autoComplete={autoComplete}\n        onChange={handleChange}\n        onFocus={handleFocus}\n        onBlur={handleBlur}\n        onKeyDown={handleKeyDown}\n      />\n      <i className=\"icon-search\" />\n      {isLoading && (\n        <Loading />\n      )}\n      {!isLoading && (value || canClose) && onReset && (\n        <Button\n          round\n          size=\"tiny\"\n          color=\"translucent\"\n          onClick={onReset}\n        >\n          <span className=\"icon-close\" />\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(SearchInput);\n","import React, { FC, useRef } from '../../lib/teact/teact';\n\nimport useShowTransition from '../../hooks/useShowTransition';\nimport usePrevious from '../../hooks/usePrevious';\nimport buildClassName from '../../util/buildClassName';\n\ntype ChildrenFn = () => any;\n\ntype OwnProps = {\n  isOpen: boolean;\n  isCustom?: boolean;\n  id?: string;\n  className?: string;\n  onClick?: (e: React.MouseEvent<HTMLElement, MouseEvent>) => void;\n  children: ChildrenFn;\n};\n\nconst ShowTransition: FC<OwnProps> = ({\n  isOpen, isCustom, id, className, onClick, children,\n}) => {\n  const { shouldRender, transitionClassNames } = useShowTransition(\n    isOpen, undefined, undefined, isCustom ? false : undefined,\n  );\n  const prevIsOpen = usePrevious(isOpen);\n  const prevChildren = usePrevious(children);\n  const fromChildrenRef = useRef<ChildrenFn>();\n\n  if (prevIsOpen && !isOpen) {\n    fromChildrenRef.current = prevChildren;\n  }\n\n  return (\n    shouldRender && (\n      <div id={id} className={buildClassName(className, transitionClassNames)} onClick={onClick}>\n        {isOpen ? children() : fromChildrenRef.current!()}\n      </div>\n    )\n  );\n};\n\nexport default ShowTransition;\n","import { ChangeEvent } from 'react';\nimport React, { FC, memo, useCallback } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './Switcher.scss';\n\ntype OwnProps = {\n  id?: string;\n  name?: string;\n  value?: string;\n  label: string;\n  checked?: boolean;\n  disabled?: boolean;\n  inactive?: boolean;\n  noAnimation?: boolean;\n  onChange?: (e: ChangeEvent<HTMLInputElement>) => void;\n  onCheck?: (isChecked: boolean) => void;\n};\n\nconst Switcher: FC<OwnProps> = ({\n  id,\n  name,\n  value,\n  label,\n  checked = false,\n  disabled,\n  inactive,\n  noAnimation,\n  onChange,\n  onCheck,\n}) => {\n  const handleChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    if (onChange) {\n      onChange(e);\n    }\n\n    if (onCheck) {\n      onCheck(e.currentTarget.checked);\n    }\n  }, [onChange, onCheck]);\n\n  const className = buildClassName(\n    'Switcher',\n    disabled && 'disabled',\n    inactive && 'inactive',\n    noAnimation && 'no-animation',\n  );\n\n  return (\n    <label className={className} title={label}>\n      <input\n        type=\"checkbox\"\n        id={id}\n        name={name}\n        value={value}\n        checked={checked}\n        disabled={disabled}\n        onChange={handleChange}\n      />\n      <span className=\"widget\" />\n    </label>\n  );\n};\n\nexport default memo(Switcher);\n","import React, {\n  FC, useRef, memo, useEffect,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport forceReflow from '../../util/forceReflow';\nimport renderText from '../common/helpers/renderText';\n\nimport './Tab.scss';\n\ntype OwnProps = {\n  className?: string;\n  title: string;\n  isActive?: boolean;\n  badgeCount?: number;\n  isBadgeActive?: boolean;\n  previousActiveTab?: number;\n  onClick: (arg: number) => void;\n  clickArg: number;\n};\n\nconst classNames = {\n  active: 'Tab--active',\n  badgeActive: 'Tab__badge--active',\n};\n\nconst Tab: FC<OwnProps> = ({\n  className,\n  title,\n  isActive,\n  badgeCount,\n  isBadgeActive,\n  previousActiveTab,\n  onClick,\n  clickArg,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const tabRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    // Set initial active state\n    if (isActive && previousActiveTab === undefined && tabRef.current) {\n      tabRef.current.classList.add(classNames.active);\n    }\n\n    if (!isActive || previousActiveTab === undefined) {\n      return;\n    }\n\n    const tabEl = tabRef.current!;\n    const prevTabEl = tabEl.parentElement!.children[previousActiveTab];\n    if (!prevTabEl) {\n      return;\n    }\n\n    const platformEl = tabEl.querySelector('i')!;\n    const prevPlatformEl = prevTabEl.querySelector('i')!;\n\n    // We move and resize the platform, so it repeats the position and size of the previous one\n    const shiftLeft = prevPlatformEl.parentElement!.offsetLeft - platformEl.parentElement!.offsetLeft;\n    const scaleFactor = prevPlatformEl.clientWidth / platformEl.clientWidth;\n\n    prevPlatformEl.classList.remove('animate');\n    platformEl.classList.remove('animate');\n    platformEl.style.transform = `translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`;\n    forceReflow(platformEl);\n    platformEl.classList.add('animate');\n    platformEl.style.transform = 'none';\n\n    prevTabEl.classList.remove(classNames.active);\n    tabEl.classList.add(classNames.active);\n  }, [isActive, previousActiveTab]);\n\n  return (\n    <div\n      className={buildClassName('Tab', className)}\n      onClick={() => onClick(clickArg)}\n      ref={tabRef}\n    >\n      <span>\n        {renderText(title)}\n        {!!badgeCount && (\n          <span className={buildClassName('badge', isBadgeActive && classNames.badgeActive)}>{badgeCount}</span>\n        )}\n        <i />\n      </span>\n    </div>\n  );\n};\n\nexport default memo(Tab);\n","import React, {\n  FC, memo, useRef, useEffect,\n} from '../../lib/teact/teact';\n\nimport { IS_ANDROID, IS_IOS } from '../../util/environment';\nimport fastSmoothScrollHorizontal from '../../util/fastSmoothScrollHorizontal';\nimport usePrevious from '../../hooks/usePrevious';\nimport useHorizontalScroll from '../../hooks/useHorizontalScroll';\nimport useLang from '../../hooks/useLang';\n\nimport Tab from './Tab';\n\nimport './TabList.scss';\n\nexport type TabWithProperties = {\n  title: string;\n  badgeCount?: number;\n  isBadgeActive?: boolean;\n};\n\ntype OwnProps = {\n  tabs: readonly TabWithProperties[];\n  activeTab: number;\n  big?: boolean;\n  onSwitchTab: (index: number) => void;\n};\n\nconst TAB_SCROLL_THRESHOLD_PX = 16;\n// Should match duration from `--slide-transition` CSS variable\nconst SCROLL_DURATION = IS_IOS ? 450 : IS_ANDROID ? 400 : 300;\n\nconst TabList: FC<OwnProps> = ({\n  tabs, activeTab, big, onSwitchTab,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  const previousActiveTab = usePrevious(activeTab);\n\n  useHorizontalScroll(containerRef.current);\n\n  // Scroll container to place active tab in the center\n  useEffect(() => {\n    const container = containerRef.current!;\n    const { scrollWidth, offsetWidth, scrollLeft } = container;\n    if (scrollWidth <= offsetWidth) {\n      return;\n    }\n\n    const activeTabElement = container.childNodes[activeTab] as HTMLElement | null;\n    if (!activeTabElement) {\n      return;\n    }\n\n    const { offsetLeft: activeTabOffsetLeft, offsetWidth: activeTabOffsetWidth } = activeTabElement;\n    const newLeft = activeTabOffsetLeft - (offsetWidth / 2) + (activeTabOffsetWidth / 2);\n\n    // Prevent scrolling by only a couple of pixels, which doesn't look smooth\n    if (Math.abs(newLeft - scrollLeft) < TAB_SCROLL_THRESHOLD_PX) {\n      return;\n    }\n\n    fastSmoothScrollHorizontal(container, newLeft, SCROLL_DURATION);\n  }, [activeTab]);\n\n  const lang = useLang();\n\n  return (\n    <div\n      className={`TabList no-selection no-scrollbar ${big ? 'big' : ''}`}\n      ref={containerRef}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {tabs.map((tab, i) => (\n        <Tab\n          key={tab.title}\n          title={lang(tab.title)}\n          isActive={i === activeTab}\n          badgeCount={tab.badgeCount}\n          isBadgeActive={tab.isBadgeActive}\n          previousActiveTab={previousActiveTab}\n          onClick={onSwitchTab}\n          clickArg={i}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(TabList);\n","import { RefObject } from 'react';\nimport React, {\n  FC, useLayoutEffect, useRef,\n} from '../../lib/teact/teact';\nimport { getGlobal } from '../../lib/teact/teactn';\nimport { GlobalState } from '../../global/types';\n\nimport { ANIMATION_LEVEL_MIN } from '../../config';\nimport buildClassName from '../../util/buildClassName';\nimport forceReflow from '../../util/forceReflow';\nimport { waitForAnimationEnd, waitForTransitionEnd } from '../../util/cssAnimationEndListeners';\nimport useForceUpdate from '../../hooks/useForceUpdate';\nimport usePrevious from '../../hooks/usePrevious';\nimport { dispatchHeavyAnimationEvent } from '../../hooks/useHeavyAnimationCheck';\n\nimport './Transition.scss';\n\ntype ChildrenFn = (isActive: boolean, isFrom: boolean, currentKey: number) => any;\nexport type TransitionProps = {\n  ref?: RefObject<HTMLDivElement>;\n  activeKey: number;\n  name: (\n    'none' | 'slide' | 'slide-rtl' | 'mv-slide' | 'slide-fade' | 'zoom-fade' | 'slide-layers'\n    | 'fade' | 'push-slide' | 'reveal' | 'slide-optimized' | 'slide-optimized-rtl'\n  );\n  direction?: 'auto' | 'inverse' | 1 | -1;\n  renderCount?: number;\n  shouldRestoreHeight?: boolean;\n  shouldCleanup?: boolean;\n  cleanupExceptionKey?: number;\n  isDisabled?: boolean;\n  id?: string;\n  className?: string;\n  onStart?: NoneToVoidFunction;\n  onStop?: NoneToVoidFunction;\n  children: ChildrenFn;\n};\n\nconst CLEANED_UP = Symbol('CLEANED_UP');\n\nconst classNames = {\n  active: 'Transition__slide--active',\n};\n\nconst Transition: FC<TransitionProps> = ({\n  ref,\n  activeKey,\n  name,\n  direction = 'auto',\n  renderCount,\n  shouldRestoreHeight,\n  shouldCleanup,\n  cleanupExceptionKey,\n  id,\n  className,\n  onStart,\n  onStop,\n  children,\n}) => {\n  // No need for a container to update on change\n  const { animationLevel } = getGlobal().settings.byKey;\n  const currentKeyRef = useRef<number>();\n\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const rendersRef = useRef<Record<number, ChildrenFn | typeof CLEANED_UP>>({});\n  const prevActiveKey = usePrevious<any>(activeKey);\n  const forceUpdate = useForceUpdate();\n\n  const activeKeyChanged = prevActiveKey !== undefined && activeKey !== prevActiveKey;\n\n  if (!renderCount && activeKeyChanged) {\n    rendersRef.current = { [prevActiveKey]: rendersRef.current[prevActiveKey] };\n  }\n\n  rendersRef.current[activeKey] = children;\n\n  useLayoutEffect(() => {\n    function cleanup() {\n      if (!shouldCleanup || (cleanupExceptionKey !== undefined && cleanupExceptionKey === prevActiveKey)) {\n        return;\n      }\n\n      rendersRef.current = { [prevActiveKey]: CLEANED_UP };\n      forceUpdate();\n    }\n\n    const container = containerRef.current!;\n\n    const childElements = container.children;\n    if (childElements.length === 1 && !activeKeyChanged) {\n      if (name.startsWith('slide-optimized')) {\n        (childElements[0] as HTMLElement).style.transition = 'none';\n        (childElements[0] as HTMLElement).style.transform = 'translate3d(0, 0, 0)';\n      }\n\n      childElements[0].classList.add(classNames.active);\n\n      return;\n    }\n\n    const childNodes = Array.from(container.childNodes);\n\n    if (!activeKeyChanged || !childNodes.length) {\n      return;\n    }\n\n    currentKeyRef.current = activeKey;\n\n    const isBackwards = (\n      direction === -1\n      || (direction === 'auto' && prevActiveKey > activeKey)\n      || (direction === 'inverse' && prevActiveKey < activeKey)\n    );\n\n    const keys = Object.keys(rendersRef.current).map(Number);\n    const prevActiveIndex = renderCount ? prevActiveKey : keys.indexOf(prevActiveKey);\n    const activeIndex = renderCount ? activeKey : keys.indexOf(activeKey);\n\n    if (name === 'slide-optimized' || name === 'slide-optimized-rtl') {\n      performSlideOptimized(\n        animationLevel,\n        name,\n        isBackwards,\n        cleanup,\n        activeKey,\n        currentKeyRef,\n        container,\n        shouldRestoreHeight,\n        onStart,\n        onStop,\n        childNodes[activeIndex] as HTMLElement,\n        childNodes[prevActiveIndex] as HTMLElement,\n      );\n\n      return;\n    }\n\n    container.classList.remove('animating');\n    container.classList.toggle('backwards', isBackwards);\n\n    if (name === 'none' || animationLevel === ANIMATION_LEVEL_MIN) {\n      childNodes.forEach((node, i) => {\n        if (node instanceof HTMLElement) {\n          node.classList.remove('from', 'through', 'to');\n          node.classList.toggle(classNames.active, i === activeIndex);\n        }\n      });\n\n      cleanup();\n\n      return;\n    }\n\n    childNodes.forEach((node, i) => {\n      if (node instanceof HTMLElement) {\n        node.classList.remove(classNames.active);\n        node.classList.toggle('from', i === prevActiveIndex);\n        node.classList.toggle('through', (\n          (i > prevActiveIndex && i < activeIndex) || (i < prevActiveIndex && i > activeIndex)\n        ));\n        node.classList.toggle('to', i === activeIndex);\n      }\n    });\n\n    const dispatchHeavyAnimationStop = dispatchHeavyAnimationEvent();\n\n    requestAnimationFrame(() => {\n      container.classList.add('animating');\n\n      onStart?.();\n\n      function onAnimationEnd() {\n        requestAnimationFrame(() => {\n          if (activeKey !== currentKeyRef.current) {\n            return;\n          }\n\n          container.classList.remove('animating', 'backwards');\n\n          childNodes.forEach((node, i) => {\n            if (node instanceof HTMLElement) {\n              node.classList.remove('from', 'through', 'to');\n              node.classList.toggle(classNames.active, i === activeIndex);\n            }\n          });\n\n          if (shouldRestoreHeight) {\n            const activeElement = container.querySelector<HTMLDivElement>(`.${classNames.active}`);\n\n            if (activeElement) {\n              activeElement.style.height = 'auto';\n              container.style.height = `${activeElement.clientHeight}px`;\n            }\n          }\n\n          onStop?.();\n          dispatchHeavyAnimationStop();\n          cleanup();\n        });\n      }\n\n      const watchedNode = name === 'mv-slide'\n        ? childNodes[activeIndex]?.firstChild\n        : name === 'reveal' && isBackwards\n          ? childNodes[prevActiveIndex]\n          : childNodes[activeIndex];\n\n      if (watchedNode) {\n        waitForAnimationEnd(watchedNode, onAnimationEnd);\n      } else {\n        onAnimationEnd();\n      }\n    });\n  }, [\n    activeKey,\n    prevActiveKey,\n    activeKeyChanged,\n    direction,\n    name,\n    onStart,\n    onStop,\n    renderCount,\n    shouldRestoreHeight,\n    shouldCleanup,\n    cleanupExceptionKey,\n    animationLevel,\n    forceUpdate,\n  ]);\n\n  useLayoutEffect(() => {\n    if (shouldRestoreHeight) {\n      const container = containerRef.current!;\n      const activeElement = container.querySelector<HTMLDivElement>(`.${classNames.active}`)\n        || container.querySelector<HTMLDivElement>('.from');\n\n      if (activeElement) {\n        activeElement.style.height = 'auto';\n        container.style.height = `${activeElement.clientHeight}px`;\n        container.style.flexBasis = `${activeElement.clientHeight}px`;\n      }\n    }\n  }, [shouldRestoreHeight, children]);\n\n  const renders = rendersRef.current;\n  const collection = Object.keys(renderCount ? new Array(renderCount).fill(undefined) : renders).map(Number);\n\n  const contents = collection.map((key) => {\n    const render = renders[key];\n\n    return (\n      typeof render === 'function' ? (\n        <div key={key} teactOrderKey={key}>{render(key === activeKey, key === prevActiveKey, activeKey)}</div>\n      ) : undefined\n    );\n  });\n\n  return (\n    <div\n      ref={containerRef}\n      id={id}\n      className={buildClassName('Transition', className, name)}\n      teactFastList={!renderCount && !shouldCleanup}\n    >\n      {contents}\n    </div>\n  );\n};\n\nexport default Transition;\n\nfunction performSlideOptimized(\n  animationLevel: GlobalState['settings']['byKey']['animationLevel'],\n  name: 'slide-optimized' | 'slide-optimized-rtl',\n  isBackwards: boolean,\n  cleanup: NoneToVoidFunction,\n  activeKey: number,\n  currentKeyRef: { current: number | undefined },\n  container: HTMLElement,\n  shouldRestoreHeight?: boolean,\n  onStart?: NoneToVoidFunction,\n  onStop?: NoneToVoidFunction,\n  toSlide?: HTMLElement,\n  fromSlide?: HTMLElement,\n) {\n  if (!fromSlide || !toSlide) {\n    return;\n  }\n\n  if (animationLevel === ANIMATION_LEVEL_MIN) {\n    fromSlide.style.transition = 'none';\n    fromSlide.style.transform = '';\n    fromSlide.classList.remove(classNames.active);\n\n    toSlide.style.transition = 'none';\n    toSlide.style.transform = 'translate3d(0, 0, 0)';\n    toSlide.classList.add(classNames.active);\n\n    cleanup();\n\n    return;\n  }\n\n  if (name === 'slide-optimized-rtl') {\n    isBackwards = !isBackwards;\n  }\n\n  const dispatchHeavyAnimationStop = dispatchHeavyAnimationEvent();\n\n  requestAnimationFrame(() => {\n    onStart?.();\n\n    fromSlide.style.transition = 'none';\n    fromSlide.style.transform = 'translate3d(0, 0, 0)';\n\n    toSlide.style.transition = 'none';\n    toSlide.style.transform = `translate3d(${isBackwards ? '-' : ''}100%, 0, 0)`;\n\n    forceReflow(toSlide);\n\n    fromSlide.style.transition = '';\n    fromSlide.style.transform = `translate3d(${isBackwards ? '' : '-'}100%, 0, 0)`;\n\n    toSlide.style.transition = '';\n    toSlide.style.transform = 'translate3d(0, 0, 0)';\n\n    fromSlide.classList.remove(classNames.active);\n    toSlide.classList.add(classNames.active);\n\n    waitForTransitionEnd(fromSlide, () => {\n      if (activeKey !== currentKeyRef.current) {\n        return;\n      }\n\n      fromSlide.style.transition = 'none';\n      fromSlide.style.transform = '';\n\n      if (shouldRestoreHeight) {\n        toSlide.style.height = 'auto';\n        container.style.height = `${toSlide.clientHeight}px`;\n      }\n\n      onStop?.();\n      dispatchHeavyAnimationStop();\n      cleanup();\n    });\n  });\n}\n","import useReducer, { StateReducer, Dispatch } from '../useReducer';\nimport { ApiChatFolder } from '../../api/types';\nimport { pick, omit } from '../../util/iteratees';\n\nexport type FolderChatType = {\n  icon: string;\n  title: string;\n  key: keyof Pick<ApiChatFolder, (\n    'contacts' | 'nonContacts' | 'groups' | 'channels' | 'bots' |\n    'excludeMuted' | 'excludeArchived' | 'excludeRead'\n  )>;\n};\n\nexport const INCLUDED_CHAT_TYPES: FolderChatType[] = [\n  { icon: 'user', title: 'FilterContacts', key: 'contacts' },\n  { icon: 'non-contacts', title: 'FilterNonContacts', key: 'nonContacts' },\n  { icon: 'group', title: 'FilterGroups', key: 'groups' },\n  { icon: 'channel', title: 'FilterChannels', key: 'channels' },\n  { icon: 'bots', title: 'FilterBots', key: 'bots' },\n];\n\nexport const EXCLUDED_CHAT_TYPES: FolderChatType[] = [\n  { icon: 'mute', title: 'FilterMuted', key: 'excludeMuted' },\n  { icon: 'archive', title: 'FilterArchived', key: 'excludeArchived' },\n  { icon: 'readchats', title: 'FilterRead', key: 'excludeRead' },\n];\n\nconst INCLUDE_FILTER_FIELDS: Array<keyof FolderIncludeFilters> = [\n  'includedChatIds', 'bots', 'channels', 'groups', 'contacts', 'nonContacts',\n];\nconst EXCLUDE_FILTER_FIELDS: Array<keyof FolderExcludeFilters> = [\n  'excludedChatIds', 'excludeArchived', 'excludeMuted', 'excludeRead',\n];\n\nexport function selectChatFilters(state: FoldersState, mode: 'included' | 'excluded', selectTemp?: boolean) {\n  let selectedChatIds: string[] = [];\n  let selectedChatTypes: FolderChatType['key'][] = [];\n\n  if (mode === 'included') {\n    const {\n      includedChatIds,\n      ...includeFilters\n    } = selectTemp\n      ? state.includeFilters || {}\n      : pick(\n        state.folder,\n        INCLUDE_FILTER_FIELDS,\n      );\n\n    selectedChatIds = includedChatIds || [];\n    selectedChatTypes = (Object.keys(includeFilters) as Array<keyof typeof includeFilters>)\n      .filter((key) => Boolean(includeFilters[key]));\n  } else {\n    const {\n      excludedChatIds,\n      ...excludeFilters\n    } = selectTemp\n      ? state.excludeFilters || {}\n      : pick(\n        state.folder,\n        EXCLUDE_FILTER_FIELDS,\n      );\n\n    selectedChatIds = excludedChatIds || [];\n    selectedChatTypes = (Object.keys(excludeFilters) as Array<keyof typeof excludeFilters>)\n      .filter((key) => Boolean(excludeFilters[key]));\n  }\n\n  return {\n    selectedChatIds,\n    selectedChatTypes,\n  };\n}\n\nfunction getSuggestedFolderName(includeFilters?: FolderIncludeFilters) {\n  if (includeFilters) {\n    const {\n      includedChatIds,\n      ...filters\n    } = includeFilters;\n\n    if (\n      Object.values(filters).filter(Boolean).length > 1\n      || (includedChatIds?.length)\n    ) {\n      return '';\n    }\n\n    if (filters.bots) {\n      return 'Bots';\n    } else if (filters.groups) {\n      return 'Groups';\n    } else if (filters.channels) {\n      return 'Channels';\n    } else if (filters.contacts) {\n      return 'Contacts';\n    } else if (filters.nonContacts) {\n      return 'Non-Contacts';\n    }\n  }\n\n  return '';\n}\n\ntype FolderIncludeFilters = Pick<ApiChatFolder, (\n  'includedChatIds' | 'bots' | 'channels' | 'groups' | 'contacts' | 'nonContacts'\n)>;\ntype FolderExcludeFilters = Pick<ApiChatFolder, 'excludedChatIds' | 'excludeArchived' | 'excludeMuted' | 'excludeRead'>;\n\nexport type FoldersState = {\n  mode: 'create' | 'edit';\n  isLoading?: boolean;\n  isTouched?: boolean;\n  error?: string;\n  folderId?: number;\n  chatFilter: string;\n  folder: Omit<ApiChatFolder, 'id' | 'description' | 'emoticon'>;\n  includeFilters?: FolderIncludeFilters;\n  excludeFilters?: FolderExcludeFilters;\n};\nexport type FoldersActions = (\n  'setTitle' | 'saveFilters' | 'editFolder' | 'reset' | 'setChatFilter' | 'setIsLoading' | 'setError' |\n  'editIncludeFilters' | 'editExcludeFilters' | 'setIncludeFilters' | 'setExcludeFilters'\n);\nexport type FolderEditDispatch = Dispatch<FoldersActions>;\n\nconst INITIAL_STATE: FoldersState = {\n  mode: 'create',\n  chatFilter: '',\n  folder: {\n    title: '',\n    includedChatIds: [],\n    excludedChatIds: [],\n  },\n};\n\nconst foldersReducer: StateReducer<FoldersState, FoldersActions> = (\n  state,\n  action,\n) => {\n  switch (action.type) {\n    case 'setTitle':\n      return {\n        ...state,\n        folder: {\n          ...state.folder,\n          title: action.payload,\n        },\n        isTouched: true,\n      };\n    case 'editIncludeFilters':\n      return {\n        ...state,\n        includeFilters: pick(\n          state.folder,\n          INCLUDE_FILTER_FIELDS,\n        ),\n      };\n    case 'editExcludeFilters':\n      return {\n        ...state,\n        excludeFilters: pick(\n          state.folder,\n          EXCLUDE_FILTER_FIELDS,\n        ),\n      };\n    case 'setIncludeFilters':\n      return {\n        ...state,\n        includeFilters: action.payload,\n        chatFilter: '',\n      };\n    case 'setExcludeFilters':\n      return {\n        ...state,\n        excludeFilters: action.payload,\n        chatFilter: '',\n      };\n    case 'saveFilters':\n      if (state.includeFilters) {\n        return {\n          ...state,\n          folder: {\n            ...omit(state.folder, INCLUDE_FILTER_FIELDS),\n            title: state.folder.title ? state.folder.title : getSuggestedFolderName(state.includeFilters),\n            ...state.includeFilters,\n          },\n          includeFilters: undefined,\n          chatFilter: '',\n          isTouched: true,\n        };\n      } else if (state.excludeFilters) {\n        return {\n          ...state,\n          folder: {\n            ...omit(state.folder, EXCLUDE_FILTER_FIELDS),\n            ...state.excludeFilters,\n          },\n          excludeFilters: undefined,\n          chatFilter: '',\n          isTouched: true,\n        };\n      } else {\n        return state;\n      }\n    case 'editFolder': {\n      const { id: folderId, description, ...folder } = action.payload;\n\n      return {\n        mode: 'edit',\n        folderId,\n        folder,\n        chatFilter: '',\n      };\n    }\n    case 'setChatFilter': {\n      return {\n        ...state,\n        chatFilter: action.payload,\n      };\n    }\n    case 'setIsLoading': {\n      return {\n        ...state,\n        isLoading: action.payload,\n      };\n    }\n    case 'setError': {\n      return {\n        ...state,\n        error: action.payload,\n      };\n    }\n    case 'reset':\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n\nexport default () => {\n  return useReducer(foldersReducer, INITIAL_STATE);\n};\n","import {\n  useCallback, useEffect, useRef, useState,\n} from '../lib/teact/teact';\nimport { getDispatch, getGlobal } from '../lib/teact/teactn';\n\nimport { register, Track, TrackId } from '../util/audioPlayer';\nimport useEffectWithPrevDeps from './useEffectWithPrevDeps';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\nimport useOnChange from './useOnChange';\nimport {\n  MediaSessionHandlers, registerMediaSession, setPlaybackState, setPositionState, updateMetadata,\n} from '../util/mediaSession';\n\ntype Handler = (e: Event) => void;\n\nconst DEFAULT_SKIP_TIME = 10;\n\nexport default (\n  trackId: TrackId,\n  originalDuration: number, // Sometimes incorrect for voice messages\n  trackType: Track['type'],\n  src?: string,\n  handlers?: Record<string, Handler>,\n  metadata?: MediaMetadata,\n  onInit?: (element: HTMLAudioElement) => void,\n  shouldPlay = false,\n  onForcePlay?: NoneToVoidFunction,\n  onTrackChange?: NoneToVoidFunction,\n  noPlaylist = false,\n  noProgressUpdates = false,\n) => {\n  // eslint-disable-next-line no-null/no-null\n  const controllerRef = useRef<ReturnType<typeof register>>(null);\n\n  const [isPlaying, setIsPlaying] = useState(false);\n  let isPlayingSync = isPlaying;\n\n  const [playProgress, setPlayProgress] = useState<number>(0);\n\n  const handleTrackChange = useCallback(() => {\n    setIsPlaying(false);\n    if (onTrackChange) onTrackChange();\n  }, [onTrackChange]);\n\n  useOnChange(() => {\n    controllerRef.current = register(trackId, trackType, (eventName, e) => {\n      switch (eventName) {\n        case 'onPlay': {\n          const {\n            setVolume, setPlaybackRate, toggleMuted, proxy,\n          } = controllerRef.current!;\n          setIsPlaying(true);\n\n          registerMediaSession(metadata, makeMediaHandlers(controllerRef));\n          setPlaybackState('playing');\n          setVolume(getGlobal().audioPlayer.volume);\n          toggleMuted(!!getGlobal().audioPlayer.isMuted);\n          if (trackType === 'voice') {\n            setPlaybackRate(getGlobal().audioPlayer.playbackRate);\n          }\n\n          setPositionState({\n            duration: proxy.duration || 0,\n            playbackRate: proxy.playbackRate,\n            position: proxy.currentTime,\n          });\n          break;\n        }\n        case 'onRateChange': {\n          const { proxy } = controllerRef.current!;\n          setPositionState({\n            duration: proxy.duration || 0,\n            playbackRate: proxy.playbackRate,\n            position: proxy.currentTime,\n          });\n          break;\n        }\n        case 'onPause':\n          setIsPlaying(false);\n          setPlaybackState('paused');\n          break;\n        case 'onTimeUpdate': {\n          const { proxy } = controllerRef.current!;\n          const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n          if (!noProgressUpdates) setPlayProgress(proxy.currentTime / duration);\n          break;\n        }\n        case 'onEnded': {\n          setPlaybackState('paused');\n          break;\n        }\n      }\n\n      handlers?.[eventName]?.(e);\n    }, onForcePlay, handleTrackChange);\n\n    const { proxy } = controllerRef.current!;\n\n    if (!isPlaying && !proxy.paused) {\n      setIsPlaying(true);\n      isPlayingSync = true;\n    }\n\n    if (onInit) {\n      onInit(proxy);\n    }\n  }, [trackId]);\n\n  useEffect(() => {\n    if (isPlaying && metadata) updateMetadata(metadata);\n  }, [metadata, isPlaying]);\n\n  const {\n    play,\n    pause,\n    setCurrentTime,\n    proxy,\n    destroy,\n    setVolume,\n    stop,\n    isFirst,\n    isLast,\n    requestNextTrack,\n    requestPreviousTrack,\n    setPlaybackRate,\n    toggleMuted,\n  } = controllerRef.current!;\n  const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n\n  // RAF progress\n  useEffect(() => {\n    if (duration && !isSafariPatchInProgress(proxy) && !noProgressUpdates) {\n      setPlayProgress(proxy.currentTime / duration);\n    }\n  }, [duration, playProgress, proxy, noProgressUpdates]);\n\n  // Cleanup\n  useEffect(() => () => {\n    destroy(noPlaylist);\n  }, [destroy, noPlaylist]);\n\n  // Autoplay once `src` is present\n  useEffectWithPrevDeps(([prevShouldPlay, prevSrc]) => {\n    if (prevShouldPlay === shouldPlay && src === prevSrc) {\n      return;\n    }\n\n    // When paused by another player\n    if (proxy.src && proxy.paused) {\n      return;\n    }\n\n    if (shouldPlay && src && !isPlaying) {\n      play(src);\n    }\n  }, [shouldPlay, src, isPlaying, play, proxy.src, proxy.paused]);\n\n  const playIfPresent = useCallback(() => {\n    if (src) {\n      play(src);\n    }\n  }, [src, play]);\n\n  const playPause = useCallback(() => {\n    if (isPlaying) {\n      pause();\n    } else {\n      playIfPresent();\n    }\n  }, [pause, playIfPresent, isPlaying]);\n\n  const setTime = useCallback((time: number) => {\n    setCurrentTime(time);\n    if (duration) {\n      setPlayProgress(proxy.currentTime / duration);\n    }\n  }, [duration, proxy, setCurrentTime]);\n\n  return {\n    isPlaying: isPlayingSync,\n    playProgress,\n    playPause,\n    pause,\n    play: playIfPresent,\n    stop,\n    setCurrentTime: setTime,\n    setVolume,\n    audioProxy: proxy,\n    duration,\n    requestNextTrack,\n    requestPreviousTrack,\n    isFirst,\n    isLast,\n    setPlaybackRate,\n    toggleMuted,\n  };\n};\n\nfunction makeMediaHandlers(controllerRef: React.RefObject<ReturnType<typeof register>>) {\n  let mediaHandlers: MediaSessionHandlers = {};\n  if (controllerRef && controllerRef.current) {\n    const {\n      play, pause, setCurrentTime, proxy, requestNextTrack, requestPreviousTrack, isFirst, isLast,\n    } = controllerRef.current;\n    mediaHandlers = {\n      play: () => {\n        play(proxy.src);\n      },\n      pause: () => {\n        pause();\n      },\n      stop: () => {\n        pause();\n        setCurrentTime(0);\n        getDispatch().closeAudioPlayer();\n      },\n      seekbackward: (event) => {\n        const skipTime = event.seekOffset || DEFAULT_SKIP_TIME;\n        setCurrentTime(Math.max(proxy.currentTime - skipTime, 0));\n      },\n      seekforward: (event) => {\n        const skipTime = event.seekOffset || DEFAULT_SKIP_TIME;\n        setCurrentTime(Math.min(proxy.currentTime + skipTime, proxy.duration));\n      },\n      seekTo: (event) => {\n        if (event.seekTime) {\n          setCurrentTime(event.seekTime);\n        }\n      },\n    };\n\n    if (!isLast()) {\n      mediaHandlers.nexttrack = () => {\n        requestNextTrack();\n      };\n    }\n    if (!isFirst()) {\n      mediaHandlers.previoustrack = () => {\n        requestPreviousTrack();\n      };\n    }\n  }\n  return mediaHandlers;\n}\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nimport fastBlur from '../lib/fastBlur';\nimport { imgToCanvas } from '../util/files';\nimport useForceUpdate from './useForceUpdate';\n\nconst RADIUS = 2;\nconst ITERATIONS = 2;\nconst MAX_CACHE_SIZE = 1000;\n\nconst cache = new Map<string, string>();\n\nexport default function useBlur(dataUri?: string, isDisabled = false, delay?: number) {\n  const blurredRef = useRef<string | undefined>(dataUri ? cache.get(dataUri) : undefined);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n\n  if (timeoutRef.current && isDisabled) {\n    clearTimeout(timeoutRef.current);\n    timeoutRef.current = undefined;\n  }\n\n  useEffect(() => {\n    if (!dataUri || blurredRef.current || isDisabled) {\n      return;\n    }\n\n    const img = new Image();\n\n    img.onload = () => {\n      const canvas = imgToCanvas(img);\n      fastBlur(canvas.getContext('2d'), 0, 0, canvas.width, canvas.height, RADIUS, ITERATIONS);\n      const blurredDataUri = canvas.toDataURL();\n\n      blurredRef.current = blurredDataUri;\n      forceUpdate();\n\n      if (cache.size >= MAX_CACHE_SIZE) {\n        cache.clear();\n      }\n      cache.set(dataUri, blurredDataUri);\n    };\n\n    if (delay) {\n      timeoutRef.current = window.setTimeout(() => {\n        img.src = dataUri;\n      }, delay);\n    } else {\n      img.src = dataUri;\n    }\n  }, [dataUri, delay, forceUpdate, isDisabled]);\n\n  return blurredRef.current;\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport fastBlur from '../lib/fastBlur';\nimport useOnChange from './useOnChange';\nimport useBlur from './useBlur';\nimport { imgToCanvas } from '../util/files';\n\nconst RADIUS = 2;\nconst ITERATIONS = 2;\n\nexport default function useBlurSync(dataUri: string | false | undefined) {\n  const blurredRef = useRef<string>();\n\n  let isChanged = false;\n\n  useOnChange(() => {\n    isChanged = true;\n\n    blurredRef.current = undefined;\n\n    if (!dataUri) {\n      return;\n    }\n\n    const img = new Image();\n    img.src = dataUri;\n    if (!img.width) {\n      return;\n    }\n\n    const canvas = imgToCanvas(img);\n    fastBlur(canvas.getContext('2d'), 0, 0, canvas.width, canvas.height, RADIUS, ITERATIONS);\n\n    blurredRef.current = canvas.toDataURL();\n  }, [dataUri]);\n\n  // Sometimes `Image` do not manage to load synchronously,\n  // so we fall back the non-blurred variant and prepare the async one at least for the next time\n  const blurredAsync = useBlur(dataUri || undefined, Boolean(blurredRef.current));\n\n  return blurredRef.current || (!isChanged && blurredAsync) || dataUri || undefined;\n}\n","import React, { useCallback, useMemo, useState } from '../lib/teact/teact';\nimport { debounce } from '../util/schedulers';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\n\ntype BufferingEvent = (e: Event | React.SyntheticEvent<HTMLMediaElement>) => void;\n\nconst MIN_READY_STATE = 3;\n// Avoid flickering when re-mounting previously buffered video\nconst DEBOUNCE = 200;\n\nexport default (noInitiallyBuffered = false) => {\n  const [isBuffered, setIsBuffered] = useState(!noInitiallyBuffered);\n  const [bufferedProgress, setBufferedProgress] = useState(0);\n\n  const setIsBufferedDebounced = useMemo(() => {\n    return debounce(setIsBuffered, DEBOUNCE, false, true);\n  }, []);\n\n  const handleBuffering = useCallback<BufferingEvent>((e) => {\n    const media = e.currentTarget as HTMLMediaElement;\n\n    if (!isSafariPatchInProgress(media)) {\n      if (media.buffered.length) {\n        setBufferedProgress(media.buffered.end(0) / media.duration);\n      }\n\n      setIsBufferedDebounced(media.readyState >= MIN_READY_STATE || media.currentTime > 0);\n    }\n  }, [setIsBufferedDebounced]);\n\n  const bufferingHandlers = {\n    onLoadedData: handleBuffering,\n    onPlaying: handleBuffering,\n    onLoadStart: handleBuffering, // Needed for Safari to start\n    onPause: handleBuffering, // Needed for Chrome when seeking\n    onTimeUpdate: handleBuffering, // Needed for audio buffering progress\n    onProgress: handleBuffering, // Needed for video buffering progress\n  };\n\n  return {\n    isBuffered,\n    bufferedProgress,\n    bufferingHandlers,\n    checkBuffering(element: HTMLMediaElement) {\n      setIsBufferedDebounced(element.readyState >= MIN_READY_STATE);\n    },\n  };\n};\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nimport fastBlur from '../lib/fastBlur';\nimport useForceUpdate from './useForceUpdate';\nimport { IS_CANVAS_FILTER_SUPPORTED } from '../util/environment';\n\nconst RADIUS = 2;\nconst ITERATIONS = 2;\n\nexport default function useCanvasBlur(dataUri?: string, isDisabled = false, withRaf?: boolean) {\n  // eslint-disable-next-line no-null/no-null\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n\n    if (!dataUri || !canvas || isDisabled) {\n      return;\n    }\n\n    const img = new Image();\n\n    const processBlur = () => {\n      canvas.width = img.width;\n      canvas.height = img.height;\n\n      const ctx = canvas.getContext('2d', { alpha: false })!;\n\n      if (IS_CANVAS_FILTER_SUPPORTED) {\n        ctx.filter = `blur(${RADIUS}px)`;\n      }\n\n      ctx.drawImage(img, -RADIUS * 2, -RADIUS * 2, canvas.width + RADIUS * 4, canvas.height + RADIUS * 4);\n\n      if (!IS_CANVAS_FILTER_SUPPORTED) {\n        fastBlur(ctx, 0, 0, canvas.width, canvas.height, RADIUS, ITERATIONS);\n      }\n    };\n\n    img.onload = () => {\n      if (withRaf) {\n        requestAnimationFrame(processBlur);\n      } else {\n        processBlur();\n      }\n    };\n\n    img.src = dataUri;\n  }, [canvasRef, dataUri, forceUpdate, isDisabled, withRaf]);\n\n  return canvasRef;\n}\n","import { useMemo } from '../lib/teact/teact';\nimport { getDispatch } from '../lib/teact/teactn';\n\nimport { ApiChat, ApiUser } from '../api/types';\n\nimport {\n  isChatArchived, getCanDeleteChat, isUserId, isChatChannel,\n} from '../modules/helpers';\nimport { compact } from '../util/iteratees';\nimport useLang from './useLang';\n\nexport default ({\n  chat,\n  user,\n  handleDelete,\n  handleChatFolderChange,\n  folderId,\n  isPinned,\n  isMuted,\n  canChangeFolder,\n}: {\n  chat: ApiChat | undefined;\n  user: ApiUser | undefined;\n  handleDelete: () => void;\n  handleChatFolderChange: () => void;\n  folderId?: number;\n  isPinned?: boolean;\n  isMuted?: boolean;\n  canChangeFolder?: boolean;\n}, isInSearch = false) => {\n  const lang = useLang();\n\n  const { isSelf } = user || {};\n\n  return useMemo(() => {\n    if (!chat) {\n      return undefined;\n    }\n\n    const {\n      toggleChatPinned,\n      updateChatMutedState,\n      toggleChatArchived,\n      toggleChatUnread,\n    } = getDispatch();\n\n    const actionAddToFolder = canChangeFolder ? {\n      title: lang('ChatList.Filter.AddToFolder'),\n      icon: 'folder',\n      handler: handleChatFolderChange,\n    } : undefined;\n\n    const actionPin = isPinned\n      ? {\n        title: lang('UnpinFromTop'),\n        icon: 'unpin',\n        handler: () => toggleChatPinned({ id: chat.id, folderId }),\n      }\n      : { title: lang('PinToTop'), icon: 'pin', handler: () => toggleChatPinned({ id: chat.id, folderId }) };\n\n    if (isInSearch) {\n      return compact([actionPin, actionAddToFolder]);\n    }\n\n    const actionUnreadMark = chat.unreadCount || chat.hasUnreadMark\n      ? { title: lang('MarkAsRead'), icon: 'readchats', handler: () => toggleChatUnread({ id: chat.id }) }\n      : { title: lang('MarkAsUnread'), icon: 'unread', handler: () => toggleChatUnread({ id: chat.id }) };\n\n    const actionMute = isMuted\n      ? {\n        title: lang('ChatList.Unmute'),\n        icon: 'unmute',\n        handler: () => updateChatMutedState({ chatId: chat.id, isMuted: false }),\n      }\n      : {\n        title: lang('ChatList.Mute'),\n        icon: 'mute',\n        handler: () => updateChatMutedState({ chatId: chat.id, isMuted: true }),\n      };\n\n    const actionArchive = isChatArchived(chat)\n      ? { title: lang('Unarchive'), icon: 'unarchive', handler: () => toggleChatArchived({ id: chat.id }) }\n      : { title: lang('Archive'), icon: 'archive', handler: () => toggleChatArchived({ id: chat.id }) };\n\n    const actionDelete = {\n      title: isUserId(chat.id)\n        ? lang('Delete')\n        : lang(getCanDeleteChat(chat)\n          ? 'DeleteChat'\n          : (isChatChannel(chat) ? 'LeaveChannel' : 'Group.LeaveGroup')),\n      icon: 'delete',\n      destructive: true,\n      handler: handleDelete,\n    };\n\n    const isInFolder = folderId !== undefined;\n\n    return compact([\n      actionAddToFolder,\n      actionUnreadMark,\n      actionPin,\n      !isSelf && actionMute,\n      !isSelf && !isInFolder && actionArchive,\n      actionDelete,\n    ]);\n  }, [\n    chat, canChangeFolder, lang, handleChatFolderChange, isPinned, isInSearch, isMuted, handleDelete, folderId, isSelf,\n  ]);\n};\n","import { RefObject } from 'react';\nimport { useState, useEffect, useCallback } from '../lib/teact/teact';\n\nimport { IAnchorPosition } from '../types';\nimport {\n  IS_TOUCH_ENV, IS_SINGLE_COLUMN_LAYOUT, IS_PWA, IS_IOS,\n} from '../util/environment';\n\nconst LONG_TAP_DURATION_MS = 200;\n\nfunction checkIsDisabledForMobile() {\n  return IS_SINGLE_COLUMN_LAYOUT\n  && window.document.body.classList.contains('enable-symbol-menu-transforms');\n}\n\nfunction stopEvent(e: Event) {\n  e.stopImmediatePropagation();\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nexport default (\n  elementRef: RefObject<HTMLElement>,\n  isMenuDisabled?: boolean,\n  shouldDisableOnLink?: boolean,\n  shouldDisableOnLongTap?: boolean,\n) => {\n  const [isContextMenuOpen, setIsContextMenuOpen] = useState(false);\n  const [contextMenuPosition, setContextMenuPosition] = useState<IAnchorPosition | undefined>(undefined);\n\n  const handleBeforeContextMenu = useCallback((e: React.MouseEvent) => {\n    if (!isMenuDisabled && e.button === 2) {\n      (e.target as HTMLElement).classList.add('no-selection');\n    }\n  }, [isMenuDisabled]);\n\n  const handleContextMenu = useCallback((e: React.MouseEvent) => {\n    (e.target as HTMLElement).classList.remove('no-selection');\n\n    if (isMenuDisabled || (shouldDisableOnLink && (e.target as HTMLElement).matches('a[href]'))) {\n      return;\n    }\n    e.preventDefault();\n\n    if (contextMenuPosition) {\n      return;\n    }\n\n    setIsContextMenuOpen(true);\n    setContextMenuPosition({ x: e.clientX, y: e.clientY });\n  }, [isMenuDisabled, shouldDisableOnLink, contextMenuPosition]);\n\n  const handleContextMenuClose = useCallback(() => {\n    setIsContextMenuOpen(false);\n  }, []);\n\n  const handleContextMenuHide = useCallback(() => {\n    setContextMenuPosition(undefined);\n    document.body.classList.remove('no-selection');\n  }, []);\n\n  // Support context menu on touch-devices\n  useEffect(() => {\n    if (isMenuDisabled || !IS_TOUCH_ENV || shouldDisableOnLongTap) {\n      return undefined;\n    }\n\n    const element = elementRef.current;\n    if (!element) {\n      return undefined;\n    }\n\n    let timer: number | undefined;\n\n    const clearLongPressTimer = () => {\n      if (timer) {\n        clearTimeout(timer);\n        timer = undefined;\n      }\n    };\n\n    const emulateContextMenuEvent = (originalEvent: TouchEvent) => {\n      clearLongPressTimer();\n\n      const { clientX, clientY, target } = originalEvent.touches[0];\n\n      if (contextMenuPosition || (shouldDisableOnLink && (target as HTMLElement).matches('a[href]'))) {\n        return;\n      }\n\n      // Temporarily intercept and clear the next click\n      element.addEventListener('touchend', function cancelClickOnce(e) {\n        element.removeEventListener('touchend', cancelClickOnce, true);\n        stopEvent(e);\n      }, true);\n\n      // On iOS15, in PWA mode, the context menu immediately closes after opening\n      if (IS_PWA && IS_IOS) {\n        element.addEventListener('mousedown', function cancelClickOnce(e) {\n          element.removeEventListener('mousedown', cancelClickOnce, true);\n          stopEvent(e);\n        }, true);\n      }\n\n      document.body.classList.add('no-selection');\n      setIsContextMenuOpen(true);\n      setContextMenuPosition({ x: clientX, y: clientY });\n    };\n\n    const startLongPressTimer = (e: TouchEvent) => {\n      if (isMenuDisabled || checkIsDisabledForMobile()) {\n        return;\n      }\n      clearLongPressTimer();\n\n      timer = window.setTimeout(() => emulateContextMenuEvent(e), LONG_TAP_DURATION_MS);\n    };\n\n    // @perf Consider event delegation\n    element.addEventListener('touchstart', startLongPressTimer, { passive: true });\n    element.addEventListener('touchcancel', clearLongPressTimer, true);\n    element.addEventListener('touchend', clearLongPressTimer, true);\n    element.addEventListener('touchmove', clearLongPressTimer, { passive: true });\n\n    return () => {\n      clearLongPressTimer();\n      element.removeEventListener('touchstart', startLongPressTimer);\n      element.removeEventListener('touchcancel', clearLongPressTimer, true);\n      element.removeEventListener('touchend', clearLongPressTimer, true);\n      element.removeEventListener('touchmove', clearLongPressTimer);\n    };\n  }, [contextMenuPosition, isMenuDisabled, shouldDisableOnLongTap, elementRef, shouldDisableOnLink]);\n\n  return {\n    isContextMenuOpen,\n    contextMenuPosition,\n    handleBeforeContextMenu,\n    handleContextMenu,\n    handleContextMenuClose,\n    handleContextMenuHide,\n  };\n};\n","import { useState, useEffect } from '../lib/teact/teact';\nimport { IAnchorPosition } from '../types';\n\ninterface Layout {\n  extraPaddingX?: number;\n  extraTopPadding?: number;\n  marginSides?: number;\n  extraMarginTop?: number;\n}\n\nconst MENU_POSITION_VISUAL_COMFORT_SPACE_PX = 16;\nconst MENU_POSITION_BOTTOM_MARGIN = 12;\nconst EMPTY_RECT = {\n  width: 0, left: 0, height: 0, top: 0,\n};\n\nexport default function useContextMenuPosition(\n  anchor: IAnchorPosition | undefined,\n  getTriggerElement: () => HTMLElement | null,\n  getRootElement: () => HTMLElement | null,\n  getMenuElement: () => HTMLElement | null,\n  getLayout?: () => Layout,\n) {\n  const [positionX, setPositionX] = useState<'right' | 'left'>('right');\n  const [positionY, setPositionY] = useState<'top' | 'bottom'>('bottom');\n  const [withScroll, setWithScroll] = useState(false);\n  const [style, setStyle] = useState('');\n  const [menuStyle, setMenuStyle] = useState('opacity: 0;');\n\n  useEffect(() => {\n    const triggerEl = getTriggerElement();\n    if (!anchor || !triggerEl) {\n      return;\n    }\n\n    let { x, y } = anchor;\n\n    const menuEl = getMenuElement();\n    const rootEl = getRootElement();\n\n    const {\n      extraPaddingX = 0,\n      extraTopPadding = 0,\n      marginSides = 0,\n      extraMarginTop = 0,\n    } = getLayout?.() || {};\n\n    const marginTop = menuEl ? parseInt(getComputedStyle(menuEl).marginTop, 10) + extraMarginTop : undefined;\n\n    const menuRect = menuEl ? {\n      width: menuEl.offsetWidth,\n      height: menuEl.offsetHeight + marginTop!,\n    } : EMPTY_RECT;\n\n    const rootRect = rootEl ? rootEl.getBoundingClientRect() : EMPTY_RECT;\n\n    let horizontalPosition: 'left' | 'right';\n    if (x + menuRect.width + extraPaddingX < rootRect.width + rootRect.left) {\n      x += 3;\n      horizontalPosition = 'left';\n    } else if (x - menuRect.width > 0) {\n      horizontalPosition = 'right';\n      x -= 3;\n    } else {\n      horizontalPosition = 'left';\n      x = 16;\n    }\n    setPositionX(horizontalPosition);\n\n    if (marginSides\n      && horizontalPosition === 'right' && (x + extraPaddingX + marginSides >= rootRect.width + rootRect.left)) {\n      x -= marginSides;\n    }\n\n    if (marginSides && horizontalPosition === 'left') {\n      if (x + extraPaddingX + marginSides + menuRect.width >= rootRect.width + rootRect.left) {\n        x -= marginSides;\n      } else if (x - marginSides <= 0) {\n        x += marginSides;\n      }\n    }\n\n    if (y + menuRect.height < rootRect.height + rootRect.top) {\n      setPositionY('top');\n    } else {\n      setPositionY('bottom');\n\n      if (y - menuRect.height < rootRect.top + extraTopPadding) {\n        y = rootRect.top + rootRect.height;\n      }\n    }\n\n    const triggerRect = triggerEl.getBoundingClientRect();\n    const left = horizontalPosition === 'left'\n      ? Math.min(x - triggerRect.left, rootRect.width - menuRect.width - MENU_POSITION_VISUAL_COMFORT_SPACE_PX)\n      : Math.max((x - triggerRect.left), menuRect.width + MENU_POSITION_VISUAL_COMFORT_SPACE_PX);\n    const top = Math.min(\n      rootRect.height - triggerRect.top + triggerRect.height - MENU_POSITION_BOTTOM_MARGIN + (marginTop || 0),\n      y - triggerRect.top,\n    );\n    const menuMaxHeight = rootRect.height - MENU_POSITION_BOTTOM_MARGIN - (marginTop || 0);\n\n    setWithScroll(menuMaxHeight < menuRect.height);\n    setMenuStyle(`max-height: ${menuMaxHeight}px;`);\n    setStyle(`left: ${left}px; top: ${top}px`);\n  }, [\n    anchor, getMenuElement, getRootElement, getTriggerElement, getLayout,\n  ]);\n\n  return {\n    positionX,\n    positionY,\n    style,\n    menuStyle,\n    withScroll,\n  };\n}\n","import { useMemo } from '../lib/teact/teact';\n\nimport { debounce } from '../util/schedulers';\n\nexport default function useDebounce(ms: number, noFirst?: boolean, noLast?: boolean) {\n  return useMemo(() => {\n    return debounce((cb) => cb(), ms, !noFirst, !noLast);\n  }, [ms, noFirst, noLast]);\n}\n","import { useEffect, useMemo } from '../lib/teact/teact';\nimport { getDispatch } from '../lib/teact/teactn';\n\nimport { ApiMessage } from '../api/types';\n\nimport { throttle } from '../util/schedulers';\n\nexport default (\n  chatId: string,\n  messageId?: number,\n  message?: ApiMessage,\n  replyOriginForId?: number,\n) => {\n  const { loadMessage } = getDispatch();\n  const loadMessageThrottled = useMemo(() => {\n    const throttled = throttle(loadMessage, 500, true);\n    return () => {\n      throttled({ chatId, messageId, replyOriginForId });\n    };\n  }, [loadMessage, chatId, messageId, replyOriginForId]);\n\n  useEffect(() => {\n    if (messageId && !message) {\n      loadMessageThrottled();\n    }\n  });\n};\n","import { useEffect } from '../lib/teact/teact';\n\nexport default (container: HTMLElement | null, isDisabled?: boolean) => {\n  useEffect(() => {\n    if (!container || isDisabled) {\n      return undefined;\n    }\n\n    function handleScroll(e: WheelEvent) {\n      // Ignore horizontal scroll and let it work natively (e.g. on touchpad)\n      if (!e.deltaX) {\n        container!.scrollLeft += e.deltaY / 4;\n      }\n    }\n\n    container.addEventListener('wheel', handleScroll, { passive: true });\n\n    return () => {\n      container.removeEventListener('wheel', handleScroll);\n    };\n  }, [container, isDisabled]);\n};\n","import { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../util/environment';\n\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 500;\nconst MODAL_HIDE_DELAY_MS = 300;\n\nexport default function useInputFocusOnOpen(\n  inputRef: RefObject<HTMLInputElement | HTMLTextAreaElement>,\n  isOpen?: boolean,\n  onClose?: NoneToVoidFunction,\n) {\n  useEffect(() => {\n    if (isOpen) {\n      if (!IS_SINGLE_COLUMN_LAYOUT) {\n        setTimeout(() => {\n          requestAnimationFrame(() => {\n            if (inputRef.current) {\n              inputRef.current.focus();\n            }\n          });\n        }, FOCUS_DELAY_MS);\n      }\n    } else {\n      if (inputRef.current) {\n        inputRef.current.blur();\n      }\n\n      if (onClose) {\n        setTimeout(onClose, MODAL_HIDE_DELAY_MS);\n      }\n    }\n  }, [inputRef, isOpen, onClose]);\n}\n","import { RefObject } from 'react';\nimport {\n  useEffect, useRef, useCallback, useState,\n} from '../lib/teact/teact';\n\nimport { throttle, debounce } from '../util/schedulers';\nimport useHeavyAnimationCheck from './useHeavyAnimationCheck';\n\ntype TargetCallback = (entry: IntersectionObserverEntry) => void;\ntype RootCallback = (entries: IntersectionObserverEntry[]) => void;\ntype ObserveCleanup = NoneToVoidFunction;\nexport type ObserveFn = (target: HTMLElement, targetCallback?: TargetCallback) => ObserveCleanup;\n\ninterface IntersectionController {\n  observer: IntersectionObserver;\n  callbacks: Map<HTMLElement, TargetCallback>;\n}\n\ninterface Response {\n  observe: ObserveFn;\n  freeze: NoneToVoidFunction;\n  unfreeze: NoneToVoidFunction;\n}\n\nexport function useIntersectionObserver({\n  rootRef,\n  throttleMs,\n  debounceMs,\n  shouldSkipFirst,\n  margin,\n  threshold,\n  isDisabled,\n}: {\n  rootRef: RefObject<HTMLDivElement>;\n  throttleMs?: number;\n  debounceMs?: number;\n  shouldSkipFirst?: boolean;\n  margin?: number;\n  threshold?: number | number[];\n  isDisabled?: boolean;\n}, rootCallback?: RootCallback): Response {\n  const controllerRef = useRef<IntersectionController>();\n  const rootCallbackRef = useRef<RootCallback>();\n  const freezeFlagsRef = useRef(0);\n  const onUnfreezeRef = useRef<NoneToVoidFunction>();\n\n  rootCallbackRef.current = rootCallback;\n\n  const freeze = useCallback(() => {\n    freezeFlagsRef.current++;\n  }, []);\n\n  const unfreeze = useCallback(() => {\n    if (!freezeFlagsRef.current) {\n      return;\n    }\n\n    freezeFlagsRef.current--;\n\n    if (!freezeFlagsRef.current && onUnfreezeRef.current) {\n      onUnfreezeRef.current();\n      onUnfreezeRef.current = undefined;\n    }\n  }, []);\n\n  useHeavyAnimationCheck(freeze, unfreeze);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    return () => {\n      if (controllerRef.current) {\n        controllerRef.current.observer.disconnect();\n        controllerRef.current.callbacks.clear();\n        controllerRef.current = undefined;\n      }\n    };\n  }, [isDisabled]);\n\n  function initController() {\n    const callbacks = new Map();\n    const entriesAccumulator = new Map<Element, IntersectionObserverEntry>();\n    const observerCallbackSync = () => {\n      const entries = Array.from(entriesAccumulator.values());\n\n      entries.forEach((entry: IntersectionObserverEntry) => {\n        const callback = callbacks.get(entry.target);\n        if (callback) {\n          callback!(entry, entries);\n        }\n      });\n\n      if (rootCallbackRef.current) {\n        rootCallbackRef.current(entries);\n      }\n\n      entriesAccumulator.clear();\n    };\n    const scheduler = throttleMs ? throttle : debounceMs ? debounce : undefined;\n    const observerCallback = scheduler\n      ? scheduler(observerCallbackSync, (throttleMs || debounceMs)!, !shouldSkipFirst)\n      : observerCallbackSync;\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          entriesAccumulator.set(entry.target, entry);\n        });\n\n        if (freezeFlagsRef.current) {\n          onUnfreezeRef.current = () => {\n            observerCallback();\n          };\n        } else {\n          observerCallback();\n        }\n      },\n      {\n        root: rootRef.current,\n        rootMargin: margin ? `${margin}px` : undefined,\n        threshold,\n      },\n    );\n\n    controllerRef.current = { observer, callbacks };\n  }\n\n  const observe = useCallback((target, targetCallback) => {\n    if (!controllerRef.current) {\n      initController();\n    }\n\n    const controller = controllerRef.current!;\n    controller.observer.observe(target);\n\n    if (targetCallback) {\n      controller.callbacks.set(target, targetCallback);\n    }\n\n    return () => {\n      if (targetCallback) {\n        controller.callbacks.delete(target);\n      }\n\n      controller.observer.unobserve(target);\n    };\n    // Arguments should never change\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDisabled]);\n\n  return { observe, freeze, unfreeze };\n}\n\nexport function useOnIntersect(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  useEffect(() => {\n    return observe ? observe(targetRef.current!, callback) : undefined;\n    // Arguments should never change\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n}\n\nexport function useIsIntersecting(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  const [isIntersecting, setIsIntersecting] = useState(!observe);\n\n  useOnIntersect(targetRef, observe, (entry) => {\n    setIsIntersecting(entry.isIntersecting);\n\n    if (callback) {\n      callback(entry);\n    }\n  });\n\n  return isIntersecting;\n}\n","import { useEffect, useLayoutEffect, useRef } from '../lib/teact/teact';\n\nfunction useInterval(callback: NoneToVoidFunction, delay?: number, noFirst = false) {\n  const savedCallback = useRef(callback);\n\n  useLayoutEffect(() => {\n    savedCallback.current = callback;\n  }, [callback]);\n\n  useEffect(() => {\n    if (delay === undefined) {\n      return undefined;\n    }\n\n    const id = setInterval(() => savedCallback.current(), delay);\n    if (!noFirst) savedCallback.current();\n\n    return () => clearInterval(id);\n  }, [delay, noFirst]);\n}\n\nexport default useInterval;\n","import { useLayoutEffect } from '../lib/teact/teact';\nimport usePrevious from './usePrevious';\n\nexport default <T extends any[], PT = T>(cb: (args: PT) => void, dependencies: T, debugKey?: string) => {\n  const prevDeps = usePrevious<T>(dependencies);\n  return useLayoutEffect(() => {\n    // @ts-ignore (workaround for \"could be instantiated with a different subtype\" issue)\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies, debugKey);\n};\n","import useShowTransition from './useShowTransition';\n\nexport default function useMediaTransition(mediaData?: any) {\n  const isMediaReady = Boolean(mediaData);\n  const { transitionClassNames } = useShowTransition(isMediaReady, undefined, isMediaReady, 'slow');\n\n  return transitionClassNames;\n}\n","import { useRef } from '../lib/teact/teact';\nimport generateIdFor from '../util/generateIdFor';\n\nconst store: Record<string, boolean> = {};\n\nexport default () => {\n  const idRef = useRef<string>();\n\n  if (!idRef.current) {\n    idRef.current = generateIdFor(store);\n    store[idRef.current] = true;\n  }\n\n  return idRef.current;\n};\n","import {\n  useEffect, useMemo, useRef, useState,\n} from '../lib/teact/teact';\n\nimport { IS_PROGRESSIVE_SUPPORTED } from '../util/environment';\nimport { ApiMediaFormat } from '../api/types';\nimport { throttle } from '../util/schedulers';\nimport * as mediaLoader from '../util/mediaLoader';\nimport useForceUpdate from './useForceUpdate';\nimport useUniqueId from './useUniqueId';\n\nconst STREAMING_PROGRESS = 0.75;\nconst STREAMING_TIMEOUT = 1500;\nconst PROGRESS_THROTTLE = 500;\n\nexport default function useMediaWithLoadProgress<T extends ApiMediaFormat = ApiMediaFormat.BlobUrl>(\n  mediaHash: string | undefined,\n  noLoad = false,\n  // @ts-ignore (workaround for \"could be instantiated with a different subtype\" issue)\n  mediaFormat: T = ApiMediaFormat.BlobUrl,\n  cacheBuster?: number,\n  delay?: number | false,\n  isHtmlAllowed = false,\n) {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory(mediaHash) : undefined;\n  const isStreaming = mediaFormat === ApiMediaFormat.Stream || (\n    IS_PROGRESSIVE_SUPPORTED && mediaFormat === ApiMediaFormat.Progressive\n  );\n  const forceUpdate = useForceUpdate();\n  const id = useUniqueId();\n  const [loadProgress, setLoadProgress] = useState(mediaData && !isStreaming ? 1 : 0);\n  const startedAtRef = useRef<number>();\n\n  const handleProgress = useMemo(() => {\n    return throttle((progress: number) => {\n      if (startedAtRef.current && (!delay || (Date.now() - startedAtRef.current > delay))) {\n        setLoadProgress(progress);\n      }\n    }, PROGRESS_THROTTLE, true);\n  }, [delay]);\n\n  useEffect(() => {\n    if (!noLoad && mediaHash) {\n      if (!mediaData) {\n        setLoadProgress(0);\n\n        if (startedAtRef.current) {\n          mediaLoader.cancelProgress(handleProgress);\n        }\n\n        startedAtRef.current = Date.now();\n\n        mediaLoader.fetch(mediaHash, mediaFormat, isHtmlAllowed, handleProgress, id).then(() => {\n          const spentTime = Date.now() - startedAtRef.current!;\n          startedAtRef.current = undefined;\n\n          if (!delay || spentTime >= delay) {\n            forceUpdate();\n          } else {\n            setTimeout(forceUpdate, delay - spentTime);\n          }\n        });\n      } else if (isStreaming) {\n        setTimeout(() => {\n          setLoadProgress(STREAMING_PROGRESS);\n        }, STREAMING_TIMEOUT);\n      }\n    }\n  }, [\n    noLoad, mediaHash, mediaData, mediaFormat, cacheBuster, forceUpdate, isStreaming, delay, handleProgress,\n    isHtmlAllowed, id,\n  ]);\n\n  useEffect(() => {\n    if (noLoad && startedAtRef.current) {\n      mediaLoader.cancelProgress(handleProgress);\n      setLoadProgress(0);\n      startedAtRef.current = undefined;\n    }\n  }, [handleProgress, noLoad]);\n\n  useEffect(() => {\n    return () => {\n      if (mediaHash) {\n        mediaLoader.removeCallback(mediaHash, id);\n      }\n    };\n  }, [id, mediaHash]);\n\n  return { mediaData, loadProgress };\n}\n","import { useCallback, useEffect, useRef } from '../lib/teact/teact';\n\nimport { IS_TOUCH_ENV } from '../util/environment';\n\nconst MENU_CLOSE_TIMEOUT = 250;\nlet closeTimeout: number | undefined;\n\nexport default function useMouseInside(\n  isOpen: boolean, onClose: NoneToVoidFunction, menuCloseTimeout = MENU_CLOSE_TIMEOUT, isDisabled = false,\n) {\n  const isMouseInside = useRef(false);\n\n  const markMouseInside = useCallback(() => {\n    isMouseInside.current = true;\n  }, []);\n\n  useEffect(() => {\n    if (closeTimeout) {\n      clearTimeout(closeTimeout);\n      closeTimeout = undefined;\n    }\n\n    if (isOpen && !IS_TOUCH_ENV && !isDisabled) {\n      closeTimeout = window.setTimeout(() => {\n        if (!isMouseInside.current) {\n          onClose();\n        }\n      }, menuCloseTimeout * 2);\n    }\n  }, [isDisabled, isOpen, menuCloseTimeout, onClose]);\n\n  const handleMouseEnter = useCallback(() => {\n    isMouseInside.current = true;\n  }, []);\n\n  const handleMouseLeave = useCallback(() => {\n    isMouseInside.current = false;\n\n    if (closeTimeout) {\n      clearTimeout(closeTimeout);\n      closeTimeout = undefined;\n    }\n\n    closeTimeout = window.setTimeout(() => {\n      if (!isMouseInside.current) {\n        onClose();\n      }\n    }, menuCloseTimeout);\n  }, [menuCloseTimeout, onClose]);\n\n  return [handleMouseEnter, handleMouseLeave, markMouseInside];\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport usePrevious from './usePrevious';\nimport useForceUpdate from './useForceUpdate';\nimport useOnChange from './useOnChange';\n\nexport default function usePrevDuringAnimation(current: any, duration?: number) {\n  const prev = usePrevious(current, true);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n  // eslint-disable-next-line no-null/no-null\n  const isCurrentPresent = current !== undefined && current !== null;\n  // eslint-disable-next-line no-null/no-null\n  const isPrevPresent = prev !== undefined && prev !== null;\n\n  if (isCurrentPresent && timeoutRef.current) {\n    clearTimeout(timeoutRef.current);\n    timeoutRef.current = undefined;\n  }\n\n  useOnChange(() => {\n    // When `current` becomes empty\n    if (duration && !isCurrentPresent && isPrevPresent && !timeoutRef.current) {\n      timeoutRef.current = window.setTimeout(() => {\n        timeoutRef.current = undefined;\n        forceUpdate();\n      }, duration);\n    }\n  }, [current]);\n\n  return !timeoutRef.current || !duration || isCurrentPresent ? current : prev;\n}\n","import { useState, useCallback, useRef } from '../lib/teact/teact';\n\nexport type ReducerAction<Actions> = { type: Actions; payload?: any };\nexport type StateReducer<State, Actions> = (state: State, action: ReducerAction<Actions>) => State;\nexport type Dispatch<Actions> = (action: ReducerAction<Actions>) => void;\n\nexport default function useReducer<State, Actions>(\n  reducer: StateReducer<State, Actions>,\n  initialState: State,\n) {\n  const reducerRef = useRef(reducer);\n  const [state, setState] = useState<State>(initialState);\n\n  const dispatch = useCallback((action: ReducerAction<Actions>) => {\n    setState((currentState) => reducerRef.current(currentState, action));\n  }, []);\n\n  return [\n    state,\n    dispatch,\n  ] as [State, Dispatch<Actions>];\n}\n","import { useMemo } from '../lib/teact/teact';\nimport { getDispatch } from '../lib/teact/teactn';\n\nimport { ApiSendMessageAction } from '../api/types';\n\nimport { SEND_MESSAGE_ACTION_INTERVAL } from '../config';\nimport { throttle } from '../util/schedulers';\n\nexport default (chatId: string, threadId?: number) => {\n  return useMemo(() => {\n    return throttle((action: ApiSendMessageAction) => {\n      getDispatch().sendMessageAction({ chatId, threadId, action });\n    }, SEND_MESSAGE_ACTION_INTERVAL);\n  }, [chatId, threadId]);\n};\n","import { useEffect, useRef } from '../lib/teact/teact';\n\n// Allows to use state value as \"silent\" dependency in hooks (not causing updates).\n// Useful for state values that update frequently (such as controlled input value).\nexport function useStateRef<T>(value: T) {\n  const ref = useRef<T>(value);\n\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n\n  return ref;\n}\n","import { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\nimport { fastRaf } from '../util/schedulers';\n\n// Fix for memory leak when unmounting video element\nexport default function useVideoCleanup(videoRef: RefObject<HTMLVideoElement>, dependencies: any[]) {\n  useEffect(() => {\n    const videoEl = videoRef.current;\n\n    return () => {\n      if (videoEl) {\n        fastRaf(() => {\n          videoEl.pause();\n          videoEl.src = '';\n          videoEl.load();\n        });\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n}\n","/* eslint-disable no-nested-ternary */\n/* eslint-disable no-bitwise */\n/* eslint-disable no-multi-assign */\n/* eslint-disable no-cond-assign */\n/* eslint-disable no-param-reassign */\n/* eslint-disable prefer-const */\n/* eslint-disable eqeqeq */\n\n/*\nSuperfast Blur - a fast Box Blur For Canvas\n\nVersion:     0.5\nAuthor:        Mario Klingemann\nContact:     mario@quasimondo.com\nWebsite:    http://www.quasimondo.com/BoxBlurForCanvas\nTwitter:    @quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr:\nhttps://flattr.com/thing/140066/Superfast-Blur-a-pretty-fast-Box-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2011 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\n// eslint-disable-next-line max-len\nconst mul_table = [1, 57, 41, 21, 203, 34, 97, 73, 227, 91, 149, 62, 105, 45, 39, 137, 241, 107, 3, 173, 39, 71, 65, 238, 219, 101, 187, 87, 81, 151, 141, 133, 249, 117, 221, 209, 197, 187, 177, 169, 5, 153, 73, 139, 133, 127, 243, 233, 223, 107, 103, 99, 191, 23, 177, 171, 165, 159, 77, 149, 9, 139, 135, 131, 253, 245, 119, 231, 224, 109, 211, 103, 25, 195, 189, 23, 45, 175, 171, 83, 81, 79, 155, 151, 147, 9, 141, 137, 67, 131, 129, 251, 123, 30, 235, 115, 113, 221, 217, 53, 13, 51, 50, 49, 193, 189, 185, 91, 179, 175, 43, 169, 83, 163, 5, 79, 155, 19, 75, 147, 145, 143, 35, 69, 17, 67, 33, 65, 255, 251, 247, 243, 239, 59, 29, 229, 113, 111, 219, 27, 213, 105, 207, 51, 201, 199, 49, 193, 191, 47, 93, 183, 181, 179, 11, 87, 43, 85, 167, 165, 163, 161, 159, 157, 155, 77, 19, 75, 37, 73, 145, 143, 141, 35, 138, 137, 135, 67, 33, 131, 129, 255, 63, 250, 247, 61, 121, 239, 237, 117, 29, 229, 227, 225, 111, 55, 109, 216, 213, 211, 209, 207, 205, 203, 201, 199, 197, 195, 193, 48, 190, 47, 93, 185, 183, 181, 179, 178, 176, 175, 173, 171, 85, 21, 167, 165, 41, 163, 161, 5, 79, 157, 78, 154, 153, 19, 75, 149, 74, 147, 73, 144, 143, 71, 141, 140, 139, 137, 17, 135, 134, 133, 66, 131, 65, 129, 1];\n// eslint-disable-next-line max-len\nconst shg_table = [0, 9, 10, 10, 14, 12, 14, 14, 16, 15, 16, 15, 16, 15, 15, 17, 18, 17, 12, 18, 16, 17, 17, 19, 19, 18, 19, 18, 18, 19, 19, 19, 20, 19, 20, 20, 20, 20, 20, 20, 15, 20, 19, 20, 20, 20, 21, 21, 21, 20, 20, 20, 21, 18, 21, 21, 21, 21, 20, 21, 17, 21, 21, 21, 22, 22, 21, 22, 22, 21, 22, 21, 19, 22, 22, 19, 20, 22, 22, 21, 21, 21, 22, 22, 22, 18, 22, 22, 21, 22, 22, 23, 22, 20, 23, 22, 22, 23, 23, 21, 19, 21, 21, 21, 23, 23, 23, 22, 23, 23, 21, 23, 22, 23, 18, 22, 23, 20, 22, 23, 23, 23, 21, 22, 20, 22, 21, 22, 24, 24, 24, 24, 24, 22, 21, 24, 23, 23, 24, 21, 24, 23, 24, 22, 24, 24, 22, 24, 24, 22, 23, 24, 24, 24, 20, 23, 22, 23, 24, 24, 24, 24, 24, 24, 24, 23, 21, 23, 22, 23, 24, 24, 24, 22, 24, 24, 24, 23, 22, 24, 24, 25, 23, 25, 25, 23, 24, 25, 25, 24, 22, 25, 25, 25, 24, 23, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 23, 25, 23, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 24, 22, 25, 25, 23, 25, 25, 20, 24, 25, 24, 25, 25, 22, 24, 25, 24, 25, 24, 25, 25, 24, 25, 25, 25, 25, 22, 25, 25, 25, 24, 25, 24, 25, 18];\n\nexport default function boxBlurCanvasRGB(context, top_x, top_y, width, height, radius, iterations) {\n  if (Number.isNaN(radius) || radius < 1) return;\n\n  radius |= 0;\n\n  if (Number.isNaN(iterations)) iterations = 1;\n  iterations |= 0;\n  if (iterations > 3) iterations = 3;\n  if (iterations < 1) iterations = 1;\n\n  const imageData = context.getImageData(top_x, top_y, width, height);\n\n  const pixels = imageData.data;\n\n  let rsum;\n  let gsum;\n  let bsum;\n  let x;\n  let y;\n  let i;\n  let p;\n  let p1;\n  let p2;\n  let yp;\n  let yi;\n  let yw;\n  let wm = width - 1;\n  let hm = height - 1;\n  let rad1 = radius + 1;\n\n  let r = [];\n  let g = [];\n  let b = [];\n\n  let mul_sum = mul_table[radius];\n  let shg_sum = shg_table[radius];\n\n  let vmin = [];\n  let vmax = [];\n\n  while (iterations-- > 0) {\n    yw = yi = 0;\n\n    for (y = 0; y < height; y++) {\n      rsum = pixels[yw] * rad1;\n      gsum = pixels[yw + 1] * rad1;\n      bsum = pixels[yw + 2] * rad1;\n\n      for (i = 1; i <= radius; i++) {\n        p = yw + (((i > wm ? wm : i)) << 2);\n        rsum += pixels[p++];\n        gsum += pixels[p++];\n        bsum += pixels[p++];\n      }\n\n      for (x = 0; x < width; x++) {\n        r[yi] = rsum;\n        g[yi] = gsum;\n        b[yi] = bsum;\n\n        if (y == 0) {\n          vmin[x] = ((p = x + rad1) < wm ? p : wm) << 2;\n          vmax[x] = ((p = x - radius) > 0 ? p << 2 : 0);\n        }\n\n        p1 = yw + vmin[x];\n        p2 = yw + vmax[x];\n\n        rsum += pixels[p1++] - pixels[p2++];\n        gsum += pixels[p1++] - pixels[p2++];\n        bsum += pixels[p1++] - pixels[p2++];\n\n        yi++;\n      }\n      yw += (width << 2);\n    }\n\n    for (x = 0; x < width; x++) {\n      yp = x;\n      rsum = r[yp] * rad1;\n      gsum = g[yp] * rad1;\n      bsum = b[yp] * rad1;\n\n      for (i = 1; i <= radius; i++) {\n        yp += (i > hm ? 0 : width);\n        rsum += r[yp];\n        gsum += g[yp];\n        bsum += b[yp];\n      }\n\n      yi = x << 2;\n      for (y = 0; y < height; y++) {\n        pixels[yi] = (rsum * mul_sum) >>> shg_sum;\n        pixels[yi + 1] = (gsum * mul_sum) >>> shg_sum;\n        pixels[yi + 2] = (bsum * mul_sum) >>> shg_sum;\n\n        if (x == 0) {\n          vmin[y] = ((p = y + rad1) < hm ? p : hm) * width;\n          vmax[y] = ((p = y - radius) > 0 ? p * width : 0);\n        }\n\n        p1 = x + vmin[y];\n        p2 = x + vmax[y];\n\n        rsum += r[p1] - r[p2];\n        gsum += g[p1] - g[p2];\n        bsum += b[p1] - b[p2];\n\n        yi += width << 2;\n      }\n    }\n  }\n\n  context.putImageData(imageData, top_x, top_y);\n}\n","import { getDispatch, getGlobal } from '../lib/teact/teactn';\n\nimport { AudioOrigin, GlobalSearchContent } from '../types';\nimport { ApiMessage } from '../api/types';\n\nimport { IS_SAFARI } from './environment';\nimport safePlay from './safePlay';\nimport { patchSafariProgressiveAudio, isSafariPatchInProgress } from './patchSafariProgressiveAudio';\nimport { getMessageKey, MessageKey, parseMessageKey } from '../modules/helpers';\nimport { fastRaf } from './schedulers';\nimport { selectCurrentMessageList } from '../modules/selectors';\n\ntype Handler = (eventName: string, e: Event) => void;\nexport type TrackId = `${MessageKey}-${number}`;\n\nexport interface Track {\n  audio: HTMLAudioElement;\n  proxy: HTMLAudioElement;\n  type: 'voice' | 'audio';\n  handlers: Handler[];\n  onForcePlay?: NoneToVoidFunction;\n  onTrackChange?: NoneToVoidFunction;\n}\n\nconst tracks = new Map<TrackId, Track>();\nlet voiceQueue: TrackId[] = [];\nlet musicQueue: TrackId[] = [];\n\nlet currentTrackId: TrackId | undefined;\n\nfunction createAudio(\n  trackId: TrackId,\n  type: Track['type'],\n  onForcePlay?: NoneToVoidFunction,\n  onTrackChange?: NoneToVoidFunction,\n): Track {\n  const audio = new Audio();\n\n  function handleEvent(eventName: string) {\n    return (e: Event) => {\n      if (!tracks.has(trackId)) {\n        return;\n      }\n\n      if (isSafariPatchInProgress(audio)) {\n        return;\n      }\n\n      tracks.get(trackId)!.handlers.forEach((handler) => {\n        handler(eventName, e);\n      });\n    };\n  }\n\n  audio.addEventListener('timeupdate', handleEvent('onTimeUpdate'));\n  audio.addEventListener('play', handleEvent('onPlay'));\n  audio.addEventListener('pause', handleEvent('onPause'));\n  audio.addEventListener('loadstart', handleEvent('onLoadStart'));\n  audio.addEventListener('loadeddata', handleEvent('onLoadedData'));\n  audio.addEventListener('playing', handleEvent('onPlaying'));\n  audio.addEventListener('ended', () => {\n    if (!tracks.has(trackId)) {\n      return;\n    }\n\n    if (isSafariPatchInProgress(audio)) {\n      return;\n    }\n\n    playNext(trackId);\n  });\n\n  return {\n    audio,\n    type,\n    proxy: new Proxy(audio, {\n      get: (target, key: keyof HTMLAudioElement) => target[key],\n    }),\n    handlers: [],\n    onForcePlay,\n    onTrackChange,\n  };\n}\n\nfunction playNext(trackId: TrackId, isReverseOrder?: boolean) {\n  const currentTrack = currentTrackId && tracks.get(currentTrackId);\n  if (currentTrack) {\n    currentTrack.audio.pause();\n    currentTrack.audio.currentTime = 0;\n    if (currentTrack.onTrackChange) currentTrack.onTrackChange();\n  }\n\n  const origin = getGlobal().audioPlayer.origin || AudioOrigin.Inline;\n\n  const nextTrackId = findNextInQueue(trackId, origin, isReverseOrder);\n  if (!nextTrackId) {\n    return;\n  }\n\n  if (!tracks.has(nextTrackId)) {\n    // A bit hacky way to continue playlist when switching chat\n    getDispatch().openAudioPlayer(parseMessageKey(splitTrackId(nextTrackId).messageKey));\n\n    return;\n  }\n\n  const nextTrack = tracks.get(nextTrackId)!;\n\n  if (nextTrack.onForcePlay) {\n    nextTrack.onForcePlay();\n  }\n\n  currentTrackId = nextTrackId;\n\n  if (nextTrack.audio.src) {\n    safePlay(nextTrack.audio);\n  }\n}\n\nexport function stopCurrentAudio() {\n  const currentTrack = currentTrackId && tracks.get(currentTrackId);\n  if (currentTrack) {\n    currentTrack.audio.pause();\n  }\n}\n\nexport function register(\n  trackId: TrackId,\n  trackType: Track['type'],\n  handler: Handler,\n  onForcePlay?: NoneToVoidFunction,\n  onTrackChange?: NoneToVoidFunction,\n) {\n  if (!tracks.has(trackId)) {\n    const track = createAudio(trackId, trackType, onForcePlay, onTrackChange);\n    tracks.set(trackId, track);\n    addTrackToQueue(track, trackId);\n  }\n  const { audio, proxy, handlers } = tracks.get(trackId)!;\n\n  handlers.push(handler);\n\n  return {\n    play(src: string) {\n      if (!audio.paused) return;\n      const currentTrack = currentTrackId && tracks.get(currentTrackId);\n      if (currentTrack && currentTrackId !== trackId) {\n        currentTrack.audio.pause();\n        currentTrack.audio.currentTime = 0;\n        if (isSafariPatchInProgress(currentTrack.audio)) {\n          currentTrack.audio.dataset.preventPlayAfterPatch = 'true';\n        }\n        if (currentTrack.onTrackChange) currentTrack.onTrackChange();\n      }\n\n      currentTrackId = trackId;\n\n      if (!audio.src) {\n        audio.src = src;\n        audio.preload = 'auto';\n\n        if (src.includes('/progressive/') && IS_SAFARI) {\n          delete audio.dataset.preventPlayAfterPatch;\n          patchSafariProgressiveAudio(audio);\n        }\n      }\n\n      safePlay(audio);\n      cleanUpQueue(trackType, trackId);\n    },\n\n    pause() {\n      if (currentTrackId === trackId) {\n        audio.pause();\n      }\n    },\n\n    stop() {\n      if (currentTrackId === trackId) {\n        // Hack, reset src to remove default media session notification\n        const prevSrc = audio.src;\n        audio.pause();\n        // onPause not called otherwise, but required to sync UI\n        fastRaf(() => {\n          audio.src = '';\n          audio.src = prevSrc;\n        });\n      }\n    },\n\n    setCurrentTime(time: number) {\n      if (currentTrackId === trackId) {\n        if (audio.fastSeek) {\n          audio.fastSeek(time);\n        } else {\n          audio.currentTime = time;\n        }\n      }\n    },\n\n    setVolume(volume: number) {\n      if (currentTrackId === trackId) {\n        audio.volume = volume;\n        audio.muted = false;\n      }\n    },\n\n    setPlaybackRate(rate: number) {\n      if (currentTrackId === trackId) {\n        audio.playbackRate = rate;\n      }\n    },\n\n    toggleMuted(muted?: boolean) {\n      if (muted === undefined) {\n        audio.muted = !audio.muted;\n      } else {\n        audio.muted = muted;\n      }\n    },\n\n    proxy,\n\n    requestNextTrack() {\n      playNext(trackId);\n    },\n\n    isLast() {\n      return !findNextInQueue(trackId, getGlobal().audioPlayer.origin);\n    },\n\n    isFirst() {\n      return !findNextInQueue(trackId, getGlobal().audioPlayer.origin, true);\n    },\n\n    requestPreviousTrack() {\n      playNext(trackId, true);\n    },\n\n    destroy(shouldRemoveFromQueue = false) {\n      const track = tracks.get(trackId);\n      if (!track) {\n        return;\n      }\n\n      track.handlers = track.handlers.filter((h) => h !== handler);\n\n      if (!track.handlers.length) {\n        track.audio.pause();\n        tracks.delete(trackId);\n\n        if (shouldRemoveFromQueue) {\n          removeFromQueue(track, trackId);\n        }\n\n        if (trackId === currentTrackId) {\n          currentTrackId = undefined;\n        }\n      }\n    },\n  };\n}\n\nfunction getTrackQueue(track: Track) {\n  switch (track.type) {\n    case 'audio': return musicQueue;\n    case 'voice': return voiceQueue;\n    default: return undefined;\n  }\n}\n\nfunction addTrackToQueue(track: Track, trackId: TrackId) {\n  if (track.type === 'audio' && !musicQueue.includes(trackId)) {\n    musicQueue.push(trackId);\n    musicQueue.sort(trackIdComparator);\n  }\n\n  if (track.type === 'voice' && !voiceQueue.includes(trackId)) {\n    voiceQueue.push(trackId);\n    voiceQueue.sort(trackIdComparator);\n  }\n}\n\nfunction removeFromQueue(track: Track, trackId: TrackId) {\n  const trackIdFilter = (el: TrackId) => el !== trackId;\n  if (track.type === 'audio') {\n    musicQueue = musicQueue.filter(trackIdFilter);\n  }\n\n  if (track.type === 'voice') {\n    voiceQueue = voiceQueue.filter(trackIdFilter);\n  }\n}\n\nfunction cleanUpQueue(type: Track['type'], trackId: TrackId) {\n  if (getGlobal().globalSearch.currentContent === GlobalSearchContent.Music) return;\n  const { chatId } = parseMessageKey(splitTrackId(trackId).messageKey);\n  const openedChatId = selectCurrentMessageList(getGlobal())?.chatId;\n  const queueFilter = (id: string) => (\n    id.startsWith(`msg${chatId}`) || (openedChatId && id.startsWith(`msg${openedChatId}`))\n  );\n\n  if (type === 'audio') {\n    musicQueue = musicQueue.filter(queueFilter);\n  }\n\n  if (type === 'voice') {\n    voiceQueue = voiceQueue.filter(queueFilter);\n  }\n}\n\nfunction findNextInQueue(currentId: TrackId, origin = AudioOrigin.Inline, isReverseOrder?: boolean) {\n  const track = tracks.get(currentId)!;\n  const queue = getTrackQueue(track);\n  if (!queue) return undefined;\n\n  if (origin === AudioOrigin.Search) {\n    const index = queue.indexOf(currentId);\n    if (index < 0) return undefined;\n    const direction = isReverseOrder ? -1 : 1;\n    return queue[index + direction];\n  }\n\n  const { chatId } = parseMessageKey(splitTrackId(currentId).messageKey);\n  const chatAudio = queue.filter((id) => id.startsWith(`msg${chatId}`));\n  const index = chatAudio.indexOf(currentId);\n  if (index < 0) return undefined;\n  let direction = origin === AudioOrigin.Inline ? -1 : 1;\n  if (isReverseOrder) direction *= -1;\n  return chatAudio[index + direction];\n}\n\nexport function makeTrackId(message: ApiMessage): TrackId {\n  return `${getMessageKey(message)}-${message.date}`;\n}\n\nfunction splitTrackId(trackId: TrackId) {\n  const messageKey = trackId.match(/^msg(-?\\d+)-(\\d+)/)![0] as MessageKey;\n  const date = Number(trackId.split('-').pop());\n  return {\n    messageKey,\n    date,\n  };\n}\n\n// Descending order by date\nfunction trackIdComparator(one?: TrackId, two?: TrackId) {\n  if (!one || !two) return 0;\n  const { date: dateOne, messageKey: keyOne } = splitTrackId(one);\n  const { date: dateTwo, messageKey: keyTwo } = splitTrackId(two);\n  const diff = dateTwo - dateOne;\n  return diff === 0 ? keyTwo.localeCompare(keyOne) : diff;\n}\n","import { IS_IOS } from './environment';\n\nexport enum SwipeDirection {\n  Up,\n  Down,\n  Left,\n  Right,\n}\n\ninterface CaptureOptions {\n  onCapture?: (e: MouseEvent | TouchEvent) => void;\n  onRelease?: (e: MouseEvent | TouchEvent) => void;\n  onDrag?: (\n    e: MouseEvent | TouchEvent,\n    captureEvent: MouseEvent | TouchEvent,\n    params: {\n      dragOffsetX: number;\n      dragOffsetY: number;\n    },\n  ) => void;\n  onSwipe?: (e: Event, direction: SwipeDirection) => boolean;\n  onZoom?: (e: TouchEvent, params: {\n    // Relative zoom factor\n    zoomFactor: number;\n\n    // center coordinate of the initial pinch\n    initialCenterX: number;\n    initialCenterY: number;\n\n    // offset of the pinch center (current from initial)\n    dragOffsetX: number;\n    dragOffsetY: number;\n\n    // center coordinate of the current pinch\n    currentCenterX: number;\n    currentCenterY: number;\n  }) => void;\n  onClick?: (e: MouseEvent | TouchEvent) => void;\n  onDoubleClick?: (e: MouseEvent | RealTouchEvent, params: { centerX: number; centerY: number }) => void;\n  excludedClosestSelector?: string;\n  selectorToPreventScroll?: string;\n  maxZoom?: number;\n  minZoom?: number;\n  isNotPassive?: boolean;\n  withCursor?: boolean;\n}\n\n// https://stackoverflow.com/questions/11287877/how-can-i-get-e-offsetx-on-mobile-ipad\n// Android does not have this value, and iOS has it but as read-only\nexport interface RealTouchEvent extends TouchEvent {\n  pageX?: number;\n  pageY?: number;\n}\n\ntype TSwipeAxis =\n  'x'\n  | 'y'\n  | undefined;\n\nconst IOS_SCREEN_EDGE_THRESHOLD = 20;\nconst MOVED_THRESHOLD = 15;\nconst SWIPE_THRESHOLD = 50;\n\nfunction getDistance(a: Touch, b?: Touch) {\n  if (!b) return 0;\n  return Math.sqrt((b.pageX - a.pageX) ** 2 + (b.pageY - a.pageY) ** 2);\n}\n\nfunction getTouchCenter(a: Touch, b: Touch) {\n  return {\n    x: (a.pageX + b.pageX) / 2,\n    y: (a.pageY + b.pageY) / 2,\n  };\n}\n\nlet lastClickTime = 0;\n\nexport function captureEvents(element: HTMLElement, options: CaptureOptions) {\n  let captureEvent: MouseEvent | RealTouchEvent | undefined;\n  let hasMoved = false;\n  let hasSwiped = false;\n  let initialDistance = 0;\n  let initialTouchCenter = { x: window.innerWidth / 2, y: window.innerHeight / 2 };\n  let initialSwipeAxis: TSwipeAxis | undefined;\n\n  function onCapture(e: MouseEvent | RealTouchEvent) {\n    if (options.excludedClosestSelector && (\n      (e.target as HTMLElement).matches(options.excludedClosestSelector)\n      || (e.target as HTMLElement).closest(options.excludedClosestSelector)\n    )) {\n      return;\n    }\n\n    captureEvent = e;\n\n    if (e.type === 'mousedown') {\n      document.addEventListener('mousemove', onMove);\n      document.addEventListener('mouseup', onRelease);\n      if (options.onDoubleClick && Date.now() - lastClickTime < 300) {\n        options.onDoubleClick(e, {\n          centerX: e.pageX!,\n          centerY: e.pageY!,\n        });\n      }\n      lastClickTime = Date.now();\n    } else if (e.type === 'touchstart') {\n      // We need to always listen on `touchstart` target:\n      // https://stackoverflow.com/questions/33298828/touch-move-event-dont-fire-after-touch-start-target-is-removed\n      const target = e.target as HTMLElement;\n      target.addEventListener('touchmove', onMove, { passive: true });\n      target.addEventListener('touchend', onRelease);\n      target.addEventListener('touchcancel', onRelease);\n\n      if ('touches' in e) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (e.touches.length === 2) {\n          initialDistance = getDistance(e.touches[0], e.touches[1]);\n          initialTouchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n        }\n      }\n    }\n\n    document.body.classList.add('no-selection');\n    if (options.withCursor) {\n      document.body.classList.add('cursor-grabbing');\n    }\n\n    if (options.onCapture) {\n      options.onCapture(e);\n    }\n  }\n\n  function onRelease(e: MouseEvent | TouchEvent) {\n    if (captureEvent) {\n      if (options.withCursor) {\n        document.body.classList.remove('cursor-grabbing');\n      }\n      document.body.classList.remove('no-selection');\n\n      document.removeEventListener('mouseup', onRelease);\n      document.removeEventListener('mousemove', onMove);\n      (captureEvent.target as HTMLElement).removeEventListener('touchcancel', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchend', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchmove', onMove);\n\n      captureEvent = undefined;\n\n      if (IS_IOS && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll)).forEach((scrollable) => {\n          scrollable.style.overflow = '';\n        });\n      }\n\n      if (hasMoved) {\n        if (options.onRelease) {\n          options.onRelease(e);\n        }\n      } else if (options.onClick && (!('button' in e) || e.button === 0)) {\n        options.onClick(e);\n      }\n    }\n\n    hasMoved = false;\n    hasSwiped = false;\n    initialDistance = 0;\n    initialSwipeAxis = undefined;\n    initialTouchCenter = { x: window.innerWidth / 2, y: window.innerHeight / 2 };\n  }\n\n  function onMove(e: MouseEvent | RealTouchEvent) {\n    if (captureEvent) {\n      if (e.type === 'touchmove' && ('touches' in e)) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (options.onZoom && initialDistance > 0 && e.touches.length === 2) {\n          const endDistance = getDistance(e.touches[0], e.touches[1]);\n          const touchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n          const dragOffsetX = touchCenter.x - initialTouchCenter.x;\n          const dragOffsetY = touchCenter.y - initialTouchCenter.y;\n          const zoomFactor = endDistance / initialDistance;\n          options.onZoom(e, {\n            zoomFactor,\n            initialCenterX: initialTouchCenter.x,\n            initialCenterY: initialTouchCenter.y,\n            dragOffsetX,\n            dragOffsetY,\n            currentCenterX: touchCenter.x,\n            currentCenterY: touchCenter.y,\n          });\n          if (zoomFactor !== 1) hasMoved = true;\n        }\n      }\n\n      const dragOffsetX = e.pageX! - captureEvent.pageX!;\n      const dragOffsetY = e.pageY! - captureEvent.pageY!;\n\n      if (Math.abs(dragOffsetX) >= MOVED_THRESHOLD || Math.abs(dragOffsetY) >= MOVED_THRESHOLD) {\n        hasMoved = true;\n      }\n\n      let shouldPreventScroll = false;\n\n      if (options.onDrag) {\n        options.onDrag(e, captureEvent, { dragOffsetX, dragOffsetY });\n        shouldPreventScroll = true;\n      }\n\n      if (options.onSwipe && !hasSwiped) {\n        hasSwiped = onSwipe(e, dragOffsetX, dragOffsetY);\n        shouldPreventScroll = hasSwiped;\n      }\n\n      if (IS_IOS && shouldPreventScroll && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll)).forEach((scrollable) => {\n          scrollable.style.overflow = 'hidden';\n        });\n      }\n    }\n  }\n\n  function onSwipe(e: MouseEvent | RealTouchEvent, dragOffsetX: number, dragOffsetY: number) {\n    // Avoid conflicts with swipe-to-back gestures\n    if (IS_IOS) {\n      const x = (e as RealTouchEvent).touches[0].pageX;\n      if (x <= IOS_SCREEN_EDGE_THRESHOLD || x >= window.innerWidth - IOS_SCREEN_EDGE_THRESHOLD) {\n        return false;\n      }\n    }\n\n    const xAbs = Math.abs(dragOffsetX);\n    const yAbs = Math.abs(dragOffsetY);\n\n    if (dragOffsetX && dragOffsetY) {\n      const ratio = Math.max(xAbs, yAbs) / Math.min(xAbs, yAbs);\n      // Diagonal swipe\n      if (ratio < 2) {\n        return false;\n      }\n    }\n\n    let axis: TSwipeAxis | undefined;\n    if (xAbs >= SWIPE_THRESHOLD) {\n      axis = 'x';\n    } else if (yAbs >= SWIPE_THRESHOLD) {\n      axis = 'y';\n    }\n\n    if (!axis) {\n      return false;\n    }\n\n    if (!initialSwipeAxis) {\n      initialSwipeAxis = axis;\n    } else if (initialSwipeAxis !== axis) {\n      // Prevent horizontal swipe after vertical to prioritize scroll\n      return false;\n    }\n\n    return processSwipe(e, axis, dragOffsetX, dragOffsetY, options.onSwipe!);\n  }\n\n  element.addEventListener('mousedown', onCapture);\n  element.addEventListener('touchstart', onCapture, { passive: !options.isNotPassive });\n\n  return () => {\n    element.removeEventListener('mousedown', onCapture);\n    element.removeEventListener('touchstart', onCapture);\n  };\n}\n\nfunction processSwipe(\n  e: Event,\n  currentSwipeAxis: TSwipeAxis,\n  dragOffsetX: number,\n  dragOffsetY: number,\n  onSwipe: (e: Event, direction: SwipeDirection) => boolean,\n) {\n  if (currentSwipeAxis === 'x') {\n    if (dragOffsetX < 0) {\n      return onSwipe(e, SwipeDirection.Left);\n    } else {\n      return onSwipe(e, SwipeDirection.Right);\n    }\n  } else if (currentSwipeAxis === 'y') {\n    if (dragOffsetY < 0) {\n      return onSwipe(e, SwipeDirection.Up);\n    } else {\n      return onSwipe(e, SwipeDirection.Down);\n    }\n  }\n\n  return false;\n}\n","// Sometimes event is fired earlier than animation completes\nconst ANIMATION_END_DELAY = 50;\n\nexport function waitForTransitionEnd(node: Node, handler: NoneToVoidFunction, propertyName?: string) {\n  waitForEndEvent('transitionend', node, handler, propertyName);\n}\n\nexport function waitForAnimationEnd(node: Node, handler: NoneToVoidFunction, animationName?: string) {\n  waitForEndEvent('animationend', node, handler, animationName);\n}\n\nfunction waitForEndEvent(\n  eventType: 'transitionend' | 'animationend',\n  node: Node,\n  handler: NoneToVoidFunction,\n  detailedName?: string,\n) {\n  let isHandled = false;\n\n  node.addEventListener(eventType, function handleAnimationEnd(e: TransitionEvent | AnimationEvent) {\n    if (isHandled || e.target !== e.currentTarget) {\n      return;\n    }\n\n    if (detailedName && (\n      (e instanceof TransitionEvent && e.propertyName === detailedName)\n      || (e instanceof AnimationEvent && e.animationName === detailedName)\n    )) {\n      return;\n    }\n\n    isHandled = true;\n\n    node.removeEventListener(eventType, handleAnimationEnd as EventListener);\n\n    setTimeout(() => {\n      handler();\n    }, ANIMATION_END_DELAY);\n  } as EventListener);\n}\n","export default function cycleRestrict(length: number, index: number) {\n  return index - Math.floor(index / length) * length;\n}\n","import { getGlobal } from '../lib/teact/teactn';\n\nimport { FocusDirection } from '../types';\n\nimport {\n  ANIMATION_LEVEL_MIN,\n  FAST_SMOOTH_MAX_DISTANCE, FAST_SMOOTH_MAX_DURATION, FAST_SMOOTH_MIN_DURATION,\n  FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE,\n} from '../config';\nimport { IS_ANDROID } from './environment';\nimport { dispatchHeavyAnimationEvent } from '../hooks/useHeavyAnimationCheck';\nimport { animateSingle } from './animation';\nimport { fastRaf } from './schedulers';\n\nlet isAnimating = false;\n\nexport default function fastSmoothScroll(\n  container: HTMLElement,\n  element: HTMLElement,\n  position: ScrollLogicalPosition | 'centerOrTop',\n  margin = 0,\n  maxDistance = FAST_SMOOTH_MAX_DISTANCE,\n  forceDirection?: FocusDirection,\n  forceDuration?: number,\n  forceNormalContainerHeight?: boolean,\n) {\n  const scrollFrom = calculateScrollFrom(container, element, maxDistance, forceDirection);\n\n  if (forceDirection === FocusDirection.Static) {\n    scrollWithJs(container, element, scrollFrom, position, margin, 0);\n    return;\n  }\n\n  if (getGlobal().settings.byKey.animationLevel === ANIMATION_LEVEL_MIN) {\n    forceDuration = 0;\n  }\n\n  scrollWithJs(container, element, scrollFrom, position, margin, forceDuration, forceNormalContainerHeight);\n}\n\nexport function isAnimatingScroll() {\n  return isAnimating;\n}\n\nfunction calculateScrollFrom(\n  container: HTMLElement,\n  element: HTMLElement,\n  maxDistance = FAST_SMOOTH_MAX_DISTANCE,\n  forceDirection?: FocusDirection,\n) {\n  const { offsetTop: elementTop } = element;\n  const { scrollTop } = container;\n\n  if (forceDirection === undefined) {\n    const offset = elementTop - container.scrollTop;\n\n    if (offset < -maxDistance) {\n      return scrollTop + (offset + maxDistance);\n    } else if (offset > maxDistance) {\n      return scrollTop + (offset - maxDistance);\n    }\n  } else if (forceDirection === FocusDirection.Up) {\n    return elementTop + maxDistance;\n  } else if (forceDirection === FocusDirection.Down) {\n    return Math.max(0, elementTop - maxDistance);\n  }\n\n  return scrollTop;\n}\n\nfunction scrollWithJs(\n  container: HTMLElement,\n  element: HTMLElement,\n  scrollFrom: number,\n  position: ScrollLogicalPosition | 'centerOrTop',\n  margin = 0,\n  forceDuration?: number,\n  forceNormalContainerHeight?: boolean,\n) {\n  const { offsetTop: elementTop, offsetHeight: elementHeight } = element;\n  const { scrollTop: currentScrollTop, offsetHeight: containerHeight, scrollHeight } = container;\n  const targetContainerHeight = forceNormalContainerHeight && container.dataset.normalHeight\n    ? Number(container.dataset.normalHeight)\n    : containerHeight;\n\n  if (currentScrollTop !== scrollFrom) {\n    container.scrollTop = scrollFrom;\n  }\n\n  let path!: number;\n\n  switch (position) {\n    case 'start':\n      path = (elementTop - margin) - scrollFrom + (IS_ANDROID ? 1 : 0);\n      break;\n    case 'end':\n      path = (elementTop + elementHeight + margin) - (scrollFrom + targetContainerHeight);\n      break;\n    // 'nearest' is not supported yet\n    case 'nearest':\n    case 'center':\n    case 'centerOrTop':\n      path = elementHeight < targetContainerHeight\n        ? (elementTop + elementHeight / 2) - (scrollFrom + targetContainerHeight / 2)\n        : (elementTop - margin) - scrollFrom;\n      break;\n  }\n\n  if (path < 0) {\n    const remainingPath = -scrollFrom;\n    path = Math.max(path, remainingPath);\n  } else if (path > 0) {\n    const remainingPath = scrollHeight - (scrollFrom + targetContainerHeight);\n    path = Math.min(path, remainingPath);\n  }\n\n  if (path === 0) {\n    return;\n  }\n\n  const target = scrollFrom + path;\n\n  if (forceDuration === 0) {\n    container.scrollTop = target;\n    return;\n  }\n\n  isAnimating = true;\n\n  const absPath = Math.abs(path);\n  const transition = absPath < FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE ? shortTransition : longTransition;\n  const duration = forceDuration || (\n    FAST_SMOOTH_MIN_DURATION\n    + (absPath / FAST_SMOOTH_MAX_DISTANCE) * (FAST_SMOOTH_MAX_DURATION - FAST_SMOOTH_MIN_DURATION)\n  );\n  const startAt = Date.now();\n  const onHeavyAnimationStop = dispatchHeavyAnimationEvent();\n\n  fastRaf(() => {\n    animateSingle(() => {\n      const t = Math.min((Date.now() - startAt) / duration, 1);\n      const currentPath = path * (1 - transition(t));\n\n      container.scrollTop = Math.round(target - currentPath);\n\n      isAnimating = t < 1;\n\n      if (!isAnimating) {\n        onHeavyAnimationStop();\n      }\n\n      return isAnimating;\n    });\n  });\n}\n\nfunction longTransition(t: number) {\n  return 1 - ((1 - t) ** 5);\n}\n\nfunction shortTransition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n","import { getGlobal } from '../lib/teact/teactn';\n\nimport { ANIMATION_LEVEL_MIN } from '../config';\nimport { animate } from './animation';\nimport { fastRaf } from './schedulers';\n\nconst DEFAULT_DURATION = 300;\n\nexport default function fastSmoothScrollHorizontal(container: HTMLElement, left: number, duration = DEFAULT_DURATION) {\n  if (getGlobal().settings.byKey.animationLevel === ANIMATION_LEVEL_MIN) {\n    duration = 0;\n  }\n\n  scrollWithJs(container, left, duration);\n}\n\nfunction scrollWithJs(container: HTMLElement, left: number, duration: number) {\n  const isRtl = container.getAttribute('dir') === 'rtl';\n  const { scrollLeft, offsetWidth: containerWidth, scrollWidth } = container;\n  let path = left - scrollLeft;\n\n  if (path < 0) {\n    const remainingPath = -scrollLeft * (isRtl ? -1 : 1);\n    path = Math.max(path, remainingPath);\n  } else if (path > 0) {\n    const remainingPath = scrollWidth - (scrollLeft + containerWidth);\n    path = Math.min(path, remainingPath);\n  }\n\n  if (path === 0) {\n    return;\n  }\n\n  const target = scrollLeft + path;\n\n  if (duration === 0) {\n    container.scrollLeft = target;\n    return;\n  }\n\n  const startAt = Date.now();\n\n  fastRaf(() => {\n    animate(() => {\n      const t = Math.min((Date.now() - startAt) / duration, 1);\n\n      const currentPath = path * (1 - transition(t));\n      container.scrollLeft = Math.round(target - currentPath);\n\n      return t < 1;\n    });\n  });\n}\n\nfunction transition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n","import { IS_TOUCH_ENV } from './environment';\n\nexport default function focusEditableElement(element: HTMLElement, force?: boolean) {\n  if (!force && element === document.activeElement) {\n    return;\n  }\n\n  const selection = window.getSelection()!;\n  const range = document.createRange();\n  const lastChild = element.lastChild || element;\n\n  if (!IS_TOUCH_ENV && (!lastChild || !lastChild.nodeValue)) {\n    element.focus();\n    return;\n  }\n\n  range.selectNodeContents(lastChild);\n  // `false` means collapse to the end rather than the start\n  range.collapse(false);\n  selection.removeAllRanges();\n  selection.addRange(range);\n}\n","export default function getKeyFromEvent(e: KeyboardEvent) {\n  const key = 'key' in e ? e.key : e.code;\n\n  return key.startsWith('Key') ? key.slice(3).toLowerCase() : key;\n}\n","export type MediaSessionHandlers = {\n  play?: () => void;\n  pause?: () => void;\n  stop?: () => void;\n\n  previoustrack?: () => void;\n  nexttrack?: () => void;\n\n  togglemicrophone?: () => void;\n  togglecamera?: () => void;\n  hangup?: () => void;\n\n  seekbackward?: (details: MediaSessionActionDetails) => void;\n  seekforward?: (details: MediaSessionActionDetails) => void;\n  seekTo?: ((details: MediaSessionActionDetails) => void);\n};\n\ninterface MediaMetadataParameters {\n  title?: string;\n  artist?: string;\n  album?: string;\n  artwork?: MediaImage[];\n}\n\nconst DEFAULT_HANDLERS = {\n  play: undefined,\n  pause: undefined,\n  seekbackward: undefined,\n  seekforward: undefined,\n  previoustrack: undefined,\n  nexttrack: undefined,\n  stop: undefined,\n  seekTo: undefined,\n};\n\nexport function registerMediaSession(metadata?: MediaMetadata, handlers?: MediaSessionHandlers) {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    if (metadata) updateMetadata(metadata);\n    if (handlers) setMediaSessionHandlers(handlers);\n  } else {\n    // eslint-disable-next-line no-console\n    console.warn('MediaSession API not supported in this browser');\n  }\n}\n\nexport function updateMetadata(metadata?: MediaMetadata) {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    // eslint-disable-next-line no-null/no-null\n    mediaSession.metadata = metadata ?? null;\n  }\n}\n\nexport function setMediaSessionHandlers(handlers: MediaSessionHandlers) {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    Object.entries({ ...DEFAULT_HANDLERS, ...handlers }).forEach(([key, handler]) => {\n      try {\n        // @ts-ignore API not standardized yet\n        mediaSession.setActionHandler(key, handler);\n      } catch (err) {\n        // Handler not supported, ignoring\n      }\n    });\n  }\n}\n\nexport function clearMediaSession() {\n  const { mediaSession } = window.navigator;\n  if (mediaSession) {\n    // eslint-disable-next-line no-null/no-null\n    mediaSession.metadata = null;\n    setMediaSessionHandlers(DEFAULT_HANDLERS);\n    if (mediaSession.playbackState) mediaSession.playbackState = 'none';\n    mediaSession.setPositionState?.();\n  }\n}\n\nexport function setPlaybackState(state: 'none' | 'paused' | 'playing' = 'none') {\n  const { mediaSession } = window.navigator;\n  if (mediaSession && mediaSession.playbackState) {\n    mediaSession.playbackState = state;\n  }\n}\n\nexport function setPositionState(state?: MediaPositionState) {\n  if (!state || state.position === undefined || state.duration === undefined) return;\n  state.position = Math.min(state.position, state.duration);\n\n  const { mediaSession } = window.navigator;\n  mediaSession?.setPositionState?.(state);\n}\n\nexport function setMicrophoneActive(active: boolean) {\n  const { mediaSession } = window.navigator;\n  // @ts-ignore typings not updated yet\n  mediaSession?.setMicrophoneActive?.(active);\n}\n\nexport function setCameraActive(active: boolean) {\n  const { mediaSession } = window.navigator;\n  // @ts-ignore typings not updated yet\n  mediaSession?.setCameraActive?.(active);\n}\n\nexport function buildMediaMetadata({\n  title, artist, album, artwork,\n}: MediaMetadataParameters) {\n  if ('MediaMetadata' in window) {\n    return new window.MediaMetadata({\n      title,\n      artist,\n      album,\n      artwork,\n    });\n  }\n  return undefined;\n}\n","import { ApiMessageEntity, ApiMessageEntityTypes, ApiFormattedText } from '../api/types';\nimport { IS_EMOJI_SUPPORTED } from './environment';\n\nconst ENTITY_CLASS_BY_NODE_NAME: Record<string, string> = {\n  B: ApiMessageEntityTypes.Bold,\n  STRONG: ApiMessageEntityTypes.Bold,\n  I: ApiMessageEntityTypes.Italic,\n  EM: ApiMessageEntityTypes.Italic,\n  U: ApiMessageEntityTypes.Underline,\n  S: ApiMessageEntityTypes.Strike,\n  STRIKE: ApiMessageEntityTypes.Strike,\n  DEL: ApiMessageEntityTypes.Strike,\n  CODE: ApiMessageEntityTypes.Code,\n  PRE: ApiMessageEntityTypes.Pre,\n  BLOCKQUOTE: ApiMessageEntityTypes.Blockquote,\n};\n\nconst MAX_TAG_DEEPNESS = 3;\n\nexport default function parseMessageInput(html: string): ApiFormattedText {\n  const fragment = document.createElement('div');\n  fragment.innerHTML = parseMarkdown(html);\n  const text = fragment.innerText.trim().replace(/\\u200b+/g, '');\n  let textIndex = 0;\n  let recursionDeepness = 0;\n  const entities: ApiMessageEntity[] = [];\n\n  function addEntity(node: ChildNode) {\n    const { index, entity } = getEntityDataFromNode(node, text, textIndex);\n\n    if (entity) {\n      textIndex = index;\n      entities.push(entity);\n    } else if (node.textContent) {\n      textIndex += node.textContent.length;\n    }\n\n    if (node.hasChildNodes() && recursionDeepness <= MAX_TAG_DEEPNESS) {\n      recursionDeepness += 1;\n      Array.from(node.childNodes).forEach(addEntity);\n    }\n  }\n\n  Array.from(fragment.childNodes).forEach((node) => {\n    recursionDeepness = 1;\n    addEntity(node);\n  });\n\n  return {\n    text,\n    entities: entities.length ? entities : undefined,\n  };\n}\n\nfunction parseMarkdown(html: string) {\n  let parsedHtml = html.slice(0);\n\n  if (!IS_EMOJI_SUPPORTED) {\n    // Emojis\n    parsedHtml = parsedHtml.replace(/<img[^>]+alt=\"([^\"]+)\"[^>]*>/gm, '$1');\n  }\n\n  // Strip redundant <span> tags\n  parsedHtml = parsedHtml.replace(/<\\/?span([^>]*)?>/g, '');\n\n  // Strip redundant nbsp's\n  parsedHtml = parsedHtml.replace(/&nbsp;/g, ' ');\n\n  // Replace <div><br></div> with newline (new line in Safari)\n  parsedHtml = parsedHtml.replace(/<div><br([^>]*)?><\\/div>/g, '\\n');\n  // Replace <br> with newline\n  parsedHtml = parsedHtml.replace(/<br([^>]*)?>/g, '\\n');\n\n  // Strip redundant <div> tags\n  parsedHtml = parsedHtml.replace(/<\\/div>(\\s*)<div>/g, '\\n');\n  parsedHtml = parsedHtml.replace(/<div>/g, '\\n');\n  parsedHtml = parsedHtml.replace(/<\\/div>/g, '');\n\n  // Pre\n  parsedHtml = parsedHtml.replace(/^`{3}(.*[\\n\\r][^]*?^)`{3}/gm, '<pre>$1</pre>');\n  parsedHtml = parsedHtml.replace(/[`]{3}([^`]+)[`]{3}/g, '<pre>$1</pre>');\n\n  // Code\n  parsedHtml = parsedHtml.replace(/[`]{1}([^`\\n]+)[`]{1}/g, '<code>$1</code>');\n\n  // Other simple markdown\n  parsedHtml = parsedHtml.replace(\n    /(^|\\s)(?!<code[^<]*|<\\/)[*]{2}([^*\\n]+)[*]{2}(?![^<]*<\\/code>)(\\s|$)/g,\n    '$1<b>$2</b>$3',\n  );\n  parsedHtml = parsedHtml.replace(\n    /(^|\\s)(?!<code[^<]*|<\\/)[_]{2}([^_\\n]+)[_]{2}(?![^<]*<\\/code>)(\\s|$)/g,\n    '$1<i>$2</i>$3',\n  );\n  parsedHtml = parsedHtml.replace(\n    /(^|\\s)(?!<code[^<]*|<\\/)[~]{2}([^~\\n]+)[~]{2}(?![^<]*<\\/code>)(\\s|$)/g,\n    '$1<s>$2</s>$3',\n  );\n\n  return parsedHtml;\n}\n\nfunction getEntityDataFromNode(\n  node: ChildNode,\n  rawText: string,\n  textIndex: number,\n): { index: number; entity?: ApiMessageEntity } {\n  const type = getEntityTypeFromNode(node);\n  if (!type || !node.textContent) {\n    return {\n      index: textIndex,\n      entity: undefined,\n    };\n  }\n\n  const rawIndex = rawText.indexOf(node.textContent, textIndex);\n  // In some cases, last text entity ends with a newline (which gets trimmed from `rawText`).\n  // In this case, `rawIndex` would return `-1`, so we use `textIndex` instead.\n  const index = rawIndex >= 0 ? rawIndex : textIndex;\n  const offset = rawText.substring(0, index).length;\n  const { length } = rawText.substring(index, index + node.textContent.length);\n\n  let url: string | undefined;\n  let userId: string | undefined;\n  if (type === ApiMessageEntityTypes.TextUrl) {\n    url = (node as HTMLAnchorElement).href;\n  }\n  if (type === ApiMessageEntityTypes.MentionName) {\n    userId = (node as HTMLAnchorElement).dataset.userId;\n  }\n\n  return {\n    index,\n    entity: {\n      type,\n      offset,\n      length,\n      ...(url && { url }),\n      ...(userId && { userId }),\n    },\n  };\n}\n\nfunction getEntityTypeFromNode(node: ChildNode) {\n  if (ENTITY_CLASS_BY_NODE_NAME[node.nodeName]) {\n    return ENTITY_CLASS_BY_NODE_NAME[node.nodeName];\n  }\n\n  if (node.nodeName === 'A') {\n    const anchor = node as HTMLAnchorElement;\n    if (anchor.dataset.entityType === ApiMessageEntityTypes.MentionName) {\n      return ApiMessageEntityTypes.MentionName;\n    }\n    if (anchor.dataset.entityType === ApiMessageEntityTypes.Url) {\n      return ApiMessageEntityTypes.Url;\n    }\n    if (anchor.href.startsWith('mailto:')) {\n      return ApiMessageEntityTypes.Email;\n    }\n    if (anchor.href.startsWith('tel:')) {\n      return ApiMessageEntityTypes.Phone;\n    }\n    if (anchor.href !== anchor.textContent) {\n      return ApiMessageEntityTypes.TextUrl;\n    }\n\n    return ApiMessageEntityTypes.Url;\n  }\n\n  if (node.nodeName === 'SPAN') {\n    return (node as HTMLElement).dataset.entityType;\n  }\n\n  return undefined;\n}\n","/*\n * Thanks to Ace Monkey for this mind-blowing patch.\n */\n\nexport function patchSafariProgressiveAudio(audioEl: HTMLAudioElement) {\n  if (audioEl.dataset.patchedForSafari) {\n    return;\n  }\n\n  audioEl.addEventListener('play', () => {\n    const t = audioEl.currentTime;\n\n    audioEl.dataset.patchForSafariInProgress = 'true';\n    function onProgress() {\n      if (!audioEl.buffered.length) {\n        return;\n      }\n      audioEl.currentTime = audioEl.duration - 1;\n      audioEl.addEventListener('progress', () => {\n        delete audioEl.dataset.patchForSafariInProgress;\n        audioEl.currentTime = t;\n        if (audioEl.paused && !audioEl.dataset.preventPlayAfterPatch) {\n          audioEl.play();\n        }\n      }, { once: true });\n\n      audioEl.removeEventListener('progress', onProgress);\n    }\n\n    audioEl.addEventListener('progress', onProgress);\n  }, { once: true });\n\n  audioEl.dataset.patchedForSafari = 'true';\n}\n\nexport function isSafariPatchInProgress(audioEl: HTMLAudioElement) {\n  return Boolean(audioEl.dataset.patchForSafariInProgress);\n}\n","import React from '../lib/teact/teact';\n\nexport default (e: React.UIEvent | Event) => {\n  e.stopPropagation();\n  e.preventDefault();\n};\n"],"names":["memo","sticker","effect","isOwn","soundId","size","observeIntersection","lastSyncTime","forceLoadPreview","messageId","chatId","activeEmojiInteraction","markAnimationLoaded","isAnimationLoaded","ref","width","style","handleClick","playKey","useAnimatedEmoji","undefined","emoji","localMediaHash","id","isIntersecting","useIsIntersecting","thumbDataUri","thumbnail","dataUri","previewBlobUrl","useMedia","ApiMediaFormat","transitionClassNames","useMediaTransition","mediaData","isMediaLoaded","Boolean","className","buildClassName","LIKE_STICKER_ID","onClick","src","alt","key","animationData","quality","play","forceOnHeavyAnimation","noLoop","onLoad","MIN_SPIKES","IS_SINGLE_COLUMN_LAYOUT","MAX_SPIKES","renderSeekline","playProgress","bufferedProgress","seekerRef","theme","message","senderTitle","uploadProgress","origin","date","isSelectable","isSelected","isDownloading","onPlay","onReadMedia","onCancelUpload","onDateClick","content","audio","voice","video","isMediaUnread","isVoice","isSeeking","useRef","playStateBeforeSeeking","lang","useLang","isRtl","dispatch","getDispatch","isActivated","setIsActivated","useState","shouldLoad","coverHash","getMessageMediaHash","coverBlobUrl","getMessageMediaFormat","loadProgress","downloadProgress","useMediaWithLoadProgress","handleForcePlay","useCallback","handleTrackChange","isBuffered","bufferingHandlers","checkBuffering","useBuffering","isPlaying","playPause","pause","setCurrentTime","duration","useAudioPlayer","makeTrackId","getMediaDuration","isMessageLocal","isOwnMessage","waveformCanvasRef","canvasRef","data","spikes","peak","useMemo","waveform","Array","Math","min","fill","durationFactor","spikesCount","round","fitCount","newData","springFactor","length","leftFiller","rightFiller","i","idx","floor","val","interpolateArray","encoded5bit","bitsCount","valuesCount","result","bitsData","l","byteIndex","bitShift","value","lastByteIndex","lastBitShift","lastValue","decodeWaveform","Uint8Array","useLayoutEffect","canvas","current","progress","fillStyle","progressFillStyle","height","ctx","getContext","scale","forEach","item","globalAlpha","spikeHeight","max","x","y","radius","beginPath","moveTo","arcTo","closePath","roundedRectangle","renderWaveform","useWaveformCanvas","withSeekline","useEffect","isLoadingForPlaying","isUploading","isTransferring","transferProgress","getMediaTransferState","shouldRender","shouldRenderSpinner","spinnerClassNames","useShowTransition","shouldRenderCross","handleButtonClick","setAudioPlayerOrigin","handleDownloadClick","cancelMessageMediaDownload","downloadMessageMedia","handleSeek","e","left","getBoundingClientRect","clientX","MouseEvent","targetTouches","stopPropagation","handleStartSeek","button","handleStopSeek","handleDateClick","renderFirstLine","title","fileName","captureEvents","onCapture","onRelease","onDrag","fullClassName","AudioOrigin","buttonClassNames","push","contentClassName","renderWithTitle","dir","renderText","Link","formatPastTimeShort","formatMediaDuration","performer","renderSecondLine","Button","ripple","color","join","ariaLabel","backgroundImage","ProgressSpinner","transparent","noCross","showProgress","showSeekline","getTranslation","getFileSizeString","formatMediaDateTime","renderAudio","draggable","renderVoice","props","isOpen","CalendarModal","useModuleLoader","Bundles","withGlobal","global","chatOrUserId","countryList","phoneCodes","phoneCodeList","chat","selectChat","user","isUserId","selectUser","isMuted","selectIsChatMuted","selectNotifySettings","selectNotifyExceptions","canInviteUsers","isChatChannel","isUserRightBanned","getHasAdminRight","forceShowSelf","loadFullUser","showNotification","updateChatMutedState","userId","fullInfo","username","phoneNumber","isSelf","handleNotificationChange","isRestricted","copy","text","entity","copyTextToClipboard","formattedNumber","formatPhoneNumberWithCode","link","getChatLink","description","bio","getChatDescription","icon","multiline","narrow","isStatic","label","checked","inactive","isPrivateChat","isChatWithSelf","selectIsChatWithSelf","getPrivateChatUserId","isBot","isUserBot","isSupport","canDeleteForAll","contactName","getUserFirstOrLastName","isChannel","isBasicGroup","isChatBasicGroup","isSuperGroup","isChatSuperGroup","currentUserId","onClose","onCloseAnimationEnd","leaveChannel","deleteHistory","deleteChannel","deleteChatUser","blockContact","chatTitle","getChatTitle","handleDeleteMessageForAll","shouldDeleteForAll","handleDeleteAndStop","contactId","accessHash","handleDeleteChat","isCreator","header","isSavedMessages","isText","smaller","canAutoLoad","autoLoadFileMaxSizeMb","withDate","datetime","sender","onMediaClick","document","timestamp","extension","getDocumentExtension","wasIntersected","markIntersected","useFlag","isLoadAllowed","setIsLoadAllowed","shouldDownload","documentHash","isLoaded","hasPreview","getDocumentHasPreview","getMessageMediaThumbDataUri","localBlobUrl","previewData","withMediaViewer","mediaType","name","thumbnailDataUri","actionIcon","isMessageDocumentVideo","elementRef","shouldSpinnerRender","getColorFromExtension","sizeString","getDocumentThumbnailDimensions","onlineCount","selectChatOnlineCount","areMessagesLoaded","selectChatMessages","typingStatus","avatarSize","withUsername","withFullInfo","withUpdatingStatus","withChatType","noRtl","loadFullChat","openMediaViewer","isMin","handleAvatarViewerOpen","hasPhoto","avatarOwnerId","MediaViewerOrigin","isVerified","getChatTypeString","handle","groupStatus","chatTypeString","membersCount","getGroupStatus","onlineStatus","renderStatusOrTyping","outgoingStatus","status","idPrefix","isProtected","mediaBlobUrl","getMessageVideo","onContextMenu","stopEvent","isGif","Keys","activeKey","itemIds","selectedIds","filterValue","filterPlaceholder","notFoundText","searchInputId","isLoading","noScrollRestore","onSelectedIdsChange","onFilterChange","onLoadMore","inputRef","shouldMinimize","setTimeout","requestAnimationFrame","focus","handleItemClick","newSelectedIds","includes","splice","indexOf","handleFilterChange","currentTarget","viewportIds","getMore","useInfiniteScroll","map","isMinimized","canClose","clickArg","onChange","placeholder","items","iconElement","titleText","serverTimeOffset","userStatus","selectUserStatus","noStatusOrTyping","fullName","getUserFullName","isUserOnline","getUserStatus","photo","isFirstPhoto","isDeleted","isDeletedUser","isRepliesChat","isChatWithRepliesBot","getMediaHash","forceAvatar","hash","getChatAvatarHash","photoBlobUrl","avatarMediaHash","avatarBlobUrl","useBlurSync","imageSrc","prevImageSrc","usePrevious","decoding","userFullName","getFirstLetters","Spinner","getUserColorKey","connectionState","animationLevel","settings","byKey","photos","slideAnimation","currentPhotoIndex","setCurrentPhotoIndex","isFirst","isLast","profile","currentIndex","slice","mediaLoader","usePhotosPreload","handleProfilePhotoClick","profilePhotoIndex","selectPreviousMedia","selectNextMedia","element","querySelector","selectorToPreventScroll","onSwipe","IS_TOUCH_ENV","direction","SwipeDirection","renderPhoto","isVerifiedIconShown","_","renderPhotoTabs","Transition","type","VerifiedIcon","reaction","staticIconId","getGlobal","availableReactions","find","staticIcon","noAnimate","onUnfaveClick","stickerSelector","shouldPlay","lottieData","isAnimated","markLoaded","unmarkLoaded","canAnimatedPlay","previewTransitionClassNames","onMouseDown","preventMessageInputBlurWithBubbling","isLowPriority","preventDefault","StickerSetModal","typingUser","typingUserName","action","replace","trim","onMessageClick","linkData","getMessageWebPage","getFirstLinkInMessage","url","domain","messageText","getMessageSummaryText","siteName","handleMessageClick","displayUrl","truncatedDescription","trimText","MEDIA_VIEWER_MEDIA_QUERY","REM","parseInt","getComputedStyle","documentElement","fontSize","ROUND_VIDEO_DIMENSIONS_PX","AVATAR_FULL_DIMENSIONS","DEFAULT_MEDIA_DIMENSIONS","cachedMaxWidthOwn","cachedMaxWidth","cachedMaxWidthNoAvatar","getAvailableWidth","fromOwnMessage","isForwarded","isWebPagePhoto","noAvatars","extraPaddingRem","regularMaxWidth","windowWidth","windowSize","getMaxMessageWidthRem","calculateDimensionsForMessageMedia","aspectRatio","availableWidth","availableHeight","getAvailableHeight","mediaWidth","calculateDimensions","getMediaViewerAvailableDimensions","withFooter","isVideo","mql","window","matchMedia","windowHeight","occupiedHeightRem","matches","calculateInlineImageDimensions","getPhotoInlineDimensions","calculateVideoDimensions","getVideoDimensions","getPictogramDimensions","getStickerDimensions","baseWidth","STICKER_SIZE_INLINE_MOBILE_FACTOR","STICKER_SIZE_INLINE_DESKTOP_FACTOR","calculatedHeight","calculateMediaViewerDimensions","mediaHeight","calculatedWidth","renderMessageText","highlight","shouldRenderHqEmoji","formattedText","rawText","getMessageText","entities","renderTextWithEntities","organizeEntity","index","organizedEntityIndexes","offset","organizedIndexes","Set","has","nestedEntities","filter","parsedEntity","isChanged","organizedIndex","add","organizeEntities","organizedEntities","organizedEntity","shouldRenderAsHtml","renderMessagePart","deleteLineBreakAfterPre","renderEntity","textPartStart","textPartEnd","isLastEntity","renderResult","textBefore","substring","textBeforeLength","substr","entityStartIndex","entityEndIndex","entityContent","nestedEntityContent","ApiMessageEntityTypes","nestedIndex","nestedEntity","nestedEntityIndex","nestedResult","nestedEntityEndIndex","newEntity","rawEntityText","renderedContent","getLinkUrl","processEntityAsHtml","entityText","handleBotCommandClick","handleHashtagClick","href","target","rel","processEntity","isArray","textAfter","arrayIndex","c","emojiFilter","sendBotCommand","command","innerText","setLocalTextSearchQuery","query","searchTextMessagesLocal","WIDTH","large","medium","small","localEffect","interactWithAnimatedEmoji","sendEmojiInteraction","sendWatchingEmojiInteraction","hasEffect","audioRef","soundMediaData","setPlayKey","String","random","interactions","startedInteractions","sendInteractionBunch","remove","Audio","safePlay","addEventListener","once","container","startSize","isReversed","performance","now","selectedMessageId","endX","endY","emoticon","selectLocalAnimatedEmojiEffectByName","ChatFolderModal","ChatAnimationTypes","isPinned","isShown","unreadCount","hasUnreadMark","renderContent","unreadMentionsCount","formatIntegerCompact","ShowTransition","isCustom","isActive","lastMessage","senderId","replyToMessageId","isOutgoing","lastMessageSender","lastMessageAction","getMessageAction","actionTargetMessage","selectChatMessage","targetUserIds","actionTargetUserIds","targetChatId","actionTargetChatId","privateChatUserId","currentChatId","threadId","currentThreadId","messageListType","selectCurrentMessageList","MAIN_THREAD_ID","draft","selectDraft","canScrollDown","canChangeFolder","chatFolders","orderedIds","lastMessageOutgoingStatus","selectOutgoingStatus","folderId","orderDiff","animationType","openChat","focusLastMessage","isDeleteModalOpen","openDeleteModal","closeDeleteModal","isChatFolderModalOpen","openChatFolderModal","closeChatFolderModal","shouldRenderDeleteModal","markRenderDeleteModal","unmarkRenderDeleteModal","shouldRenderChatFolderModal","markRenderChatFolderModal","unmarkRenderChatFolderModal","isAction","isActionMessage","useEnsureMessage","mediaThumbnail","getMessageSticker","isRoundVideo","getMessageRoundVideo","actionTargetUsers","usersById","users","byId","Opacity","opacity","fastRaf","classList","Move","transform","ANIMATION_END_DELAY","shouldReplaceHistory","contextActions","useChatContextActions","handleDelete","handleChatFolderChange","ListItem","Avatar","isCallActive","isCallNotEmpty","LastMessageMeta","TypingStatus","actionOrigin","renderActionMessageText","asPlain","senderName","getMessageSenderName","blobUrl","renderMessageSummary","renderLastMessageOrTyping","DeleteChatModal","folderType","chatFolder","selectChatFolder","animatedEmoji","selectAnimatedEmoji","foldersDispatch","onScreenSelect","handleEditFolder","payload","SettingsScreens","AnimatedEmoji","fluid","pill","FolderTypeToListType","chats","listIds","chatsById","orderedPinnedIds","listType","allListIds","notifySettings","notifyExceptions","loadMoreChats","preloadTopChatMessages","preloadArchivedChats","openNextChat","currentListIds","currentPinnedIds","prepareFolderListIds","orderById","chatArrays","newChatArrays","prepareChatList","singleList","concat","pinnedChats","otherChats","newOrderedIds","reduce","acc","prevOrderById","orderDiffById","mapValues","order","loadMoreOfType","CHAT_LIST_SLICE","ALL_CHATS_PRELOAD_DISABLED","viewportChatArrays","reduceChatList","handleKeyDown","removeEventListener","IS_PWA","IS_MAC_OS","metaKey","ctrlKey","code","startsWith","digit","match","position","Number","altKey","targetIndexDelta","getAnimationType","orderDiffs","Object","values","numberOfUp","diff","numberOfDown","None","Infinity","useChatAnimationType","InfiniteScroll","preloadBackwards","noFastList","viewportOffset","pinnedOffset","IS_ANDROID","CHAT_HEIGHT_PX","teactFastList","teactOrderKey","getChatOrder","renderChats","Loading","getSenderName","getSenderTitle","isChatGroup","isQuick","onFileSelect","isHovered","markHovered","unmarkHovered","onDrop","onDragEnter","onDragLeave","relatedTarget","toTarget","DropAreaState","withQuick","onHide","hideTimeoutRef","prevWithQuick","captureEscKeyListener","handleFilesDrop","dataTransfer","dt","files","from","handleQuickFilesDrop","handleDragLeave","fromTarget","Portal","containerId","onDragOver","clearTimeout","EmojiTooltip","MAX_INPUT_HEIGHT","messageSendKeyCombo","replyingToId","selectReplyingToId","noTabCapture","isPollModalOpen","payment","isPaymentModalOpen","isAttachmentModalInput","editableInputId","html","forcedPlaceholder","canAutoFocus","shouldSuppressFocus","shouldSuppressTextFormatter","onUpdate","onSuppressedFocus","onSend","editLastMessage","replyToNextMessage","cloneRef","isContextMenuOpenRef","isTextFormatterOpen","openTextFormatter","closeTextFormatter","textFormatterAnchorPosition","setTextFormatterAnchorPosition","selectedRange","setSelectedRange","sendMessageAction","useSendMessageAction","updateInputHeight","useLayoutEffectWithPrevDeps","prevHtml","innerHTML","focusInput","isHeavyAnimating","focusEditableElement","handleCloseTextFormatter","selection","getSelection","removeAllRanges","empty","clearSelection","checkSelection","IS_IOS","rangeCount","selectionRange","getRangeAt","selectedText","toString","isSelectionInsideInput","EDITABLE_INPUT_ID","parseEmojiOnlyString","START_TO_END","processSelection","selectionRect","inputRect","top","willSend","input","clone","currentHeight","newHeight","scrollHeight","transitionDuration","log","abs","exec","toggle","captureFirstTab","debounce","captureKeyboardListeners","onTab","suppressFocus","blur","contentEditable","textContent","IS_EMOJI_SUPPORTED","onKeyDown","shiftKey","handleKeyUp","event","closeContextMenuMouseListener","closeContextMenuKeyListener","handleMouseUp","onTouchCancel","anchorPosition","TEXT_FORMAT_BY_TAG_NAME","B","STRONG","I","EM","U","DEL","CODE","fragmentEl","createElement","containerRef","linkUrlInputRef","isLinkControlOpen","openLinkControl","closeLinkControl","linkUrl","setLinkUrl","isEditingLink","setIsEditingLink","inputClassName","setInputClassName","selectedTextFormats","setSelectedTextFormats","useVirtualBackdrop","selectedFormats","parentElement","commonAncestorContainer","textFormat","tagName","updateSelectedRange","getSelectedText","getSelectedElement","updateInputStyles","offsetWidth","scrollWidth","scrollLeft","getFormatButtonClassName","keys","some","fKey","monospace","strikethrough","handleBoldText","execCommand","bold","handleItalicText","italic","handleUnderlineText","underline","handleStrikethroughText","replaceWith","handleMonospaceText","handleLinkUrlConfirm","formattedLinkUrl","encodeURI","ensureProtocol","addRange","restoreSelection","handler","k","b","u","m","s","getKeyFromEvent","linkUrlConfirmClassName","autoComplete","inputMode","onScroll","RE_BR","RE_SPACE","RE_CLEAN_HTML","RE_EXTRA_NEW_LINE","prepareForRegExp","inputId","parentNode","iterations","cache","WeakMap","memoized","fn","args","cached","get","areSortedArraysEqual","lastArgs","lastResult","set","emojiDataPromise","emojiRawData","emojiData","RE_EMOJI_SEARCH","prepareRecentEmojisMemo","recentEmojiIds","limit","pickTruthy","MEMO_EMPTY_ARRAY","prepareLibraryMemo","baseEmojiKeywords","emojiKeywords","emojis","byNative","buildCollectionByKey","baseEmojisByKeyword","natives","emojisByKeyword","byKeyword","keywords","byName","names","searchInLibraryMemo","library","matched","matchedKeywords","keyword","sort","flatten","matchedNames","unique","RegExp","useEmojiTooltip","isAllowed","htmlRef","onUpdateHtml","isDisabled","markIsOpen","unmarkIsOpen","setById","shouldForceInsertEmoji","setShouldForceInsertEmoji","filteredEmojis","setFilteredEmojis","async","default","uncompressEmoji","ensureEmojiData","then","getEmojiCode","forceSend","endsWith","insertEmoji","textEmoji","isForce","currentHtml","atIndex","lastIndexOf","messageInput","getElementById","native","isEmojiTooltipOpen","closeEmojiTooltip","runThrottled","throttle","cb","RE_USERNAME_SEARCH","useMentionTooltip","canSuggestMembers","groupChatMembers","topInlineBotIds","usersToMention","setUsersToMention","updateFilteredUsers","withInlineBots","memberIds","member","filteredIds","filterUsersByName","usernameFilter","getUsernameFilter","canSuggestInlineBots","insertMention","forceFocus","insertedHtml","isMentionTooltipOpen","closeMentionTooltip","mentionFilteredUsers","useAsyncRendering","dependencies","delay","shouldRenderRef","timeoutRef","forceUpdate","useForceUpdate","useOnChange","options","selected","disabled","loadingOptions","setValues","handleChange","newValues","v","option","subLabel","children","buttonClassName","tabIndex","buttonRef","secondaryIcon","destructive","onSecondaryIconClick","isTouched","markIsTouched","unmarkIsTouched","isContextMenuOpen","contextMenuPosition","handleBeforeContextMenu","handleContextMenu","handleContextMenuClose","handleContextMenuHide","useContextMenuHandlers","getTriggerElement","getRootElement","closest","getMenuElement","positionX","positionY","menuStyle","useContextMenuPosition","handleMouseDown","role","autoClose","onDismiss","setIsOpen","timerRef","closeAndDismiss","handleMouseEnter","handleMouseLeave","onMouseEnter","onMouseLeave","RADIUSES","xl","square","circleRadius","STROKE_WIDTH","borderRadius","circumference","PI","svg","firstElementChild","strokeDashOffset","setAttribute","hidden","loadingOption","step","renderValue","trackWidth","parentContainerClassName","focused","autoFocusSearch","onReset","onFocus","onBlur","isInputFocused","markInputFocused","unmarkInputFocused","useInputFocusOnOpen","prevIsOpen","prevChildren","fromChildrenRef","noAnimation","onCheck","classNames","badgeCount","isBadgeActive","previousActiveTab","tabRef","tabEl","prevTabEl","platformEl","prevPlatformEl","shiftLeft","offsetLeft","scaleFactor","clientWidth","forceReflow","SCROLL_DURATION","tabs","activeTab","big","onSwitchTab","useHorizontalScroll","activeTabElement","childNodes","activeTabOffsetLeft","activeTabOffsetWidth","newLeft","fastSmoothScrollHorizontal","tab","CLEANED_UP","Symbol","renderCount","shouldRestoreHeight","shouldCleanup","cleanupExceptionKey","onStart","onStop","currentKeyRef","rendersRef","prevActiveKey","activeKeyChanged","cleanup","childElements","transition","isBackwards","prevActiveIndex","activeIndex","toSlide","fromSlide","ANIMATION_LEVEL_MIN","dispatchHeavyAnimationStop","dispatchHeavyAnimationEvent","waitForTransitionEnd","clientHeight","performSlideOptimized","node","HTMLElement","onAnimationEnd","activeElement","watchedNode","firstChild","waitForAnimationEnd","flexBasis","renders","contents","render","INCLUDED_CHAT_TYPES","EXCLUDED_CHAT_TYPES","INCLUDE_FILTER_FIELDS","EXCLUDE_FILTER_FIELDS","selectChatFilters","state","mode","selectTemp","selectedChatIds","selectedChatTypes","includedChatIds","includeFilters","pick","folder","excludedChatIds","excludeFilters","getSuggestedFolderName","filters","bots","groups","channels","contacts","nonContacts","INITIAL_STATE","chatFilter","foldersReducer","omit","error","useReducer","trackId","originalDuration","trackType","handlers","metadata","onInit","onForcePlay","onTrackChange","noPlaylist","noProgressUpdates","controllerRef","setIsPlaying","isPlayingSync","setPlayProgress","register","eventName","setVolume","setPlaybackRate","toggleMuted","proxy","registerMediaSession","mediaHandlers","requestNextTrack","requestPreviousTrack","stop","closeAudioPlayer","seekbackward","skipTime","seekOffset","currentTime","seekforward","seekTo","seekTime","nexttrack","previoustrack","makeMediaHandlers","setPlaybackState","audioPlayer","volume","playbackRate","setPositionState","isFinite","paused","updateMetadata","destroy","isSafariPatchInProgress","useEffectWithPrevDeps","prevShouldPlay","prevSrc","playIfPresent","setTime","time","audioProxy","Map","blurredRef","img","Image","imgToCanvas","fastBlur","toDataURL","blurredAsync","onload","blurredDataUri","clear","useBlur","noInitiallyBuffered","setIsBuffered","setBufferedProgress","setIsBufferedDebounced","handleBuffering","media","buffered","end","readyState","onLoadedData","onPlaying","onLoadStart","onPause","onTimeUpdate","onProgress","useCanvasBlur","withRaf","processBlur","alpha","IS_CANVAS_FILTER_SUPPORTED","drawImage","RADIUS","isInSearch","toggleChatPinned","toggleChatArchived","toggleChatUnread","actionAddToFolder","actionPin","compact","actionUnreadMark","actionMute","actionArchive","isChatArchived","actionDelete","getCanDeleteChat","isInFolder","stopImmediatePropagation","isMenuDisabled","shouldDisableOnLink","shouldDisableOnLongTap","setIsContextMenuOpen","setContextMenuPosition","clientY","body","timer","clearLongPressTimer","startLongPressTimer","contains","originalEvent","touches","cancelClickOnce","emulateContextMenuEvent","passive","EMPTY_RECT","anchor","getLayout","setPositionX","setPositionY","withScroll","setWithScroll","setStyle","setMenuStyle","triggerEl","menuEl","rootEl","extraPaddingX","extraTopPadding","marginSides","extraMarginTop","marginTop","menuRect","offsetHeight","rootRect","horizontalPosition","triggerRect","menuMaxHeight","useDebounce","ms","noFirst","noLast","replyOriginForId","loadMessage","loadMessageThrottled","throttled","handleScroll","deltaX","deltaY","useIntersectionObserver","rootRef","throttleMs","debounceMs","shouldSkipFirst","margin","threshold","rootCallback","rootCallbackRef","freezeFlagsRef","onUnfreezeRef","freeze","unfreeze","useHeavyAnimationCheck","observer","disconnect","callbacks","observe","targetCallback","entriesAccumulator","observerCallbackSync","entries","entry","callback","scheduler","observerCallback","IntersectionObserver","root","rootMargin","initController","controller","delete","unobserve","useOnIntersect","targetRef","setIsIntersecting","savedCallback","setInterval","clearInterval","debugKey","prevDeps","isMediaReady","store","mediaHash","noLoad","mediaFormat","cacheBuster","isHtmlAllowed","isStreaming","IS_PROGRESSIVE_SUPPORTED","idRef","generateIdFor","useUniqueId","setLoadProgress","startedAtRef","handleProgress","Date","spentTime","closeTimeout","useMouseInside","menuCloseTimeout","isMouseInside","markMouseInside","usePrevDuringAnimation","prev","isCurrentPresent","isPrevPresent","reducer","initialState","reducerRef","setState","currentState","SEND_MESSAGE_ACTION_INTERVAL","useStateRef","useVideoCleanup","videoRef","videoEl","load","mul_table","shg_table","boxBlurCanvasRGB","context","top_x","top_y","isNaN","imageData","getImageData","pixels","rsum","gsum","bsum","p","p1","p2","yp","yi","yw","wm","hm","rad1","r","g","mul_sum","shg_sum","vmin","vmax","putImageData","tracks","currentTrackId","voiceQueue","musicQueue","playNext","isReverseOrder","currentTrack","nextTrackId","findNextInQueue","openAudioPlayer","parseMessageKey","splitTrackId","messageKey","nextTrack","stopCurrentAudio","track","handleEvent","Proxy","createAudio","trackIdComparator","addTrackToQueue","dataset","preventPlayAfterPatch","preload","IS_SAFARI","patchSafariProgressiveAudio","globalSearch","currentContent","GlobalSearchContent","openedChatId","queueFilter","cleanUpQueue","fastSeek","muted","rate","shouldRemoveFromQueue","h","trackIdFilter","el","removeFromQueue","currentId","queue","getTrackQueue","chatAudio","getMessageKey","split","pop","one","two","dateOne","keyOne","dateTwo","keyTwo","localeCompare","getDistance","a","sqrt","pageX","pageY","getTouchCenter","lastClickTime","captureEvent","initialSwipeAxis","hasMoved","hasSwiped","initialDistance","initialTouchCenter","innerWidth","innerHeight","excludedClosestSelector","onMove","onDoubleClick","centerX","centerY","withCursor","querySelectorAll","scrollable","overflow","onZoom","endDistance","touchCenter","dragOffsetX","dragOffsetY","zoomFactor","initialCenterX","initialCenterY","currentCenterX","currentCenterY","shouldPreventScroll","xAbs","yAbs","axis","currentSwipeAxis","Left","Right","Up","Down","processSwipe","isNotPassive","propertyName","waitForEndEvent","animationName","eventType","detailedName","isHandled","handleAnimationEnd","TransitionEvent","AnimationEvent","cycleRestrict","isAnimating","fastSmoothScroll","maxDistance","FAST_SMOOTH_MAX_DISTANCE","forceDirection","forceDuration","forceNormalContainerHeight","scrollFrom","offsetTop","elementTop","scrollTop","FocusDirection","calculateScrollFrom","scrollWithJs","isAnimatingScroll","elementHeight","currentScrollTop","containerHeight","targetContainerHeight","normalHeight","path","remainingPath","absPath","FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE","shortTransition","longTransition","FAST_SMOOTH_MIN_DURATION","FAST_SMOOTH_MAX_DURATION","startAt","onHeavyAnimationStop","animateSingle","t","currentPath","getAttribute","containerWidth","animate","force","range","createRange","lastChild","nodeValue","selectNodeContents","collapse","toLowerCase","DEFAULT_HANDLERS","mediaSession","navigator","setMediaSessionHandlers","console","warn","setActionHandler","err","clearMediaSession","playbackState","buildMediaMetadata","artist","album","artwork","MediaMetadata","ENTITY_CLASS_BY_NODE_NAME","S","STRIKE","PRE","BLOCKQUOTE","parseMessageInput","fragment","parsedHtml","parseMarkdown","textIndex","recursionDeepness","addEntity","nodeName","entityType","getEntityTypeFromNode","rawIndex","getEntityDataFromNode","hasChildNodes","audioEl","patchedForSafari","patchForSafariInProgress"],"sourceRoot":""}